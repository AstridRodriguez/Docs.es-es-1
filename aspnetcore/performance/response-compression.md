---
title: "Middleware de compresión de respuesta para ASP.NET Core"
author: guardrex
description: "Obtenga información acerca de la compresión de respuesta y cómo usar el Middleware de compresión de respuesta en aplicaciones de ASP.NET Core."
keywords: "Núcleo de ASP.NET, rendimiento, compresión de respuesta, gzip, codificación aceptada, middleware"
ms.author: riande
manager: wpickett
ms.date: 08/20/2017
ms.topic: article
ms.assetid: de621887-c5c9-4ac8-9efd-f5cc0457a134
ms.technology: aspnet
ms.prod: asp.net-core
uid: performance/response-compression
ms.openlocfilehash: 5705e9f879af4be3fe338716a4310bf9f0530039
ms.sourcegitcommit: 9cdbfd0d670d70b9c354216aabee260c52dad5ee
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/12/2017
---
# <a name="response-compression-middleware-for-aspnet-core"></a><span data-ttu-id="d8992-104">Middleware de compresión de respuesta para ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d8992-104">Response Compression Middleware for ASP.NET Core</span></span>

<span data-ttu-id="d8992-105">Por [Luke Latham](https://github.com/GuardRex)</span><span class="sxs-lookup"><span data-stu-id="d8992-105">By [Luke Latham](https://github.com/GuardRex)</span></span>

[<span data-ttu-id="d8992-106">Ver o descargar el código de ejemplo</span><span class="sxs-lookup"><span data-stu-id="d8992-106">View or download sample code</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/response-compression/samples)

<span data-ttu-id="d8992-107">Ancho de banda de red es un recurso limitado.</span><span class="sxs-lookup"><span data-stu-id="d8992-107">Network bandwidth is a limited resource.</span></span> <span data-ttu-id="d8992-108">Reducir el tamaño de la respuesta normalmente aumenta la capacidad de respuesta de una aplicación, a menudo drásticamente.</span><span class="sxs-lookup"><span data-stu-id="d8992-108">Reducing the size of the response usually increases the responsiveness of an app, often dramatically.</span></span> <span data-ttu-id="d8992-109">Una manera de reducir el tamaño de carga es comprimir las respuestas de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="d8992-109">One way to reduce payload sizes is to compress an app's responses.</span></span>

## <a name="when-to-use-response-compression-middleware"></a><span data-ttu-id="d8992-110">Cuándo utilizar Middleware de compresión de respuesta</span><span class="sxs-lookup"><span data-stu-id="d8992-110">When to use Response Compression Middleware</span></span>
<span data-ttu-id="d8992-111">Utilizar tecnologías de compresión de respuesta basada en servidor en IIS, Apache o Nginx donde el rendimiento del middleware de probablemente no coincide con el de los módulos del servidor.</span><span class="sxs-lookup"><span data-stu-id="d8992-111">Use server-based response compression technologies in IIS, Apache, or Nginx where the performance of the middleware probably won't match that of the server modules.</span></span> <span data-ttu-id="d8992-112">Utilice Middleware de compresión de respuesta cuando no puede volver a usar:</span><span class="sxs-lookup"><span data-stu-id="d8992-112">Use Response Compression Middleware when you're unable to use:</span></span>
* [<span data-ttu-id="d8992-113">Módulo de compresión dinámica de IIS</span><span class="sxs-lookup"><span data-stu-id="d8992-113">IIS Dynamic Compression module</span></span>](https://www.iis.net/overview/reliability/dynamiccachingandcompression)
* [<span data-ttu-id="d8992-114">Módulo de mod_deflate de Apache</span><span class="sxs-lookup"><span data-stu-id="d8992-114">Apache mod_deflate module</span></span>](http://httpd.apache.org/docs/current/mod/mod_deflate.html)
* [<span data-ttu-id="d8992-115">NGINX compresión y descompresión</span><span class="sxs-lookup"><span data-stu-id="d8992-115">NGINX Compression and Decompression</span></span>](https://www.nginx.com/resources/admin-guide/compression-and-decompression/)
* <span data-ttu-id="d8992-116">[Servidor HTTP.sys](xref:fundamentals/servers/httpsys) (anteriormente denominados [WebListener](xref:fundamentals/servers/weblistener))</span><span class="sxs-lookup"><span data-stu-id="d8992-116">[HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called [WebListener](xref:fundamentals/servers/weblistener))</span></span>
* [<span data-ttu-id="d8992-117">Kestrel</span><span class="sxs-lookup"><span data-stu-id="d8992-117">Kestrel</span></span>](xref:fundamentals/servers/kestrel)

## <a name="response-compression"></a><span data-ttu-id="d8992-118">Compresión de respuesta</span><span class="sxs-lookup"><span data-stu-id="d8992-118">Response compression</span></span>
<span data-ttu-id="d8992-119">Por lo general, cualquier respuesta que comprimen de forma nativa puede beneficiarse de compresión de respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-119">Usually, any response not natively compressed can benefit from response compression.</span></span> <span data-ttu-id="d8992-120">Respuestas de forma no nativa comprimidas normalmente son: CSS, JavaScript, HTML, XML y JSON.</span><span class="sxs-lookup"><span data-stu-id="d8992-120">Responses not natively compressed typically include: CSS, JavaScript, HTML, XML, and JSON.</span></span> <span data-ttu-id="d8992-121">No debe comprimir activos comprimidos de forma nativa, como archivos PNG.</span><span class="sxs-lookup"><span data-stu-id="d8992-121">You shouldn't compress natively compressed assets, such as PNG files.</span></span> <span data-ttu-id="d8992-122">Si se intentan volver a comprimir aún más una respuesta cifrada de forma nativa, cualquier pequeña reducción adicional en tiempo de tamaño y la transmisión probablemente resultar mínimo comparado con el tiempo que tardó en procesarse la compresión.</span><span class="sxs-lookup"><span data-stu-id="d8992-122">If you attempt to further compress a natively compressed response, any small additional reduction in size and transmission time will likely be overshadowed by the time it took to process the compression.</span></span> <span data-ttu-id="d8992-123">No comprimir los archivos de menos de aproximadamente 150-1000 bytes (según el contenido del archivo y la eficacia de compresión).</span><span class="sxs-lookup"><span data-stu-id="d8992-123">Don't compress files smaller than about 150-1000 bytes (depending on the file's content and the efficiency of compression).</span></span> <span data-ttu-id="d8992-124">La sobrecarga de la compresión de archivos pequeños puede generar un archivo comprimido mayor que el archivo sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="d8992-124">The overhead of compressing small files may produce a compressed file larger than the uncompressed file.</span></span>

<span data-ttu-id="d8992-125">Cuando un cliente puede procesar contenido comprimido, el cliente debe informar al servidor de sus capacidades mediante el envío de la `Accept-Encoding` encabezado con la solicitud.</span><span class="sxs-lookup"><span data-stu-id="d8992-125">When a client can process compressed content, the client must inform the server of its capabilities by sending the `Accept-Encoding` header with the request.</span></span> <span data-ttu-id="d8992-126">Cuando un servidor envía contenido comprimido, debe incluir información de la `Content-Encoding` encabezado en cómo se codifican las respuestas comprimidas.</span><span class="sxs-lookup"><span data-stu-id="d8992-126">When a server sends compressed content, it must include information in the `Content-Encoding` header on how the compressed response is encoded.</span></span> <span data-ttu-id="d8992-127">Contenido designaciones de codificación admitidas por el middleware se muestran en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="d8992-127">Content encoding designations supported by the middleware are shown in the following table.</span></span>

| <span data-ttu-id="d8992-128">`Accept-Encoding`valores de encabezado</span><span class="sxs-lookup"><span data-stu-id="d8992-128">`Accept-Encoding` header values</span></span> | <span data-ttu-id="d8992-129">Software intermedio compatible</span><span class="sxs-lookup"><span data-stu-id="d8992-129">Middleware Supported</span></span> | <span data-ttu-id="d8992-130">Descripción</span><span class="sxs-lookup"><span data-stu-id="d8992-130">Description</span></span>                                                 |
| :-----------------------------: | :------------------: | ----------------------------------------------------------- |
| `br`                            | <span data-ttu-id="d8992-131">No</span><span class="sxs-lookup"><span data-stu-id="d8992-131">No</span></span>                   | <span data-ttu-id="d8992-132">Formato de los datos comprimidos de Brotli</span><span class="sxs-lookup"><span data-stu-id="d8992-132">Brotli Compressed Data Format</span></span>                               |
| `compress`                      | <span data-ttu-id="d8992-133">No</span><span class="sxs-lookup"><span data-stu-id="d8992-133">No</span></span>                   | <span data-ttu-id="d8992-134">Formato de datos de "comprimir" de UNIX</span><span class="sxs-lookup"><span data-stu-id="d8992-134">UNIX "compress" data format</span></span>                                 |
| `deflate`                       | <span data-ttu-id="d8992-135">No</span><span class="sxs-lookup"><span data-stu-id="d8992-135">No</span></span>                   | <span data-ttu-id="d8992-136">"deflate" datos comprimidos en el formato de datos de "zlib"</span><span class="sxs-lookup"><span data-stu-id="d8992-136">"deflate" compressed data inside the "zlib" data format</span></span>     |
| `exi`                           | <span data-ttu-id="d8992-137">No</span><span class="sxs-lookup"><span data-stu-id="d8992-137">No</span></span>                   | <span data-ttu-id="d8992-138">Intercambio eficaz de XML de W3C</span><span class="sxs-lookup"><span data-stu-id="d8992-138">W3C Efficient XML Interchange</span></span>                               |
| `gzip`                          | <span data-ttu-id="d8992-139">Sí (valor predeterminado)</span><span class="sxs-lookup"><span data-stu-id="d8992-139">Yes (default)</span></span>        | <span data-ttu-id="d8992-140">formato de archivo GZIP</span><span class="sxs-lookup"><span data-stu-id="d8992-140">gzip file format</span></span>                                            |
| `identity`                      | <span data-ttu-id="d8992-141">Sí</span><span class="sxs-lookup"><span data-stu-id="d8992-141">Yes</span></span>                  | <span data-ttu-id="d8992-142">Identificador de "Sin codificación": no se debe codificar la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-142">"No encoding" identifier: The response must not be encoded.</span></span> |
| `pack200-gzip`                  | <span data-ttu-id="d8992-143">No</span><span class="sxs-lookup"><span data-stu-id="d8992-143">No</span></span>                   | <span data-ttu-id="d8992-144">Formato de transferencia de red para archivos de Java</span><span class="sxs-lookup"><span data-stu-id="d8992-144">Network Transfer Format for Java Archives</span></span>                   |
| `*`                             | <span data-ttu-id="d8992-145">Sí</span><span class="sxs-lookup"><span data-stu-id="d8992-145">Yes</span></span>                  | <span data-ttu-id="d8992-146">Cualquier contenido disponible no codificación explícitamente solicitada</span><span class="sxs-lookup"><span data-stu-id="d8992-146">Any available content encoding not explicitly requested</span></span>     |

<span data-ttu-id="d8992-147">Para obtener más información, consulte el [lista de codificación oficial contenido de IANA](http://www.iana.org/assignments/http-parameters/http-parameters.xml#http-content-coding-registry).</span><span class="sxs-lookup"><span data-stu-id="d8992-147">For more information, see the [IANA Official Content Coding List](http://www.iana.org/assignments/http-parameters/http-parameters.xml#http-content-coding-registry).</span></span>

<span data-ttu-id="d8992-148">El middleware le permite agregar proveedores de compresión adicional para personalizado `Accept-Encoding` valores de encabezado.</span><span class="sxs-lookup"><span data-stu-id="d8992-148">The middleware allows you to add additional compression providers for custom `Accept-Encoding` header values.</span></span> <span data-ttu-id="d8992-149">Para obtener más información, consulte [proveedores personalizados](#custom-providers) a continuación.</span><span class="sxs-lookup"><span data-stu-id="d8992-149">For more information, see [Custom Providers](#custom-providers) below.</span></span>

<span data-ttu-id="d8992-150">El software intermedio es capaz de reaccionar ante el valor de calidad (qvalue, `q`) ponderación cuando enviada por el cliente para dar prioridad a los esquemas de compresión.</span><span class="sxs-lookup"><span data-stu-id="d8992-150">The middleware is capable of reacting to quality value (qvalue, `q`) weighting when sent by the client to prioritize compression schemes.</span></span> <span data-ttu-id="d8992-151">Para obtener más información, consulte [RFC 7231: codificación aceptada](https://tools.ietf.org/html/rfc7231#section-5.3.4).</span><span class="sxs-lookup"><span data-stu-id="d8992-151">For more information, see [RFC 7231: Accept-Encoding](https://tools.ietf.org/html/rfc7231#section-5.3.4).</span></span>

<span data-ttu-id="d8992-152">Algoritmos de compresión se están sujetas a un equilibrio entre la velocidad de compresión y la eficacia de la compresión.</span><span class="sxs-lookup"><span data-stu-id="d8992-152">Compression algorithms are subject to a tradeoff between compression speed and the effectiveness of the compression.</span></span> <span data-ttu-id="d8992-153">*Eficacia* en este contexto hace referencia al tamaño de la salida después de la compresión.</span><span class="sxs-lookup"><span data-stu-id="d8992-153">*Effectiveness* in this context refers to the size of the output after compression.</span></span> <span data-ttu-id="d8992-154">El tamaño más pequeño se logra mediante la mayoría *óptimo* compresión.</span><span class="sxs-lookup"><span data-stu-id="d8992-154">The smallest size is achieved by the most *optimal* compression.</span></span>

<span data-ttu-id="d8992-155">Los encabezados implicados en la solicitud, enviar, almacenamiento en caché y recibir contenido comprimido se describen en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="d8992-155">The headers involved in requesting, sending, caching, and receiving compressed content are described in the table below.</span></span>

| <span data-ttu-id="d8992-156">Header</span><span class="sxs-lookup"><span data-stu-id="d8992-156">Header</span></span>             | <span data-ttu-id="d8992-157">Rol</span><span class="sxs-lookup"><span data-stu-id="d8992-157">Role</span></span> |
| ------------------ | ---- |
| `Accept-Encoding`  | <span data-ttu-id="d8992-158">Envía desde el cliente al servidor para indicar el contenido aceptable para el cliente de esquemas de codificación.</span><span class="sxs-lookup"><span data-stu-id="d8992-158">Sent from the client to the server to indicate the content encoding schemes acceptable to the client.</span></span> |
| `Content-Encoding` | <span data-ttu-id="d8992-159">Envía desde el servidor al cliente para indicar la codificación del contenido de la carga.</span><span class="sxs-lookup"><span data-stu-id="d8992-159">Sent from the server to the client to indicate the encoding of the content in the payload.</span></span> |
| `Content-Length`   | <span data-ttu-id="d8992-160">Cuando se produce la compresión, el `Content-Length` se quita el encabezado, desde los cambios de contenido del cuerpo cuando se comprime la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-160">When compression occurs, the `Content-Length` header is removed, since the body content changes when the response is compressed.</span></span> |
| `Content-MD5`      | <span data-ttu-id="d8992-161">Cuando se produce la compresión, el `Content-MD5` se quita el encabezado, puesto que ha cambiado el contenido del cuerpo y el hash ya no es válido.</span><span class="sxs-lookup"><span data-stu-id="d8992-161">When compression occurs, the `Content-MD5` header is removed, since the body content has changed and the hash is no longer valid.</span></span> |
| `Content-Type`     | <span data-ttu-id="d8992-162">Especifica el tipo MIME del contenido.</span><span class="sxs-lookup"><span data-stu-id="d8992-162">Specifies the MIME type of the content.</span></span> <span data-ttu-id="d8992-163">Debe especificar cada respuesta su `Content-Type`.</span><span class="sxs-lookup"><span data-stu-id="d8992-163">Every response should specify its `Content-Type`.</span></span> <span data-ttu-id="d8992-164">El middleware comprueba este valor para determinar si se debe comprimir la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-164">The middleware checks this value to determine if the response should be compressed.</span></span> <span data-ttu-id="d8992-165">El middleware especifica un conjunto de [predeterminado tipos MIME](#mime-types) que puede codificar, pero puede reemplazar o agregar un tipo MIME.</span><span class="sxs-lookup"><span data-stu-id="d8992-165">The middleware specifies a set of [default MIME types](#mime-types) that it can encode, but you can replace or add MIME types.</span></span> |
| `Vary`             | <span data-ttu-id="d8992-166">Cuando envía el servidor con un valor de `Accept-Encoding` a los clientes y servidores proxy, la `Vary` encabezado indica al cliente o proxy que debe almacenar en caché (varían) las respuestas en función del valor de la `Accept-Encoding` encabezado de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="d8992-166">When sent by the server with a value of `Accept-Encoding` to clients and proxies, the `Vary` header indicates to the client or proxy that it should cache (vary) responses based on the value of the `Accept-Encoding` header of the request.</span></span> <span data-ttu-id="d8992-167">El resultado de la devolución del contenido con el `Vary: Accept-Encoding` encabezado es que ambos comprimen y sin comprimir las respuestas se almacenan en caché por separado.</span><span class="sxs-lookup"><span data-stu-id="d8992-167">The result of returning content with the `Vary: Accept-Encoding` header is that both compressed and uncompressed responses are cached separately.</span></span> |

<span data-ttu-id="d8992-168">Puede explorar las características del Middleware de compresión de respuesta con el [aplicación de ejemplo](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/response-compression/samples).</span><span class="sxs-lookup"><span data-stu-id="d8992-168">You can explore the features of the Response Compression Middleware with the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/response-compression/samples).</span></span> <span data-ttu-id="d8992-169">El ejemplo muestra:</span><span class="sxs-lookup"><span data-stu-id="d8992-169">The sample illustrates:</span></span>
* <span data-ttu-id="d8992-170">La compresión de las respuestas de aplicación mediante gzip y proveedores de compresión personalizada.</span><span class="sxs-lookup"><span data-stu-id="d8992-170">The compression of app responses using gzip and custom compression providers.</span></span>
* <span data-ttu-id="d8992-171">Cómo agregar un tipo MIME a la lista predeterminada de tipos MIME para la compresión.</span><span class="sxs-lookup"><span data-stu-id="d8992-171">How to add a MIME type to the default list of MIME types for compression.</span></span>

## <a name="package"></a><span data-ttu-id="d8992-172">Package</span><span class="sxs-lookup"><span data-stu-id="d8992-172">Package</span></span>
<span data-ttu-id="d8992-173">Para incluir el software intermedio en el proyecto, agregue una referencia a la [ `Microsoft.AspNetCore.ResponseCompression` ](https://www.nuget.org/packages/Microsoft.AspNetCore.ResponseCompression/) empaquetar o usar el [ `Microsoft.AspNetCore.All` ](https://www.nuget.org/packages/Microsoft.AspNetCore.All/) paquete.</span><span class="sxs-lookup"><span data-stu-id="d8992-173">To include the middleware in your project, add a reference to the [`Microsoft.AspNetCore.ResponseCompression`](https://www.nuget.org/packages/Microsoft.AspNetCore.ResponseCompression/) package or use the [`Microsoft.AspNetCore.All`](https://www.nuget.org/packages/Microsoft.AspNetCore.All/) package.</span></span> <span data-ttu-id="d8992-174">Esta característica está disponible para las aplicaciones que tienen como destino ASP.NET Core 1.1 o posterior.</span><span class="sxs-lookup"><span data-stu-id="d8992-174">This feature is available for apps that target ASP.NET Core 1.1 or later.</span></span>

## <a name="configuration"></a><span data-ttu-id="d8992-175">Configuración</span><span class="sxs-lookup"><span data-stu-id="d8992-175">Configuration</span></span>
<span data-ttu-id="d8992-176">El código siguiente muestra cómo habilitar el Middleware de compresión de respuesta con el con la compresión de gzip predeterminada y para los tipos MIME predeterminado.</span><span class="sxs-lookup"><span data-stu-id="d8992-176">The following code shows how to enable the Response Compression Middleware with the with the default gzip compression and for default MIME types.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d8992-177">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d8992-177">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d8992-178">[!code-csharp[Main](response-compression/samples/2.x/StartupBasic.cs?name=snippet1&highlight=4,8)]</span><span class="sxs-lookup"><span data-stu-id="d8992-178">[!code-csharp[Main](response-compression/samples/2.x/StartupBasic.cs?name=snippet1&highlight=4,8)]</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d8992-179">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d8992-179">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d8992-180">[!code-csharp[Main](response-compression/samples/1.x/StartupBasic.cs?name=snippet1&highlight=3,8)]</span><span class="sxs-lookup"><span data-stu-id="d8992-180">[!code-csharp[Main](response-compression/samples/1.x/StartupBasic.cs?name=snippet1&highlight=3,8)]</span></span>

---

> [!NOTE]
> <span data-ttu-id="d8992-181">Utilice una herramienta como [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), o [Postman](https://www.getpostman.com/) para establecer el `Accept-Encoding` encabezado de solicitud y estudiar los encabezados de respuesta, el tamaño y el cuerpo.</span><span class="sxs-lookup"><span data-stu-id="d8992-181">Use a tool like [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), or [Postman](https://www.getpostman.com/) to set the `Accept-Encoding` request header and study the response headers, size, and body.</span></span>

<span data-ttu-id="d8992-182">Enviar una solicitud a la aplicación de ejemplo sin la `Accept-Encoding` encabezado y observe que la respuesta es sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="d8992-182">Submit a request to the sample app without the `Accept-Encoding` header and observe that the response is uncompressed.</span></span> <span data-ttu-id="d8992-183">El `Content-Encoding` y `Vary` encabezados no están presentes en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-183">The `Content-Encoding` and `Vary` headers aren't present on the response.</span></span>

![Ventana de Fiddler que muestra el resultado de una solicitud sin el encabezado Accept-Encoding.](response-compression/_static/request-uncompressed.png)

<span data-ttu-id="d8992-186">Enviar una solicitud a la aplicación de ejemplo con el `Accept-Encoding: gzip` encabezado y observe que la respuesta está comprimida.</span><span class="sxs-lookup"><span data-stu-id="d8992-186">Submit a request to the sample app with the `Accept-Encoding: gzip` header and observe that the response is compressed.</span></span> <span data-ttu-id="d8992-187">El `Content-Encoding` y `Vary` encabezados están presentes en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-187">The `Content-Encoding` and `Vary` headers are present on the response.</span></span>

![Ventana de Fiddler Mostrar resultado de una solicitud con el encabezado Accept-Encoding y un valor de gzip.](response-compression/_static/request-compressed.png)

## <a name="providers"></a><span data-ttu-id="d8992-191">Proveedores</span><span class="sxs-lookup"><span data-stu-id="d8992-191">Providers</span></span>
### <a name="gzipcompressionprovider"></a><span data-ttu-id="d8992-192">GzipCompressionProvider</span><span class="sxs-lookup"><span data-stu-id="d8992-192">GzipCompressionProvider</span></span>
<span data-ttu-id="d8992-193">Use la `GzipCompressionProvider` para comprimir las respuestas con gzip.</span><span class="sxs-lookup"><span data-stu-id="d8992-193">Use the `GzipCompressionProvider` to compress responses with gzip.</span></span> <span data-ttu-id="d8992-194">Esto es el proveedor de compresión predeterminado si no se especifica ninguno.</span><span class="sxs-lookup"><span data-stu-id="d8992-194">This is the default compression provider if none are specified.</span></span> <span data-ttu-id="d8992-195">Puede establecer la compresión de nivel con el `GzipCompressionProviderOptions`.</span><span class="sxs-lookup"><span data-stu-id="d8992-195">You can set the compression level with the `GzipCompressionProviderOptions`.</span></span> 

<span data-ttu-id="d8992-196">El proveedor de compresión gzip usa de forma predeterminada el nivel de compresión más rápido (`CompressionLevel.Fastest`), que no puede producir la compresión más eficaz.</span><span class="sxs-lookup"><span data-stu-id="d8992-196">The gzip compression provider defaults to the fastest compression level (`CompressionLevel.Fastest`), which might not produce the most efficient compression.</span></span> <span data-ttu-id="d8992-197">Si se desea la compresión más eficaz, puede configurar el middleware de compresión óptima.</span><span class="sxs-lookup"><span data-stu-id="d8992-197">If the most efficient compression is desired, you can configure the middleware for optimal compression.</span></span>

| <span data-ttu-id="d8992-198">Nivel de compresión</span><span class="sxs-lookup"><span data-stu-id="d8992-198">Compression Level</span></span>                | <span data-ttu-id="d8992-199">Descripción</span><span class="sxs-lookup"><span data-stu-id="d8992-199">Description</span></span>                                                                                                   |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| `CompressionLevel.Fastest`       | <span data-ttu-id="d8992-200">Compresión debe completarse tan pronto como sea posible, incluso si el resultado no se comprime un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="d8992-200">Compression should complete as quickly as possible, even if the resulting output is not optimally compressed.</span></span> |
| `CompressionLevel.NoCompression` | <span data-ttu-id="d8992-201">Es necesario realizar ninguna compresión.</span><span class="sxs-lookup"><span data-stu-id="d8992-201">No compression should be performed.</span></span>                                                                           |
| `CompressionLevel.Optimal`       | <span data-ttu-id="d8992-202">Las respuestas se deben comprimir un rendimiento óptimo, incluso si la compresión tarda más tiempo en completarse.</span><span class="sxs-lookup"><span data-stu-id="d8992-202">Responses should be optimally compressed, even if the compression takes more time to complete.</span></span>                |


# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d8992-203">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d8992-203">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d8992-204">[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=3,8-11)]</span><span class="sxs-lookup"><span data-stu-id="d8992-204">[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=3,8-11)]</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d8992-205">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d8992-205">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d8992-206">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=5,10-13)]</span><span class="sxs-lookup"><span data-stu-id="d8992-206">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=5,10-13)]</span></span>

---

## <a name="mime-types"></a><span data-ttu-id="d8992-207">tipos MIME</span><span class="sxs-lookup"><span data-stu-id="d8992-207">MIME types</span></span>
<span data-ttu-id="d8992-208">El middleware especifica un conjunto predeterminado de tipos MIME para la compresión:</span><span class="sxs-lookup"><span data-stu-id="d8992-208">The middleware specifies a default set of MIME types for compression:</span></span>
* `text/plain`
* `text/css`
* `application/javascript`
* `text/html`
* `application/xml`
* `text/xml`
* `application/json`
* `text/json`

<span data-ttu-id="d8992-209">Puede reemplazar o anexar los tipos MIME con las opciones de Middleware de compresión de respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-209">You can replace or append MIME types with the Response Compression Middleware options.</span></span> <span data-ttu-id="d8992-210">Tenga en cuenta que MIME de comodines tipos, como `text/*` no son compatibles.</span><span class="sxs-lookup"><span data-stu-id="d8992-210">Note that wildcard MIME types, such as `text/*` aren't supported.</span></span> <span data-ttu-id="d8992-211">La aplicación de ejemplo agrega un tipo MIME para `image/svg+xml` y comprime y sirve de imagen de titular de ASP.NET Core (*banner.svg*).</span><span class="sxs-lookup"><span data-stu-id="d8992-211">The sample app adds a MIME type for `image/svg+xml` and compresses and serves the ASP.NET Core banner image (*banner.svg*).</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d8992-212">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d8992-212">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d8992-213">[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=5)]</span><span class="sxs-lookup"><span data-stu-id="d8992-213">[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=5)]</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d8992-214">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d8992-214">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d8992-215">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=7)]</span><span class="sxs-lookup"><span data-stu-id="d8992-215">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=7)]</span></span>

---

### <a name="custom-providers"></a><span data-ttu-id="d8992-216">Proveedores personalizados</span><span class="sxs-lookup"><span data-stu-id="d8992-216">Custom providers</span></span>
<span data-ttu-id="d8992-217">Puede crear implementaciones de compresión personalizada con `ICompressionProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8992-217">You can create custom compression implementations with `ICompressionProvider`.</span></span> <span data-ttu-id="d8992-218">El `EncodingName` representa la codificación que el control de contenido `ICompressionProvider` genera.</span><span class="sxs-lookup"><span data-stu-id="d8992-218">The `EncodingName` represents the content encoding that this `ICompressionProvider` produces.</span></span> <span data-ttu-id="d8992-219">El middleware que usa esta información para elegir el proveedor basándose en la lista especificada en el `Accept-Encoding` encabezado de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="d8992-219">The middleware uses this information to choose the provider based on the list specified in the `Accept-Encoding` header of the request.</span></span>

<span data-ttu-id="d8992-220">Mediante la aplicación de ejemplo, el cliente envía una solicitud con el `Accept-Encoding: mycustomcompression` encabezado.</span><span class="sxs-lookup"><span data-stu-id="d8992-220">Using the sample app, the client submits a request with the `Accept-Encoding: mycustomcompression` header.</span></span> <span data-ttu-id="d8992-221">El software intermedio utiliza la implementación de compresión personalizada y devuelve la respuesta con un `Content-Encoding: mycustomcompression` encabezado.</span><span class="sxs-lookup"><span data-stu-id="d8992-221">The middleware uses the custom compression implementation and returns the response with a `Content-Encoding: mycustomcompression` header.</span></span> <span data-ttu-id="d8992-222">El cliente debe poder descomprimir la codificación personalizada en orden para una implementación de la compresión personalizado para que funcione.</span><span class="sxs-lookup"><span data-stu-id="d8992-222">The client must be able to decompress the custom encoding in order for a custom compression implementation to work.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d8992-223">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d8992-223">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d8992-224">[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=4)]</span><span class="sxs-lookup"><span data-stu-id="d8992-224">[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=4)]</span></span>

<span data-ttu-id="d8992-225">[!code-csharp[Main](response-compression/samples/2.x/CustomCompressionProvider.cs?name=snippet1)]</span><span class="sxs-lookup"><span data-stu-id="d8992-225">[!code-csharp[Main](response-compression/samples/2.x/CustomCompressionProvider.cs?name=snippet1)]</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d8992-226">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d8992-226">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d8992-227">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=6)]</span><span class="sxs-lookup"><span data-stu-id="d8992-227">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=6)]</span></span>

<span data-ttu-id="d8992-228">[!code-csharp[Main](response-compression/samples/1.x/CustomCompressionProvider.cs?name=snippet1)]</span><span class="sxs-lookup"><span data-stu-id="d8992-228">[!code-csharp[Main](response-compression/samples/1.x/CustomCompressionProvider.cs?name=snippet1)]</span></span>

---

<span data-ttu-id="d8992-229">Enviar una solicitud a la aplicación de ejemplo con el `Accept-Encoding: mycustomcompression` encabezado y observe los encabezados de respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-229">Submit a request to the sample app with the `Accept-Encoding: mycustomcompression` header and observe the response headers.</span></span> <span data-ttu-id="d8992-230">El `Vary` y `Content-Encoding` encabezados están presentes en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-230">The `Vary` and `Content-Encoding` headers are present on the response.</span></span> <span data-ttu-id="d8992-231">El cuerpo de respuesta (no mostrado) no está comprimido en el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d8992-231">The response body (not shown) isn't compressed by the sample.</span></span> <span data-ttu-id="d8992-232">No hay una implementación de la compresión en el `CustomCompressionProvider` clase del ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d8992-232">There isn't a compression implementation in the `CustomCompressionProvider` class of the sample.</span></span> <span data-ttu-id="d8992-233">Sin embargo, en el ejemplo se muestra donde se implementa un algoritmo de compresión de este tipo.</span><span class="sxs-lookup"><span data-stu-id="d8992-233">However, the sample shows where you would implement such a compression algorithm.</span></span>

![Ventana de Fiddler Mostrar resultado de una solicitud con el encabezado Accept-Encoding y un valor de mycustomcompression.](response-compression/_static/request-custom-compression.png)

## <a name="compression-with-secure-protocol"></a><span data-ttu-id="d8992-236">Compresión con protocolo seguro</span><span class="sxs-lookup"><span data-stu-id="d8992-236">Compression with secure protocol</span></span>
<span data-ttu-id="d8992-237">Las respuestas comprimidas a través de conexiones seguras pueden controlarse con el `EnableForHttps` opción, que está deshabilitada de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="d8992-237">Compressed responses over secure connections can be controlled with the `EnableForHttps` option, which is disabled by default.</span></span> <span data-ttu-id="d8992-238">Utilice la compresión con páginas generadas dinámicamente puede provocar problemas de seguridad como la [CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) y [infracción](https://wikipedia.org/wiki/BREACH_(security_exploit)) ataques.</span><span class="sxs-lookup"><span data-stu-id="d8992-238">Using compression with dynamically generated pages can lead to security problems such as the [CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) and [BREACH](https://wikipedia.org/wiki/BREACH_(security_exploit)) attacks.</span></span>

## <a name="adding-the-vary-header"></a><span data-ttu-id="d8992-239">Agregar el encabezado Vary</span><span class="sxs-lookup"><span data-stu-id="d8992-239">Adding the Vary header</span></span>
<span data-ttu-id="d8992-240">Al comprimir las respuestas según el `Accept-Encoding` encabezado, hay potencialmente varias versiones comprimidas de la respuesta y una versión sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="d8992-240">When compressing responses based on the `Accept-Encoding` header, there are potentially multiple compressed versions of the response and an uncompressed version.</span></span> <span data-ttu-id="d8992-241">Para indicar a las memorias caché de cliente y servidor proxy que existen varias versiones y deben almacenarse el `Vary` encabezado se agrega con un `Accept-Encoding` valor.</span><span class="sxs-lookup"><span data-stu-id="d8992-241">In order to instruct client and proxy caches that multiple versions exist and should be stored, the `Vary` header is added with an `Accept-Encoding` value.</span></span> <span data-ttu-id="d8992-242">En ASP.NET Core 1.x, agregar el `Vary` encabezado en la respuesta se realiza manualmente.</span><span class="sxs-lookup"><span data-stu-id="d8992-242">In ASP.NET Core 1.x, adding the `Vary` header to the response is accomplished manually.</span></span> <span data-ttu-id="d8992-243">En ASP.NET Core 2.x, el middleware agrega el `Vary` encabezado automáticamente cuando se comprime la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-243">In ASP.NET Core 2.x, the middleware adds the `Vary` header automatically when the response is compressed.</span></span>

<span data-ttu-id="d8992-244">**ASP.NET Core solo 1.x**</span><span class="sxs-lookup"><span data-stu-id="d8992-244">**ASP.NET Core 1.x only**</span></span>

<span data-ttu-id="d8992-245">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet1)]</span><span class="sxs-lookup"><span data-stu-id="d8992-245">[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet1)]</span></span>

## <a name="middlware-issue-when-behind-an-nginx-reverse-proxy"></a><span data-ttu-id="d8992-246">Problema de Middlware al estar detrás de un proxy inverso Nginx</span><span class="sxs-lookup"><span data-stu-id="d8992-246">Middlware issue when behind an Nginx reverse-proxy</span></span>
<span data-ttu-id="d8992-247">Una vez procesada por Nginx, una solicitud de la `Accept-Encoding` se quita el encabezado.</span><span class="sxs-lookup"><span data-stu-id="d8992-247">When a request is proxied by Nginx, the `Accept-Encoding` header is removed.</span></span> <span data-ttu-id="d8992-248">Esto evita que el middleware de la compresión de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-248">This prevents the middleware from compressing the response.</span></span> <span data-ttu-id="d8992-249">Para obtener más información, consulte [NGINX: compresión y descompresión](https://www.nginx.com/resources/admin-guide/compression-and-decompression/).</span><span class="sxs-lookup"><span data-stu-id="d8992-249">For more information, see [NGINX: Compression and Decompression](https://www.nginx.com/resources/admin-guide/compression-and-decompression/).</span></span> <span data-ttu-id="d8992-250">Este problema se realiza un seguimiento por [averiguar compresión de paso a través de nginx (BasicMiddleware n.º 123)](https://github.com/aspnet/BasicMiddleware/issues/123).</span><span class="sxs-lookup"><span data-stu-id="d8992-250">This issue is tracked by [Figure out pass-through compression for nginx (BasicMiddleware #123)](https://github.com/aspnet/BasicMiddleware/issues/123).</span></span>

## <a name="working-with-iis-dynamic-compression"></a><span data-ttu-id="d8992-251">Trabajar con la compresión dinámica de IIS</span><span class="sxs-lookup"><span data-stu-id="d8992-251">Working with IIS dynamic compression</span></span>
<span data-ttu-id="d8992-252">Si tiene un módulo de compresión dinámica de IIS activo configurado en el nivel de servidor que desea deshabilitar para una aplicación, puede hacerlo con un complemento de la *web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="d8992-252">If you have an active IIS Dynamic Compression Module configured at the server level that you would like to disable for an app, you can do so with an addition to your *web.config* file.</span></span> <span data-ttu-id="d8992-253">Para obtener más información, consulte [módulos IIS deshabilitar](xref:hosting/iis-modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="d8992-253">For more information, see [Disabling IIS modules](xref:hosting/iis-modules#disabling-iis-modules).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="d8992-254">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="d8992-254">Troubleshooting</span></span>
<span data-ttu-id="d8992-255">Utilice una herramienta como [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), o [Postman](https://www.getpostman.com/), que permite establecer el `Accept-Encoding` encabezado de solicitud y estudiar los encabezados de respuesta, el tamaño y el cuerpo.</span><span class="sxs-lookup"><span data-stu-id="d8992-255">Use a tool like [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), or [Postman](https://www.getpostman.com/), which allow you to set the `Accept-Encoding` request header and study the response headers, size, and body.</span></span> <span data-ttu-id="d8992-256">El Middleware de compresión de respuesta comprime las respuestas que cumplen las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="d8992-256">The Response Compression Middleware compresses responses that meet the following conditions:</span></span>
* <span data-ttu-id="d8992-257">El `Accept-Encoding` encabezado está presente con un valor de `gzip`, `*`, o codificación personalizada que coincida con un proveedor de compresión personalizada que ha establecido.</span><span class="sxs-lookup"><span data-stu-id="d8992-257">The `Accept-Encoding` header is present with a value of `gzip`, `*`, or custom encoding that matches a custom compression provider that you've established.</span></span> <span data-ttu-id="d8992-258">El valor no debe ser `identity` o tener un valor de calidad (qvalue, `q`) de 0 (cero).</span><span class="sxs-lookup"><span data-stu-id="d8992-258">The value must not be `identity` or have a quality value (qvalue, `q`) setting of 0 (zero).</span></span>
* <span data-ttu-id="d8992-259">El tipo MIME (`Content-Type`) debe establecerse y debe coincidir con un tipo MIME configurado en el `ResponseCompressionOptions`.</span><span class="sxs-lookup"><span data-stu-id="d8992-259">The MIME type (`Content-Type`) must be set and must match a MIME type configured on the `ResponseCompressionOptions`.</span></span>
* <span data-ttu-id="d8992-260">La solicitud no debe incluir el `Content-Range` encabezado.</span><span class="sxs-lookup"><span data-stu-id="d8992-260">The request must not include the `Content-Range` header.</span></span>
* <span data-ttu-id="d8992-261">La solicitud debe utilizar inseguro protocolo (http), a menos que el protocolo seguro (https) se configura en las opciones de Middleware de compresión de respuesta.</span><span class="sxs-lookup"><span data-stu-id="d8992-261">The request must use insecure protocol (http), unless secure protocol (https) is configured in the Response Compression Middleware options.</span></span> <span data-ttu-id="d8992-262">*Tenga en cuenta el peligro [se ha descrito anteriormente](#compression-with-secure-protocol) al habilitar la compresión de contenido segura.*</span><span class="sxs-lookup"><span data-stu-id="d8992-262">*Note the danger [described above](#compression-with-secure-protocol) when enabling secure content compression.*</span></span>

## <a name="additional-resources"></a><span data-ttu-id="d8992-263">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="d8992-263">Additional resources</span></span>
* [<span data-ttu-id="d8992-264">Inicio de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="d8992-264">Application Startup</span></span>](xref:fundamentals/startup)
* [<span data-ttu-id="d8992-265">Software intermedio</span><span class="sxs-lookup"><span data-stu-id="d8992-265">Middleware</span></span>](xref:fundamentals/middleware)
* [<span data-ttu-id="d8992-266">Red de desarrollador de Mozilla: Codificación aceptada</span><span class="sxs-lookup"><span data-stu-id="d8992-266">Mozilla Developer Network: Accept-Encoding</span></span>](https://developer.mozilla.org/docs/Web/HTTP/Headers/Accept-Encoding)
* [<span data-ttu-id="d8992-267">RFC 7231 sección 3.1.2.1: Códigos contenidos</span><span class="sxs-lookup"><span data-stu-id="d8992-267">RFC 7231 Section 3.1.2.1: Content Codings</span></span>](https://tools.ietf.org/html/rfc7231#section-3.1.2.1)
* [<span data-ttu-id="d8992-268">RFC 7230 sección 4.2.3: Codificación Gzip</span><span class="sxs-lookup"><span data-stu-id="d8992-268">RFC 7230 Section 4.2.3: Gzip Coding</span></span>](https://tools.ietf.org/html/rfc7230#section-4.2.3)
* [<span data-ttu-id="d8992-269">Versión 4.3 de la especificación de formato del archivo GZIP</span><span class="sxs-lookup"><span data-stu-id="d8992-269">GZIP file format specification version 4.3</span></span>](http://www.ietf.org/rfc/rfc1952.txt)
