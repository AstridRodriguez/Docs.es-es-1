---
title: Filtros
author: ardalis
description: "Obtenga información acerca de cómo * filtros * trabajo y cómo utilizarlas en MVC de ASP.NET Core."
keywords: "ASP.NET Core, filtros, filtros de mvc, los filtros de acción, los filtros de autorización, filtros de recursos, filtros de resultados, los filtros de excepción"
ms.author: tdykstra
manager: wpickett
ms.date: 12/12/2016
ms.topic: article
ms.assetid: 531bda08-aa5b-4471-8f08-96add22c8683
ms.technology: aspnet
ms.prod: asp.net-core
uid: mvc/controllers/filters
ms.openlocfilehash: bf90698bbac850b1917cd93dbf0a5fc5b6792aa0
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/11/2017
---
# <a name="filters"></a><span data-ttu-id="16f7b-104">Filtros</span><span class="sxs-lookup"><span data-stu-id="16f7b-104">Filters</span></span>

<span data-ttu-id="16f7b-105">Por [Tom Dykstra](https://github.com/tdykstra/) y [Steve Smith](http://ardalis.com)</span><span class="sxs-lookup"><span data-stu-id="16f7b-105">By [Tom Dykstra](https://github.com/tdykstra/) and [Steve Smith](http://ardalis.com)</span></span>

<span data-ttu-id="16f7b-106">*Filtros* en MVC de ASP.NET Core permite ejecutar código antes o después de ciertas fases de la canalización de procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="16f7b-106">*Filters* in ASP.NET Core MVC allow you to run code before or after certain stages in the request processing pipeline.</span></span>

 <span data-ttu-id="16f7b-107">Tareas de controlador de filtros integrados, como autorización (impedir el acceso a los recursos de para que un usuario no está autorizado), asegurarse de que todas las solicitudes utilicen HTTPS y el almacenamiento en caché (evaluación "cortocircuitada" de la canalización de solicitud para devolver una respuesta almacenada en caché) de respuesta.</span><span class="sxs-lookup"><span data-stu-id="16f7b-107">Built-in filters handle tasks such as authorization (preventing access to resources a user isn't authorized for), ensuring that all requests use HTTPS, and response caching (short-circuiting the request pipeline to return a cached response).</span></span> 

<span data-ttu-id="16f7b-108">Puede crear filtros personalizados para controlar cuestiones de corte del cruce para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="16f7b-108">You can create custom filters to handle cross-cutting concerns for your application.</span></span> <span data-ttu-id="16f7b-109">Siempre que desee evitar la duplicación de código a través de acciones, los filtros son la solución.</span><span class="sxs-lookup"><span data-stu-id="16f7b-109">Anytime you want to avoid duplicating code across actions, filters are the solution.</span></span> <span data-ttu-id="16f7b-110">Por ejemplo, puede consolidar el código en un filtro de excepción de control de errores.</span><span class="sxs-lookup"><span data-stu-id="16f7b-110">For example, you can consolidate error handling code in a exception filter.</span></span>

<span data-ttu-id="16f7b-111">[Ver o descargar el ejemplo desde GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span><span class="sxs-lookup"><span data-stu-id="16f7b-111">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>

## <a name="how-do-filters-work"></a><span data-ttu-id="16f7b-112">¿Cómo funcionan los filtros?</span><span class="sxs-lookup"><span data-stu-id="16f7b-112">How do filters work?</span></span>

<span data-ttu-id="16f7b-113">Los filtros se ejecutan dentro de la *canalización de invocación de acción de MVC*, a veces denominado el *canalización filtro*.</span><span class="sxs-lookup"><span data-stu-id="16f7b-113">Filters run within the *MVC action invocation pipeline*, sometimes referred to as the *filter pipeline*.</span></span>  <span data-ttu-id="16f7b-114">La canalización de filtro se ejecuta después de MVC selecciona la acción que se va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="16f7b-114">The filter pipeline runs after MVC selects the action to execute.</span></span>

![La solicitud se procesa a través de Middleware de otros, enrutamiento Middleware, selección de acción y la canalización de invocación de acción de MVC.](filters/_static/filter-pipeline-1.png)

### <a name="filter-types"></a><span data-ttu-id="16f7b-117">Tipos de filtro</span><span class="sxs-lookup"><span data-stu-id="16f7b-117">Filter types</span></span>

<span data-ttu-id="16f7b-118">Cada tipo de filtro se ejecuta en una fase diferente de la canalización de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-118">Each filter type is executed at a different stage in the filter pipeline.</span></span>

* <span data-ttu-id="16f7b-119">[Los filtros de autorización](#authorization-filters) se ejecutan primero y se usan para determinar si el usuario actual está autorizado para la solicitud actual.</span><span class="sxs-lookup"><span data-stu-id="16f7b-119">[Authorization filters](#authorization-filters) run first and are used to determine whether the current user is authorized for the current request.</span></span> <span data-ttu-id="16f7b-120">La canalización puede cortocircuito si una solicitud no está autorizada.</span><span class="sxs-lookup"><span data-stu-id="16f7b-120">They can short-circuit the pipeline if a request is unauthorized.</span></span> 

* <span data-ttu-id="16f7b-121">[Filtros de recurso](#resource-filters) son los primeros en atender una solicitud después de la autorización.</span><span class="sxs-lookup"><span data-stu-id="16f7b-121">[Resource filters](#resource-filters) are the first to handle a request after authorization.</span></span>  <span data-ttu-id="16f7b-122">Puede ejecutar código antes que el resto de la canalización de filtro y después de que se ha completado el resto de la canalización.</span><span class="sxs-lookup"><span data-stu-id="16f7b-122">They can run code before the rest of the filter pipeline, and after the rest of the pipeline has completed.</span></span> <span data-ttu-id="16f7b-123">Son útiles para implementar el almacenamiento en caché o cortocircuito en caso contrario, la canalización de filtro por motivos de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="16f7b-123">They're useful to implement caching or otherwise short-circuit the filter pipeline for performance reasons.</span></span> <span data-ttu-id="16f7b-124">Dado que ejecuta antes del enlace de modelo, resultan útiles para todo lo que necesita para influir en el enlace de modelos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-124">Since they run before model binding, they're useful for anything that needs to influence model binding.</span></span>

* <span data-ttu-id="16f7b-125">[Filtros de acción](#action-filters) puede ejecutar código inmediatamente antes y después de llama a un método de acción individuales.</span><span class="sxs-lookup"><span data-stu-id="16f7b-125">[Action filters](#action-filters) can run code immediately before and after an individual action method is called.</span></span> <span data-ttu-id="16f7b-126">Puede utilizar para manipular los argumentos pasados a una acción y el resultado devuelto de la acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-126">They can be used to manipulate the arguments passed into an action and the result returned from the action.</span></span>

* <span data-ttu-id="16f7b-127">[Los filtros de excepción](#exception-filters) se utilizan para aplicar directivas globales para las excepciones no controladas que se producen antes de nada se ha escrito en el cuerpo de respuesta.</span><span class="sxs-lookup"><span data-stu-id="16f7b-127">[Exception filters](#exception-filters) are used to apply global policies to unhandled exceptions that occur before anything has been written to the response body.</span></span>

* <span data-ttu-id="16f7b-128">[Como resultado filtros](#result-filters) puede ejecutar código inmediatamente antes y después de la ejecución de los resultados de acción individual.</span><span class="sxs-lookup"><span data-stu-id="16f7b-128">[Result filters](#result-filters) can run code immediately before and after the execution of individual action results.</span></span> <span data-ttu-id="16f7b-129">Ejecutan sólo cuando el método de acción se ha ejecutado correctamente y son útiles para la lógica que debe rodean la ejecución de la vista o el formateador.</span><span class="sxs-lookup"><span data-stu-id="16f7b-129">They run only when the action method has executed successfully and are useful for logic that must surround view or formatter execution.</span></span>

<span data-ttu-id="16f7b-130">El siguiente diagrama muestra cómo interactúan estos tipos de filtro en la canalización de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-130">The following diagram shows how these filter types interact in the filter pipeline.</span></span>

![La solicitud se procesa a través de los filtros de autorización, filtros de recursos, enlace de modelos, filtros de acción, ejecución de acciones y conversión del resultado de acción, los filtros de excepción, filtros de resultados y ejecución de resultado.](filters/_static/filter-pipeline-2.png)

## <a name="implementation"></a><span data-ttu-id="16f7b-133">Implementación</span><span class="sxs-lookup"><span data-stu-id="16f7b-133">Implementation</span></span>

<span data-ttu-id="16f7b-134">Los filtros admiten implementaciones sincrónicas y asincrónicas a través de definiciones de interfaz diferente.</span><span class="sxs-lookup"><span data-stu-id="16f7b-134">Filters support both synchronous and asynchronous implementations through different interface definitions.</span></span> <span data-ttu-id="16f7b-135">Elija la sincronización o async variante según el tipo de tarea que necesite realizar.</span><span class="sxs-lookup"><span data-stu-id="16f7b-135">Choose either the sync or async variant depending on the kind of task you need to perform.</span></span> 

<span data-ttu-id="16f7b-136">Sincrónicos filtros que se pueden ejecutar código tanto antes y después de definir su fase de canalización en*fase*Executing y en*fase*ejecuta métodos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-136">Synchronous filters that can run code both before and after their pipeline stage define On*Stage*Executing and On*Stage*Executed methods.</span></span> <span data-ttu-id="16f7b-137">Por ejemplo, `OnActionExecuting` se llama antes de que se llama al método de acción, y `OnActionExecuted` se llama después de que vuelva el método de acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-137">For example, `OnActionExecuting` is called before the action method is called, and `OnActionExecuted` is called after the action method returns.</span></span>

<span data-ttu-id="16f7b-138">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?highlight=6,8,13)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-138">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?highlight=6,8,13)]</span></span>

<span data-ttu-id="16f7b-139">Filtros asincrónicos definen una sola en*fase*ExecutionAsync método.</span><span class="sxs-lookup"><span data-stu-id="16f7b-139">Asynchronous filters define a single On*Stage*ExecutionAsync method.</span></span> <span data-ttu-id="16f7b-140">Este método toma un *FilterType*ExecutionDelegate delegado que se ejecuta la fase de canalización de filtros.</span><span class="sxs-lookup"><span data-stu-id="16f7b-140">This method takes a *FilterType*ExecutionDelegate delegate which executes the filter's pipeline stage.</span></span> <span data-ttu-id="16f7b-141">Por ejemplo, `ActionExecutionDelegate` llamadas al método de acción y se pueden ejecutar código antes y después de llamar a él.</span><span class="sxs-lookup"><span data-stu-id="16f7b-141">For example, `ActionExecutionDelegate` calls the action method, and you can execute code before and after you call it.</span></span>

<span data-ttu-id="16f7b-142">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleAsyncActionFilter.cs?highlight=6,8-10,13)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-142">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleAsyncActionFilter.cs?highlight=6,8-10,13)]</span></span>

<span data-ttu-id="16f7b-143">Pueden implementar interfaces para varias fases de filtro en una sola clase.</span><span class="sxs-lookup"><span data-stu-id="16f7b-143">You can implement interfaces for multiple filter stages in a single class.</span></span> <span data-ttu-id="16f7b-144">Por ejemplo, el [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) clase abstracta implementa tanto `IActionFilter` y `IResultFilter`, así como sus equivalentes asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-144">For example, the [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) abstract class implements both `IActionFilter` and `IResultFilter`, as well as their async equivalents.</span></span>

> [!NOTE]
> <span data-ttu-id="16f7b-145">Implemente **cualquier** sincrónico o la versión asincrónica de una interfaz de filtro, no ambos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-145">Implement **either** the synchronous or the async version of a filter interface, not both.</span></span> <span data-ttu-id="16f7b-146">El marco de trabajo comprueba primero si el filtro implementa la interfaz asincrónica y, si es así, llama.</span><span class="sxs-lookup"><span data-stu-id="16f7b-146">The framework checks first to see if the filter implements the async interface, and if so, it calls that.</span></span> <span data-ttu-id="16f7b-147">De lo contrario, llama a métodos de la interfaz sincrónica.</span><span class="sxs-lookup"><span data-stu-id="16f7b-147">If not, it calls the synchronous interface's method(s).</span></span> <span data-ttu-id="16f7b-148">Si fuera a implementar ambas interfaces en una clase, se denominaría solo el método asincrónico.</span><span class="sxs-lookup"><span data-stu-id="16f7b-148">If you were to implement both interfaces on one class, only the async method would be called.</span></span> <span data-ttu-id="16f7b-149">Al utilizar las clases abstractas como [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) invalidaría solo los métodos sincrónicos o el método asincrónico para cada tipo de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-149">When using abstract classes like [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) you would override only the synchronous methods or the async method for each filter type.</span></span>

### <a name="ifilterfactory"></a><span data-ttu-id="16f7b-150">IFilterFactory</span><span class="sxs-lookup"><span data-stu-id="16f7b-150">IFilterFactory</span></span>

<span data-ttu-id="16f7b-151">`IFilterFactory` implementa `IFilter`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-151">`IFilterFactory` implements `IFilter`.</span></span> <span data-ttu-id="16f7b-152">Por lo tanto, un `IFilterFactory` instancia se puede usar como un `IFilter` instancia en cualquier parte de la canalización de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-152">Therefore, an `IFilterFactory` instance can be used as an `IFilter` instance anywhere in the filter pipeline.</span></span> <span data-ttu-id="16f7b-153">Cuando el marco de trabajo se prepara para invocar el filtro, intenta convertirlo a un `IFilterFactory`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-153">When the framework prepares to invoke the filter, it attempts to cast it to an `IFilterFactory`.</span></span> <span data-ttu-id="16f7b-154">Si esa conversión se realiza correctamente, el `CreateInstance` método se llama para crear el `IFilter` instancia que se invocará.</span><span class="sxs-lookup"><span data-stu-id="16f7b-154">If that cast succeeds, the `CreateInstance` method is called to create the `IFilter` instance that will be invoked.</span></span> <span data-ttu-id="16f7b-155">Esto proporciona un diseño muy flexible, ya que no es necesario que la canalización de filtro preciso establecerse de forma explícita cuando se inicia la aplicación.</span><span class="sxs-lookup"><span data-stu-id="16f7b-155">This provides a very flexible design, since the precise filter pipeline does not need to be set explicitly when the application starts.</span></span>

<span data-ttu-id="16f7b-156">Puede implementar `IFilterFactory` en sus propias implementaciones de atributo como otro enfoque para la creación de filtros:</span><span class="sxs-lookup"><span data-stu-id="16f7b-156">You can implement `IFilterFactory` on your own attribute implementations as another approach to creating filters:</span></span>

<span data-ttu-id="16f7b-157">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderWithFactoryAttribute.cs?name=snippet_IFilterFactory&highlight=1,4,5,6,7)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-157">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderWithFactoryAttribute.cs?name=snippet_IFilterFactory&highlight=1,4,5,6,7)]</span></span>

### <a name="built-in-filter-attributes"></a><span data-ttu-id="16f7b-158">Atributos de filtro integrado</span><span class="sxs-lookup"><span data-stu-id="16f7b-158">Built-in filter attributes</span></span>

<span data-ttu-id="16f7b-159">El marco incluye filtros integrados basado en atributos que puede crear subclases y personalizar.</span><span class="sxs-lookup"><span data-stu-id="16f7b-159">The framework includes built-in attribute-based filters that you can subclass and customize.</span></span> <span data-ttu-id="16f7b-160">Por ejemplo, el siguiente filtro de resultado agrega un encabezado a la respuesta.</span><span class="sxs-lookup"><span data-stu-id="16f7b-160">For example, the following Result filter adds a header to the response.</span></span>

<a name=add-header-attribute></a>

<span data-ttu-id="16f7b-161">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderAttribute.cs?highlight=5,16)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-161">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderAttribute.cs?highlight=5,16)]</span></span>

<span data-ttu-id="16f7b-162">Los atributos permiten filtros aceptar argumentos, como se muestra en el ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="16f7b-162">Attributes allow filters to accept arguments, as shown in the example above.</span></span> <span data-ttu-id="16f7b-163">¿Agregar este atributo a un método de acción o controlador y especifique el nombre y el valor del encabezado HTTP:</span><span class="sxs-lookup"><span data-stu-id="16f7b-163">You would add this attribute to a controller or action method and specify the name and value of the HTTP header:</span></span>

<span data-ttu-id="16f7b-164">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-164">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1)]</span></span>

<span data-ttu-id="16f7b-165">El resultado de la `Index` acción se muestra a continuación, se muestran los encabezados de respuesta en la parte inferior derecha.</span><span class="sxs-lookup"><span data-stu-id="16f7b-165">The result of the `Index` action is shown below - the response headers are displayed on the bottom right.</span></span>

![Developer Tools de Microsoft Edge que muestra los encabezados de respuesta, incluido el autor Steve Smith@ardalis](filters/_static/add-header.png)

<span data-ttu-id="16f7b-167">Algunas de las interfaces de filtro tienen atributos correspondientes que pueden usarse como clases base para las implementaciones personalizadas.</span><span class="sxs-lookup"><span data-stu-id="16f7b-167">Several of the filter interfaces have corresponding attributes that can be used as base classes for custom implementations.</span></span>

<span data-ttu-id="16f7b-168">Atributos de filtro:</span><span class="sxs-lookup"><span data-stu-id="16f7b-168">Filter attributes:</span></span>

* `ActionFilterAttribute`
* `ExceptionFilterAttribute`
* `ResultFilterAttribute`
* `FormatFilterAttribute`
* `ServiceFilterAttribute`
* `TypeFilterAttribute`

<span data-ttu-id="16f7b-169">`TypeFilterAttribute`y `ServiceFilterAttribute` se explican [más adelante en este artículo](#dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="16f7b-169">`TypeFilterAttribute` and `ServiceFilterAttribute` are explained [later in this article](#dependency-injection).</span></span>

## <a name="filter-scopes-and-order-of-execution"></a><span data-ttu-id="16f7b-170">Ámbitos de filtro y orden de ejecución</span><span class="sxs-lookup"><span data-stu-id="16f7b-170">Filter scopes and order of execution</span></span>

<span data-ttu-id="16f7b-171">Puede agregar un filtro a la canalización en uno de los tres *ámbitos*.</span><span class="sxs-lookup"><span data-stu-id="16f7b-171">A filter can be added to the pipeline at one of three *scopes*.</span></span> <span data-ttu-id="16f7b-172">Puede agregar un filtro a un método de acción concreta o a una clase de controlador mediante un atributo.</span><span class="sxs-lookup"><span data-stu-id="16f7b-172">You can add a filter to a particular action method or to a controller class by using an attribute.</span></span> <span data-ttu-id="16f7b-173">O puede registrar un filtro global (para todos los controladores y acciones) agregándolo a la `MvcOptions.Filters` colección en la `ConfigureServices` método en la `Startup` clase:</span><span class="sxs-lookup"><span data-stu-id="16f7b-173">Or you can register a filter globally (for all controllers and actions) by adding it to the `MvcOptions.Filters` collection in the `ConfigureServices` method in the `Startup` class:</span></span>

<span data-ttu-id="16f7b-174">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=5-8)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-174">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=5-8)]</span></span>

### <a name="default-order-of-execution"></a><span data-ttu-id="16f7b-175">Orden de ejecución predeterminado</span><span class="sxs-lookup"><span data-stu-id="16f7b-175">Default order of execution</span></span>

<span data-ttu-id="16f7b-176">Cuando hay varios filtros para una determinada fase de la canalización, ámbito determina el orden predeterminado de la ejecución del filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-176">When there are multiple filters for a particular stage of the pipeline, scope determines the default order of filter execution.</span></span>  <span data-ttu-id="16f7b-177">Filtros globales especifica los filtros de clase, que a su vez rodean filtros de método.</span><span class="sxs-lookup"><span data-stu-id="16f7b-177">Global filters surround class filters, which in turn surround method filters.</span></span> <span data-ttu-id="16f7b-178">Esto se conoce a veces como anidamiento "Ruso muñeca", tal y como cada aumento en el ámbito se ajusta alrededor del ámbito anterior, como un [muñeca anidamiento](https://en.wikipedia.org/wiki/Matryoshka_doll).</span><span class="sxs-lookup"><span data-stu-id="16f7b-178">This is sometimes referred to as "Russian doll" nesting, as each increase in scope is wrapped around the previous scope, like a [nesting doll](https://en.wikipedia.org/wiki/Matryoshka_doll).</span></span> <span data-ttu-id="16f7b-179">Por lo general, obtendrá el comportamiento deseado de reemplazo sin tener que determinar el orden de forma explícita.</span><span class="sxs-lookup"><span data-stu-id="16f7b-179">You generally get the desired overriding behavior without having to explicitly determine ordering.</span></span>

<span data-ttu-id="16f7b-180">Resultado asa de este anidamiento, la *después* código de filtros se ejecuta en el orden inverso de la *antes de* código.</span><span class="sxs-lookup"><span data-stu-id="16f7b-180">Asa result of this nesting, the *after* code of filters runs in the reverse order of the *before* code.</span></span> <span data-ttu-id="16f7b-181">La secuencia tiene el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="16f7b-181">The sequence looks like this:</span></span>

* <span data-ttu-id="16f7b-182">El *antes de* código de filtros aplicados globalmente</span><span class="sxs-lookup"><span data-stu-id="16f7b-182">The *before* code of filters applied globally</span></span>
  * <span data-ttu-id="16f7b-183">El *antes de* código de filtros aplicados a los controladores</span><span class="sxs-lookup"><span data-stu-id="16f7b-183">The *before* code of filters applied to controllers</span></span>
    * <span data-ttu-id="16f7b-184">El *antes de* código de filtros aplicados a métodos de acción</span><span class="sxs-lookup"><span data-stu-id="16f7b-184">The *before* code of filters applied to action methods</span></span>
    * <span data-ttu-id="16f7b-185">El *después* código de filtros aplicados a métodos de acción</span><span class="sxs-lookup"><span data-stu-id="16f7b-185">The *after* code of filters applied to action methods</span></span>
  * <span data-ttu-id="16f7b-186">El *después* código de filtros aplicados a los controladores</span><span class="sxs-lookup"><span data-stu-id="16f7b-186">The *after* code of filters applied to controllers</span></span>
* <span data-ttu-id="16f7b-187">El *después* código de filtros aplicados globalmente</span><span class="sxs-lookup"><span data-stu-id="16f7b-187">The *after* code of filters applied globally</span></span>
  
<span data-ttu-id="16f7b-188">Este es un ejemplo que muestra el orden en el filtro que se denominan métodos sincrónicos filtros de acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-188">Here's an example that illustrates the order in which filter methods are called for synchronous Action filters.</span></span>

| <span data-ttu-id="16f7b-189">Secuencia</span><span class="sxs-lookup"><span data-stu-id="16f7b-189">Sequence</span></span> | <span data-ttu-id="16f7b-190">Ámbito de filtro</span><span class="sxs-lookup"><span data-stu-id="16f7b-190">Filter scope</span></span> | <span data-ttu-id="16f7b-191">Filter (método)</span><span class="sxs-lookup"><span data-stu-id="16f7b-191">Filter method</span></span> |
|:--------:|:------------:|:-------------:|
| <span data-ttu-id="16f7b-192">1</span><span class="sxs-lookup"><span data-stu-id="16f7b-192">1</span></span> | <span data-ttu-id="16f7b-193">Global</span><span class="sxs-lookup"><span data-stu-id="16f7b-193">Global</span></span> | `OnActionExecuting` |
| <span data-ttu-id="16f7b-194">2</span><span class="sxs-lookup"><span data-stu-id="16f7b-194">2</span></span> | <span data-ttu-id="16f7b-195">Controlador</span><span class="sxs-lookup"><span data-stu-id="16f7b-195">Controller</span></span> | `OnActionExecuting` |
| <span data-ttu-id="16f7b-196">3</span><span class="sxs-lookup"><span data-stu-id="16f7b-196">3</span></span> | <span data-ttu-id="16f7b-197">Método</span><span class="sxs-lookup"><span data-stu-id="16f7b-197">Method</span></span> | `OnActionExecuting` |
| <span data-ttu-id="16f7b-198">4</span><span class="sxs-lookup"><span data-stu-id="16f7b-198">4</span></span> | <span data-ttu-id="16f7b-199">Método</span><span class="sxs-lookup"><span data-stu-id="16f7b-199">Method</span></span> | `OnActionExecuted` |
| <span data-ttu-id="16f7b-200">5</span><span class="sxs-lookup"><span data-stu-id="16f7b-200">5</span></span> | <span data-ttu-id="16f7b-201">Controlador</span><span class="sxs-lookup"><span data-stu-id="16f7b-201">Controller</span></span> | `OnActionExecuted` |
| <span data-ttu-id="16f7b-202">6</span><span class="sxs-lookup"><span data-stu-id="16f7b-202">6</span></span> | <span data-ttu-id="16f7b-203">Global</span><span class="sxs-lookup"><span data-stu-id="16f7b-203">Global</span></span> | `OnActionExecuted` |

<span data-ttu-id="16f7b-204">Esta secuencia se muestra que el filtro de método se anida en el filtro de controlador y el filtro de controlador se anida dentro de los filtros globales.</span><span class="sxs-lookup"><span data-stu-id="16f7b-204">This sequence shows that the method filter is nested within the controller filter, and the controller filter is nested within the global filter.</span></span> <span data-ttu-id="16f7b-205">Lo coloque otra forma, si está dentro de un filtro de async de*fase*ExecutionAsync método, todos los filtros con un ámbito más estricto ejecutan mientras el código está en la pila.</span><span class="sxs-lookup"><span data-stu-id="16f7b-205">To put it another way, if you're inside an async filter's On*Stage*ExecutionAsync method, all of the filters with a tighter scope run while your code is on the stack.</span></span>

> [!NOTE]
> <span data-ttu-id="16f7b-206">Todos los controladores que se hereda de la `Controller` incluye la clase base `OnActionExecuting` y `OnActionExecuted` métodos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-206">Every controller that inherits from the `Controller` base class includes `OnActionExecuting` and `OnActionExecuted` methods.</span></span> <span data-ttu-id="16f7b-207">Estos métodos ajustan los filtros que se ejecutan para una acción determinada: `OnActionExecuting` se llama antes de cualquiera de los filtros, y `OnActionExecuted` se llama después de todos los filtros.</span><span class="sxs-lookup"><span data-stu-id="16f7b-207">These methods wrap the filters that run for a given action:  `OnActionExecuting` is called before any of the filters, and `OnActionExecuted` is called after all of the filters.</span></span>

### <a name="overriding-the-default-order"></a><span data-ttu-id="16f7b-208">Invalidar el orden predeterminado</span><span class="sxs-lookup"><span data-stu-id="16f7b-208">Overriding the default order</span></span>

<span data-ttu-id="16f7b-209">Puede invalidar la secuencia predeterminada de ejecución mediante la implementación de `IOrderedFilter`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-209">You can override the default sequence of execution by implementing `IOrderedFilter`.</span></span> <span data-ttu-id="16f7b-210">Esta interfaz expone un `Order` propiedad que tiene prioridad sobre el ámbito para determinar el orden de ejecución.</span><span class="sxs-lookup"><span data-stu-id="16f7b-210">This interface exposes an `Order` property that takes precedence over scope to determine the order of execution.</span></span> <span data-ttu-id="16f7b-211">Un filtro con un menor `Order` valor tendrá su *antes de* código ejecutado antes de que un filtro con un valor más alto de `Order`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-211">A filter with a lower `Order` value will have its *before* code executed before that of a filter with a higher value of `Order`.</span></span> <span data-ttu-id="16f7b-212">Un filtro con un menor `Order` valor tendrá su *después* código ejecutado después de que un filtro con una mayor `Order` valor.</span><span class="sxs-lookup"><span data-stu-id="16f7b-212">A filter with a lower `Order` value will have its *after* code executed after that of a filter with a higher `Order` value.</span></span> <span data-ttu-id="16f7b-213">Puede establecer el `Order` propiedad usando un parámetro de constructor:</span><span class="sxs-lookup"><span data-stu-id="16f7b-213">You can set the `Order` property by using a constructor parameter:</span></span>

```csharp
[MyFilter(Name = "Controller Level Attribute", Order=1)]
```

<span data-ttu-id="16f7b-214">Si tiene el mismo 3 filtros de acción que se muestra en el ejemplo anterior pero el conjunto la `Order` propiedades globales y del controlador de filtros a 1 y 2 respectivamente, el orden de ejecución estarían invertido.</span><span class="sxs-lookup"><span data-stu-id="16f7b-214">If you have the same 3 Action filters shown in the preceding example but set the `Order` property of the controller and global filters to 1 and 2 respectively, the order of execution would be reversed.</span></span>

| <span data-ttu-id="16f7b-215">Secuencia</span><span class="sxs-lookup"><span data-stu-id="16f7b-215">Sequence</span></span> | <span data-ttu-id="16f7b-216">Ámbito de filtro</span><span class="sxs-lookup"><span data-stu-id="16f7b-216">Filter scope</span></span> | <span data-ttu-id="16f7b-217">Propiedad `Order`</span><span class="sxs-lookup"><span data-stu-id="16f7b-217">`Order` property</span></span> | <span data-ttu-id="16f7b-218">Filter (método)</span><span class="sxs-lookup"><span data-stu-id="16f7b-218">Filter method</span></span> |
|:--------:|:------------:|:-----------------:|:-------------:|
| <span data-ttu-id="16f7b-219">1</span><span class="sxs-lookup"><span data-stu-id="16f7b-219">1</span></span> | <span data-ttu-id="16f7b-220">Método</span><span class="sxs-lookup"><span data-stu-id="16f7b-220">Method</span></span> | <span data-ttu-id="16f7b-221">0</span><span class="sxs-lookup"><span data-stu-id="16f7b-221">0</span></span> | `OnActionExecuting` |
| <span data-ttu-id="16f7b-222">2</span><span class="sxs-lookup"><span data-stu-id="16f7b-222">2</span></span> | <span data-ttu-id="16f7b-223">Controlador</span><span class="sxs-lookup"><span data-stu-id="16f7b-223">Controller</span></span> | <span data-ttu-id="16f7b-224">1</span><span class="sxs-lookup"><span data-stu-id="16f7b-224">1</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="16f7b-225">3</span><span class="sxs-lookup"><span data-stu-id="16f7b-225">3</span></span> | <span data-ttu-id="16f7b-226">Global</span><span class="sxs-lookup"><span data-stu-id="16f7b-226">Global</span></span> | <span data-ttu-id="16f7b-227">2</span><span class="sxs-lookup"><span data-stu-id="16f7b-227">2</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="16f7b-228">4</span><span class="sxs-lookup"><span data-stu-id="16f7b-228">4</span></span> | <span data-ttu-id="16f7b-229">Global</span><span class="sxs-lookup"><span data-stu-id="16f7b-229">Global</span></span> | <span data-ttu-id="16f7b-230">2</span><span class="sxs-lookup"><span data-stu-id="16f7b-230">2</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="16f7b-231">5</span><span class="sxs-lookup"><span data-stu-id="16f7b-231">5</span></span> | <span data-ttu-id="16f7b-232">Controlador</span><span class="sxs-lookup"><span data-stu-id="16f7b-232">Controller</span></span> | <span data-ttu-id="16f7b-233">1</span><span class="sxs-lookup"><span data-stu-id="16f7b-233">1</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="16f7b-234">6</span><span class="sxs-lookup"><span data-stu-id="16f7b-234">6</span></span> | <span data-ttu-id="16f7b-235">Método</span><span class="sxs-lookup"><span data-stu-id="16f7b-235">Method</span></span> | <span data-ttu-id="16f7b-236">0</span><span class="sxs-lookup"><span data-stu-id="16f7b-236">0</span></span>  | `OnActionExecuted` |

<span data-ttu-id="16f7b-237">El `Order` falsean la propiedad ámbito al determinar el orden en el que se ejecutarán los filtros.</span><span class="sxs-lookup"><span data-stu-id="16f7b-237">The `Order` property trumps scope when determining the order in which filters will run.</span></span> <span data-ttu-id="16f7b-238">Los filtros aparecen ordenados primero por orden, a continuación, ámbito se utiliza para romper los enlaces.</span><span class="sxs-lookup"><span data-stu-id="16f7b-238">Filters are sorted first by order, then scope is used to break ties.</span></span> <span data-ttu-id="16f7b-239">Todos los filtros integrados implementan `IOrderedFilter` y establezca el valor predeterminado `Order` valor en 0, por lo que el ámbito determina el orden a menos que establezca `Order` en un valor distinto de cero.</span><span class="sxs-lookup"><span data-stu-id="16f7b-239">All of the built-in filters implement `IOrderedFilter` and set the default `Order` value to 0, so scope determines order unless you set `Order` to a non-zero value.</span></span>

## <a name="cancellation-and-short-circuiting"></a><span data-ttu-id="16f7b-240">La cancelación y el cortocircuito</span><span class="sxs-lookup"><span data-stu-id="16f7b-240">Cancellation and short circuiting</span></span>

<span data-ttu-id="16f7b-241">Puede cortocircuita la canalización de filtro en cualquier momento estableciendo la `Result` propiedad en el `context` parámetro proporcionado para el método de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-241">You can short-circuit the filter pipeline at any point by setting the `Result` property on the `context` parameter provided to the filter method.</span></span> <span data-ttu-id="16f7b-242">Por ejemplo, el siguiente filtro de recursos impide que el resto de la canalización de ejecución.</span><span class="sxs-lookup"><span data-stu-id="16f7b-242">For instance, the following Resource filter prevents the rest of the pipeline from executing.</span></span>

<a name=short-circuiting-resource-filter></a>

<span data-ttu-id="16f7b-243">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ShortCircuitingResourceFilterAttribute.cs?highlight=12,13,14,15)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-243">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ShortCircuitingResourceFilterAttribute.cs?highlight=12,13,14,15)]</span></span>

<span data-ttu-id="16f7b-244">En el código siguiente, tanto el `ShortCircuitingResourceFilter` y `AddHeader` destino filtro el `SomeResource` método de acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-244">In the following code, both the `ShortCircuitingResourceFilter` and the `AddHeader` filter target the `SomeResource` action method.</span></span> <span data-ttu-id="16f7b-245">Sin embargo, dado que la `ShortCircuitingResourceFilter` se ejecuta primero (porque es un filtro de recurso y `AddHeader` es un filtro de acción) y cortocircuita el resto de la canalización, el `AddHeader` filtro nunca se ejecuta durante la `SomeResource` acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-245">However, because the `ShortCircuitingResourceFilter` runs first (because it is a Resource Filter and `AddHeader` is an Action Filter) and short-circuits the rest of the pipeline, the `AddHeader` filter never runs for the `SomeResource` action.</span></span> <span data-ttu-id="16f7b-246">Este comportamiento podría ser el mismo si ambos filtros aplicados en el nivel de método de acción, proporciona el `ShortCircuitingResourceFilter` ejecutó primer (usar debido a su tipo de filtro, o explícita de `Order` propiedad, por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="16f7b-246">This behavior would be the same if both filters were applied at the action method level, provided the `ShortCircuitingResourceFilter` ran first (because of its filter type, or explicit use of `Order` property, for instance).</span></span>

<span data-ttu-id="16f7b-247">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1,9)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-247">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1,9)]</span></span>

## <a name="dependency-injection"></a><span data-ttu-id="16f7b-248">Inyección de dependencia</span><span class="sxs-lookup"><span data-stu-id="16f7b-248">Dependency injection</span></span>

<span data-ttu-id="16f7b-249">Filtros se pueden agregar por tipo o instancia.</span><span class="sxs-lookup"><span data-stu-id="16f7b-249">Filters can be added by type or by instance.</span></span> <span data-ttu-id="16f7b-250">Si agrega una instancia, esa instancia se utilizará para cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="16f7b-250">If you add an instance, that instance will be used for every request.</span></span> <span data-ttu-id="16f7b-251">Si agrega un tipo, estará activa de tipo, lo que significa que se creará una instancia para cada solicitud y las dependencias de constructor se llenará con [inyección de dependencia](../../fundamentals/dependency-injection.md) (DI).</span><span class="sxs-lookup"><span data-stu-id="16f7b-251">If you add a type, it will be type-activated, meaning an instance will be created for each request and any constructor dependencies will be populated by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="16f7b-252">Agregar un filtro por tipo es equivalente a `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-252">Adding a filter by type is equivalent to `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span></span>

<span data-ttu-id="16f7b-253">Los filtros que se implementan como atributos y agregan directamente a las clases de controlador o a los métodos de acción no pueden tener dependencias de constructor proporcionadas por [inyección de dependencia](../../fundamentals/dependency-injection.md) (DI).</span><span class="sxs-lookup"><span data-stu-id="16f7b-253">Filters that are implemented as attributes and added directly to controller classes or action methods cannot have constructor dependencies provided by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="16f7b-254">Esto es porque los atributos deben tener sus parámetros de constructor proporcionados que se aplican.</span><span class="sxs-lookup"><span data-stu-id="16f7b-254">This is because attributes must have their constructor parameters supplied where they are applied.</span></span> <span data-ttu-id="16f7b-255">Se trata de una limitación de cómo funcionan los atributos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-255">This is a limitation of how attributes work.</span></span>

<span data-ttu-id="16f7b-256">Si los filtros tienen dependencias que necesite tener acceso desde DI, existen varios enfoques admitidos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-256">If your filters have dependencies that you need to access from DI, there are several supported approaches.</span></span> <span data-ttu-id="16f7b-257">Puede aplicar el filtro a un método de acción o clase mediante uno de los siguientes:</span><span class="sxs-lookup"><span data-stu-id="16f7b-257">You can apply your filter to a class or action method using one of the following:</span></span>

* `ServiceFilterAttribute`
* `TypeFilterAttribute`
* <span data-ttu-id="16f7b-258">`IFilterFactory`implementado en el atributo</span><span class="sxs-lookup"><span data-stu-id="16f7b-258">`IFilterFactory` implemented on your attribute</span></span>

> [!NOTE]
> <span data-ttu-id="16f7b-259">Una dependencia que se desea obtener de DI es un registrador.</span><span class="sxs-lookup"><span data-stu-id="16f7b-259">One dependency you might want to get from DI is a logger.</span></span> <span data-ttu-id="16f7b-260">Sin embargo, evite crear y usar filtros para fines de registro, ya que la [características de registro de marco de trabajo integrado](../../fundamentals/logging.md) ya puede proporcionar lo que necesita.</span><span class="sxs-lookup"><span data-stu-id="16f7b-260">However, avoid creating and using filters purely for logging purposes, since the [built-in framework logging features](../../fundamentals/logging.md) may already provide what you need.</span></span> <span data-ttu-id="16f7b-261">Si se va a agregar un registro a los filtros, debe centrarse en cuestiones de dominio empresariales o el comportamiento específico para el filtro, en lugar de las acciones de MVC u otros eventos de framework.</span><span class="sxs-lookup"><span data-stu-id="16f7b-261">If you're going to add logging to your filters, it should focus on business domain concerns or behavior specific to your filter, rather than MVC actions or other framework events.</span></span>

### <a name="servicefilterattribute"></a><span data-ttu-id="16f7b-262">ServiceFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="16f7b-262">ServiceFilterAttribute</span></span>

<span data-ttu-id="16f7b-263">Un `ServiceFilter` recupera una instancia del filtro de DI.</span><span class="sxs-lookup"><span data-stu-id="16f7b-263">A `ServiceFilter` retrieves an instance of the filter from DI.</span></span> <span data-ttu-id="16f7b-264">Agregue el filtro en el contenedor en `ConfigureServices`y hacer referencia a él en un `ServiceFilter` atributo</span><span class="sxs-lookup"><span data-stu-id="16f7b-264">You add the filter to the container in `ConfigureServices`, and reference it in a `ServiceFilter` attribute</span></span>

<span data-ttu-id="16f7b-265">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=11)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-265">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=11)]</span></span>

<span data-ttu-id="16f7b-266">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_ServiceFilter&highlight=1)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-266">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_ServiceFilter&highlight=1)]</span></span>

<span data-ttu-id="16f7b-267">Usar `ServiceFilter` sin registrar los resultados del tipo de filtro en una excepción:</span><span class="sxs-lookup"><span data-stu-id="16f7b-267">Using `ServiceFilter` without registering the filter type results in an exception:</span></span>

```
System.InvalidOperationException: No service for type
'FiltersSample.Filters.AddHeaderFilterWithDI' has been registered.
```

<span data-ttu-id="16f7b-268">`ServiceFilterAttribute`implementa `IFilterFactory`, que expone un único método para crear un `IFilter` instancia.</span><span class="sxs-lookup"><span data-stu-id="16f7b-268">`ServiceFilterAttribute` implements `IFilterFactory`, which exposes a single method for creating an `IFilter` instance.</span></span> <span data-ttu-id="16f7b-269">En el caso de `ServiceFilterAttribute`, `IFilterFactory` la interfaz `CreateInstance` método se implementa para cargar el tipo especificado desde el contenedor de servicios (DI).</span><span class="sxs-lookup"><span data-stu-id="16f7b-269">In the case of `ServiceFilterAttribute`, the `IFilterFactory` interface's `CreateInstance` method is implemented to load the specified type from the services container (DI).</span></span>

### <a name="typefilterattribute"></a><span data-ttu-id="16f7b-270">TypeFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="16f7b-270">TypeFilterAttribute</span></span>

<span data-ttu-id="16f7b-271">`TypeFilterAttribute`es muy similar a `ServiceFilterAttribute` (y también implementa `IFilterFactory`), pero su tipo no se resuelve directamente desde el contenedor DI.</span><span class="sxs-lookup"><span data-stu-id="16f7b-271">`TypeFilterAttribute` is very similar to `ServiceFilterAttribute` (and also implements `IFilterFactory`), but its type is not resolved directly from the DI container.</span></span> <span data-ttu-id="16f7b-272">En su lugar, crea una instancia del tipo mediante el uso de `Microsoft.Extensions.DependencyInjection.ObjectFactory`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-272">Instead, it instantiates the type by using `Microsoft.Extensions.DependencyInjection.ObjectFactory`.</span></span>

<span data-ttu-id="16f7b-273">Debido a esta diferencia, tipos que se hace referencia mediante el `TypeFilterAttribute` no tienen que ser registrados con el contenedor en primer lugar (pero todavía tendrán sus dependencias cumplirlas con el contenedor).</span><span class="sxs-lookup"><span data-stu-id="16f7b-273">Because of this difference, types that are referenced using the `TypeFilterAttribute` do not need to be registered with the container first (but they will still have their dependencies fulfilled by the container).</span></span> <span data-ttu-id="16f7b-274">Además, `TypeFilterAttribute` , opcionalmente, puede aceptar argumentos de constructor para el tipo en cuestión.</span><span class="sxs-lookup"><span data-stu-id="16f7b-274">Also, `TypeFilterAttribute` can optionally accept constructor arguments for the type in question.</span></span> <span data-ttu-id="16f7b-275">En el ejemplo siguiente se muestra cómo pasar argumentos a un tipo mediante `TypeFilterAttribute`:</span><span class="sxs-lookup"><span data-stu-id="16f7b-275">The following example demonstrates how to pass arguments to a type using `TypeFilterAttribute`:</span></span>

<span data-ttu-id="16f7b-276">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_TypeFilter&highlight=1,2)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-276">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_TypeFilter&highlight=1,2)]</span></span>

<span data-ttu-id="16f7b-277">Si tiene un filtro que no requiere ningún argumento, pero que tiene dependencias de constructor que deba ser completada por DI, puede usar su propio atributo con nombre en las clases y métodos en lugar de `[TypeFilter(typeof(FilterType))]`).</span><span class="sxs-lookup"><span data-stu-id="16f7b-277">If you have a filter that doesn't require any arguments, but which has constructor dependencies that need to be filled by DI, you can use your own named attribute on classes and methods instead of `[TypeFilter(typeof(FilterType))]`).</span></span> <span data-ttu-id="16f7b-278">El filtro siguiente muestra cómo se puede implementar esto:</span><span class="sxs-lookup"><span data-stu-id="16f7b-278">The following filter shows how this can be implemented:</span></span>

<span data-ttu-id="16f7b-279">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilterAttribute.cs?name=snippet_TypeFilterAttribute&highlight=1,3,7)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-279">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilterAttribute.cs?name=snippet_TypeFilterAttribute&highlight=1,3,7)]</span></span>

<span data-ttu-id="16f7b-280">Este filtro se puede aplicar a clases o métodos que utilizan el `[SampleActionFilter]` sintaxis, en lugar de tener que usar `[TypeFilter]` o `[ServiceFilter]`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-280">This filter can be applied to classes or methods using the `[SampleActionFilter]` syntax, instead of having to use `[TypeFilter]` or `[ServiceFilter]`.</span></span>

## <a name="authorization-filters"></a><span data-ttu-id="16f7b-281">Filtros de autorización</span><span class="sxs-lookup"><span data-stu-id="16f7b-281">Authorization filters</span></span>

<span data-ttu-id="16f7b-282">*Los filtros de autorización* controlar el acceso a los métodos de acción y el primer filtros para su ejecución en la canalización de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-282">*Authorization filters* control access to action methods and are the first filters to be executed within the filter pipeline.</span></span> <span data-ttu-id="16f7b-283">Solo tienen un antes de método, a diferencia de la mayoría de los filtros que admiten antes y después de métodos.</span><span class="sxs-lookup"><span data-stu-id="16f7b-283">They have only a before method, unlike most filters that support before and after methods.</span></span> <span data-ttu-id="16f7b-284">Sólo debe escribir un filtro de autorización personalizada si está escribiendo su propio marco de autorización.</span><span class="sxs-lookup"><span data-stu-id="16f7b-284">You should only write a custom authorization filter if you are writing your own authorization framework.</span></span> <span data-ttu-id="16f7b-285">Prefiere configurar las directivas de autorización o escribir una directiva de autorización personalizada frente a escribir un filtro personalizado.</span><span class="sxs-lookup"><span data-stu-id="16f7b-285">Prefer configuring your authorization policies or writing a custom authorization policy over writing a custom filter.</span></span> <span data-ttu-id="16f7b-286">La implementación de filtro integrado es solo responsable de la llamada del sistema de autorización.</span><span class="sxs-lookup"><span data-stu-id="16f7b-286">The built-in filter implementation is just responsible for calling the authorization system.</span></span>

<span data-ttu-id="16f7b-287">Tenga en cuenta que no deben producir excepciones en los filtros de autorización, ya que no hay nada controlará la excepción (filtros de excepciones no controlen).</span><span class="sxs-lookup"><span data-stu-id="16f7b-287">Note that you should not throw exceptions within authorization filters, since nothing will handle the exception (exception filters won't handle them).</span></span> <span data-ttu-id="16f7b-288">En su lugar, emita una respuesta de desafío o encontrar otra manera.</span><span class="sxs-lookup"><span data-stu-id="16f7b-288">Instead, issue a challenge or find another way.</span></span>

<span data-ttu-id="16f7b-289">Obtenga más información sobre [autorización](../../security/authorization/index.md).</span><span class="sxs-lookup"><span data-stu-id="16f7b-289">Learn more about [Authorization](../../security/authorization/index.md).</span></span>

## <a name="resource-filters"></a><span data-ttu-id="16f7b-290">Filtros de recursos</span><span class="sxs-lookup"><span data-stu-id="16f7b-290">Resource filters</span></span>

<span data-ttu-id="16f7b-291">*Filtros de recurso* implementan la `IResourceFilter` o `IAsyncResourceFilter` interfaz y su ejecución ajusta la mayor parte de la canalización de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-291">*Resource filters* implement either the `IResourceFilter` or `IAsyncResourceFilter` interface, and their execution wraps most of the filter pipeline.</span></span> <span data-ttu-id="16f7b-292">(Solo [filtros de autorización](#authorization-filters) ejecutar antes de ellos.) Filtros de recursos son especialmente útiles si tiene que la mayoría del trabajo que se está realizando una solicitud de cortocircuito.</span><span class="sxs-lookup"><span data-stu-id="16f7b-292">(Only [Authorization filters](#authorization-filters) run before them.) Resource filters are especially useful if you need to short-circuit most of the work a request is doing.</span></span> <span data-ttu-id="16f7b-293">Por ejemplo, un filtro de almacenamiento en caché puede evitar el resto de la canalización si la respuesta está en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="16f7b-293">For example, a caching filter can avoid the rest of the pipeline if the response is already in the cache.</span></span>

<span data-ttu-id="16f7b-294">El [filtro de recursos de evaluación "cortocircuitada" short](#short-circuiting-resource-filter) mostrado anteriormente es un ejemplo de un filtro de recurso.</span><span class="sxs-lookup"><span data-stu-id="16f7b-294">The [short circuiting resource filter](#short-circuiting-resource-filter) shown earlier is one example of a resource filter.</span></span> <span data-ttu-id="16f7b-295">Otro ejemplo es [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), lo que impide que el enlace de modelos tengan acceso a los datos del formulario.</span><span class="sxs-lookup"><span data-stu-id="16f7b-295">Another example is [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), which prevents model binding from accessing the form data.</span></span> <span data-ttu-id="16f7b-296">Es útil para los casos donde se sabe que va a recibir grandes cargas de archivos y desea impedir que el formulario que se va a leer en la memoria.</span><span class="sxs-lookup"><span data-stu-id="16f7b-296">It's useful for cases where you know that you're going to receive large file uploads and want to prevent the form from being read into memory.</span></span>

## <a name="action-filters"></a><span data-ttu-id="16f7b-297">Filtros de acción</span><span class="sxs-lookup"><span data-stu-id="16f7b-297">Action filters</span></span>

<span data-ttu-id="16f7b-298">*Filtros de acción* implementan la `IActionFilter` o `IAsyncActionFilter` interfaz y su ejecución rodea la ejecución de métodos de acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-298">*Action filters* implement either the `IActionFilter` or `IAsyncActionFilter` interface, and their execution surrounds the execution of action methods.</span></span>

<span data-ttu-id="16f7b-299">Este es un filtro de acción de ejemplo:</span><span class="sxs-lookup"><span data-stu-id="16f7b-299">Here's a sample action filter:</span></span>

<span data-ttu-id="16f7b-300">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?name=snippet_ActionFilter)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-300">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?name=snippet_ActionFilter)]</span></span>

<span data-ttu-id="16f7b-301">El [ResultExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) proporciona las siguientes propiedades:</span><span class="sxs-lookup"><span data-stu-id="16f7b-301">The [ActionExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) provides the following properties:</span></span>

* <span data-ttu-id="16f7b-302">`ActionArguments`-le permite manipular las entradas a la acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-302">`ActionArguments` - lets you manipulate the inputs to the action.</span></span>
* <span data-ttu-id="16f7b-303">`Controller`-le permite manipular la instancia del controlador.</span><span class="sxs-lookup"><span data-stu-id="16f7b-303">`Controller` - lets you manipulate the controller instance.</span></span> 
* <span data-ttu-id="16f7b-304">`Result`-Si se establece cortocircuita la ejecución del método de acción y filtros de acción posterior.</span><span class="sxs-lookup"><span data-stu-id="16f7b-304">`Result` - setting this short-circuits execution of the action method and subsequent action filters.</span></span> <span data-ttu-id="16f7b-305">Producir una excepción también impide la ejecución del método de acción y los filtros siguientes, pero se trata como un error en lugar de un resultado correcto.</span><span class="sxs-lookup"><span data-stu-id="16f7b-305">Throwing an exception also prevents execution of the action method and subsequent filters, but is treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="16f7b-306">El [ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) proporciona `Controller` y `Result` además de las siguientes propiedades:</span><span class="sxs-lookup"><span data-stu-id="16f7b-306">The [ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) provides `Controller` and `Result` plus the following properties:</span></span>

* <span data-ttu-id="16f7b-307">`Canceled`-será true si la ejecución de la acción se cortocircuitado por otro filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-307">`Canceled` - will be true if the action execution was short-circuited by another filter.</span></span>
* <span data-ttu-id="16f7b-308">`Exception`-será distinto de null si la acción o un filtro de acción posteriores produjo una excepción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-308">`Exception` - will be non-null if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="16f7b-309">Al establecer esta propiedad en null de forma eficaz 'handles' una excepción, y `Result` se ejecutará como si se han devuelto desde el método de acción normalmente.</span><span class="sxs-lookup"><span data-stu-id="16f7b-309">Setting this property to null effectively 'handles' an exception, and `Result` will be executed as if it were returned from the action method normally.</span></span>

<span data-ttu-id="16f7b-310">Para una `IAsyncActionFilter`, una llamada a la `ActionExecutionDelegate` ejecuta cualquier filtro de acción posterior y el método de acción, devolver un `ActionExecutedContext`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-310">For an `IAsyncActionFilter`, a call to the `ActionExecutionDelegate` executes any subsequent action filters and the action method, returning an `ActionExecutedContext`.</span></span> <span data-ttu-id="16f7b-311">De cortocircuito, asignar `ActionExecutingContext.Result` a algunos de los resultados de la instancia y no llame a la `ActionExecutionDelegate`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-311">To short-circuit, assign `ActionExecutingContext.Result` to some result instance and do not call the `ActionExecutionDelegate`.</span></span>

<span data-ttu-id="16f7b-312">El marco de trabajo proporciona un resumen `ActionFilterAttribute` que puede crear subclases.</span><span class="sxs-lookup"><span data-stu-id="16f7b-312">The framework provides an abstract `ActionFilterAttribute` that you can subclass.</span></span> 

<span data-ttu-id="16f7b-313">Puede utilizar un filtro de acción para validar el estado del modelo y devolver los errores si el estado es válido automáticamente:</span><span class="sxs-lookup"><span data-stu-id="16f7b-313">You can use an action filter to automatically validate model state and return any errors if the state is invalid:</span></span>

<span data-ttu-id="16f7b-314">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ValidateModelAttribute.cs)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-314">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ValidateModelAttribute.cs)]</span></span>

<span data-ttu-id="16f7b-315">El `OnActionExecuted` método ejecuta después del método de acción y puede ver y manipular los resultados de la acción a través de la `ActionExecutedContext.Result` propiedad.</span><span class="sxs-lookup"><span data-stu-id="16f7b-315">The `OnActionExecuted` method runs after the action method and can see and manipulate the results of the action through the `ActionExecutedContext.Result` property.</span></span> <span data-ttu-id="16f7b-316">`ActionExecutedContext.Canceled`se establecerá en true si la ejecución de la acción se cortocircuitado por otro filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-316">`ActionExecutedContext.Canceled` will be set to true if the action execution was short-circuited by another filter.</span></span> <span data-ttu-id="16f7b-317">`ActionExecutedContext.Exception`se establecerá en un valor distinto de null si la acción o un filtro de acción posteriores produjo una excepción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-317">`ActionExecutedContext.Exception` will be set to a non-null value if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="16f7b-318">Establecer `ActionExecutedContext.Exception` en null de forma eficaz 'handles' una excepción, y `ActionExectedContext.Result` , a continuación, se ejecutará como si se han devuelto desde el método de acción normalmente.</span><span class="sxs-lookup"><span data-stu-id="16f7b-318">Setting `ActionExecutedContext.Exception` to null effectively 'handles' an exception, and `ActionExectedContext.Result` will then be executed as if it were returned from the action method normally.</span></span>

## <a name="exception-filters"></a><span data-ttu-id="16f7b-319">Filtros de excepciones</span><span class="sxs-lookup"><span data-stu-id="16f7b-319">Exception filters</span></span>

<span data-ttu-id="16f7b-320">*Los filtros de excepción* implementan la `IExceptionFilter` o `IAsyncExceptionFilter` interfaz.</span><span class="sxs-lookup"><span data-stu-id="16f7b-320">*Exception filters* implement either the `IExceptionFilter` or `IAsyncExceptionFilter` interface.</span></span> <span data-ttu-id="16f7b-321">Puede utilizar para implementar directivas para una aplicación de control de errores comunes.</span><span class="sxs-lookup"><span data-stu-id="16f7b-321">They can be used to implement common error handling policies for an app.</span></span> 

<span data-ttu-id="16f7b-322">El filtro de excepción de ejemplo siguiente utiliza una vista de error de programador personalizado para mostrar los detalles sobre las excepciones que se producen cuando la aplicación está en desarrollo:</span><span class="sxs-lookup"><span data-stu-id="16f7b-322">The following sample exception filter uses a custom developer error view to display details about exceptions that occur when the application is in development:</span></span>

<span data-ttu-id="16f7b-323">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/CustomExceptionFilterAttribute.cs?name=snippet_ExceptionFilter&highlight=1,14)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-323">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/CustomExceptionFilterAttribute.cs?name=snippet_ExceptionFilter&highlight=1,14)]</span></span>

<span data-ttu-id="16f7b-324">Filtros de excepciones no tiene dos eventos (para antes y después de): solo implementan `OnException` (o `OnExceptionAsync`).</span><span class="sxs-lookup"><span data-stu-id="16f7b-324">Exception filters do not have two events (for before and after) - they only implement `OnException` (or `OnExceptionAsync`).</span></span> 

<span data-ttu-id="16f7b-325">Los filtros de excepción controlan las excepciones no controladas que se producen en la creación del controlador, [enlace de modelo](../models/model-binding.md), filtros de acción o métodos de acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-325">Exception filters handle unhandled exceptions that occur in controller creation, [model binding](../models/model-binding.md), action filters, or action methods.</span></span> <span data-ttu-id="16f7b-326">No detectar las excepciones que se producen en los filtros de recursos, filtros de resultados o ejecución de resultado de MVC.</span><span class="sxs-lookup"><span data-stu-id="16f7b-326">They won't catch exceptions that occur in Resource filters, Result filters, or MVC Result execution.</span></span>

<span data-ttu-id="16f7b-327">Para controlar una excepción, establezca la `ExceptionContext.ExceptionHandled` propiedad en true o escribir una respuesta.</span><span class="sxs-lookup"><span data-stu-id="16f7b-327">To handle an exception, set the `ExceptionContext.ExceptionHandled` property to true or write a response.</span></span> <span data-ttu-id="16f7b-328">Esto detiene la propagación de la excepción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-328">This stops propagation of the exception.</span></span> <span data-ttu-id="16f7b-329">Tenga en cuenta que un filtro de excepción no se puede activar una excepción en un estado "correcto".</span><span class="sxs-lookup"><span data-stu-id="16f7b-329">Note that an Exception filter can't turn an exception into a "success".</span></span> <span data-ttu-id="16f7b-330">Sólo un filtro de acción puede hacer eso.</span><span class="sxs-lookup"><span data-stu-id="16f7b-330">Only an Action filter can do that.</span></span>

> [!NOTE]
> <span data-ttu-id="16f7b-331">En ASP.NET 1.1, no se envía la respuesta si establece `ExceptionHandled` en true **y** escribir una respuesta.</span><span class="sxs-lookup"><span data-stu-id="16f7b-331">In ASP.NET 1.1, the response is not sent if you set `ExceptionHandled` to true **and** write a response.</span></span> <span data-ttu-id="16f7b-332">En ese caso, ASP.NET Core 1.0 enviar la respuesta y ASP.NET Core 1.1.2 devolverá al 1.0 comportamiento.</span><span class="sxs-lookup"><span data-stu-id="16f7b-332">In that scenario, ASP.NET Core 1.0 does send the response, and ASP.NET Core 1.1.2 will return to the 1.0 behavior.</span></span> <span data-ttu-id="16f7b-333">Para obtener más información, consulte [emitir #5594](https://github.com/aspnet/Mvc/issues/5594) en el repositorio de GitHub.</span><span class="sxs-lookup"><span data-stu-id="16f7b-333">For more information, see [issue #5594](https://github.com/aspnet/Mvc/issues/5594) in the GitHub repository.</span></span> 

<span data-ttu-id="16f7b-334">Los filtros de excepción son buenos para la captura de excepciones que se producen dentro de las acciones de MVC, pero no son lo más flexibles middleware de control de errores.</span><span class="sxs-lookup"><span data-stu-id="16f7b-334">Exception filters are good for trapping exceptions that occur within MVC actions, but they're not as flexible as error handling middleware.</span></span> <span data-ttu-id="16f7b-335">Prefiere middleware para el caso general y usar filtros sólo donde es necesario para realizar el control de errores *diferente* en función de qué acción de MVC se ha elegido.</span><span class="sxs-lookup"><span data-stu-id="16f7b-335">Prefer middleware for the general case, and use filters only where you need to do error handling *differently* based on which MVC action was chosen.</span></span> <span data-ttu-id="16f7b-336">Por ejemplo, la aplicación podría tener métodos de acción para ambos extremos de la API y vistas/HTML.</span><span class="sxs-lookup"><span data-stu-id="16f7b-336">For example, your app might have action methods for both API endpoints and for views/HTML.</span></span> <span data-ttu-id="16f7b-337">Los puntos de conexión de API pudieron devolver información de error como JSON, mientras que las acciones basadas en vistas pudieron devolver una página de error como HTML.</span><span class="sxs-lookup"><span data-stu-id="16f7b-337">The API endpoints could return error information as JSON, while the view-based actions could return an error page as HTML.</span></span>

<span data-ttu-id="16f7b-338">El marco de trabajo proporciona un resumen `ExceptionFilterAttribute` que puede crear subclases.</span><span class="sxs-lookup"><span data-stu-id="16f7b-338">The framework provides an abstract `ExceptionFilterAttribute` that you can subclass.</span></span> 

## <a name="result-filters"></a><span data-ttu-id="16f7b-339">Filtros de resultados</span><span class="sxs-lookup"><span data-stu-id="16f7b-339">Result filters</span></span>

<span data-ttu-id="16f7b-340">*Como resultado filtros* implementan la `IResultFilter` o `IAsyncResultFilter` interfaz y su ejecución rodea la ejecución de los resultados de la acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-340">*Result filters* implement either the `IResultFilter` or `IAsyncResultFilter` interface, and their execution surrounds the execution of action results.</span></span> 

<span data-ttu-id="16f7b-341">Este es un ejemplo de un filtro de resultado que agrega un encabezado HTTP.</span><span class="sxs-lookup"><span data-stu-id="16f7b-341">Here's an example of a Result filter that adds an HTTP header.</span></span>

<span data-ttu-id="16f7b-342">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LoggingAddHeaderFilter.cs?name=snippet_ResultFilter)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-342">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LoggingAddHeaderFilter.cs?name=snippet_ResultFilter)]</span></span>

<span data-ttu-id="16f7b-343">El tipo de resultado que se está ejecutando depende de la acción en cuestión.</span><span class="sxs-lookup"><span data-stu-id="16f7b-343">The kind of result being executed depends on the action in question.</span></span> <span data-ttu-id="16f7b-344">Una acción de MVC devuelve una vista incluye todos los razor procesamiento como parte de la `ViewResult` que se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="16f7b-344">An MVC action returning a view would include all razor processing as part of the `ViewResult` being executed.</span></span> <span data-ttu-id="16f7b-345">Un método de API puede llevar a cabo algunas serialización como parte de la ejecución del resultado.</span><span class="sxs-lookup"><span data-stu-id="16f7b-345">An API method might perform some serialization as part of the execution of the result.</span></span> <span data-ttu-id="16f7b-346">Obtenga más información sobre [resultados de acción](actions.md)</span><span class="sxs-lookup"><span data-stu-id="16f7b-346">Learn more about [action results](actions.md)</span></span>

<span data-ttu-id="16f7b-347">Filtros de resultados solo se ejecutan para resultados correctos - cuando la acción o filtros de acción no generan un resultado de acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-347">Result filters are only executed for successful results - when the action or action filters produce an action result.</span></span> <span data-ttu-id="16f7b-348">Filtros de resultados no se ejecutan cuando los filtros de excepción controlen una excepción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-348">Result filters are not executed when exception filters handle an exception.</span></span>

<span data-ttu-id="16f7b-349">El `OnResultExecuting` método de ejecución de los filtros de resultados siguientes y el resultado de la acción puede cortocircuito estableciendo `ResultExecutingContext.Cancel` en true.</span><span class="sxs-lookup"><span data-stu-id="16f7b-349">The `OnResultExecuting` method can short-circuit execution of the action result and subsequent result filters by setting `ResultExecutingContext.Cancel` to true.</span></span> <span data-ttu-id="16f7b-350">Por lo general debe escribir en el objeto de respuesta cuando evaluación "cortocircuitada" para evitar la generación de una respuesta vacía.</span><span class="sxs-lookup"><span data-stu-id="16f7b-350">You should generally write to the response object when short-circuiting to avoid generating an empty response.</span></span> <span data-ttu-id="16f7b-351">Producir una excepción también impedirá la ejecución de los filtros subsiguientes y el resultado de la acción, pero se tratará como un error en lugar de un resultado correcto.</span><span class="sxs-lookup"><span data-stu-id="16f7b-351">Throwing an exception will also prevent execution of the action result and subsequent filters, but will be treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="16f7b-352">Cuando el `OnResultExecuted` método ejecuciones, la respuesta es probable que se ha enviado al cliente y no se puede cambiar más (a menos que se inició una excepción).</span><span class="sxs-lookup"><span data-stu-id="16f7b-352">When the `OnResultExecuted` method runs, the response has likely been sent to the client and cannot be changed further (unless an exception was thrown).</span></span> <span data-ttu-id="16f7b-353">`ResultExecutedContext.Canceled`se establecerá en true si la ejecución del resultado de acción se cortocircuitado por otro filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-353">`ResultExecutedContext.Canceled` will be set to true if the action result execution was short-circuited by another filter.</span></span>

<span data-ttu-id="16f7b-354">`ResultExecutedContext.Exception`se establecerá en un valor distinto de null si el resultado de acción o un filtro de resultados siguientes produjo una excepción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-354">`ResultExecutedContext.Exception` will be set to a non-null value if the action result or a subsequent result filter threw an exception.</span></span> <span data-ttu-id="16f7b-355">Establecer `Exception` a null eficazmente 'handles' una excepción y evita que la excepción que se va a MVC vuelve a producir más adelante en la canalización.</span><span class="sxs-lookup"><span data-stu-id="16f7b-355">Setting `Exception` to null effectively 'handles' an exception and prevents the exception from being rethrown by MVC later in the pipeline.</span></span> <span data-ttu-id="16f7b-356">Cuando se está administrando una excepción en un filtro de resultado, no puede escribir datos en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="16f7b-356">When you're handling an exception in a result filter, you might not be able to write any data to the response.</span></span> <span data-ttu-id="16f7b-357">Si el resultado de acción mitad produce a través de su ejecución, y los encabezados ya se han vaciado en el cliente, no hay ningún mecanismo confiable para enviar un código de error.</span><span class="sxs-lookup"><span data-stu-id="16f7b-357">If the action result throws partway through its execution, and the headers have already been flushed to the client, there's no reliable mechanism to send a failure code.</span></span>

<span data-ttu-id="16f7b-358">Para una `IAsyncResultFilter` una llamada a `await next()` en el `ResultExecutionDelegate` ejecuta cualquier filtro de resultados siguientes y el resultado de acción.</span><span class="sxs-lookup"><span data-stu-id="16f7b-358">For an `IAsyncResultFilter` a call to `await next()` on the `ResultExecutionDelegate` executes any subsequent result filters and the action result.</span></span> <span data-ttu-id="16f7b-359">De cortocircuito, establezca `ResultExecutingContext.Cancel` en true y no llame a la `ResultExectionDelegate`.</span><span class="sxs-lookup"><span data-stu-id="16f7b-359">To short-circuit, set `ResultExecutingContext.Cancel` to true and do not call the `ResultExectionDelegate`.</span></span>

<span data-ttu-id="16f7b-360">El marco de trabajo proporciona un resumen `ResultFilterAttribute` que puede crear subclases.</span><span class="sxs-lookup"><span data-stu-id="16f7b-360">The framework provides an abstract `ResultFilterAttribute` that you can subclass.</span></span> <span data-ttu-id="16f7b-361">El [AddHeaderAttribute](#add-header-attribute) clase mostrado anteriormente es un ejemplo de un atributo de filtro de resultado.</span><span class="sxs-lookup"><span data-stu-id="16f7b-361">The [AddHeaderAttribute](#add-header-attribute) class shown earlier is an example of a result filter attribute.</span></span>

## <a name="using-middleware-in-the-filter-pipeline"></a><span data-ttu-id="16f7b-362">Uso de middleware en la canalización de filtro</span><span class="sxs-lookup"><span data-stu-id="16f7b-362">Using middleware in the filter pipeline</span></span>

<span data-ttu-id="16f7b-363">Filtros de recursos funcionan como [middleware](../../fundamentals/middleware.md) en que les rodea la ejecución de todo lo que se incluye más adelante en la canalización.</span><span class="sxs-lookup"><span data-stu-id="16f7b-363">Resource filters work like [middleware](../../fundamentals/middleware.md) in that they surround the execution of everything that comes later in the pipeline.</span></span> <span data-ttu-id="16f7b-364">Pero los filtros se diferencian de middleware en que forman parte de MVC, lo que significa que tienen acceso al contexto MVC y construcciones.</span><span class="sxs-lookup"><span data-stu-id="16f7b-364">But filters differ from middleware in that they are part of MVC, which means that they have access to MVC context and constructs.</span></span>

<span data-ttu-id="16f7b-365">En ASP.NET Core 1.1, puede usar middleware en la canalización de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-365">In ASP.NET Core 1.1, you can use middleware in the filter pipeline.</span></span> <span data-ttu-id="16f7b-366">Puede hacerlo si tiene un componente de middleware que necesita acceso a los datos de ruta MVC, o uno que se debe ejecutar solo para ciertos controladores o acciones.</span><span class="sxs-lookup"><span data-stu-id="16f7b-366">You might want to do that if you have a middleware component that needs access to MVC route data, or one that should run only for certain controllers or actions.</span></span>

<span data-ttu-id="16f7b-367">Para usar el middleware como un filtro, crear un tipo con un `Configure` método que especifica el middleware que desea insertar en la canalización de filtro.</span><span class="sxs-lookup"><span data-stu-id="16f7b-367">To use middleware as a filter, create a type with a `Configure` method that specifies the middleware that you want to inject into the filter pipeline.</span></span> <span data-ttu-id="16f7b-368">Este es un ejemplo que utiliza el middleware de localización para establecer la referencia cultural actual para una solicitud:</span><span class="sxs-lookup"><span data-stu-id="16f7b-368">Here's an example that uses the localization middleware to establish the current culture for a request:</span></span>

<span data-ttu-id="16f7b-369">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LocalizationPipeline.cs?name=snippet_MiddlewareFilter&highlight=3,21)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-369">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LocalizationPipeline.cs?name=snippet_MiddlewareFilter&highlight=3,21)]</span></span>

<span data-ttu-id="16f7b-370">A continuación, puede usar el `MiddlewareFilterAttribute` para ejecutar middleware de una acción o controlador seleccionado o de manera global:</span><span class="sxs-lookup"><span data-stu-id="16f7b-370">You can then use the `MiddlewareFilterAttribute` to run the middleware for a selected controller or action or globally:</span></span>

<span data-ttu-id="16f7b-371">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_MiddlewareFilter&highlight=2)]</span><span class="sxs-lookup"><span data-stu-id="16f7b-371">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_MiddlewareFilter&highlight=2)]</span></span>

<span data-ttu-id="16f7b-372">Filtros de middleware que se ejecuten en la misma fase de la canalización de filtros como filtros de recursos, antes del enlace de modelo y después el resto de la canalización.</span><span class="sxs-lookup"><span data-stu-id="16f7b-372">Middleware filters run at the same stage of the filter pipeline as Resource filters, before model binding and after the rest of the pipeline.</span></span>

## <a name="next-actions"></a><span data-ttu-id="16f7b-373">Acciones siguientes</span><span class="sxs-lookup"><span data-stu-id="16f7b-373">Next actions</span></span>

<span data-ttu-id="16f7b-374">Para experimentar con los filtros, [descargar, probar y modificar el ejemplo](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span><span class="sxs-lookup"><span data-stu-id="16f7b-374">To experiment with filters, [download, test and modify the sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>
