---
title: "Duración y administración de claves"
author: rick-anderson
description: "Describe la duración y la administración de claves."
keywords: "Clave de ASP.NET Core, administración, DPAPI, DataProtection"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: ef7dad2a-7029-4ae5-8f06-1fbebedccaa4
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/default-settings
ms.openlocfilehash: c361af7d336fc0f7651e5d2f28d71515e2949c65
ms.sourcegitcommit: 78d28178345a0eea91556e4cd1adad98b1446db8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/22/2017
---
# <a name="key-management-and-lifetime"></a><span data-ttu-id="4a5f2-104">Duración y administración de claves</span><span class="sxs-lookup"><span data-stu-id="4a5f2-104">Key management and lifetime</span></span>

<a name=data-protection-default-settings></a>

## <a name="key-management"></a><span data-ttu-id="4a5f2-105">Administración de claves</span><span class="sxs-lookup"><span data-stu-id="4a5f2-105">Key Management</span></span>

<span data-ttu-id="4a5f2-106">El sistema intenta detectar su entorno operativo y proporcionar valores predeterminados de comportamientos de sin configuración buena.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-106">The system tries to detect its operational environment and provide good zero-configuration behavioral defaults.</span></span> <span data-ttu-id="4a5f2-107">La heurística utilizada es la siguiente.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-107">The heuristic used is as follows.</span></span>

1. <span data-ttu-id="4a5f2-108">Si el sistema se hospedan en sitios Web Azure, las claves se guardan en la carpeta "% HOME%\ASP.NET\DataProtection-Keys".</span><span class="sxs-lookup"><span data-stu-id="4a5f2-108">If the system is being hosted in Azure Web Sites, keys are persisted to the "%HOME%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="4a5f2-109">Esta carpeta está respaldada por el almacenamiento de red y se sincroniza en todos los equipos que hospeda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-109">This folder is backed by network storage and is synchronized across all machines hosting the application.</span></span> <span data-ttu-id="4a5f2-110">Las claves no están protegidas en reposo.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-110">Keys are not protected at rest.</span></span> <span data-ttu-id="4a5f2-111">Esta carpeta proporciona el anillo de clave a todas las instancias de una aplicación en una única ranura de implementación.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-111">This folder supplies the key ring to all instances of an application in a single deployment slot.</span></span> <span data-ttu-id="4a5f2-112">Las ranuras de implementación independiente, por ejemplo, ensayo y producción, no compartirán un anillo de clave.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-112">Separate deployment slots, such as Staging and Production, will not share a key ring.</span></span> <span data-ttu-id="4a5f2-113">Al intercambiar las ranuras de implementación, por ejemplo, el intercambio de ensayo a producción o usando A / B pruebas, cualquier sistema mediante la protección de datos no podrá descifrar los datos almacenados mediante el anillo de clave dentro de la ranura anterior.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-113">When you swap between deployment slots, for example swapping Staging to Production or using A/B testing, any system using data protection will not be able to decrypt stored data using the key ring inside the previous slot.</span></span> <span data-ttu-id="4a5f2-114">Esto dará lugar a los usuarios que se están registrados fuera de una aplicación de ASP.NET que usa el middleware de cookies ASP.NET estándar, ya que usa protección de datos para proteger sus cookies.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-114">This will lead to users being logged out of an ASP.NET application that uses the standard ASP.NET cookie middleware, as it uses data protection to protect its cookies.</span></span> <span data-ttu-id="4a5f2-115">Si desea llaveros independiente de la ranura, utiliza un proveedor de anillo de clave externa, como almacenamiento de blobs de Azure, el almacén de claves de Azure, un almacén de SQL, o la caché en Redis.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-115">If you desire slot-independent key rings, use an external key ring provider, such as Azure Blob Storage, Azure Key Vault, a SQL store, or Redis cache.</span></span>

2. <span data-ttu-id="4a5f2-116">Si el perfil de usuario está disponible, las claves se guardan en la carpeta "% LOCALAPPDATA%\ASP.NET\DataProtection-Keys".</span><span class="sxs-lookup"><span data-stu-id="4a5f2-116">If the user profile is available, keys are persisted to the "%LOCALAPPDATA%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="4a5f2-117">Además, si el sistema operativo es Windows, podrá se cifran en reposo con DPAPI.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-117">Additionally, if the operating system is Windows, they'll be encrypted at rest using DPAPI.</span></span>

3. <span data-ttu-id="4a5f2-118">Si la aplicación se hospeda en IIS, las claves se conservan en el registro HKLM en una clave del registro especial que se disponen de las ACL solo a la cuenta de proceso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-118">If the application is hosted in IIS, keys are persisted to the HKLM registry in a special registry key that is ACLed only to the worker process account.</span></span> <span data-ttu-id="4a5f2-119">Las claves se cifran en reposo con DPAPI.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-119">Keys are encrypted at rest using DPAPI.</span></span>

4. <span data-ttu-id="4a5f2-120">Si coincide con ninguna de estas condiciones, no se conservan las claves fuera del proceso actual.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-120">If none of these conditions matches, keys are not persisted outside of the current process.</span></span> <span data-ttu-id="4a5f2-121">Cuando el proceso se cierra, todos los genera claves se perderán.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-121">When the process shuts down, all generated keys will be lost.</span></span>

<span data-ttu-id="4a5f2-122">El programador está siempre en control total y puede invalidar cómo y dónde se almacenan las claves.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-122">The developer is always in full control and can override how and where keys are stored.</span></span> <span data-ttu-id="4a5f2-123">Las tres primeras opciones anteriores deben buena valores predeterminados para la mayoría de las aplicaciones similar a cómo ASP.NET <machineKey> rutinas de la generación automática funcionaban en el pasado.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-123">The first three options above should good defaults for most applications similar to how the ASP.NET <machineKey> auto-generation routines worked in the past.</span></span> <span data-ttu-id="4a5f2-124">La última opción de recuperación de otoño es el único escenario que requiere realmente al programador especificar [configuración](overview.md) por adelantado si quieren persistencia de clave, pero este retroceso solo ocurre en raras ocasiones.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-124">The final, fall back option is the only scenario that truly requires the developer to specify [configuration](overview.md) upfront if they want key persistence, but this fall-back would only occur in rare situations.</span></span>

>[!WARNING]
> <span data-ttu-id="4a5f2-125">Si el desarrollador invalida esta heurística y señala el sistema de protección de datos en un repositorio de clave específico, se deshabilitará el cifrado automático de claves en reposo.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-125">If the developer overrides this heuristic and points the data protection system at a specific key repository, automatic encryption of keys at rest will be disabled.</span></span> <span data-ttu-id="4a5f2-126">En reposo protección puede habilitarse de nuevo a través de [configuración](overview.md).</span><span class="sxs-lookup"><span data-stu-id="4a5f2-126">At rest protection can be re-enabled via [configuration](overview.md).</span></span>

## <a name="key-lifetime"></a><span data-ttu-id="4a5f2-127">Vigencia de clave</span><span class="sxs-lookup"><span data-stu-id="4a5f2-127">Key Lifetime</span></span>

<span data-ttu-id="4a5f2-128">Las claves de forma predeterminada tienen una duración de 90 días.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-128">Keys by default have a 90-day lifetime.</span></span> <span data-ttu-id="4a5f2-129">Cuando expira una clave, el sistema automáticamente generará una nueva clave y establecer la nueva clave como la clave activa.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-129">When a key expires, the system will automatically generate a new key and set the new key as the active key.</span></span> <span data-ttu-id="4a5f2-130">Como claves retiradas permanecen en el sistema podrá descifrar los datos protegidos con ellos.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-130">As long as retired keys remain on the system you will still be able to decrypt any data protected with them.</span></span> <span data-ttu-id="4a5f2-131">Vea [administración de claves](../implementation/key-management.md#data-protection-implementation-key-management-expiration) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-131">See [key management](../implementation/key-management.md#data-protection-implementation-key-management-expiration) for more information.</span></span>

## <a name="default-algorithms"></a><span data-ttu-id="4a5f2-132">Algoritmos predeterminados</span><span class="sxs-lookup"><span data-stu-id="4a5f2-132">Default Algorithms</span></span>

<span data-ttu-id="4a5f2-133">El algoritmo de protección de carga predeterminado usado es AES-256-CBC para HMACSHA256 la confidencialidad y la autenticidad.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-133">The default payload protection algorithm used is AES-256-CBC for confidentiality and HMACSHA256 for authenticity.</span></span> <span data-ttu-id="4a5f2-134">Una clave maestra de 512 bits, revierte cada 90 días, se utiliza para derivar las claves secundarias dos utilizadas para estos algoritmos según una por cada carga.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-134">A 512-bit master key, rolled every 90 days, is used to derive the two sub-keys used for these algorithms on a per-payload basis.</span></span> <span data-ttu-id="4a5f2-135">Vea [subclave derivación](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="4a5f2-135">See [subkey derivation](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) for more information.</span></span>
