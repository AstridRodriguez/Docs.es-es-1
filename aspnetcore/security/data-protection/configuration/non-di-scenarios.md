---
title: DI no es compatible con escenarios
author: rick-anderson
description: 
keywords: "Núcleo de ASP.NET,"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: a7d8a962-80ff-48e3-96f6-8472b7ba2df9
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/non-di-scenarios
ms.openlocfilehash: 54a930c26f9f48ea0e6f7865e2927bcde0f4d6c0
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/11/2017
---
# <a name="non-di-aware-scenarios"></a><span data-ttu-id="298cc-103">DI no es compatible con escenarios</span><span class="sxs-lookup"><span data-stu-id="298cc-103">Non DI aware scenarios</span></span>

<span data-ttu-id="298cc-104">El sistema de protección de datos normalmente está diseñado [va a agregar a un contenedor de servicios](../consumer-apis/overview.md) y proporcionar a sus componentes dependientes a través de un mecanismo de DI.</span><span class="sxs-lookup"><span data-stu-id="298cc-104">The data protection system is normally designed [to be added to a service container](../consumer-apis/overview.md) and to be provided to dependent components via a DI mechanism.</span></span> <span data-ttu-id="298cc-105">Sin embargo, puede haber algunos casos donde esto no es factible, especialmente al importar el sistema en una aplicación existente.</span><span class="sxs-lookup"><span data-stu-id="298cc-105">However, there may be some cases where this is not feasible, especially when importing the system into an existing application.</span></span>

<span data-ttu-id="298cc-106">Para admitir estos escenarios el paquete Microsoft.AspNetCore.DataProtection.Extensions proporciona un tipo concreto DataProtectionProvider que ofrece una manera sencilla de usar el sistema de protección de datos sin tener que pasar a través de las rutas de código DI específica.</span><span class="sxs-lookup"><span data-stu-id="298cc-106">To support these scenarios the package Microsoft.AspNetCore.DataProtection.Extensions provides a concrete type DataProtectionProvider which offers a simple way to use the data protection system without going through DI-specific code paths.</span></span> <span data-ttu-id="298cc-107">El propio tipo implementa IDataProtectionProvider, y la creación, es tan fácil como proporcionar un DirectoryInfo dónde se deben almacenar las claves criptográficas de este proveedor.</span><span class="sxs-lookup"><span data-stu-id="298cc-107">The type itself implements IDataProtectionProvider, and constructing it is as easy as providing a DirectoryInfo where this provider's cryptographic keys should be stored.</span></span>

<span data-ttu-id="298cc-108">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="298cc-108">For example:</span></span>

<span data-ttu-id="298cc-109">[!code-none[Main](non-di-scenarios/_static/nodisample1.cs)]</span><span class="sxs-lookup"><span data-stu-id="298cc-109">[!code-none[Main](non-di-scenarios/_static/nodisample1.cs)]</span></span>

>[!WARNING]
> <span data-ttu-id="298cc-110">De forma predeterminada el DataProtectionProvider tipo concreto no cifra material de clave sin procesar antes la almacenarla en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="298cc-110">By default the DataProtectionProvider concrete type does not encrypt raw key material before persisting it to the file system.</span></span> <span data-ttu-id="298cc-111">Esto sirve para admitir escenarios donde se comparten los puntos de desarrollador a una red, en cuyo caso el sistema de protección de datos no puede deducir automáticamente un mecanismo de cifrado de clave adecuado en rest.</span><span class="sxs-lookup"><span data-stu-id="298cc-111">This is to support scenarios where the developer points to a network share, in which case the data protection system cannot automatically deduce an appropriate at-rest key encryption mechanism.</span></span>
>
><span data-ttu-id="298cc-112">Además, no el tipo concreto de DataProtectionProvider [aislar las aplicaciones](overview.md#data-protection-configuration-per-app-isolation) de forma predeterminada, por lo que todas las aplicaciones que apunta en el mismo directorio clave pueden compartir cargas siempre que coincidan con sus parámetros de uso.</span><span class="sxs-lookup"><span data-stu-id="298cc-112">Additionally, the DataProtectionProvider concrete type does not [isolate applications](overview.md#data-protection-configuration-per-app-isolation) by default, so all applications pointed at the same key directory can share payloads as long as their purpose parameters match.</span></span>

<span data-ttu-id="298cc-113">El desarrollador de aplicaciones puede resolver ambos si lo desea.</span><span class="sxs-lookup"><span data-stu-id="298cc-113">The application developer can address both of these if desired.</span></span> <span data-ttu-id="298cc-114">El constructor DataProtectionProvider acepta un [devolución de llamada de configuración opcional](overview.md#data-protection-configuration-callback) que se puede utilizar para ajustar los comportamientos del sistema.</span><span class="sxs-lookup"><span data-stu-id="298cc-114">The DataProtectionProvider constructor accepts an [optional configuration callback](overview.md#data-protection-configuration-callback) which can be used to tweak the behaviors of the system.</span></span> <span data-ttu-id="298cc-115">El ejemplo siguiente muestra la restauración aislamiento a través de una llamada explícita a SetApplicationName, y también se muestra la configuración del sistema para cifrar automáticamente las claves permanentes mediante DPAPI de Windows.</span><span class="sxs-lookup"><span data-stu-id="298cc-115">The sample below demonstrates restoring isolation via an explicit call to SetApplicationName, and it also demonstrates configuring the system to automatically encrypt persisted keys using Windows DPAPI.</span></span> <span data-ttu-id="298cc-116">Si el directorio apunta a un recurso compartido UNC, es recomendable que se va a distribuir un certificado compartido entre todos los equipos correspondientes como configurar el sistema para usar cifrado basado en certificados en su lugar mediante una llamada a [ProtectKeysWithCertificate](overview.md#configuring-x509-certificate).</span><span class="sxs-lookup"><span data-stu-id="298cc-116">If the directory points to a UNC share, you may wish to distribute a shared certificate across all relevant machines and to configure the system to use certificate-based encryption instead via a call to [ProtectKeysWithCertificate](overview.md#configuring-x509-certificate).</span></span>

<span data-ttu-id="298cc-117">[!code-none[Main](non-di-scenarios/_static/nodisample2.cs)]</span><span class="sxs-lookup"><span data-stu-id="298cc-117">[!code-none[Main](non-di-scenarios/_static/nodisample2.cs)]</span></span>

>[!TIP]
> <span data-ttu-id="298cc-118">Las instancias de un tipo concreto de DataProtectionProvider son caras de crear.</span><span class="sxs-lookup"><span data-stu-id="298cc-118">Instances of the DataProtectionProvider concrete type are expensive to create.</span></span> <span data-ttu-id="298cc-119">Si una aplicación mantiene varias instancias de este tipo y si está señala en el mismo directorio de almacenamiento de claves, el rendimiento de la aplicación puede verse afectado.</span><span class="sxs-lookup"><span data-stu-id="298cc-119">If an application maintains multiple instances of this type and if they're all pointing at the same key storage directory, application performance may be degraded.</span></span> <span data-ttu-id="298cc-120">El uso previsto es que el desarrollador de aplicaciones crear instancias de este tipo una vez tenga que volver a usar esta referencia única tanto como sea posible.</span><span class="sxs-lookup"><span data-stu-id="298cc-120">The intended usage is that the application developer instantiate this type once then keep reusing this single reference as much as possible.</span></span> <span data-ttu-id="298cc-121">El tipo de DataProtectionProvider y todas las instancias de IDataProtector creadas a partir de él son seguras para subprocesos para distintos llamadores.</span><span class="sxs-lookup"><span data-stu-id="298cc-121">The DataProtectionProvider type and all IDataProtector instances created from it are thread-safe for multiple callers.</span></span>
