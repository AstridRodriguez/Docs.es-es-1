---
title: Migrar desde el núcleo de ASP.NET 2.0 a 2.1
author: rick-anderson
description: Este artículo tratan los conceptos básicos sobre la migración de una aplicación de ASP.NET Core 2.0 a 2.1.
ms.author: riande
ms.date: 05/30/2018
uid: migration/20_21
ms.openlocfilehash: 8d27d916b04c12c17c0054de8392408f751b6990
ms.sourcegitcommit: 1faf2525902236428dae6a59e375519bafd5d6d7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/28/2018
ms.locfileid: "37089898"
---
# <a name="migrate-from-aspnet-core-20-to-21"></a><span data-ttu-id="20e23-103">Migrar desde el núcleo de ASP.NET 2.0 a 2.1</span><span class="sxs-lookup"><span data-stu-id="20e23-103">Migrate from ASP.NET Core 2.0 to 2.1</span></span>

<span data-ttu-id="20e23-104">Por [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="20e23-104">By [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="20e23-105">Vea [Novedades de ASP.NET Core 2.1](xref:aspnetcore-2.1) para obtener información general de las nuevas características de ASP.NET Core 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-105">See [What's new in ASP.NET Core 2.1](xref:aspnetcore-2.1) for an overview of the new features in ASP.NET Core 2.1.</span></span>

<span data-ttu-id="20e23-106">En este artículo:</span><span class="sxs-lookup"><span data-stu-id="20e23-106">This article:</span></span>

* <span data-ttu-id="20e23-107">Explica los conceptos básicos sobre la migración de una aplicación de ASP.NET Core 2.0 a 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-107">Covers the basics of migrating an ASP.NET Core 2.0 app to 2.1.</span></span>
* <span data-ttu-id="20e23-108">Proporciona una visión general de los cambios realizados en las plantillas de aplicación web de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="20e23-108">Provides an overview of the changes to the ASP.NET Core web application templates.</span></span>

<span data-ttu-id="20e23-109">Es una forma rápida de obtener una visión general de los cambios en 2.1:</span><span class="sxs-lookup"><span data-stu-id="20e23-109">A quick way to get an overview of the changes in 2.1 is to:</span></span>

* <span data-ttu-id="20e23-110">Crear una aplicación web de ASP.NET Core 2.0 denominada WebApp1.</span><span class="sxs-lookup"><span data-stu-id="20e23-110">Create an ASP.NET Core 2.0 web app named WebApp1.</span></span>
* <span data-ttu-id="20e23-111">Confirmar la WebApp1 en un sistema de control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="20e23-111">Commit the WebApp1 in a source control system.</span></span>
* <span data-ttu-id="20e23-112">Elimine WebApp1 y cree una aplicación web de ASP.NET Core 2.1 denominada WebApp1 en el mismo lugar.</span><span class="sxs-lookup"><span data-stu-id="20e23-112">Delete WebApp1 and create an ASP.NET Core 2.1 web app named WebApp1 in the same place.</span></span>
* <span data-ttu-id="20e23-113">Revise los cambios en la versión 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-113">Review the changes in the 2.1 version.</span></span>

<span data-ttu-id="20e23-114">Este artículo proporciona información general sobre la migración a ASP.NET Core 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-114">This article provides an overview on migration to  ASP.NET Core 2.1.</span></span> <span data-ttu-id="20e23-115">No contiene una lista completa de todos los cambios necesarios para migrar a la versión 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-115">It does not contain a complete list of all changes needed to migrate to version 2.1.</span></span> <span data-ttu-id="20e23-116">Algunos proyectos pueden requerir más pasos dependiendo de las opciones seleccionadas cuando se creó el proyecto y las modificaciones realizadas en el proyecto.</span><span class="sxs-lookup"><span data-stu-id="20e23-116">Some projects might require more steps depending on the options selected when the project was created and modifications made to the project.</span></span>

## <a name="update-the-project-file-to-use-21-versions"></a><span data-ttu-id="20e23-117">Actualice el archivo de proyecto para usar 2.1 versiones</span><span class="sxs-lookup"><span data-stu-id="20e23-117">Update the project file to use 2.1 versions</span></span>

<span data-ttu-id="20e23-118">Actualización de la *.csproj* archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="20e23-118">Update the *.csproj* project file:</span></span>

* <span data-ttu-id="20e23-119">Cambio `<TargetFramework>netcoreapp2.0</TargetFramework>` a la versión 2.1, que es `<TargetFramework>netcoreapp2.1</TargetFramework>`.</span><span class="sxs-lookup"><span data-stu-id="20e23-119">Change `<TargetFramework>netcoreapp2.0</TargetFramework>` to the 2.1 version, that is `<TargetFramework>netcoreapp2.1</TargetFramework>`.</span></span>
* <span data-ttu-id="20e23-120">Reemplazar la versión había especificada "Microsoft.AspNetCore.All" referencia de paquetes con la referencia de paquete "Microsoft.AspNetCore.App" sin versión.</span><span class="sxs-lookup"><span data-stu-id="20e23-120">Replace the version specified "Microsoft.AspNetCore.All" package reference with the versionless "Microsoft.AspNetCore.App" package reference.</span></span> <span data-ttu-id="20e23-121">Debe agregar las dependencias que se quitaron de "Microsoft.AspNetCore.All".</span><span class="sxs-lookup"><span data-stu-id="20e23-121">You may need to add dependencies that were removed from "Microsoft.AspNetCore.All".</span></span> <span data-ttu-id="20e23-122">Vea [migración desde Microsoft.AspNetCore.All a Microsoft.AspNetCore.App](xref:fundamentals/metapackage#migrate) y [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span><span class="sxs-lookup"><span data-stu-id="20e23-122">See [Migrating from Microsoft.AspNetCore.All to Microsoft.AspNetCore.App](xref:fundamentals/metapackage#migrate) and [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span></span> <span data-ttu-id="20e23-123">Si tiene como destino .NET Framework:</span><span class="sxs-lookup"><span data-stu-id="20e23-123">If you're targetting the .NET Framework:</span></span>

  * <span data-ttu-id="20e23-124">Agregar referencias de paquete individual en lugar de una referencia de paquete meta.</span><span class="sxs-lookup"><span data-stu-id="20e23-124">Add individual package references instead of a meta package reference.</span></span>
  * <span data-ttu-id="20e23-125">Actualizar cada referencia de paquete a 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-125">Update each package reference to 2.1.</span></span>
* <span data-ttu-id="20e23-126">Quite todas las referencias a `<DotNetCliToolReference>` elementos para los paquetes "Microsoft.AspNetCore", "Microsoft.VisualStudio" y "Microsoft.EntityFrameworkCore".</span><span class="sxs-lookup"><span data-stu-id="20e23-126">Remove all references to `<DotNetCliToolReference>` elements for "Microsoft.AspNetCore", "Microsoft.VisualStudio", and "Microsoft.EntityFrameworkCore" packages.</span></span> <span data-ttu-id="20e23-127">Estas herramientas se han reemplazado por herramientas globales.</span><span class="sxs-lookup"><span data-stu-id="20e23-127">These tools have been replaced by global tools.</span></span>

<span data-ttu-id="20e23-128">El marcado siguiente se muestra la plantilla genera 2.0 *.csproj* archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="20e23-128">The following markup shows the template generated 2.0 *.csproj* project file:</span></span>

[!code-xml[Main](20_21/sample/WebApp20.csproj)]

<span data-ttu-id="20e23-129">El marcado siguiente se muestra la plantilla genera 2.1 *.csproj* archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="20e23-129">The following markup shows the template generated 2.1 *.csproj* project file:</span></span>

[!code-xml[Main](20_21/sample/WebApp21.csproj)]

## <a name="rules-for-projects-targeting-the-shared-runtime"></a><span data-ttu-id="20e23-130">Reglas para proyectos tienen como destino el tiempo de ejecución compartido</span><span class="sxs-lookup"><span data-stu-id="20e23-130">Rules for projects targeting the shared runtime</span></span>

<span data-ttu-id="20e23-131">ASP.NET Core incluye los tiempos de ejecución compartido siguientes:</span><span class="sxs-lookup"><span data-stu-id="20e23-131">ASP.NET Core includes the following shared runtimes:</span></span>

* [<span data-ttu-id="20e23-132">Microsoft.AspNetCore.App</span><span class="sxs-lookup"><span data-stu-id="20e23-132">Microsoft.AspNetCore.App</span></span>](xref:fundamentals/metapackage-app)
* [<span data-ttu-id="20e23-133">Microsoft.AspNetCore.All</span><span class="sxs-lookup"><span data-stu-id="20e23-133">Microsoft.AspNetCore.All</span></span>](xref:fundamentals/metapackage)

<span data-ttu-id="20e23-134">Reglas para los proyectos de destino es el runtime compartido:</span><span class="sxs-lookup"><span data-stu-id="20e23-134">Rules for projects targeting the shared runtime:</span></span>

* <span data-ttu-id="20e23-135">Los proyectos que hacen referencia a la `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App` paquetes deben establecer SDK del proyecto en `Microsoft.NET.Sdk.Web` en la parte superior del archivo del proyecto (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span><span class="sxs-lookup"><span data-stu-id="20e23-135">Projects referencing the `Microsoft.AspNetCore.All` or `Microsoft.AspNetCore.App` packages must set the project's SDK to `Microsoft.NET.Sdk.Web` at the top of the project file (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span></span>
* <span data-ttu-id="20e23-136">Los proyectos que hacen referencia a paquetes o proyectos que hacen referencia a transitivamente `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`:</span><span class="sxs-lookup"><span data-stu-id="20e23-136">Projects referencing packages or projects that transitively reference `Microsoft.AspNetCore.All` or `Microsoft.AspNetCore.App`:</span></span>
  * <span data-ttu-id="20e23-137">Debe establecer el SDK del proyecto en `Microsoft.NET.Sdk.Web` en la parte superior del archivo del proyecto (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span><span class="sxs-lookup"><span data-stu-id="20e23-137">Must set the project's SDK to `Microsoft.NET.Sdk.Web` at the top of the project file (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span></span>
  * <span data-ttu-id="20e23-138">Debe hacer referencia el mismo paquete en tiempo de ejecución compartido.</span><span class="sxs-lookup"><span data-stu-id="20e23-138">Must reference the same shared runtime package.</span></span> <span data-ttu-id="20e23-139">Si hace referencia a LibraryA `Microsoft.AspNetCore.App`, también deben hacer referencia a todos los proyectos que hacen referencia a LibraryA `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="20e23-139">If LibraryA references `Microsoft.AspNetCore.App`, any projects referencing LibraryA must also reference `Microsoft.AspNetCore.App`.</span></span>
* <span data-ttu-id="20e23-140">Proyectos ejecutables (proyectos que contienen aplicaciones que se inician con `dotnet run` o aplicaciones que se ejecutan y proyectos para las aplicaciones de prueba) no se debe especificar una versión para `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="20e23-140">Executable projects (projects that contain apps that are launched with `dotnet run` or apps that run and test projects for apps) must not specify a version for `Microsoft.AspNetCore.App`.</span></span> <span data-ttu-id="20e23-141">El SDK especifica la versión implícitamente a través `<PackageReference Include="Microsoft.AspNetCore.App" />`.</span><span class="sxs-lookup"><span data-stu-id="20e23-141">The SDK specifies the version implicitly via `<PackageReference Include="Microsoft.AspNetCore.App" />`.</span></span>
* <span data-ttu-id="20e23-142">Hacer referencia a proyectos (proyectos que no son el punto de entrada y las referencias del proyecto `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`) debe especificar una versión del paquete.</span><span class="sxs-lookup"><span data-stu-id="20e23-142">Referenced projects (projects that aren't the entry point and the project references `Microsoft.AspNetCore.All` or `Microsoft.AspNetCore.App`) must specify a package version.</span></span>

## <a name="changes-to-take-advantage-of-the-new-code-based-idioms-that-are-recommended-in-aspnet-core-21"></a><span data-ttu-id="20e23-143">Cambios para aprovechar las ventajas de las expresiones nueva basada en código que se recomiendan en ASP.NET Core 2.1</span><span class="sxs-lookup"><span data-stu-id="20e23-143">Changes to take advantage of the new code-based idioms that are recommended in ASP.NET Core 2.1</span></span>

### <a name="changes-to-main"></a><span data-ttu-id="20e23-144">Cambios a la página principal</span><span class="sxs-lookup"><span data-stu-id="20e23-144">Changes to Main</span></span>

<span data-ttu-id="20e23-145">Las siguientes imágenes muestran los cambios realizados en la plantilla genera *Program.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="20e23-145">The following images show the changes made to the templated generated *Program.cs* file.</span></span>

![diferencias de versión anterior](20_21/_static/main20.png)

<span data-ttu-id="20e23-147">La imagen anterior muestra la versión 2.0 con las eliminaciones en color rojo.</span><span class="sxs-lookup"><span data-stu-id="20e23-147">The preceding image shows the 2.0 version with the deletions in red.</span></span>

<span data-ttu-id="20e23-148">La siguiente imagen muestra el código 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-148">The following image shows the 2.1 code.</span></span> <span data-ttu-id="20e23-149">El código en verde sustituye a la versión 2.0:</span><span class="sxs-lookup"><span data-stu-id="20e23-149">The code in green replaced the 2.0 version:</span></span>

![diferencias de versión nuevo](20_21/_static/main21.png)

<span data-ttu-id="20e23-151">El código siguiente muestra la versión 2.1 de *Program.cs*:</span><span class="sxs-lookup"><span data-stu-id="20e23-151">The following code shows the 2.1 version of *Program.cs*:</span></span>

[!code-csharp[Main](20_21/sample/Program.cs?name=snippet)]

<span data-ttu-id="20e23-152">El nuevo `Main` reemplaza la llamada a `BuildWebHost` con [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder).</span><span class="sxs-lookup"><span data-stu-id="20e23-152">The new `Main` replaces the call to `BuildWebHost` with [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder).</span></span> <span data-ttu-id="20e23-153">[IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) se agregó para admitir un nuevo [infraestructura de pruebas de integración](xref:test/integration-tests).</span><span class="sxs-lookup"><span data-stu-id="20e23-153">[IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) was added to support a new [integration test infrastructure](xref:test/integration-tests).</span></span>

### <a name="changes-to-startup"></a><span data-ttu-id="20e23-154">Cambios en el inicio</span><span class="sxs-lookup"><span data-stu-id="20e23-154">Changes to Startup</span></span>

<span data-ttu-id="20e23-155">El código siguiente muestra los cambios al código de plantilla 2.1 generado.</span><span class="sxs-lookup"><span data-stu-id="20e23-155">The following code shows the changes to 2.1 template generated code.</span></span> <span data-ttu-id="20e23-156">Todos los cambios se agregan recién código, salvo que `UseBrowserLink` se ha quitado:</span><span class="sxs-lookup"><span data-stu-id="20e23-156">All changes are newly added code, except that `UseBrowserLink` has been removed:</span></span>

[!code-csharp[Main](20_21/sample/Startup.cs?highlight=3,4,21-26,30,42,45,47)]

<span data-ttu-id="20e23-157">Los cambios de código anterior se detallan en:</span><span class="sxs-lookup"><span data-stu-id="20e23-157">The preceding code changes are detailed in:</span></span>

* <span data-ttu-id="20e23-158">[Compatibilidad con GDPR en ASP.NET Core](xref:security/gdpr) para `CookiePolicyOptions` y `UseCookiePolicy`.</span><span class="sxs-lookup"><span data-stu-id="20e23-158">[GDPR support in ASP.NET Core](xref:security/gdpr) for `CookiePolicyOptions` and `UseCookiePolicy`.</span></span>
* <span data-ttu-id="20e23-159">[Protocolo de seguridad de transporte estrictos de HTTP (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) para `UseHsts`.</span><span class="sxs-lookup"><span data-stu-id="20e23-159">[HTTP Strict Transport Security Protocol (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) for `UseHsts`.</span></span>
* <span data-ttu-id="20e23-160">[Requerir HTTPS](xref:security/enforcing-ssl#require-https) para `UseHttpsRedirection`.</span><span class="sxs-lookup"><span data-stu-id="20e23-160">[Require HTTPS](xref:security/enforcing-ssl#require-https) for `UseHttpsRedirection`.</span></span>
* <span data-ttu-id="20e23-161">[SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) para `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.</span><span class="sxs-lookup"><span data-stu-id="20e23-161">[SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) for `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.</span></span>

## <a name="changes-to-authentication-code"></a><span data-ttu-id="20e23-162">Cambios en el código de autenticación</span><span class="sxs-lookup"><span data-stu-id="20e23-162">Changes to authentication code</span></span>

<span data-ttu-id="20e23-163">ASP.NET Core 2.1 proporciona [ASP.NET Core Identity](xref:security/authentication/identity) como un [biblioteca de clases de Razor](xref:razor-pages/ui-class) (RCL).</span><span class="sxs-lookup"><span data-stu-id="20e23-163">ASP.NET Core 2.1 provides [ASP.NET Core Identity](xref:security/authentication/identity) as a [Razor Class Library](xref:razor-pages/ui-class) (RCL).</span></span>

<span data-ttu-id="20e23-164">El valor predeterminado 2.1 interfaz de usuario de identidad actualmente no proporciona nuevas características importantes con respecto a la versión 2.0.</span><span class="sxs-lookup"><span data-stu-id="20e23-164">The default 2.1 Identity UI doesn't currently provide significant new features over the 2.0 version.</span></span> <span data-ttu-id="20e23-165">Sustituyendo la identidad con el paquete RCL es opcional.</span><span class="sxs-lookup"><span data-stu-id="20e23-165">Replacing Identity with the RCL package is optional.</span></span> <span data-ttu-id="20e23-166">Las ventajas para reemplazar la plantilla generan identidad código con la versión RCL incluye:</span><span class="sxs-lookup"><span data-stu-id="20e23-166">The advantages to replacing the template generated Identity code with the RCL version include:</span></span>

* <span data-ttu-id="20e23-167">Todos los archivos se mueven fuera del árbol de código fuente.</span><span class="sxs-lookup"><span data-stu-id="20e23-167">Many files are moved out of your source tree.</span></span>
* <span data-ttu-id="20e23-168">Nuevas características de identidad ni correcciones de errores se incluyen en el [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span><span class="sxs-lookup"><span data-stu-id="20e23-168">Any bug fixes or new features to Identity are included in the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span></span> <span data-ttu-id="20e23-169">Obtendrá automáticamente la identidad actualizada cuando `Microsoft.AspNetCore.App` se actualiza.</span><span class="sxs-lookup"><span data-stu-id="20e23-169">You automatically get the updated Identity when `Microsoft.AspNetCore.App` is updated.</span></span>

<span data-ttu-id="20e23-170">Si ha tomado no trivial cambios a la plantilla generan código de identidad:</span><span class="sxs-lookup"><span data-stu-id="20e23-170">If you've made non-trivial changes to the template generated Identity code:</span></span>

* <span data-ttu-id="20e23-171">Las ventajas anteriores no pueden justificar la conversión a la versión de RCL.</span><span class="sxs-lookup"><span data-stu-id="20e23-171">The preceding advantages may not justify converting to the the RCL version.</span></span>
* <span data-ttu-id="20e23-172">Puede mantener el código de ASP.NET Core 2.0 Identity, es totalmente compatible.</span><span class="sxs-lookup"><span data-stu-id="20e23-172">You can keep your ASP.NET Core 2.0 Identity code, it's fully supported.</span></span>

<span data-ttu-id="20e23-173">Identidad 2.1 expone extremos con el `Identity` área.</span><span class="sxs-lookup"><span data-stu-id="20e23-173">Identity 2.1 exposes endpoints with the `Identity` area.</span></span> <span data-ttu-id="20e23-174">Por ejemplo, en la tabla siguiente se muestra ejemplos de puntos de conexión de identidad que cambian de 2.0 a 2.1:</span><span class="sxs-lookup"><span data-stu-id="20e23-174">For example, the follow table shows examples of Identity endpoints that change from 2.0 to 2.1:</span></span>

| <span data-ttu-id="20e23-175">2.0 DIRECCIÓN URL DE</span><span class="sxs-lookup"><span data-stu-id="20e23-175">2.0 URL</span></span>         | <span data-ttu-id="20e23-176">2.1 DIRECCIÓN URL DE</span><span class="sxs-lookup"><span data-stu-id="20e23-176">2.1 URL</span></span> |
| --------------- | ------------ |
| <span data-ttu-id="20e23-177">/ Cuenta/inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="20e23-177">/Account/Login</span></span>  | <span data-ttu-id="20e23-178">/ / Cuenta/inicio de sesión identidades</span><span class="sxs-lookup"><span data-stu-id="20e23-178">/Identity/Account/Login</span></span> |
| <span data-ttu-id="20e23-179">/ Cuenta/cierre de sesión</span><span class="sxs-lookup"><span data-stu-id="20e23-179">/Account/Logout</span></span> | <span data-ttu-id="20e23-180">/ Identidad/cuenta/cierre de sesión</span><span class="sxs-lookup"><span data-stu-id="20e23-180">/Identity/Account/Logout</span></span> |
| <span data-ttu-id="20e23-181">/ Cuenta/administrar</span><span class="sxs-lookup"><span data-stu-id="20e23-181">/Account/Manage</span></span> | <span data-ttu-id="20e23-182">/ Identidad/cuenta/administrar</span><span class="sxs-lookup"><span data-stu-id="20e23-182">/Identity/Account/Manage</span></span> |

<span data-ttu-id="20e23-183">Interfaz de usuario de identidad con la necesidad de biblioteca de identidad 2.1 para tener en cuenta las direcciones URL de identidad de las aplicaciones que tienen código de uso de la identidad y reemplace 2.0 tienen `/Identity` segmento antepuesto a los URI.</span><span class="sxs-lookup"><span data-stu-id="20e23-183">Applications that have code using Identity and replace 2.0 Identity UI with the 2.1 Identity Library need to take into account Identity URLs have `/Identity` segement prepended to the URIs.</span></span> <span data-ttu-id="20e23-184">Una manera de controlar el nuevo es configurar redirecciones, por ejemplo desde los puntos de conexión de identidad `/Account/Login` a `/Identity/Account/Login`.</span><span class="sxs-lookup"><span data-stu-id="20e23-184">One way to handle the new Identity endpoints is to set up redirects, for example from `/Account/Login` to `/Identity/Account/Login`.</span></span>

### <a name="update-identity-to-version-21"></a><span data-ttu-id="20e23-185">Identidad de la actualización a la versión 2.1</span><span class="sxs-lookup"><span data-stu-id="20e23-185">Update Identity to version 2.1</span></span>

<span data-ttu-id="20e23-186">Las siguientes opciones están disponibles para actualizar la identidad a 2.1.</span><span class="sxs-lookup"><span data-stu-id="20e23-186">The following options are available to update Identity to 2.1.</span></span>

* <span data-ttu-id="20e23-187">Utilice el código 2.0 de la interfaz de usuario de identidad sin realizar ningún cambio.</span><span class="sxs-lookup"><span data-stu-id="20e23-187">Use the Identity UI 2.0 code with no changes.</span></span> <span data-ttu-id="20e23-188">Usando código 2.0 de la interfaz de usuario de identidad es totalmente compatible.</span><span class="sxs-lookup"><span data-stu-id="20e23-188">Using Identity UI 2.0 code is fully supported.</span></span> <span data-ttu-id="20e23-189">Esto es un enfoque adecuado cuando se han efectuado cambios significativo para el código de identidad generado.</span><span class="sxs-lookup"><span data-stu-id="20e23-189">This is a good approach when signficant changes have been made to the generated Identity code.</span></span>
* <span data-ttu-id="20e23-190">Elimine el código existente de identidad 2.0 y [Scaffold identidad](xref:security/authentication/scaffold-identity) en el proyecto.</span><span class="sxs-lookup"><span data-stu-id="20e23-190">Delete your existing Identity 2.0 code and [Scaffold Identity](xref:security/authentication/scaffold-identity) into your project.</span></span> <span data-ttu-id="20e23-191">El proyecto usará el [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteca de clases de Razor](xref:razor-pages/ui-class).</span><span class="sxs-lookup"><span data-stu-id="20e23-191">Your project will use the [ASP.NET Core Identity](xref:security/authentication/identity) [Razor Class Library](xref:razor-pages/ui-class).</span></span> <span data-ttu-id="20e23-192">Puede generar código y la interfaz de usuario para el código de interfaz de usuario de identidad que se ha modificado.</span><span class="sxs-lookup"><span data-stu-id="20e23-192">You can generate code and UI for any of the Identity UI code that you modified.</span></span> <span data-ttu-id="20e23-193">Aplicar los cambios de código para el código de interfaz de usuario recién con scaffolding.</span><span class="sxs-lookup"><span data-stu-id="20e23-193">Apply your code changes to the newly scaffolded UI code.</span></span>
* <span data-ttu-id="20e23-194">Elimine el código existente de identidad 2.0 y [Scaffold identidad](xref:security/authentication/scaffold-identity) en el proyecto con la opción de **invalidar todos los archivos**.</span><span class="sxs-lookup"><span data-stu-id="20e23-194">Delete your existing Identity 2.0 code and [Scaffold Identity](xref:security/authentication/scaffold-identity) into your project with the option to **Override all files**.</span></span>

### <a name="replace-identity-20-ui-with-the-identity-21-razor-class-library"></a><span data-ttu-id="20e23-195">Reemplazar identidad 2.0 IU con la biblioteca de clases de identidad 2.1 Razor</span><span class="sxs-lookup"><span data-stu-id="20e23-195">Replace Identity 2.0 UI with the Identity 2.1 Razor Class Library</span></span>

<span data-ttu-id="20e23-196">En esta sección se describe los pasos para reemplazar el código de identidad de plantilla que genera ASP.NET Core 2.0 con el [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteca de clases de Razor](xref:razor-pages/ui-class).</span><span class="sxs-lookup"><span data-stu-id="20e23-196">This section outlines the steps to replace the ASP.NET Core 2.0 template generated Identity code with the [ASP.NET Core Identity](xref:security/authentication/identity) [Razor Class Library](xref:razor-pages/ui-class).</span></span> <span data-ttu-id="20e23-197">Los pasos siguientes son para un proyecto de las páginas de Razor, pero el enfoque de un proyecto de MVC es similar.</span><span class="sxs-lookup"><span data-stu-id="20e23-197">The following steps are for a Razor Pages project, but the approach for an MVC project is similar.</span></span>

* <span data-ttu-id="20e23-198">Compruebe el [archivo de proyecto se actualiza para usar 2.1 versiones](#update-the-project-file-to-use-21-versions)</span><span class="sxs-lookup"><span data-stu-id="20e23-198">Verify the [project file is updated to use 2.1 versions](#update-the-project-file-to-use-21-versions)</span></span>
* <span data-ttu-id="20e23-199">Elimine las siguientes carpetas y todos los archivos contenidos en ellas:</span><span class="sxs-lookup"><span data-stu-id="20e23-199">Delete the following folders and all the files in them:</span></span>
  * <span data-ttu-id="20e23-200">*Controladores*</span><span class="sxs-lookup"><span data-stu-id="20e23-200">*Controllers*</span></span>
  * <span data-ttu-id="20e23-201">*Páginas/cuenta /*</span><span class="sxs-lookup"><span data-stu-id="20e23-201">*Pages/Account/*</span></span>
  * <span data-ttu-id="20e23-202">*Extensiones*</span><span class="sxs-lookup"><span data-stu-id="20e23-202">*Extensions*</span></span>
* <span data-ttu-id="20e23-203">Compile el proyecto.</span><span class="sxs-lookup"><span data-stu-id="20e23-203">Build the project.</span></span>
* <span data-ttu-id="20e23-204">[Aplicar la técnica scaffolding identidad](xref:security/authentication/scaffold-identity) en el proyecto:</span><span class="sxs-lookup"><span data-stu-id="20e23-204">[Scaffold Identity](xref:security/authentication/scaffold-identity) into your project:</span></span>
  * <span data-ttu-id="20e23-205">Seleccione los proyectos salir *_Layout.cshtml* archivo.</span><span class="sxs-lookup"><span data-stu-id="20e23-205">Select the projects exiting *_Layout.cshtml* file.</span></span>
  * <span data-ttu-id="20e23-206">Seleccione el **+** icono en el lado derecho de la **clase de contexto de datos**.</span><span class="sxs-lookup"><span data-stu-id="20e23-206">Select the **+** icon on the right side of the **Data context class**.</span></span> <span data-ttu-id="20e23-207">Acepte el nombre predeterminado.</span><span class="sxs-lookup"><span data-stu-id="20e23-207">Accept the default name.</span></span>
  * <span data-ttu-id="20e23-208">Seleccione **agregar** para crear una nueva clase de contexto de datos.</span><span class="sxs-lookup"><span data-stu-id="20e23-208">Select **Add** to create a new Data context class.</span></span> <span data-ttu-id="20e23-209">Crear un nuevo contexto de datos es necesario para aplicar la técnica scaffolding.</span><span class="sxs-lookup"><span data-stu-id="20e23-209">Creating a new data context is required for to scaffold.</span></span> <span data-ttu-id="20e23-210">Quite el nuevo contexto de datos en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="20e23-210">You remove the new data context in the next section.</span></span>

### <a name="update-after-scaffolding-identity"></a><span data-ttu-id="20e23-211">Actualizar después de la identidad de scaffolding</span><span class="sxs-lookup"><span data-stu-id="20e23-211">Update after scaffolding Identity</span></span>

* <span data-ttu-id="20e23-212">Eliminar el scaffolder de identidad generado `IdentityDbContext` clase derivada en la *áreas/identidad/Data/* carpeta.</span><span class="sxs-lookup"><span data-stu-id="20e23-212">Delete the Identity scaffolder generated `IdentityDbContext` derrived class in the *Areas/Identity/Data/* folder.</span></span>
* <span data-ttu-id="20e23-213">Eliminar *Areas/Identity/IdentityHostingStartup.cs*</span><span class="sxs-lookup"><span data-stu-id="20e23-213">Delete *Areas/Identity/IdentityHostingStartup.cs*</span></span>
* <span data-ttu-id="20e23-214">Actualización de la *_LoginPartial.cshtml* archivo:</span><span class="sxs-lookup"><span data-stu-id="20e23-214">Update the *_LoginPartial.cshtml* file:</span></span>
  * <span data-ttu-id="20e23-215">Mover *Pages/_LoginPartial.cshtml* a *Pages/Shared/_LoginPartial.cshtml*</span><span class="sxs-lookup"><span data-stu-id="20e23-215">Move *Pages/_LoginPartial.cshtml* to *Pages/Shared/_LoginPartial.cshtml*</span></span>
  * <span data-ttu-id="20e23-216">Agregar `asp-area="Identity"` a los vínculos del formulario y delimitadora.</span><span class="sxs-lookup"><span data-stu-id="20e23-216">Add `asp-area="Identity"` to the form and achor links.</span></span>
  * <span data-ttu-id="20e23-217">Actualización de la `<form />` elemento a `    <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`</span><span class="sxs-lookup"><span data-stu-id="20e23-217">Update the `<form />` element to `    <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`</span></span>

  <span data-ttu-id="20e23-218">El siguiente código muestra actualizado *_LoginPartial.cshtml* archivo:</span><span class="sxs-lookup"><span data-stu-id="20e23-218">The following code shows the updated *_LoginPartial.cshtml* file:</span></span>

  [!code-cshtml[Main](20_21/sample/_LoginPartial.cshtml?highlight=8,11,22,23)]

<span data-ttu-id="20e23-219">Actualización `ConfigureServices` con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="20e23-219">Update `ConfigureServices` with the following code:</span></span>

[!code-csharp[Main](20_21/sample/Startup2.cs?name=snippet)]

## <a name="changes-to-razor-pages-projects-razor-files"></a><span data-ttu-id="20e23-220">Cambios en las páginas de Razor los proyectos de archivos de Razor</span><span class="sxs-lookup"><span data-stu-id="20e23-220">Changes to Razor Pages projects Razor files</span></span>

### <a name="the-layout-file"></a><span data-ttu-id="20e23-221">El archivo de diseño</span><span class="sxs-lookup"><span data-stu-id="20e23-221">The layout file</span></span>

* <span data-ttu-id="20e23-222">Mover *Pages/_Layout.cshtml* a *Pages/Shared/_Layout.cshtml*</span><span class="sxs-lookup"><span data-stu-id="20e23-222">Move *Pages/_Layout.cshtml* to *Pages/Shared/_Layout.cshtml*</span></span>
* <span data-ttu-id="20e23-223">El *Layout.cshtml* archivo tiene los siguientes cambios:</span><span class="sxs-lookup"><span data-stu-id="20e23-223">The *Layout.cshtml* file has the following changes:</span></span>

  * <span data-ttu-id="20e23-224">`<partial name="_CookieConsentPartial" />` se agrega.</span><span class="sxs-lookup"><span data-stu-id="20e23-224">`<partial name="_CookieConsentPartial" />` is added.</span></span> <span data-ttu-id="20e23-225">Para más información, vea [GDPR support in ASP.NET Core](xref:security/gdpr) (Compatibilidad con el Reglamento general de protección de datos en ASP.NET Core).</span><span class="sxs-lookup"><span data-stu-id="20e23-225">For more information, see [GDPR support in ASP.NET Core](xref:security/gdpr).</span></span>
  * <span data-ttu-id="20e23-226">cambios de jQuery de 2.2.0 a 3.3.1</span><span class="sxs-lookup"><span data-stu-id="20e23-226">jQuery changes from 2.2.0 to 3.3.1</span></span>

### <a name="validationscriptspartialcshtml"></a><span data-ttu-id="20e23-227">_ValidationScriptsPartial.cshtml</span><span class="sxs-lookup"><span data-stu-id="20e23-227">_ValidationScriptsPartial.cshtml</span></span>

* <span data-ttu-id="20e23-228">*Pages/_ValidationScriptsPartial.cshtml* mueve a *Pages/Shared/_ValidationScriptsPartial.cshtml*</span><span class="sxs-lookup"><span data-stu-id="20e23-228">*Pages/_ValidationScriptsPartial.cshtml* moves to  *Pages/Shared/_ValidationScriptsPartial.cshtml*</span></span>
* <span data-ttu-id="20e23-229">*jQuery.Validate/1.14.0* cambia a *jquery.validate/1.17.0*</span><span class="sxs-lookup"><span data-stu-id="20e23-229">*jquery.validate/1.14.0* changes to *jquery.validate/1.17.0*</span></span>

### <a name="new-files"></a><span data-ttu-id="20e23-230">Nuevos archivos</span><span class="sxs-lookup"><span data-stu-id="20e23-230">New files</span></span>

<span data-ttu-id="20e23-231">Se agregan los siguientes archivos:</span><span class="sxs-lookup"><span data-stu-id="20e23-231">The following files are added:</span></span>

* <span data-ttu-id="20e23-232">*Privacy.cshtml*</span><span class="sxs-lookup"><span data-stu-id="20e23-232">*Privacy.cshtml*</span></span>
* <span data-ttu-id="20e23-233">*Privacy.cshtml.cs*</span><span class="sxs-lookup"><span data-stu-id="20e23-233">*Privacy.cshtml.cs*</span></span>

<span data-ttu-id="20e23-234">Vea [GDPR admite en ASP.NET Core](xref:security/gdpr) para obtener información sobre los archivos anteriores.</span><span class="sxs-lookup"><span data-stu-id="20e23-234">See [GDPR support in ASP.NET Core](xref:security/gdpr) for information on the preceding files.</span></span>

## <a name="changes-to-mvc-projects-razor-files"></a><span data-ttu-id="20e23-235">Cambios en los archivos de Razor de proyectos MVC</span><span class="sxs-lookup"><span data-stu-id="20e23-235">Changes to MVC projects Razor files</span></span>

### <a name="the-layout-file"></a><span data-ttu-id="20e23-236">El archivo de diseño</span><span class="sxs-lookup"><span data-stu-id="20e23-236">The layout file</span></span>

<span data-ttu-id="20e23-237">El *Layout.cshtml* archivo tiene los siguientes cambios:</span><span class="sxs-lookup"><span data-stu-id="20e23-237">The *Layout.cshtml* file has the following changes:</span></span>

* <span data-ttu-id="20e23-238">`<partial name="_CookieConsentPartial" />` se agrega.</span><span class="sxs-lookup"><span data-stu-id="20e23-238">`<partial name="_CookieConsentPartial" />` is added.</span></span>
* <span data-ttu-id="20e23-239">cambios de jQuery de 2.2.0 a 3.3.1</span><span class="sxs-lookup"><span data-stu-id="20e23-239">jQuery changes from 2.2.0 to 3.3.1</span></span>

### <a name="validationscriptspartialcshtml"></a><span data-ttu-id="20e23-240">_ValidationScriptsPartial.cshtml</span><span class="sxs-lookup"><span data-stu-id="20e23-240">_ValidationScriptsPartial.cshtml</span></span>

<span data-ttu-id="20e23-241">*jQuery.Validate/1.14.0* cambia a *jquery.validate/1.17.0*</span><span class="sxs-lookup"><span data-stu-id="20e23-241">*jquery.validate/1.14.0* changes to *jquery.validate/1.17.0*</span></span>

### <a name="new-files-and-action-methods"></a><span data-ttu-id="20e23-242">Nuevos archivos y los métodos de acción</span><span class="sxs-lookup"><span data-stu-id="20e23-242">New files and action methods</span></span>

<span data-ttu-id="20e23-243">Se ha agregado lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="20e23-243">The following are added:</span></span>

* <span data-ttu-id="20e23-244">*Views/Home/Privacy.cshtml*</span><span class="sxs-lookup"><span data-stu-id="20e23-244">*Views/Home/Privacy.cshtml*</span></span>
* <span data-ttu-id="20e23-245">El `Privacy` se agrega el método de acción para el controlador Home.</span><span class="sxs-lookup"><span data-stu-id="20e23-245">The `Privacy` action method is added to the Home controller.</span></span>

<span data-ttu-id="20e23-246">Vea [GDPR admite en ASP.NET Core](xref:security/gdpr) para obtener información sobre los archivos anteriores.</span><span class="sxs-lookup"><span data-stu-id="20e23-246">See [GDPR support in ASP.NET Core](xref:security/gdpr) for information on the preceding files.</span></span>

## <a name="additional-changes"></a><span data-ttu-id="20e23-247">Cambios adicionales</span><span class="sxs-lookup"><span data-stu-id="20e23-247">Additional changes</span></span>

* [<span data-ttu-id="20e23-248">SetCompatibilityVersion</span><span class="sxs-lookup"><span data-stu-id="20e23-248">SetCompatibilityVersion</span></span>](xref:fundamentals/startup#setcompatibilityversion)
* [<span data-ttu-id="20e23-249">Configuración de transporte</span><span class="sxs-lookup"><span data-stu-id="20e23-249">Transport configuration</span></span>](xref:fundamentals/servers/kestrel#transport-configuration)
