---
title: Migración de ASP.NET Core 2.0 a 2.1
author: rick-anderson
description: En este artículo se trata los aspectos básicos de la migración de una aplicación ASP.NET Core 2.0 a 2.1.
ms.author: riande
ms.date: 07/25/2018
uid: migration/20_21
ms.openlocfilehash: caa679f80122e39f7e9a0f6e5f210d64bb73437f
ms.sourcegitcommit: 75bf5fdbfdcb6a7cfe8fe207b9ff37655ccbacd4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/26/2018
ms.locfileid: "39275821"
---
# <a name="migrate-from-aspnet-core-20-to-21"></a><span data-ttu-id="0927a-103">Migración de ASP.NET Core 2.0 a 2.1</span><span class="sxs-lookup"><span data-stu-id="0927a-103">Migrate from ASP.NET Core 2.0 to 2.1</span></span>

<span data-ttu-id="0927a-104">Por [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="0927a-104">By [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="0927a-105">Consulte [Novedades de ASP.NET Core 2.1](xref:aspnetcore-2.1) para obtener información general de las nuevas características de ASP.NET Core 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-105">See [What's new in ASP.NET Core 2.1](xref:aspnetcore-2.1) for an overview of the new features in ASP.NET Core 2.1.</span></span>

<span data-ttu-id="0927a-106">En este artículo:</span><span class="sxs-lookup"><span data-stu-id="0927a-106">This article:</span></span>

* <span data-ttu-id="0927a-107">Cubre los aspectos básicos de la migración de una aplicación ASP.NET Core 2.0 a 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-107">Covers the basics of migrating an ASP.NET Core 2.0 app to 2.1.</span></span>
* <span data-ttu-id="0927a-108">Proporciona información general de los cambios en las plantillas de aplicación web de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="0927a-108">Provides an overview of the changes to the ASP.NET Core web application templates.</span></span>

<span data-ttu-id="0927a-109">Es una forma rápida de obtener una visión general de los cambios en 2.1:</span><span class="sxs-lookup"><span data-stu-id="0927a-109">A quick way to get an overview of the changes in 2.1 is to:</span></span>

* <span data-ttu-id="0927a-110">Crear una aplicación web de ASP.NET Core 2.0 denominada WebApp1.</span><span class="sxs-lookup"><span data-stu-id="0927a-110">Create an ASP.NET Core 2.0 web app named WebApp1.</span></span>
* <span data-ttu-id="0927a-111">Confirmar la WebApp1 en un sistema de control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="0927a-111">Commit the WebApp1 in a source control system.</span></span>
* <span data-ttu-id="0927a-112">Eliminar WebApp1 y crear una aplicación web de ASP.NET Core 2.1 denominada WebApp1 en el mismo lugar.</span><span class="sxs-lookup"><span data-stu-id="0927a-112">Delete WebApp1 and create an ASP.NET Core 2.1 web app named WebApp1 in the same place.</span></span>
* <span data-ttu-id="0927a-113">Revise los cambios en la versión 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-113">Review the changes in the 2.1 version.</span></span>

<span data-ttu-id="0927a-114">En este artículo se proporciona información general sobre la migración a ASP.NET Core 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-114">This article provides an overview on migration to ASP.NET Core 2.1.</span></span> <span data-ttu-id="0927a-115">No contiene una lista completa de todos los cambios necesarios para migrar a la versión 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-115">It doesn't contain a complete list of all changes needed to migrate to version 2.1.</span></span> <span data-ttu-id="0927a-116">Algunos proyectos es posible que requieren más pasos dependiendo de las opciones seleccionadas cuando se creó el proyecto y las modificaciones realizadas en el proyecto.</span><span class="sxs-lookup"><span data-stu-id="0927a-116">Some projects might require more steps depending on the options selected when the project was created and modifications made to the project.</span></span>

## <a name="update-the-project-file-to-use-21-versions"></a><span data-ttu-id="0927a-117">Actualización del archivo de proyecto para que use las versiones 2.1</span><span class="sxs-lookup"><span data-stu-id="0927a-117">Update the project file to use 2.1 versions</span></span>

<span data-ttu-id="0927a-118">Actualice el archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="0927a-118">Update the project file:</span></span>

* <span data-ttu-id="0927a-119">Cambiar la plataforma de destino a .NET Core 2.1 actualizando el archivo de proyecto a `<TargetFramework>netcoreapp2.1</TargetFramework>`.</span><span class="sxs-lookup"><span data-stu-id="0927a-119">Change the target framework to .NET Core 2.1 by updating the project file to `<TargetFramework>netcoreapp2.1</TargetFramework>`.</span></span>
* <span data-ttu-id="0927a-120">Reemplace la referencia de paquete para `Microsoft.AspNetCore.All` con una referencia de paquete para `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="0927a-120">Replace the package reference for `Microsoft.AspNetCore.All` with a package reference for `Microsoft.AspNetCore.App`.</span></span> <span data-ttu-id="0927a-121">Es posible que deba agregar las dependencias que se quitaron de `Microsoft.AspNetCore.All`.</span><span class="sxs-lookup"><span data-stu-id="0927a-121">You may need to add dependencies that were removed from `Microsoft.AspNetCore.All`.</span></span> <span data-ttu-id="0927a-122">Para obtener más información, consulte <xref:fundamentals/metapackage#migrate> y <xref:fundamentals/metapackage-app>.</span><span class="sxs-lookup"><span data-stu-id="0927a-122">For more information, see <xref:fundamentals/metapackage#migrate> and <xref:fundamentals/metapackage-app>.</span></span> <span data-ttu-id="0927a-123">Para las aplicaciones que tienen como destino .NET Framework:</span><span class="sxs-lookup"><span data-stu-id="0927a-123">For apps that target the .NET Framework:</span></span>
  * <span data-ttu-id="0927a-124">Agregar referencias de paquete individual en lugar de una referencia del metapaquete.</span><span class="sxs-lookup"><span data-stu-id="0927a-124">Add individual package references instead of a metapackage reference.</span></span>
  * <span data-ttu-id="0927a-125">Actualizar cada referencia de paquete a 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-125">Update each package reference to 2.1.</span></span>
* <span data-ttu-id="0927a-126">Quite las referencias a **&lt;DotNetCliToolReference&gt;** elementos para los siguientes paquetes.</span><span class="sxs-lookup"><span data-stu-id="0927a-126">Remove references to **&lt;DotNetCliToolReference&gt;** elements for the following packages.</span></span> <span data-ttu-id="0927a-127">Estas herramientas se agrupan de forma predeterminada en la CLI de .NET Core y no deben instalarse por separado.</span><span class="sxs-lookup"><span data-stu-id="0927a-127">These tools are bundled by default in the .NET Core CLI and don't need to be installed separately.</span></span>
  * <span data-ttu-id="0927a-128">Microsoft.DotNet.Watcher.Tools (`dotnet watch`)</span><span class="sxs-lookup"><span data-stu-id="0927a-128">Microsoft.DotNet.Watcher.Tools (`dotnet watch`)</span></span>
  * <span data-ttu-id="0927a-129">Microsoft.EntityFrameworkCore.Tools.DotNet (`dotnet ef`)</span><span class="sxs-lookup"><span data-stu-id="0927a-129">Microsoft.EntityFrameworkCore.Tools.DotNet (`dotnet ef`)</span></span>
  * <span data-ttu-id="0927a-130">Microsoft.Extensions.Caching.SqlConfig.Tools (`dotnet sql-cache`)</span><span class="sxs-lookup"><span data-stu-id="0927a-130">Microsoft.Extensions.Caching.SqlConfig.Tools  (`dotnet sql-cache`)</span></span>
  * <span data-ttu-id="0927a-131">Microsoft.Extensions.SecretManager.Tools (`dotnet user-secrets`)</span><span class="sxs-lookup"><span data-stu-id="0927a-131">Microsoft.Extensions.SecretManager.Tools (`dotnet user-secrets`)</span></span>
* <span data-ttu-id="0927a-132">Opcional: puede quitar el **&lt;DotNetCliToolReference&gt;** (elemento) para `Microsoft.VisualStudio.Web.CodeGeneration.Tools`.</span><span class="sxs-lookup"><span data-stu-id="0927a-132">Optional: you can remove the **&lt;DotNetCliToolReference&gt;** element for `Microsoft.VisualStudio.Web.CodeGeneration.Tools`.</span></span> <span data-ttu-id="0927a-133">Puede reemplazar esta herramienta con una versión instalada globalmente mediante la ejecución de `dotnet tool install -g dotnet-aspnet-codegenerator`.</span><span class="sxs-lookup"><span data-stu-id="0927a-133">You can replace this tool with a globally installed version by running `dotnet tool install -g dotnet-aspnet-codegenerator`.</span></span>

<span data-ttu-id="0927a-134">El marcado siguiente muestra el archivo de 2.0 proyecto generadas por las plantillas:</span><span class="sxs-lookup"><span data-stu-id="0927a-134">The following markup shows the template-generated 2.0 project file:</span></span>

[!code-xml[Main](20_21/sample/WebApp20.csproj)]

<span data-ttu-id="0927a-135">El marcado siguiente muestra el archivo de 2.1 proyecto generadas por las plantillas:</span><span class="sxs-lookup"><span data-stu-id="0927a-135">The following markup shows the template-generated 2.1 project file:</span></span>

[!code-xml[Main](20_21/sample/WebApp21.csproj)]

## <a name="rules-for-projects-targeting-the-shared-runtime"></a><span data-ttu-id="0927a-136">Reglas para los proyectos destinados a tiempo de ejecución compartido</span><span class="sxs-lookup"><span data-stu-id="0927a-136">Rules for projects targeting the shared runtime</span></span>

<span data-ttu-id="0927a-137">ASP.NET Core incluye los siguientes tiempos de ejecución compartido:</span><span class="sxs-lookup"><span data-stu-id="0927a-137">ASP.NET Core includes the following shared runtimes:</span></span>

* [<span data-ttu-id="0927a-138">Microsoft.AspNetCore.App</span><span class="sxs-lookup"><span data-stu-id="0927a-138">Microsoft.AspNetCore.App</span></span>](xref:fundamentals/metapackage-app)
* [<span data-ttu-id="0927a-139">Microsoft.AspNetCore.All</span><span class="sxs-lookup"><span data-stu-id="0927a-139">Microsoft.AspNetCore.All</span></span>](xref:fundamentals/metapackage)

<span data-ttu-id="0927a-140">La versión especificada por la referencia de paquete es el *mínimo requerido* versión.</span><span class="sxs-lookup"><span data-stu-id="0927a-140">The version specified by the package reference is the *minimum required* version.</span></span> <span data-ttu-id="0927a-141">Por ejemplo, un proyecto que hacen referencia a la 2.1.1 versiones de estos paquetes no se ejecutarán en un equipo con sólo el 2.1.0 en tiempo de ejecución instalado.</span><span class="sxs-lookup"><span data-stu-id="0927a-141">For example, a project referencing the 2.1.1 versions of these packages won't run on a machine with only the 2.1.0 runtime installed.</span></span>

<span data-ttu-id="0927a-142">Problemas conocidos de los proyectos destinados a tiempo de ejecución compartido:</span><span class="sxs-lookup"><span data-stu-id="0927a-142">Known issues for projects targeting the shared runtime:</span></span>

* <span data-ttu-id="0927a-143">Uso de `Microsoft.AspNetCore.App` 2.1.0 con Entity Framework Core 2.1.1 provoca errores de restauración debido a conflictos de paquetes de NuGet.</span><span class="sxs-lookup"><span data-stu-id="0927a-143">Using `Microsoft.AspNetCore.App` 2.1.0 with Entity Framework Core 2.1.1 causes NuGet restore failures due to package conflicts.</span></span> <span data-ttu-id="0927a-144">La solución recomendada consiste en actualizar `Microsoft.AspNetCore.App` a 2.1.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-144">The recommended solution is to upgrade `Microsoft.AspNetCore.App` to 2.1.1.</span></span> <span data-ttu-id="0927a-145">Para obtener más información, consulte [paquetes que comparten las dependencias con Microsoft.AspNetCore.App no pueden hacer referencia a las versiones de revisión](https://github.com/aspnet/Universe/issues/1180).</span><span class="sxs-lookup"><span data-stu-id="0927a-145">For more information, see [Packages that share dependencies with Microsoft.AspNetCore.App cannot reference patch versions](https://github.com/aspnet/Universe/issues/1180).</span></span>
* <span data-ttu-id="0927a-146">Todos los proyectos que se deben usar `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App` debe agregar una referencia de paquete para el paquete en el archivo de proyecto, incluso si contienen una referencia de proyecto a otro proyecto utilizando `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="0927a-146">All projects that must use `Microsoft.AspNetCore.All` or `Microsoft.AspNetCore.App` should add a package reference for the package in the project file, even if they contain a project reference to another project using `Microsoft.AspNetCore.All` or `Microsoft.AspNetCore.App`.</span></span>

  <span data-ttu-id="0927a-147">Ejemplo:</span><span class="sxs-lookup"><span data-stu-id="0927a-147">Example:</span></span>

  * <span data-ttu-id="0927a-148">`MyApp` tiene una referencia de paquete a `Microsoft.AspNetCore.App`.</span><span class="sxs-lookup"><span data-stu-id="0927a-148">`MyApp` has a package reference to `Microsoft.AspNetCore.App`.</span></span>
  * <span data-ttu-id="0927a-149">`MyApp.Tests` tiene una referencia de proyecto a `MyApp.csproj`.</span><span class="sxs-lookup"><span data-stu-id="0927a-149">`MyApp.Tests` has a project reference to `MyApp.csproj`.</span></span>
  
  <span data-ttu-id="0927a-150">Agregue una referencia de paquete para `Microsoft.AspNetCore.App` a `MyApp.Tests`.</span><span class="sxs-lookup"><span data-stu-id="0927a-150">Add a package reference for `Microsoft.AspNetCore.App` to `MyApp.Tests`.</span></span> <span data-ttu-id="0927a-151">Para obtener más información, consulte [las pruebas de integración es difícil de configurar y dejar de funcionar en el servicio de marco de trabajo compartido](https://github.com/aspnet/Home/issues/3156).</span><span class="sxs-lookup"><span data-stu-id="0927a-151">For more information, see [Integration testing is hard to set up and may break on shared framework servicing](https://github.com/aspnet/Home/issues/3156).</span></span>

## <a name="update-to-the-21-docker-images"></a><span data-ttu-id="0927a-152">Actualizar a las imágenes de Docker 2.1</span><span class="sxs-lookup"><span data-stu-id="0927a-152">Update to the 2.1 Docker images</span></span>

<span data-ttu-id="0927a-153">En ASP.NET Core 2.1, las imágenes de Docker se migran a la [repositorio de GitHub dotnet/dotnet-docker](https://github.com/dotnet/dotnet-docker).</span><span class="sxs-lookup"><span data-stu-id="0927a-153">In ASP.NET Core 2.1, the Docker images migrated to the [dotnet/dotnet-docker GitHub repository](https://github.com/dotnet/dotnet-docker).</span></span> <span data-ttu-id="0927a-154">La siguiente tabla muestra los cambios de imagen y etiqueta de Docker:</span><span class="sxs-lookup"><span data-stu-id="0927a-154">The following table shows the Docker image and tag changes:</span></span>

|<span data-ttu-id="0927a-155">2.0</span><span class="sxs-lookup"><span data-stu-id="0927a-155">2.0</span></span>      |<span data-ttu-id="0927a-156">2.1</span><span class="sxs-lookup"><span data-stu-id="0927a-156">2.1</span></span>      |
|---------|---------|
|<span data-ttu-id="0927a-157">Microsoft / aspnetcore:2.0</span><span class="sxs-lookup"><span data-stu-id="0927a-157">microsoft/aspnetcore:2.0</span></span>        |<span data-ttu-id="0927a-158">Microsoft / dotnet:2.1-aspnetcore-runtime</span><span class="sxs-lookup"><span data-stu-id="0927a-158">microsoft/dotnet:2.1-aspnetcore-runtime</span></span> |
|<span data-ttu-id="0927a-159">Microsoft/aspnetcore-build: 2.0</span><span class="sxs-lookup"><span data-stu-id="0927a-159">microsoft/aspnetcore-build:2.0</span></span>  |<span data-ttu-id="0927a-160">Microsoft / dotnet:2.1-sdk</span><span class="sxs-lookup"><span data-stu-id="0927a-160">microsoft/dotnet:2.1-sdk</span></span> |

<span data-ttu-id="0927a-161">Cambiar el `FROM` líneas en su *Dockerfile* para usar las etiquetas y los nuevos nombres de imagen en la columna 2.1 de la tabla anterior.</span><span class="sxs-lookup"><span data-stu-id="0927a-161">Change the `FROM` lines in your *Dockerfile* to use the new image names and tags in the preceding table's 2.1 column.</span></span> <span data-ttu-id="0927a-162">Para obtener más información, consulte [migrar desde los repositorios de docker de aspnetcore a dotnet](https://github.com/aspnet/Announcements/issues/298).</span><span class="sxs-lookup"><span data-stu-id="0927a-162">For more information, see [Migrating from aspnetcore docker repos to dotnet](https://github.com/aspnet/Announcements/issues/298).</span></span>

## <a name="changes-to-take-advantage-of-the-new-code-based-idioms-that-are-recommended-in-aspnet-core-21"></a><span data-ttu-id="0927a-163">Cambios para aprovechar las ventajas de las expresiones basadas en código nuevo que se recomiendan en ASP.NET Core 2.1</span><span class="sxs-lookup"><span data-stu-id="0927a-163">Changes to take advantage of the new code-based idioms that are recommended in ASP.NET Core 2.1</span></span>

### <a name="changes-to-main"></a><span data-ttu-id="0927a-164">Cambios a la página principal</span><span class="sxs-lookup"><span data-stu-id="0927a-164">Changes to Main</span></span>

<span data-ttu-id="0927a-165">Las siguientes imágenes muestran los cambios realizados en la plantilla genera *Program.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="0927a-165">The following images show the changes made to the templated generated *Program.cs* file.</span></span>

![diferencias de versión anterior](20_21/_static/main20.png)

<span data-ttu-id="0927a-167">La imagen anterior muestra la versión 2.0 con las eliminaciones en rojo.</span><span class="sxs-lookup"><span data-stu-id="0927a-167">The preceding image shows the 2.0 version with the deletions in red.</span></span>

<span data-ttu-id="0927a-168">La siguiente imagen muestra el código 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-168">The following image shows the 2.1 code.</span></span> <span data-ttu-id="0927a-169">El código en verde sustituye a la versión 2.0:</span><span class="sxs-lookup"><span data-stu-id="0927a-169">The code in green replaced the 2.0 version:</span></span>

![diferencias de versión nuevo](20_21/_static/main21.png)

<span data-ttu-id="0927a-171">El código siguiente muestra la versión 2.1 de *Program.cs*:</span><span class="sxs-lookup"><span data-stu-id="0927a-171">The following code shows the 2.1 version of *Program.cs*:</span></span>

[!code-csharp[Main](20_21/sample/Program.cs?name=snippet)]

<span data-ttu-id="0927a-172">El nuevo `Main` reemplaza la llamada a `BuildWebHost` con [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder).</span><span class="sxs-lookup"><span data-stu-id="0927a-172">The new `Main` replaces the call to `BuildWebHost` with [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder).</span></span> <span data-ttu-id="0927a-173">[IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) se agregó para admitir un nuevo [infraestructura de prueba de integración](xref:test/integration-tests).</span><span class="sxs-lookup"><span data-stu-id="0927a-173">[IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) was added to support a new [integration test infrastructure](xref:test/integration-tests).</span></span>

### <a name="changes-to-startup"></a><span data-ttu-id="0927a-174">Cambios realizados en el inicio</span><span class="sxs-lookup"><span data-stu-id="0927a-174">Changes to Startup</span></span>

<span data-ttu-id="0927a-175">El código siguiente muestra los cambios al código de plantilla 2.1 generado.</span><span class="sxs-lookup"><span data-stu-id="0927a-175">The following code shows the changes to 2.1 template generated code.</span></span> <span data-ttu-id="0927a-176">Todos los cambios de código, salvo que recién agregados `UseBrowserLink` se ha quitado:</span><span class="sxs-lookup"><span data-stu-id="0927a-176">All changes are newly added code, except that `UseBrowserLink` has been removed:</span></span>

[!code-csharp[Main](20_21/sample/Startup.cs?highlight=3,4,21-26,30,42,45,47)]

<span data-ttu-id="0927a-177">Los cambios de código anterior se detallan en:</span><span class="sxs-lookup"><span data-stu-id="0927a-177">The preceding code changes are detailed in:</span></span>

* <span data-ttu-id="0927a-178">[Compatibilidad con GDPR en ASP.NET Core](xref:security/gdpr) para `CookiePolicyOptions` y `UseCookiePolicy`.</span><span class="sxs-lookup"><span data-stu-id="0927a-178">[GDPR support in ASP.NET Core](xref:security/gdpr) for `CookiePolicyOptions` and `UseCookiePolicy`.</span></span>
* <span data-ttu-id="0927a-179">[Protocolo de seguridad de transporte estricto HTTP (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) para `UseHsts`.</span><span class="sxs-lookup"><span data-stu-id="0927a-179">[HTTP Strict Transport Security Protocol (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) for `UseHsts`.</span></span>
* <span data-ttu-id="0927a-180">[Requerir HTTPS](xref:security/enforcing-ssl#require-https) para `UseHttpsRedirection`.</span><span class="sxs-lookup"><span data-stu-id="0927a-180">[Require HTTPS](xref:security/enforcing-ssl#require-https) for `UseHttpsRedirection`.</span></span>
* <span data-ttu-id="0927a-181">[SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) para `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.</span><span class="sxs-lookup"><span data-stu-id="0927a-181">[SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) for `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.</span></span>

## <a name="changes-to-authentication-code"></a><span data-ttu-id="0927a-182">Cambios en el código de autenticación</span><span class="sxs-lookup"><span data-stu-id="0927a-182">Changes to authentication code</span></span>

<span data-ttu-id="0927a-183">ASP.NET Core 2.1 proporciona [ASP.NET Core Identity](xref:security/authentication/identity) como un [biblioteca de clases de Razor](xref:razor-pages/ui-class) (RCL).</span><span class="sxs-lookup"><span data-stu-id="0927a-183">ASP.NET Core 2.1 provides [ASP.NET Core Identity](xref:security/authentication/identity) as a [Razor Class Library](xref:razor-pages/ui-class) (RCL).</span></span>

<span data-ttu-id="0927a-184">El valor predeterminado 2.1 la interfaz de usuario de identidad actualmente no proporciona nuevas características importantes con respecto a la versión 2.0.</span><span class="sxs-lookup"><span data-stu-id="0927a-184">The default 2.1 Identity UI doesn't currently provide significant new features over the 2.0 version.</span></span> <span data-ttu-id="0927a-185">Sustituyendo la identidad con el paquete RCL es opcional.</span><span class="sxs-lookup"><span data-stu-id="0927a-185">Replacing Identity with the RCL package is optional.</span></span> <span data-ttu-id="0927a-186">Entre las ventajas de reemplazar la plantilla generan identidad código con la versión RCL incluyen:</span><span class="sxs-lookup"><span data-stu-id="0927a-186">The advantages to replacing the template generated Identity code with the RCL version include:</span></span>

* <span data-ttu-id="0927a-187">Número de archivos se mueve fuera de un árbol de origen.</span><span class="sxs-lookup"><span data-stu-id="0927a-187">Many files are moved out of your source tree.</span></span>
* <span data-ttu-id="0927a-188">Nuevas características de identidad ni correcciones de errores se incluyen en el [Microsoft.AspNetCore.App metapaquete](xref:fundamentals/metapackage-app).</span><span class="sxs-lookup"><span data-stu-id="0927a-188">Any bug fixes or new features to Identity are included in the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span></span> <span data-ttu-id="0927a-189">Obtendrá automáticamente la identidad actualizada cuando `Microsoft.AspNetCore.App` se actualiza.</span><span class="sxs-lookup"><span data-stu-id="0927a-189">You automatically get the updated Identity when `Microsoft.AspNetCore.App` is updated.</span></span>

<span data-ttu-id="0927a-190">Si ha realizado no trivial cambios en la plantilla generan código de identidad:</span><span class="sxs-lookup"><span data-stu-id="0927a-190">If you've made non-trivial changes to the template generated Identity code:</span></span>

* <span data-ttu-id="0927a-191">Las ventajas anteriores probablemente sí lo hagan **no** justificar convertir en el la versión RCL.</span><span class="sxs-lookup"><span data-stu-id="0927a-191">The preceding advantages probably do **not** justify converting to the the RCL version.</span></span>
* <span data-ttu-id="0927a-192">Puede mantener el código de la identidad de ASP.NET Core 2.0, es totalmente compatible.</span><span class="sxs-lookup"><span data-stu-id="0927a-192">You can keep your ASP.NET Core 2.0 Identity code, it's fully supported.</span></span>

<span data-ttu-id="0927a-193">Identidad 2.1 expone los puntos de conexión con el `Identity` área.</span><span class="sxs-lookup"><span data-stu-id="0927a-193">Identity 2.1 exposes endpoints with the `Identity` area.</span></span> <span data-ttu-id="0927a-194">Por ejemplo, la tabla siguiente muestra ejemplos de puntos de conexión de identidad que cambian de 2.0 a 2.1:</span><span class="sxs-lookup"><span data-stu-id="0927a-194">For example, the follow table shows examples of Identity endpoints that change from 2.0 to 2.1:</span></span>

| <span data-ttu-id="0927a-195">2.0 DIRECCIÓN URL DE</span><span class="sxs-lookup"><span data-stu-id="0927a-195">2.0 URL</span></span>         | <span data-ttu-id="0927a-196">2.1 DIRECCIÓN URL DE</span><span class="sxs-lookup"><span data-stu-id="0927a-196">2.1 URL</span></span> |
| --------------- | ------------ |
| <span data-ttu-id="0927a-197">/ Cuenta/inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="0927a-197">/Account/Login</span></span>  | <span data-ttu-id="0927a-198">/ Identidad o cuenta/inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="0927a-198">/Identity/Account/Login</span></span> |
| <span data-ttu-id="0927a-199">/ Cuenta/cierre de sesión</span><span class="sxs-lookup"><span data-stu-id="0927a-199">/Account/Logout</span></span> | <span data-ttu-id="0927a-200">/ Identidad o cuenta/cierre de sesión</span><span class="sxs-lookup"><span data-stu-id="0927a-200">/Identity/Account/Logout</span></span> |
| <span data-ttu-id="0927a-201">/ Cuenta/administrar</span><span class="sxs-lookup"><span data-stu-id="0927a-201">/Account/Manage</span></span> | <span data-ttu-id="0927a-202">/ Identidad o cuenta/administrar</span><span class="sxs-lookup"><span data-stu-id="0927a-202">/Identity/Account/Manage</span></span> |

<span data-ttu-id="0927a-203">Interfaz de usuario de identidad con la necesidad de biblioteca de identidades 2.1 para tener en cuenta las direcciones URL de identidad de las aplicaciones que tienen con la identidad del código y reemplace 2.0 tienen `/Identity` segmento antepuesto a los URI.</span><span class="sxs-lookup"><span data-stu-id="0927a-203">Applications that have code using Identity and replace 2.0 Identity UI with the 2.1 Identity Library need to take into account Identity URLs have `/Identity` segment prepended to the URIs.</span></span> <span data-ttu-id="0927a-204">Una manera de controlar el nuevo es configurar las redirecciones, por ejemplo desde los puntos de conexión de la identidad `/Account/Login` a `/Identity/Account/Login`.</span><span class="sxs-lookup"><span data-stu-id="0927a-204">One way to handle the new Identity endpoints is to set up redirects, for example from `/Account/Login` to `/Identity/Account/Login`.</span></span>

### <a name="update-identity-to-version-21"></a><span data-ttu-id="0927a-205">Identidad de la actualización a la versión 2.1</span><span class="sxs-lookup"><span data-stu-id="0927a-205">Update Identity to version 2.1</span></span>

<span data-ttu-id="0927a-206">Las siguientes opciones están disponibles para actualizar la identidad a 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927a-206">The following options are available to update Identity to 2.1.</span></span>

* <span data-ttu-id="0927a-207">Use el código de 2.0 de la interfaz de usuario de identidad sin realizar ningún cambio.</span><span class="sxs-lookup"><span data-stu-id="0927a-207">Use the Identity UI 2.0 code with no changes.</span></span> <span data-ttu-id="0927a-208">Mediante código 2.0 de la interfaz de usuario de identidad es totalmente compatible.</span><span class="sxs-lookup"><span data-stu-id="0927a-208">Using Identity UI 2.0 code is fully supported.</span></span> <span data-ttu-id="0927a-209">Esto es una buena opción cuando se realizaron cambios significativos en el código de identidad generado.</span><span class="sxs-lookup"><span data-stu-id="0927a-209">This is a good approach when significant changes have been made to the generated Identity code.</span></span>
* <span data-ttu-id="0927a-210">Elimine el código existente de identidad 2.0 y [Scaffold identidad](xref:security/authentication/scaffold-identity) en el proyecto.</span><span class="sxs-lookup"><span data-stu-id="0927a-210">Delete your existing Identity 2.0 code and [Scaffold Identity](xref:security/authentication/scaffold-identity) into your project.</span></span> <span data-ttu-id="0927a-211">El proyecto usará la [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteca de clases de Razor](xref:razor-pages/ui-class).</span><span class="sxs-lookup"><span data-stu-id="0927a-211">Your project will use the [ASP.NET Core Identity](xref:security/authentication/identity) [Razor Class Library](xref:razor-pages/ui-class).</span></span> <span data-ttu-id="0927a-212">Puede generar código y la interfaz de usuario para el código de interfaz de usuario de identidad que se ha modificado.</span><span class="sxs-lookup"><span data-stu-id="0927a-212">You can generate code and UI for any of the Identity UI code that you modified.</span></span> <span data-ttu-id="0927a-213">Aplicar los cambios de código en el código de interfaz de usuario recién con scaffolding.</span><span class="sxs-lookup"><span data-stu-id="0927a-213">Apply your code changes to the newly scaffolded UI code.</span></span>
* <span data-ttu-id="0927a-214">Elimine el código existente de identidad 2.0 y [Scaffold identidad](xref:security/authentication/scaffold-identity) en el proyecto con la opción **reemplazar todos los archivos**.</span><span class="sxs-lookup"><span data-stu-id="0927a-214">Delete your existing Identity 2.0 code and [Scaffold Identity](xref:security/authentication/scaffold-identity) into your project with the option to **Override all files**.</span></span>

### <a name="replace-identity-20-ui-with-the-identity-21-razor-class-library"></a><span data-ttu-id="0927a-215">Reemplazar la identidad 2.0 interfaz de usuario con la biblioteca de clases de Razor de identidad 2.1</span><span class="sxs-lookup"><span data-stu-id="0927a-215">Replace Identity 2.0 UI with the Identity 2.1 Razor Class Library</span></span>

<span data-ttu-id="0927a-216">En esta sección se describe los pasos para reemplazar el código de identidad de ASP.NET Core 2.0 plantilla generada con el [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteca de clases de Razor](xref:razor-pages/ui-class).</span><span class="sxs-lookup"><span data-stu-id="0927a-216">This section outlines the steps to replace the ASP.NET Core 2.0 template generated Identity code with the [ASP.NET Core Identity](xref:security/authentication/identity) [Razor Class Library](xref:razor-pages/ui-class).</span></span> <span data-ttu-id="0927a-217">Los pasos siguientes son para un proyecto de páginas de Razor, pero el enfoque para un proyecto MVC es similar.</span><span class="sxs-lookup"><span data-stu-id="0927a-217">The following steps are for a Razor Pages project, but the approach for an MVC project is similar.</span></span>

* <span data-ttu-id="0927a-218">Compruebe el [se actualiza el archivo de proyecto para utilizar las 2.1 versiones](#update-the-project-file-to-use-21-versions)</span><span class="sxs-lookup"><span data-stu-id="0927a-218">Verify the [project file is updated to use 2.1 versions](#update-the-project-file-to-use-21-versions)</span></span>
* <span data-ttu-id="0927a-219">Elimine las siguientes carpetas y todos los archivos en ellos:</span><span class="sxs-lookup"><span data-stu-id="0927a-219">Delete the following folders and all the files in them:</span></span>
  * <span data-ttu-id="0927a-220">*Controladores*</span><span class="sxs-lookup"><span data-stu-id="0927a-220">*Controllers*</span></span>
  * <span data-ttu-id="0927a-221">*Páginas/Account /*</span><span class="sxs-lookup"><span data-stu-id="0927a-221">*Pages/Account/*</span></span>
  * <span data-ttu-id="0927a-222">*Extensiones*</span><span class="sxs-lookup"><span data-stu-id="0927a-222">*Extensions*</span></span>
* <span data-ttu-id="0927a-223">Compile el proyecto.</span><span class="sxs-lookup"><span data-stu-id="0927a-223">Build the project.</span></span>
* <span data-ttu-id="0927a-224">[Aplicar la técnica scaffolding identidad](xref:security/authentication/scaffold-identity) en el proyecto:</span><span class="sxs-lookup"><span data-stu-id="0927a-224">[Scaffold Identity](xref:security/authentication/scaffold-identity) into your project:</span></span>
  * <span data-ttu-id="0927a-225">Seleccione los proyectos salir *_Layout.cshtml* archivo.</span><span class="sxs-lookup"><span data-stu-id="0927a-225">Select the projects exiting *_Layout.cshtml* file.</span></span>
  * <span data-ttu-id="0927a-226">Seleccione el **+** icono en el lado derecho de la **clase de contexto de datos**.</span><span class="sxs-lookup"><span data-stu-id="0927a-226">Select the **+** icon on the right side of the **Data context class**.</span></span> <span data-ttu-id="0927a-227">Acepte el nombre predeterminado.</span><span class="sxs-lookup"><span data-stu-id="0927a-227">Accept the default name.</span></span>
  * <span data-ttu-id="0927a-228">Seleccione **agregar** para crear una nueva clase de contexto de datos.</span><span class="sxs-lookup"><span data-stu-id="0927a-228">Select **Add** to create a new Data context class.</span></span> <span data-ttu-id="0927a-229">Crear un nuevo contexto de datos es necesario para aplicar la técnica scaffolding.</span><span class="sxs-lookup"><span data-stu-id="0927a-229">Creating a new data context is required for to scaffold.</span></span> <span data-ttu-id="0927a-230">Quite el nuevo contexto de datos en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="0927a-230">You remove the new data context in the next section.</span></span>

### <a name="update-after-scaffolding-identity"></a><span data-ttu-id="0927a-231">Actualizar después de la identidad de scaffolding</span><span class="sxs-lookup"><span data-stu-id="0927a-231">Update after scaffolding Identity</span></span>

* <span data-ttu-id="0927a-232">Eliminar el proveedor de scaffolding de identidad generado `IdentityDbContext` clase derivada de la *áreas/identidad/Data/* carpeta.</span><span class="sxs-lookup"><span data-stu-id="0927a-232">Delete the Identity scaffolder generated `IdentityDbContext` derived class in the *Areas/Identity/Data/* folder.</span></span>
* <span data-ttu-id="0927a-233">Eliminar *Areas/Identity/IdentityHostingStartup.cs*</span><span class="sxs-lookup"><span data-stu-id="0927a-233">Delete *Areas/Identity/IdentityHostingStartup.cs*</span></span>
* <span data-ttu-id="0927a-234">Actualización de la *_LoginPartial.cshtml* archivo:</span><span class="sxs-lookup"><span data-stu-id="0927a-234">Update the *_LoginPartial.cshtml* file:</span></span>
  * <span data-ttu-id="0927a-235">Mover *Pages/_LoginPartial.cshtml* a *Pages/Shared/_LoginPartial.cshtml*</span><span class="sxs-lookup"><span data-stu-id="0927a-235">Move *Pages/_LoginPartial.cshtml* to *Pages/Shared/_LoginPartial.cshtml*</span></span>
  * <span data-ttu-id="0927a-236">Agregar `asp-area="Identity"` los vínculos del formulario y el delimitador.</span><span class="sxs-lookup"><span data-stu-id="0927a-236">Add `asp-area="Identity"` to the form and anchor links.</span></span>
  * <span data-ttu-id="0927a-237">Actualización de la `<form />` elemento a `<form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`</span><span class="sxs-lookup"><span data-stu-id="0927a-237">Update the `<form />` element to `<form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`</span></span>

  <span data-ttu-id="0927a-238">El código siguiente muestra la actualización *_LoginPartial.cshtml* archivo:</span><span class="sxs-lookup"><span data-stu-id="0927a-238">The following code shows the updated *_LoginPartial.cshtml* file:</span></span>

  [!code-cshtml[Main](20_21/sample/_LoginPartial.cshtml?highlight=8,11,22,23)]

<span data-ttu-id="0927a-239">Actualización `ConfigureServices` con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="0927a-239">Update `ConfigureServices` with the following code:</span></span>

[!code-csharp[Main](20_21/sample/Startup2.cs?name=snippet)]

## <a name="changes-to-razor-pages-projects-razor-files"></a><span data-ttu-id="0927a-240">Cambios en las páginas de Razor proyectos de archivos de Razor</span><span class="sxs-lookup"><span data-stu-id="0927a-240">Changes to Razor Pages projects Razor files</span></span>

### <a name="the-layout-file"></a><span data-ttu-id="0927a-241">El archivo de diseño</span><span class="sxs-lookup"><span data-stu-id="0927a-241">The layout file</span></span>

* <span data-ttu-id="0927a-242">Mover *Pages/_Layout.cshtml* a *Pages/Shared/_Layout.cshtml*</span><span class="sxs-lookup"><span data-stu-id="0927a-242">Move *Pages/_Layout.cshtml* to *Pages/Shared/_Layout.cshtml*</span></span>
* <span data-ttu-id="0927a-243">El *Layout.cshtml* archivo tiene los siguientes cambios:</span><span class="sxs-lookup"><span data-stu-id="0927a-243">The *Layout.cshtml* file has the following changes:</span></span>

  * <span data-ttu-id="0927a-244">`<partial name="_CookieConsentPartial" />` se agrega.</span><span class="sxs-lookup"><span data-stu-id="0927a-244">`<partial name="_CookieConsentPartial" />` is added.</span></span> <span data-ttu-id="0927a-245">Para más información, vea [GDPR support in ASP.NET Core](xref:security/gdpr) (Compatibilidad con el Reglamento general de protección de datos en ASP.NET Core).</span><span class="sxs-lookup"><span data-stu-id="0927a-245">For more information, see [GDPR support in ASP.NET Core](xref:security/gdpr).</span></span>
  * <span data-ttu-id="0927a-246">cambios de jQuery de 2.2.0 a 3.3.1</span><span class="sxs-lookup"><span data-stu-id="0927a-246">jQuery changes from 2.2.0 to 3.3.1</span></span>

### <a name="validationscriptspartialcshtml"></a><span data-ttu-id="0927a-247">_ValidationScriptsPartial.cshtml</span><span class="sxs-lookup"><span data-stu-id="0927a-247">_ValidationScriptsPartial.cshtml</span></span>

* <span data-ttu-id="0927a-248">*Pages/_validationscriptspartial.cshtml* se mueve a *Pages/Shared/_ValidationScriptsPartial.cshtml*</span><span class="sxs-lookup"><span data-stu-id="0927a-248">*Pages/_ValidationScriptsPartial.cshtml* moves to  *Pages/Shared/_ValidationScriptsPartial.cshtml*</span></span>
* <span data-ttu-id="0927a-249">*jQuery.Validate/1.14.0* cambia a *jquery.validate/1.17.0*</span><span class="sxs-lookup"><span data-stu-id="0927a-249">*jquery.validate/1.14.0* changes to *jquery.validate/1.17.0*</span></span>

### <a name="new-files"></a><span data-ttu-id="0927a-250">Nuevos archivos</span><span class="sxs-lookup"><span data-stu-id="0927a-250">New files</span></span>

<span data-ttu-id="0927a-251">Se agregan los siguientes archivos:</span><span class="sxs-lookup"><span data-stu-id="0927a-251">The following files are added:</span></span>

* <span data-ttu-id="0927a-252">*Privacy.cshtml*</span><span class="sxs-lookup"><span data-stu-id="0927a-252">*Privacy.cshtml*</span></span>
* <span data-ttu-id="0927a-253">*Privacy.cshtml.cs*</span><span class="sxs-lookup"><span data-stu-id="0927a-253">*Privacy.cshtml.cs*</span></span>

<span data-ttu-id="0927a-254">Consulte [RGPD se admiten en ASP.NET Core](xref:security/gdpr) para obtener información sobre los archivos anteriores.</span><span class="sxs-lookup"><span data-stu-id="0927a-254">See [GDPR support in ASP.NET Core](xref:security/gdpr) for information on the preceding files.</span></span>

## <a name="changes-to-mvc-projects-razor-files"></a><span data-ttu-id="0927a-255">Cambios en los archivos de Razor de proyectos MVC</span><span class="sxs-lookup"><span data-stu-id="0927a-255">Changes to MVC projects Razor files</span></span>

### <a name="the-layout-file"></a><span data-ttu-id="0927a-256">El archivo de diseño</span><span class="sxs-lookup"><span data-stu-id="0927a-256">The layout file</span></span>

<span data-ttu-id="0927a-257">El *Layout.cshtml* archivo tiene los siguientes cambios:</span><span class="sxs-lookup"><span data-stu-id="0927a-257">The *Layout.cshtml* file has the following changes:</span></span>

* <span data-ttu-id="0927a-258">`<partial name="_CookieConsentPartial" />` se agrega.</span><span class="sxs-lookup"><span data-stu-id="0927a-258">`<partial name="_CookieConsentPartial" />` is added.</span></span>
* <span data-ttu-id="0927a-259">cambios de jQuery de 2.2.0 a 3.3.1</span><span class="sxs-lookup"><span data-stu-id="0927a-259">jQuery changes from 2.2.0 to 3.3.1</span></span>

### <a name="validationscriptspartialcshtml"></a><span data-ttu-id="0927a-260">_ValidationScriptsPartial.cshtml</span><span class="sxs-lookup"><span data-stu-id="0927a-260">_ValidationScriptsPartial.cshtml</span></span>

<span data-ttu-id="0927a-261">*jQuery.Validate/1.14.0* cambia a *jquery.validate/1.17.0*</span><span class="sxs-lookup"><span data-stu-id="0927a-261">*jquery.validate/1.14.0* changes to *jquery.validate/1.17.0*</span></span>

### <a name="new-files-and-action-methods"></a><span data-ttu-id="0927a-262">Los archivos nuevos y los métodos de acción</span><span class="sxs-lookup"><span data-stu-id="0927a-262">New files and action methods</span></span>

<span data-ttu-id="0927a-263">Se agrega lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0927a-263">The following are added:</span></span>

* <span data-ttu-id="0927a-264">*Views/Home/Privacy.cshtml*</span><span class="sxs-lookup"><span data-stu-id="0927a-264">*Views/Home/Privacy.cshtml*</span></span>
* <span data-ttu-id="0927a-265">El `Privacy` se agrega el método de acción para el controlador Home.</span><span class="sxs-lookup"><span data-stu-id="0927a-265">The `Privacy` action method is added to the Home controller.</span></span>

<span data-ttu-id="0927a-266">Consulte [RGPD se admiten en ASP.NET Core](xref:security/gdpr) para obtener información sobre los archivos anteriores.</span><span class="sxs-lookup"><span data-stu-id="0927a-266">See [GDPR support in ASP.NET Core](xref:security/gdpr) for information on the preceding files.</span></span>

## <a name="additional-changes"></a><span data-ttu-id="0927a-267">Cambios adicionales</span><span class="sxs-lookup"><span data-stu-id="0927a-267">Additional changes</span></span>

* [<span data-ttu-id="0927a-268">SetCompatibilityVersion</span><span class="sxs-lookup"><span data-stu-id="0927a-268">SetCompatibilityVersion</span></span>](xref:fundamentals/startup#setcompatibilityversion)
* [<span data-ttu-id="0927a-269">Configuración de transporte</span><span class="sxs-lookup"><span data-stu-id="0927a-269">Transport configuration</span></span>](xref:fundamentals/servers/kestrel#transport-configuration)
