---
title: Migrar desde el núcleo de ASP.NET 2.0 a 2.1
author: rick-anderson
description: Este artículo tratan los conceptos básicos sobre la migración de una aplicación de ASP.NET Core 2.0 a 2.1.
ms.author: riande
ms.date: 05/30/2018
uid: migration/20_21
ms.openlocfilehash: 8d27d916b04c12c17c0054de8392408f751b6990
ms.sourcegitcommit: 1faf2525902236428dae6a59e375519bafd5d6d7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/28/2018
ms.locfileid: "37089898"
---
# <a name="migrate-from-aspnet-core-20-to-21"></a>Migrar desde el núcleo de ASP.NET 2.0 a 2.1

Por [Rick Anderson](https://twitter.com/RickAndMSFT)

Vea [Novedades de ASP.NET Core 2.1](xref:aspnetcore-2.1) para obtener información general de las nuevas características de ASP.NET Core 2.1.

En este artículo:

* Explica los conceptos básicos sobre la migración de una aplicación de ASP.NET Core 2.0 a 2.1.
* Proporciona una visión general de los cambios realizados en las plantillas de aplicación web de ASP.NET Core.

Es una forma rápida de obtener una visión general de los cambios en 2.1:

* Crear una aplicación web de ASP.NET Core 2.0 denominada WebApp1.
* Confirmar la WebApp1 en un sistema de control de código fuente.
* Elimine WebApp1 y cree una aplicación web de ASP.NET Core 2.1 denominada WebApp1 en el mismo lugar.
* Revise los cambios en la versión 2.1.

Este artículo proporciona información general sobre la migración a ASP.NET Core 2.1. No contiene una lista completa de todos los cambios necesarios para migrar a la versión 2.1. Algunos proyectos pueden requerir más pasos dependiendo de las opciones seleccionadas cuando se creó el proyecto y las modificaciones realizadas en el proyecto.

## <a name="update-the-project-file-to-use-21-versions"></a>Actualice el archivo de proyecto para usar 2.1 versiones

Actualización de la *.csproj* archivo de proyecto:

* Cambio `<TargetFramework>netcoreapp2.0</TargetFramework>` a la versión 2.1, que es `<TargetFramework>netcoreapp2.1</TargetFramework>`.
* Reemplazar la versión había especificada "Microsoft.AspNetCore.All" referencia de paquetes con la referencia de paquete "Microsoft.AspNetCore.App" sin versión. Debe agregar las dependencias que se quitaron de "Microsoft.AspNetCore.All". Vea [migración desde Microsoft.AspNetCore.All a Microsoft.AspNetCore.App](xref:fundamentals/metapackage#migrate) y [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Si tiene como destino .NET Framework:

  * Agregar referencias de paquete individual en lugar de una referencia de paquete meta.
  * Actualizar cada referencia de paquete a 2.1.
* Quite todas las referencias a `<DotNetCliToolReference>` elementos para los paquetes "Microsoft.AspNetCore", "Microsoft.VisualStudio" y "Microsoft.EntityFrameworkCore". Estas herramientas se han reemplazado por herramientas globales.

El marcado siguiente se muestra la plantilla genera 2.0 *.csproj* archivo de proyecto:

[!code-xml[Main](20_21/sample/WebApp20.csproj)]

El marcado siguiente se muestra la plantilla genera 2.1 *.csproj* archivo de proyecto:

[!code-xml[Main](20_21/sample/WebApp21.csproj)]

## <a name="rules-for-projects-targeting-the-shared-runtime"></a>Reglas para proyectos tienen como destino el tiempo de ejecución compartido

ASP.NET Core incluye los tiempos de ejecución compartido siguientes:

* [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app)
* [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)

Reglas para los proyectos de destino es el runtime compartido:

* Los proyectos que hacen referencia a la `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App` paquetes deben establecer SDK del proyecto en `Microsoft.NET.Sdk.Web` en la parte superior del archivo del proyecto (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
* Los proyectos que hacen referencia a paquetes o proyectos que hacen referencia a transitivamente `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`:
  * Debe establecer el SDK del proyecto en `Microsoft.NET.Sdk.Web` en la parte superior del archivo del proyecto (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
  * Debe hacer referencia el mismo paquete en tiempo de ejecución compartido. Si hace referencia a LibraryA `Microsoft.AspNetCore.App`, también deben hacer referencia a todos los proyectos que hacen referencia a LibraryA `Microsoft.AspNetCore.App`.
* Proyectos ejecutables (proyectos que contienen aplicaciones que se inician con `dotnet run` o aplicaciones que se ejecutan y proyectos para las aplicaciones de prueba) no se debe especificar una versión para `Microsoft.AspNetCore.App`. El SDK especifica la versión implícitamente a través `<PackageReference Include="Microsoft.AspNetCore.App" />`.
* Hacer referencia a proyectos (proyectos que no son el punto de entrada y las referencias del proyecto `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`) debe especificar una versión del paquete.

## <a name="changes-to-take-advantage-of-the-new-code-based-idioms-that-are-recommended-in-aspnet-core-21"></a>Cambios para aprovechar las ventajas de las expresiones nueva basada en código que se recomiendan en ASP.NET Core 2.1

### <a name="changes-to-main"></a>Cambios a la página principal

Las siguientes imágenes muestran los cambios realizados en la plantilla genera *Program.cs* archivo.

![diferencias de versión anterior](20_21/_static/main20.png)

La imagen anterior muestra la versión 2.0 con las eliminaciones en color rojo.

La siguiente imagen muestra el código 2.1. El código en verde sustituye a la versión 2.0:

![diferencias de versión nuevo](20_21/_static/main21.png)

El código siguiente muestra la versión 2.1 de *Program.cs*:

[!code-csharp[Main](20_21/sample/Program.cs?name=snippet)]

El nuevo `Main` reemplaza la llamada a `BuildWebHost` con [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder). [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) se agregó para admitir un nuevo [infraestructura de pruebas de integración](xref:test/integration-tests).

### <a name="changes-to-startup"></a>Cambios en el inicio

El código siguiente muestra los cambios al código de plantilla 2.1 generado. Todos los cambios se agregan recién código, salvo que `UseBrowserLink` se ha quitado:

[!code-csharp[Main](20_21/sample/Startup.cs?highlight=3,4,21-26,30,42,45,47)]

Los cambios de código anterior se detallan en:

* [Compatibilidad con GDPR en ASP.NET Core](xref:security/gdpr) para `CookiePolicyOptions` y `UseCookiePolicy`.
* [Protocolo de seguridad de transporte estrictos de HTTP (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) para `UseHsts`.
* [Requerir HTTPS](xref:security/enforcing-ssl#require-https) para `UseHttpsRedirection`.
* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) para `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.

## <a name="changes-to-authentication-code"></a>Cambios en el código de autenticación

ASP.NET Core 2.1 proporciona [ASP.NET Core Identity](xref:security/authentication/identity) como un [biblioteca de clases de Razor](xref:razor-pages/ui-class) (RCL).

El valor predeterminado 2.1 interfaz de usuario de identidad actualmente no proporciona nuevas características importantes con respecto a la versión 2.0. Sustituyendo la identidad con el paquete RCL es opcional. Las ventajas para reemplazar la plantilla generan identidad código con la versión RCL incluye:

* Todos los archivos se mueven fuera del árbol de código fuente.
* Nuevas características de identidad ni correcciones de errores se incluyen en el [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Obtendrá automáticamente la identidad actualizada cuando `Microsoft.AspNetCore.App` se actualiza.

Si ha tomado no trivial cambios a la plantilla generan código de identidad:

* Las ventajas anteriores no pueden justificar la conversión a la versión de RCL.
* Puede mantener el código de ASP.NET Core 2.0 Identity, es totalmente compatible.

Identidad 2.1 expone extremos con el `Identity` área. Por ejemplo, en la tabla siguiente se muestra ejemplos de puntos de conexión de identidad que cambian de 2.0 a 2.1:

| 2.0 DIRECCIÓN URL DE         | 2.1 DIRECCIÓN URL DE |
| --------------- | ------------ |
| / Cuenta/inicio de sesión  | / / Cuenta/inicio de sesión identidades |
| / Cuenta/cierre de sesión | / Identidad/cuenta/cierre de sesión |
| / Cuenta/administrar | / Identidad/cuenta/administrar |

Interfaz de usuario de identidad con la necesidad de biblioteca de identidad 2.1 para tener en cuenta las direcciones URL de identidad de las aplicaciones que tienen código de uso de la identidad y reemplace 2.0 tienen `/Identity` segmento antepuesto a los URI. Una manera de controlar el nuevo es configurar redirecciones, por ejemplo desde los puntos de conexión de identidad `/Account/Login` a `/Identity/Account/Login`.

### <a name="update-identity-to-version-21"></a>Identidad de la actualización a la versión 2.1

Las siguientes opciones están disponibles para actualizar la identidad a 2.1.

* Utilice el código 2.0 de la interfaz de usuario de identidad sin realizar ningún cambio. Usando código 2.0 de la interfaz de usuario de identidad es totalmente compatible. Esto es un enfoque adecuado cuando se han efectuado cambios significativo para el código de identidad generado.
* Elimine el código existente de identidad 2.0 y [Scaffold identidad](xref:security/authentication/scaffold-identity) en el proyecto. El proyecto usará el [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteca de clases de Razor](xref:razor-pages/ui-class). Puede generar código y la interfaz de usuario para el código de interfaz de usuario de identidad que se ha modificado. Aplicar los cambios de código para el código de interfaz de usuario recién con scaffolding.
* Elimine el código existente de identidad 2.0 y [Scaffold identidad](xref:security/authentication/scaffold-identity) en el proyecto con la opción de **invalidar todos los archivos**.

### <a name="replace-identity-20-ui-with-the-identity-21-razor-class-library"></a>Reemplazar identidad 2.0 IU con la biblioteca de clases de identidad 2.1 Razor

En esta sección se describe los pasos para reemplazar el código de identidad de plantilla que genera ASP.NET Core 2.0 con el [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteca de clases de Razor](xref:razor-pages/ui-class). Los pasos siguientes son para un proyecto de las páginas de Razor, pero el enfoque de un proyecto de MVC es similar.

* Compruebe el [archivo de proyecto se actualiza para usar 2.1 versiones](#update-the-project-file-to-use-21-versions)
* Elimine las siguientes carpetas y todos los archivos contenidos en ellas:
  * *Controladores*
  * *Páginas/cuenta /*
  * *Extensiones*
* Compile el proyecto.
* [Aplicar la técnica scaffolding identidad](xref:security/authentication/scaffold-identity) en el proyecto:
  * Seleccione los proyectos salir *_Layout.cshtml* archivo.
  * Seleccione el **+** icono en el lado derecho de la **clase de contexto de datos**. Acepte el nombre predeterminado.
  * Seleccione **agregar** para crear una nueva clase de contexto de datos. Crear un nuevo contexto de datos es necesario para aplicar la técnica scaffolding. Quite el nuevo contexto de datos en la sección siguiente.

### <a name="update-after-scaffolding-identity"></a>Actualizar después de la identidad de scaffolding

* Eliminar el scaffolder de identidad generado `IdentityDbContext` clase derivada en la *áreas/identidad/Data/* carpeta.
* Eliminar *Areas/Identity/IdentityHostingStartup.cs*
* Actualización de la *_LoginPartial.cshtml* archivo:
  * Mover *Pages/_LoginPartial.cshtml* a *Pages/Shared/_LoginPartial.cshtml*
  * Agregar `asp-area="Identity"` a los vínculos del formulario y delimitadora.
  * Actualización de la `<form />` elemento a `    <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`

  El siguiente código muestra actualizado *_LoginPartial.cshtml* archivo:

  [!code-cshtml[Main](20_21/sample/_LoginPartial.cshtml?highlight=8,11,22,23)]

Actualización `ConfigureServices` con el código siguiente:

[!code-csharp[Main](20_21/sample/Startup2.cs?name=snippet)]

## <a name="changes-to-razor-pages-projects-razor-files"></a>Cambios en las páginas de Razor los proyectos de archivos de Razor

### <a name="the-layout-file"></a>El archivo de diseño

* Mover *Pages/_Layout.cshtml* a *Pages/Shared/_Layout.cshtml*
* El *Layout.cshtml* archivo tiene los siguientes cambios:

  * `<partial name="_CookieConsentPartial" />` se agrega. Para más información, vea [GDPR support in ASP.NET Core](xref:security/gdpr) (Compatibilidad con el Reglamento general de protección de datos en ASP.NET Core).
  * cambios de jQuery de 2.2.0 a 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

* *Pages/_ValidationScriptsPartial.cshtml* mueve a *Pages/Shared/_ValidationScriptsPartial.cshtml*
* *jQuery.Validate/1.14.0* cambia a *jquery.validate/1.17.0*

### <a name="new-files"></a>Nuevos archivos

Se agregan los siguientes archivos:

* *Privacy.cshtml*
* *Privacy.cshtml.cs*

Vea [GDPR admite en ASP.NET Core](xref:security/gdpr) para obtener información sobre los archivos anteriores.

## <a name="changes-to-mvc-projects-razor-files"></a>Cambios en los archivos de Razor de proyectos MVC

### <a name="the-layout-file"></a>El archivo de diseño

El *Layout.cshtml* archivo tiene los siguientes cambios:

* `<partial name="_CookieConsentPartial" />` se agrega.
* cambios de jQuery de 2.2.0 a 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

*jQuery.Validate/1.14.0* cambia a *jquery.validate/1.17.0*

### <a name="new-files-and-action-methods"></a>Nuevos archivos y los métodos de acción

Se ha agregado lo siguiente:

* *Views/Home/Privacy.cshtml*
* El `Privacy` se agrega el método de acción para el controlador Home.

Vea [GDPR admite en ASP.NET Core](xref:security/gdpr) para obtener información sobre los archivos anteriores.

## <a name="additional-changes"></a>Cambios adicionales

* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion)
* [Configuración de transporte](xref:fundamentals/servers/kestrel#transport-configuration)
