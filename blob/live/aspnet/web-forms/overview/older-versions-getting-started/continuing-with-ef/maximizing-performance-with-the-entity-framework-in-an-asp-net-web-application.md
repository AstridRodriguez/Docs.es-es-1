---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
title: "Maximizar el rendimiento con Entity Framework 4.0 en una aplicación de ASP.NET 4 Web | Documentos de Microsoft"
author: tdykstra
description: "Esta serie de tutoriales se basa en la aplicación web de la Universidad de Contoso que se crea mediante la introducción a la serie de tutoriales de Entity Framework 4.0. ¿..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: 4e43455e-dfa1-42db-83cb-c987703f04b5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: 9e257f5061f6bdf14ad0776ff6385fb526d6dcb1
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/10/2017
---
<a name="maximizing-performance-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="0aee0-104">Maximizar el rendimiento con Entity Framework 4.0 en una aplicación Web 4 de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="0aee0-104">Maximizing Performance with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>
====================
<span data-ttu-id="0aee0-105">Por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="0aee0-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="0aee0-106">Esta serie de tutoriales que se basa en la aplicación web de la Universidad de Contoso que se crea mediante la [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="0aee0-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="0aee0-107">Si no has completado los tutoriales anteriores, como punto de partida para este tutorial puede [descargar la aplicación](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) que puede haberla creado.</span><span class="sxs-lookup"><span data-stu-id="0aee0-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="0aee0-108">También puede [descargar la aplicación](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) creado por la serie de tutoriales completa.</span><span class="sxs-lookup"><span data-stu-id="0aee0-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="0aee0-109">Si tiene alguna pregunta acerca de los tutoriales, puede publicar para la [foro de ASP.NET Entity Framework](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="0aee0-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="0aee0-110">En el tutorial anterior, ha visto cómo tratar los conflictos de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="0aee0-110">In the previous tutorial, you saw how to handle concurrency conflicts.</span></span> <span data-ttu-id="0aee0-111">Este tutorial muestra opciones para mejorar el rendimiento de una aplicación web ASP.NET que utiliza Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="0aee0-111">This tutorial shows options for improving the performance of an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="0aee0-112">Obtendrá información sobre varios métodos para maximizar el rendimiento o para diagnosticar problemas de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0aee0-112">You'll learn several methods for maximizing performance or for diagnosing performance problems.</span></span>

<span data-ttu-id="0aee0-113">Información que se presenta en las secciones siguientes es probable que sea útil en una amplia variedad de escenarios:</span><span class="sxs-lookup"><span data-stu-id="0aee0-113">Information presented in the following sections is likely to be useful in a broad variety of scenarios:</span></span>

- <span data-ttu-id="0aee0-114">Cargar eficazmente datos relacionados.</span><span class="sxs-lookup"><span data-stu-id="0aee0-114">Efficiently load related data.</span></span>
- <span data-ttu-id="0aee0-115">Administrar el estado de vista.</span><span class="sxs-lookup"><span data-stu-id="0aee0-115">Manage view state.</span></span>

<span data-ttu-id="0aee0-116">Información presentada en las secciones siguientes puede ser útil si tiene consultas individuales que presentan problemas de rendimiento:</span><span class="sxs-lookup"><span data-stu-id="0aee0-116">Information presented in the following sections might be useful if you have individual queries that present performance problems:</span></span>

- <span data-ttu-id="0aee0-117">Use la `NoTracking` merge (opción).</span><span class="sxs-lookup"><span data-stu-id="0aee0-117">Use the `NoTracking` merge option.</span></span>
- <span data-ttu-id="0aee0-118">Precompilar consultas LINQ.</span><span class="sxs-lookup"><span data-stu-id="0aee0-118">Pre-compile LINQ queries.</span></span>
- <span data-ttu-id="0aee0-119">Examine los comandos de consulta que se envía a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="0aee0-119">Examine query commands sent to the database.</span></span>

<span data-ttu-id="0aee0-120">Información que se presenta en la sección siguiente es potencialmente útil para las aplicaciones que tienen modelos de datos extremadamente grandes:</span><span class="sxs-lookup"><span data-stu-id="0aee0-120">Information presented in the following section is potentially useful for applications that have extremely large data models:</span></span>

- <span data-ttu-id="0aee0-121">Generar previamente las vistas.</span><span class="sxs-lookup"><span data-stu-id="0aee0-121">Pre-generate views.</span></span>

> [!NOTE]
> <span data-ttu-id="0aee0-122">Rendimiento de la aplicación Web se ve afectado por diversos factores, incluidos elementos tales como el tamaño de los datos de solicitud y respuesta, la velocidad de las consultas de base de datos, la cantidad de solicitudes que el servidor puede poner en cola y la rapidez con pueda dar servicio a ellos así como incluso la eficacia de cualquier bibliotecas de script de cliente puede que esté usando.</span><span class="sxs-lookup"><span data-stu-id="0aee0-122">Web application performance is affected by many factors, including things like the size of request and response data, the speed of database queries, how many requests the server can queue and how quickly it can service them, and even the efficiency of any client-script libraries you might be using.</span></span> <span data-ttu-id="0aee0-123">Si el rendimiento resulta esencial en la aplicación, o pruebas o la experiencia muestra que el rendimiento de la aplicación no es satisfactorio, debe seguir protocolo normal para la optimización de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0aee0-123">If performance is critical in your application, or if testing or experience shows that application performance isn't satisfactory, you should follow normal protocol for performance tuning.</span></span> <span data-ttu-id="0aee0-124">Para determinar dónde se producen cuellos de botella de rendimiento de medida y, a continuación, solucione las áreas que tendrán mayor impacto en el rendimiento general de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-124">Measure to determine where performance bottlenecks are occurring, and then address the areas that will have the greatest impact on overall application performance.</span></span>
> 
> <span data-ttu-id="0aee0-125">En este tema se centra principalmente en las formas en que puede mejorar potencialmente el rendimiento específicamente de Entity Framework en ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0aee0-125">This topic focuses mainly on ways in which you can potentially improve the performance specifically of the Entity Framework in ASP.NET.</span></span> <span data-ttu-id="0aee0-126">Las sugerencias aquí son útiles si determina que el acceso a los datos es uno de los cuellos de botella de rendimiento en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-126">The suggestions here are useful if you determine that data access is one of the performance bottlenecks in your application.</span></span> <span data-ttu-id="0aee0-127">Excepto como se indicó, no deben interpretarse como los métodos explicados aquí &quot;prácticas recomendadas&quot; en general, muchos de ellos son adecuados solo en situaciones excepcionales o a tipos muy específicos de dirección de los cuellos de botella de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0aee0-127">Except as noted, the methods explained here shouldn't be considered &quot;best practices&quot; in general — many of them are appropriate only in exceptional situations or to address very specific kinds of performance bottlenecks.</span></span>


<span data-ttu-id="0aee0-128">Para iniciar el tutorial, inicie Visual Studio y abra la aplicación web de la Universidad de Contoso que estaba trabajando con en el tutorial anterior.</span><span class="sxs-lookup"><span data-stu-id="0aee0-128">To start the tutorial, start Visual Studio and open the Contoso University web application that you were working with in the previous tutorial.</span></span>

## <a name="efficiently-loading-related-data"></a><span data-ttu-id="0aee0-129">Cargar eficazmente datos relacionados</span><span class="sxs-lookup"><span data-stu-id="0aee0-129">Efficiently Loading Related Data</span></span>

<span data-ttu-id="0aee0-130">Hay varias maneras que Entity Framework pueda cargar los datos relacionados en las propiedades de navegación de una entidad:</span><span class="sxs-lookup"><span data-stu-id="0aee0-130">There are several ways that the Entity Framework can load related data into the navigation properties of an entity:</span></span>

- <span data-ttu-id="0aee0-131">*Carga diferida*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-131">*Lazy loading*.</span></span> <span data-ttu-id="0aee0-132">Cuando la entidad es de lectura en primer lugar, no recuperan datos relacionados.</span><span class="sxs-lookup"><span data-stu-id="0aee0-132">When the entity is first read, related data isn't retrieved.</span></span> <span data-ttu-id="0aee0-133">Sin embargo, la primera vez que intente acceder a una propiedad de navegación, se recuperan automáticamente los datos necesarios para esa propiedad de navegación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-133">However, the first time you attempt to access a navigation property, the data required for that navigation property is automatically retrieved.</span></span> <span data-ttu-id="0aee0-134">Esto da como resultado varias consultas que se envían a la base de datos: uno para la propia entidad y otro se debe recuperar cada vez que los datos de la entidad relacionados.</span><span class="sxs-lookup"><span data-stu-id="0aee0-134">This results in multiple queries sent to the database — one for the entity itself and one each time that related data for the entity must be retrieved.</span></span> 

    <span data-ttu-id="0aee0-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="0aee0-136">*Carga diligente*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-136">*Eager loading*.</span></span> <span data-ttu-id="0aee0-137">Cuando se lee la entidad, se recuperan los datos relacionados con él.</span><span class="sxs-lookup"><span data-stu-id="0aee0-137">When the entity is read, related data is retrieved along with it.</span></span> <span data-ttu-id="0aee0-138">Esto normalmente como resultado de una consulta de combinación única que recupera todos los datos que se necesitan.</span><span class="sxs-lookup"><span data-stu-id="0aee0-138">This typically results in a single join query that retrieves all of the data that's needed.</span></span> <span data-ttu-id="0aee0-139">Carga diligente se especifica mediante el `Include` método, como se ha visto ya en estos tutoriales.</span><span class="sxs-lookup"><span data-stu-id="0aee0-139">You specify eager loading by using the `Include` method, as you've seen already in these tutorials.</span></span>

<span data-ttu-id="0aee0-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

- <span data-ttu-id="0aee0-141">*Carga explícita*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-141">*Explicit loading*.</span></span> <span data-ttu-id="0aee0-142">Esto es similar a la carga diferida, salvo que explícitamente recuperar los datos relacionados en el código. no sucede automáticamente cuando tiene acceso a una propiedad de navegación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-142">This is similar to lazy loading, except that you explicitly retrieve the related data in code; it doesn't happen automatically when you access a navigation property.</span></span> <span data-ttu-id="0aee0-143">Cargar datos relacionados manualmente mediante la `Load` método de la propiedad de navegación para colecciones, o utilizar el `Load` método de la propiedad de referencia para las propiedades que contienen un solo objeto.</span><span class="sxs-lookup"><span data-stu-id="0aee0-143">You load related data manually using the `Load` method of the navigation property for collections, or you use the `Load` method of the reference property for properties that hold a single object.</span></span> <span data-ttu-id="0aee0-144">(Por ejemplo, se llama a la `PersonReference.Load` método para cargar el `Person` propiedad de navegación de un `Department` entidad.)</span><span class="sxs-lookup"><span data-stu-id="0aee0-144">(For example, you call the `PersonReference.Load` method to load the `Person` navigation property of a `Department` entity.)</span></span>

    <span data-ttu-id="0aee0-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="0aee0-146">Porque no recuperan inmediatamente los valores de propiedad, carga diferida y carga explícita también se las conoce como *carga aplazada*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-146">Because they don't immediately retrieve the property values, lazy loading and explicit loading are also both known as *deferred loading*.</span></span>

<span data-ttu-id="0aee0-147">Carga diferida es el comportamiento predeterminado para un contexto del objeto que se ha generado por el diseñador.</span><span class="sxs-lookup"><span data-stu-id="0aee0-147">Lazy loading is the default behavior for an object context that has been generated by the designer.</span></span> <span data-ttu-id="0aee0-148">Si abre el *SchoolModel.Designer.cs* archivo que define la clase de contexto de objeto, encontrará tres métodos de constructor y cada uno de ellos incluye la siguiente instrucción:</span><span class="sxs-lookup"><span data-stu-id="0aee0-148">If you open the *SchoolModel.Designer.cs* file that defines the object context class, you'll find three constructor methods, and each of them includes the following statement:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="0aee0-149">En general, si sabe que necesita datos relacionados para cada entidad carga diligente, recuperada ofrece el mejor rendimiento, porque una sola consulta que se envía a la base de datos es normalmente más eficaz que las consultas independientes para cada entidad recuperados.</span><span class="sxs-lookup"><span data-stu-id="0aee0-149">In general, if you know you need related data for every entity retrieved, eager loading offers the best performance, because a single query sent to the database is typically more efficient than separate queries for each entity retrieved.</span></span> <span data-ttu-id="0aee0-150">Por otro lado, si necesita tener acceso a propiedades de navegación de una entidad usen con poca frecuencia o solo para un pequeño conjunto de las entidades, la carga diferida o la carga explícita puede ser más eficaz, porque la carga diligente recuperaría más datos de los que necesita.</span><span class="sxs-lookup"><span data-stu-id="0aee0-150">On the other hand, if you need to access an entity's navigation properties only infrequently or only for a small set of the entities, lazy loading or explicit loading may be more efficient, because eager loading would retrieve more data than you need.</span></span>

<span data-ttu-id="0aee0-151">En una aplicación web, la carga diferida puede ser de relativamente poco valor de todos modos, porque tienen lugar en el explorador, que no tiene conexión con el contexto del objeto que representa la página de acciones de usuario que afectan a la necesidad de datos relacionados.</span><span class="sxs-lookup"><span data-stu-id="0aee0-151">In a web application, lazy loading may be of relatively little value anyway, because user actions that affect the need for related data take place in the browser, which has no connection to the object context that rendered the page.</span></span> <span data-ttu-id="0aee0-152">Por otro lado, al enlazar un control, normalmente saber qué datos hay que necesita y, por lo que normalmente es mejor para elegir carga diligente o la carga aplazada en función de lo que es adecuado para cada escenario.</span><span class="sxs-lookup"><span data-stu-id="0aee0-152">On the other hand, when you databind a control, you typically know what data you need, and so it's generally best to choose eager loading or deferred loading based on what's appropriate in each scenario.</span></span>

<span data-ttu-id="0aee0-153">Además, un control enlazado a datos podría usar un objeto de entidad después de que se elimine el contexto del objeto.</span><span class="sxs-lookup"><span data-stu-id="0aee0-153">In addition, a databound control might use an entity object after the object context is disposed.</span></span> <span data-ttu-id="0aee0-154">En ese caso, se producirá un error en un intento de carga diferida una propiedad de navegación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-154">In that case, an attempt to lazy-load a navigation property would fail.</span></span> <span data-ttu-id="0aee0-155">El mensaje de error que recibe es claro:&quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span><span class="sxs-lookup"><span data-stu-id="0aee0-155">The error message you receive is clear: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span></span>

<span data-ttu-id="0aee0-156">El `EntityDataSource` control deshabilita la carga diferida de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="0aee0-156">The `EntityDataSource` control disables lazy loading by default.</span></span> <span data-ttu-id="0aee0-157">Para el `ObjectDataSource` control que está usando para el tutorial actual (o si tiene acceso al contexto del objeto de código de la página), hay varias maneras de hacer que sea diferida carga deshabilitada de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="0aee0-157">For the `ObjectDataSource` control that you're using for the current tutorial (or if you access the object context from page code), there are several ways you can make lazy loading disabled by default.</span></span> <span data-ttu-id="0aee0-158">Se puede deshabilitar cuando cree instancias de un contexto del objeto.</span><span class="sxs-lookup"><span data-stu-id="0aee0-158">You can disable it when you instantiate an object context.</span></span> <span data-ttu-id="0aee0-159">Por ejemplo, puede agregar la línea siguiente al método de constructor de la `SchoolRepository` clase:</span><span class="sxs-lookup"><span data-stu-id="0aee0-159">For example, you can add the following line to the constructor method of the `SchoolRepository` class:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="0aee0-160">Para la aplicación de la Universidad de Contoso, hará que el contexto del objeto deshabilitar automáticamente la carga diferida para que esta propiedad no tiene que establecerse siempre que se crea una instancia de un contexto.</span><span class="sxs-lookup"><span data-stu-id="0aee0-160">For the Contoso University application, you'll make the object context automatically disable lazy loading so that this property doesn't have to be set whenever a context is instantiated.</span></span>

<span data-ttu-id="0aee0-161">Abra la *SchoolModel.edmx* datos de modelo, haga clic en la superficie de diseño y, a continuación, en el panel Propiedades, establezca la **carga diferida habilitado** propiedad `False`.</span><span class="sxs-lookup"><span data-stu-id="0aee0-161">Open the *SchoolModel.edmx* data model, click the design surface, and then in the properties pane set the **Lazy Loading Enabled** property to `False`.</span></span> <span data-ttu-id="0aee0-162">Guarde y cierre el modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="0aee0-162">Save and close the data model.</span></span>

<span data-ttu-id="0aee0-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

## <a name="managing-view-state"></a><span data-ttu-id="0aee0-164">Administrar el estado de vista</span><span class="sxs-lookup"><span data-stu-id="0aee0-164">Managing View State</span></span>

<span data-ttu-id="0aee0-165">Con el fin de proporcionar funcionalidad de actualización, una página web ASP.NET debe almacenar los valores originales de la propiedad de una entidad cuando se representa una página.</span><span class="sxs-lookup"><span data-stu-id="0aee0-165">In order to provide update functionality, an ASP.NET web page must store the original property values of an entity when a page is rendered.</span></span> <span data-ttu-id="0aee0-166">Durante el control de procesamiento de la devolución de llamada puede volver a crear el estado original de la entidad y llamar a la entidad `Attach` método antes de aplicar los cambios y llamar a la `SaveChanges` método.</span><span class="sxs-lookup"><span data-stu-id="0aee0-166">During postback processing the control can re-create the original state of the entity and call the entity's `Attach` method before applying changes and calling the `SaveChanges` method.</span></span> <span data-ttu-id="0aee0-167">De forma predeterminada, los controles de datos de formularios Web Forms de ASP.NET utilizan el estado de vista para almacenar los valores originales.</span><span class="sxs-lookup"><span data-stu-id="0aee0-167">By default, ASP.NET Web Forms data controls use view state to store the original values.</span></span> <span data-ttu-id="0aee0-168">Sin embargo, el estado de vista puede afectar al rendimiento, porque está almacenada en los campos ocultos que pueden aumentar considerablemente el tamaño de la página que se envía a y desde el explorador.</span><span class="sxs-lookup"><span data-stu-id="0aee0-168">However, view state can affect performance, because it's stored in hidden fields that can substantially increase the size of the page that's sent to and from the browser.</span></span>

<span data-ttu-id="0aee0-169">Técnicas para administrar el estado de vista o alternativas como el estado de sesión no son únicas para Entity Framework, por lo que este tutorial no entraremos en este tema en detalle.</span><span class="sxs-lookup"><span data-stu-id="0aee0-169">Techniques for managing view state, or alternatives such as session state, aren't unique to the Entity Framework, so this tutorial doesn't go into this topic in detail.</span></span> <span data-ttu-id="0aee0-170">Para obtener más información, vea los vínculos al final del tutorial.</span><span class="sxs-lookup"><span data-stu-id="0aee0-170">For more information see the links at the end of the tutorial.</span></span>

<span data-ttu-id="0aee0-171">Sin embargo, la versión 4 de ASP.NET proporciona una nueva forma de trabajar con el estado de vista que todos los desarrolladores de aplicaciones de formularios Web Forms ASP.NET deben tener en cuenta: el `ViewStateMode` propiedad.</span><span class="sxs-lookup"><span data-stu-id="0aee0-171">However, version 4 of ASP.NET provides a new way of working with view state that every ASP.NET developer of Web Forms applications should be aware of: the `ViewStateMode` property.</span></span> <span data-ttu-id="0aee0-172">Esta nueva propiedad se puede establecer en el nivel de página o un control, y le permite deshabilitar el estado de vista de una página de forma predeterminada y habilitar solo para los controles que lo necesitan.</span><span class="sxs-lookup"><span data-stu-id="0aee0-172">This new property can be set at the page or control level, and it enables you to disable view state by default for a page and enable it only for controls that need it.</span></span>

<span data-ttu-id="0aee0-173">Para las aplicaciones que el rendimiento sea crucial, una buena práctica es siempre deshabilitar el estado de vista en el nivel de página y habilitar solo para los controles que lo requieran.</span><span class="sxs-lookup"><span data-stu-id="0aee0-173">For applications where performance is critical, a good practice is to always disable view state at the page level and enable it only for controls that require it.</span></span> <span data-ttu-id="0aee0-174">El tamaño del estado de vista en las páginas de la Universidad de Contoso no reducirse sustancialmente por este método, pero para ver cómo funciona, llevará a cabo el *Instructors.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="0aee0-174">The size of view state in the Contoso University pages wouldn't be substantially decreased by this method, but to see how it works, you'll do it for the *Instructors.aspx* page.</span></span> <span data-ttu-id="0aee0-175">Esta página contiene muchos controles, incluyendo un `Label` control que tiene el estado de vista deshabilitado.</span><span class="sxs-lookup"><span data-stu-id="0aee0-175">That page contains many controls, including a `Label` control that has view state disabled.</span></span> <span data-ttu-id="0aee0-176">Ninguno de los controles de esta página realmente necesita tener habilitado el estado de vista.</span><span class="sxs-lookup"><span data-stu-id="0aee0-176">None of the controls on this page actually need to have view state enabled.</span></span> <span data-ttu-id="0aee0-177">(El `DataKeyNames` propiedad de la `GridView` control especifica el estado que debe mantenerse entre las devoluciones de datos, pero estos valores se mantienen en estado de control, lo que no se ve afectado por la `ViewStateMode` propiedad.)</span><span class="sxs-lookup"><span data-stu-id="0aee0-177">(The `DataKeyNames` property of the `GridView` control specifies state that must be maintained between postbacks, but these values are kept in control state, which isn't affected by the `ViewStateMode` property.)</span></span>

<span data-ttu-id="0aee0-178">El `Page` directiva y `Label` marcado del control actualmente es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="0aee0-178">The `Page` directive and `Label` control markup currently resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="0aee0-179">Realice los cambios siguientes:</span><span class="sxs-lookup"><span data-stu-id="0aee0-179">Make the following changes:</span></span>

- <span data-ttu-id="0aee0-180">Agregar `ViewStateMode="Disabled"` a la `Page` directiva.</span><span class="sxs-lookup"><span data-stu-id="0aee0-180">Add `ViewStateMode="Disabled"` to the `Page` directive.</span></span>
- <span data-ttu-id="0aee0-181">Quitar `ViewStateMode="Disabled"` desde el `Label` control.</span><span class="sxs-lookup"><span data-stu-id="0aee0-181">Remove `ViewStateMode="Disabled"` from the `Label` control.</span></span>

<span data-ttu-id="0aee0-182">El marcado ahora es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="0aee0-182">The markup now resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="0aee0-183">Estado de vista ahora está deshabilitado para todos los controles.</span><span class="sxs-lookup"><span data-stu-id="0aee0-183">View state is now disabled for all controls.</span></span> <span data-ttu-id="0aee0-184">Si posteriormente, agregar un control que es necesario usar el estado de vista, todo lo que necesita hacer es incluir el `ViewStateMode="Enabled"` atributo de ese control.</span><span class="sxs-lookup"><span data-stu-id="0aee0-184">If you later add a control that does need to use view state, all you need to do is include the `ViewStateMode="Enabled"` attribute for that control.</span></span>

## <a name="using-the-notracking-merge-option"></a><span data-ttu-id="0aee0-185">Con la opción de combinación NoTracking</span><span class="sxs-lookup"><span data-stu-id="0aee0-185">Using The NoTracking Merge Option</span></span>

<span data-ttu-id="0aee0-186">Cuando un contexto del objeto recupera las filas de la base de datos y crea objetos de entidad que tienen tipos de archivo, de forma predeterminada también realiza un seguimiento de esos objetos de entidad con su administrador de estado de objeto.</span><span class="sxs-lookup"><span data-stu-id="0aee0-186">When an object context retrieves database rows and creates entity objects that represent them, by default it also tracks those entity objects using its object state manager.</span></span> <span data-ttu-id="0aee0-187">Estos datos de seguimiento actúa como una memoria caché y se utilizan cuando se actualiza una entidad.</span><span class="sxs-lookup"><span data-stu-id="0aee0-187">This tracking data acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="0aee0-188">Dado que una aplicación web normalmente tiene instancias de contexto de objetos de corta duración, las consultas a menudo devuelvan datos que no tienen que llevar un seguimiento porque el contexto del objeto que hace que se eliminará antes de cualquiera de las entidades que se lee se vuelven a utilizar o actualizarán.</span><span class="sxs-lookup"><span data-stu-id="0aee0-188">Because a web application typically has short-lived object context instances, queries often return data that doesn't need to be tracked, because the object context that reads them will be disposed before any of the entities it reads are used again or updated.</span></span>

<span data-ttu-id="0aee0-189">En Entity Framework, puede especificar si el contexto del objeto realiza el seguimiento de objetos entidad estableciendo un *merge (opción)*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-189">In the Entity Framework, you can specify whether the object context tracks entity objects by setting a *merge option*.</span></span> <span data-ttu-id="0aee0-190">Puede establecer la opción de combinación para las consultas individuales o para los conjuntos de entidades.</span><span class="sxs-lookup"><span data-stu-id="0aee0-190">You can set the merge option for individual queries or for entity sets.</span></span> <span data-ttu-id="0aee0-191">Si se establece para un conjunto de entidades, que significa que se está estableciendo la opción de combinación predeterminada para todas las consultas que se crean para ese conjunto de entidades.</span><span class="sxs-lookup"><span data-stu-id="0aee0-191">If you set it for an entity set, that means that you're setting the default merge option for all queries that are created for that entity set.</span></span>

<span data-ttu-id="0aee0-192">Para la aplicación de la Universidad de Contoso, seguimiento no se necesita para cualquiera de los conjuntos de entidades que tiene acceso desde el repositorio, por lo que puede establecer la opción de combinación `NoTracking` para los conjuntos de entidades al crear una instancia de contexto del objeto de la clase de repositorio.</span><span class="sxs-lookup"><span data-stu-id="0aee0-192">For the Contoso University application, tracking isn't needed for any of the entity sets that you access from the repository, so you can set the merge option to `NoTracking` for those entity sets when you instantiate the object context in the repository class.</span></span> <span data-ttu-id="0aee0-193">(Tenga en cuenta que en este tutorial, establecer la opción de combinación no tendrá un efecto notable en el rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-193">(Note that in this tutorial, setting the merge option won't have a noticeable effect on the application's performance.</span></span> <span data-ttu-id="0aee0-194">El `NoTracking` opción es probable que una mejora del rendimiento observable solo en determinados escenarios de gran volumen de datos.)</span><span class="sxs-lookup"><span data-stu-id="0aee0-194">The `NoTracking` option is likely to make an observable performance improvement only in certain high-data-volume scenarios.)</span></span>

<span data-ttu-id="0aee0-195">En la carpeta de la capa DAL, abra el *SchoolRepository.cs* archivo y agregar un método de constructor que establece la opción de combinación para la entidad, se establece que tiene acceso el repositorio:</span><span class="sxs-lookup"><span data-stu-id="0aee0-195">In the DAL folder, open the *SchoolRepository.cs* file and add a constructor method that sets the merge option for the entity sets that the repository accesses:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

## <a name="pre-compiling-linq-queries"></a><span data-ttu-id="0aee0-196">Compilación previa de las consultas LINQ</span><span class="sxs-lookup"><span data-stu-id="0aee0-196">Pre-Compiling LINQ Queries</span></span>

<span data-ttu-id="0aee0-197">La primera vez que Entity Framework se ejecuta una consulta de Entity SQL durante la vida de un determinado `ObjectContext` instancia, tarda algún tiempo para compilar la consulta.</span><span class="sxs-lookup"><span data-stu-id="0aee0-197">The first time that the Entity Framework executes an Entity SQL query within the life of a given `ObjectContext` instance, it takes some time to compile the query.</span></span> <span data-ttu-id="0aee0-198">El resultado de la compilación se almacena en caché, lo que significa que las ejecuciones posteriores de la consulta son mucho más rápidas.</span><span class="sxs-lookup"><span data-stu-id="0aee0-198">The result of compilation is cached, which means that subsequent executions of the query are much quicker.</span></span> <span data-ttu-id="0aee0-199">Las consultas LINQ siguen un patrón similar, salvo que algunas de las tareas necesarias para compilar la consulta se realiza cada vez que se ejecuta la consulta.</span><span class="sxs-lookup"><span data-stu-id="0aee0-199">LINQ queries follow a similar pattern, except that some of the work required to compile the query is done every time the query is executed.</span></span> <span data-ttu-id="0aee0-200">En otras palabras, para las consultas LINQ, de forma predeterminada todos los resultados de la compilación no se almacenan en caché.</span><span class="sxs-lookup"><span data-stu-id="0aee0-200">In other words, for LINQ queries, by default not all of the results of compilation are cached.</span></span>

<span data-ttu-id="0aee0-201">Si tiene una consulta LINQ que se espera que se ejecute varias veces en la vida de un contexto del objeto, puede escribir código que hace que todos los resultados de la compilación en la memoria caché la primera vez que se ejecuta la consulta LINQ.</span><span class="sxs-lookup"><span data-stu-id="0aee0-201">If you have a LINQ query that you expect to run repeatedly in the life of an object context, you can write code that causes all of the results of compilation to be cached the first time the LINQ query is run.</span></span>

<span data-ttu-id="0aee0-202">Como ilustración, deberá hacerlo para dos `Get` métodos en el `SchoolRepository` (clase), uno de los cuales no toma ningún parámetro (el `GetInstructorNames` método) y otro que requieren un parámetro (el `GetDepartmentsByAdministrator` método).</span><span class="sxs-lookup"><span data-stu-id="0aee0-202">As an illustration, you'll do this for two `Get` methods in the `SchoolRepository` class, one of which doesn't take any parameters (the `GetInstructorNames` method), and one that does require a parameter (the `GetDepartmentsByAdministrator` method).</span></span> <span data-ttu-id="0aee0-203">Estos métodos como éstos se levantan ahora realmente no deben compilarse porque no son consultas LINQ:</span><span class="sxs-lookup"><span data-stu-id="0aee0-203">These methods as they stand now actually don't need to be compiled because they aren't LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

<span data-ttu-id="0aee0-204">Sin embargo, por lo que puede probar las consultas compiladas, podrá continuar como si se hubiese escritos como las siguientes consultas LINQ:</span><span class="sxs-lookup"><span data-stu-id="0aee0-204">However, so that you can try out compiled queries, you'll proceed as if these had been written as the following LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="0aee0-205">Puede cambiar el código de estos métodos por lo que ha mostrado anteriormente y ejecute la aplicación para comprobar que funciona antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="0aee0-205">You could change the code in these methods to what's shown above and run the application to verify that it works before continuing.</span></span> <span data-ttu-id="0aee0-206">Pero las siguientes instrucciones comenzar de inmediato en la creación de versiones precompiladas de ellos.</span><span class="sxs-lookup"><span data-stu-id="0aee0-206">But the following instructions jump right into creating pre-compiled versions of them.</span></span>

<span data-ttu-id="0aee0-207">Crear un archivo de clase en el *DAL* carpeta, asígnele el nombre *SchoolEntities.cs*y reemplace el código existente por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="0aee0-207">Create a class file in the *DAL* folder, name it *SchoolEntities.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="0aee0-208">Este código crea una clase parcial que extiende la clase de contexto de objeto generado automáticamente.</span><span class="sxs-lookup"><span data-stu-id="0aee0-208">This code creates a partial class that extends the automatically generated object context class.</span></span> <span data-ttu-id="0aee0-209">La clase parcial incluye dos consultas LINQ compiladas con la `Compile` método de la `CompiledQuery` clase.</span><span class="sxs-lookup"><span data-stu-id="0aee0-209">The partial class includes two compiled LINQ queries using the `Compile` method of the `CompiledQuery` class.</span></span> <span data-ttu-id="0aee0-210">También crea los métodos que puede usar para llamar a las consultas.</span><span class="sxs-lookup"><span data-stu-id="0aee0-210">It also creates methods that you can use to call the queries.</span></span> <span data-ttu-id="0aee0-211">Guarde y cierre este archivo.</span><span class="sxs-lookup"><span data-stu-id="0aee0-211">Save and close this file.</span></span>

<span data-ttu-id="0aee0-212">Después, en *SchoolRepository.cs*, cambiar las existentes `GetInstructorNames` y `GetDepartmentsByAdministrator` métodos en el repositorio de clase para que llame a las consultas compiladas:</span><span class="sxs-lookup"><span data-stu-id="0aee0-212">Next, in *SchoolRepository.cs*, change the existing `GetInstructorNames` and `GetDepartmentsByAdministrator` methods in the repository class so that they call the compiled queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

<span data-ttu-id="0aee0-213">Ejecute el *Departments.aspx* página para comprobar que funciona igual que antes.</span><span class="sxs-lookup"><span data-stu-id="0aee0-213">Run the *Departments.aspx* page to verify that it works as it did before.</span></span> <span data-ttu-id="0aee0-214">El `GetInstructorNames` método se llama para rellenar la lista desplegable de administrador y la `GetDepartmentsByAdministrator` método se llama al hacer clic en **actualización** para comprobar que ningún instructor es administradora de más de uno departamento.</span><span class="sxs-lookup"><span data-stu-id="0aee0-214">The `GetInstructorNames` method is called in order to populate the administrator drop-down list, and the `GetDepartmentsByAdministrator` method is called when you click **Update** in order to verify that no instructor is an administrator of more than one department.</span></span>

<span data-ttu-id="0aee0-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

<span data-ttu-id="0aee0-216">Dispone de las consultas precompiladas en la aplicación de la Universidad de Contoso solo para ver cómo hacerlo, no porque podría mejorar el rendimiento mejorará en gran medida.</span><span class="sxs-lookup"><span data-stu-id="0aee0-216">You've pre-compiled queries in the Contoso University application only to see how to do it, not because it would measurably improve performance.</span></span> <span data-ttu-id="0aee0-217">La compilación previa de las consultas LINQ agregar un nivel de complejidad en el código, así que asegúrese de que hacerlo solo para las consultas que representan realmente los cuellos de botella de rendimiento en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-217">Pre-compiling LINQ queries does add a level of complexity to your code, so make sure you do it only for queries that actually represent performance bottlenecks in your application.</span></span>

## <a name="examining-queries-sent-to-the-database"></a><span data-ttu-id="0aee0-218">Examen de las consultas enviadas a la base de datos</span><span class="sxs-lookup"><span data-stu-id="0aee0-218">Examining Queries Sent to the Database</span></span>

<span data-ttu-id="0aee0-219">Cuando se está investigando problemas de rendimiento, a veces resulta útil conocer los comandos SQL exactos que Entity Framework está enviando a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="0aee0-219">When you're investigating performance issues, sometimes it's helpful to know the exact SQL commands that the Entity Framework is sending to the database.</span></span> <span data-ttu-id="0aee0-220">Si está trabajando con un `IQueryable` objeto, una manera de hacerlo es utilizar el `ToTraceString` método.</span><span class="sxs-lookup"><span data-stu-id="0aee0-220">If you're working with an `IQueryable` object, one way to do this is to use the `ToTraceString` method.</span></span>

<span data-ttu-id="0aee0-221">En *SchoolRepository.cs*, cambie el código en el `GetDepartmentsByName` método para que coincida con el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0aee0-221">In *SchoolRepository.cs*, change the code in the `GetDepartmentsByName` method to match the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.cs)]

<span data-ttu-id="0aee0-222">El `departments` variable debe convertirse a un `ObjectQuery` tipo solo porque el `Where` método al final de la línea anterior crea un `IQueryable` objeto; sin el `Where` método, la conversión no sería necesaria.</span><span class="sxs-lookup"><span data-stu-id="0aee0-222">The `departments` variable must be cast to an `ObjectQuery` type only because the `Where` method at the end of the preceding line creates an `IQueryable` object; without the `Where` method, the cast would not be necessary.</span></span>

<span data-ttu-id="0aee0-223">Establecer un punto de interrupción en la `return` de línea y, a continuación, ejecute el *Departments.aspx* página en el depurador.</span><span class="sxs-lookup"><span data-stu-id="0aee0-223">Set a breakpoint on the `return` line, and then run the *Departments.aspx* page in the debugger.</span></span> <span data-ttu-id="0aee0-224">Cuando se alcanza el punto de interrupción, examine la `commandText` variable en el **locales** ventana y usar el visualizador de texto (la lupa en el **valor** columna) para mostrar su valor en el **Visualizador de texto** ventana.</span><span class="sxs-lookup"><span data-stu-id="0aee0-224">When you hit the breakpoint, examine the `commandText` variable in the **Locals** window and use the text visualizer (the magnifying glass in the **Value** column) to display its value in the **Text Visualizer** window.</span></span> <span data-ttu-id="0aee0-225">Puede ver todo el comando SQL que es el resultado de este código:</span><span class="sxs-lookup"><span data-stu-id="0aee0-225">You can see the entire SQL command that results from this code:</span></span>

<span data-ttu-id="0aee0-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="0aee0-227">Como alternativa, la característica de IntelliTrace en Visual Studio Ultimate proporciona una manera de ver los comandos SQL generados por Entity Framework que no requiere cambios en el código o incluso establecer un punto de interrupción.</span><span class="sxs-lookup"><span data-stu-id="0aee0-227">As an alternative, the IntelliTrace feature in Visual Studio Ultimate provides a way to view SQL commands generated by the Entity Framework that doesn't require you to change your code or even set a breakpoint.</span></span>

> [!NOTE]
> <span data-ttu-id="0aee0-228">Puede realizar los siguientes procedimientos solo si tiene Visual Studio Ultimate.</span><span class="sxs-lookup"><span data-stu-id="0aee0-228">You can perform the following procedures only if you have Visual Studio Ultimate.</span></span>


<span data-ttu-id="0aee0-229">Restaure el código original en el `GetDepartmentsByName` método y, a continuación, ejecute el *Departments.aspx* página en el depurador.</span><span class="sxs-lookup"><span data-stu-id="0aee0-229">Restore the original code in the `GetDepartmentsByName` method, and then run the *Departments.aspx* page in the debugger.</span></span>

<span data-ttu-id="0aee0-230">En Visual Studio, seleccione la **depurar** menú, a continuación, **IntelliTrace**y, a continuación, **eventos de IntelliTrace**.</span><span class="sxs-lookup"><span data-stu-id="0aee0-230">In Visual Studio, select the **Debug** menu, then **IntelliTrace**, and then **IntelliTrace Events**.</span></span>

<span data-ttu-id="0aee0-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="0aee0-232">En el **IntelliTrace** ventana, haga clic en **interrumpir todos**.</span><span class="sxs-lookup"><span data-stu-id="0aee0-232">In the **IntelliTrace** window, click **Break All**.</span></span>

<span data-ttu-id="0aee0-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="0aee0-234">El **IntelliTrace** ventana muestra una lista de eventos recientes:</span><span class="sxs-lookup"><span data-stu-id="0aee0-234">The **IntelliTrace** window displays a list of recent events:</span></span>

<span data-ttu-id="0aee0-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="0aee0-236">Haga clic en el **ADO.NET** línea.</span><span class="sxs-lookup"><span data-stu-id="0aee0-236">Click the **ADO.NET** line.</span></span> <span data-ttu-id="0aee0-237">Se expande para mostrar el texto del comando:</span><span class="sxs-lookup"><span data-stu-id="0aee0-237">It expands to show you the command text:</span></span>

<span data-ttu-id="0aee0-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="0aee0-239">Puede copiar la cadena de texto de comando completo en el Portapapeles desde el **locales** ventana.</span><span class="sxs-lookup"><span data-stu-id="0aee0-239">You can copy the entire command text string to the clipboard from the **Locals** window.</span></span>

<span data-ttu-id="0aee0-240">Imagine que estaba trabajando con una base de datos con más tablas, relaciones y columnas que la simple `School` base de datos.</span><span class="sxs-lookup"><span data-stu-id="0aee0-240">Suppose you were working with a database with more tables, relationships, and columns than the simple `School` database.</span></span> <span data-ttu-id="0aee0-241">Es posible que una consulta que reúne toda la información necesite en un único equipo `Select` una instrucción que contiene varios `Join` cláusulas se vuelve demasiado complejo para que funcione de forma eficaz.</span><span class="sxs-lookup"><span data-stu-id="0aee0-241">You might find that a query that gathers all the information you need in a single `Select` statement containing multiple `Join` clauses becomes too complex to work efficiently.</span></span> <span data-ttu-id="0aee0-242">En ese caso puede cambiar de carga a la carga explícita para simplificar la consulta diligente.</span><span class="sxs-lookup"><span data-stu-id="0aee0-242">In that case you can switch from eager loading to explicit loading to simplify the query.</span></span>

<span data-ttu-id="0aee0-243">Por ejemplo, pruebe a cambiar el código en el `GetDepartmentsByName` método *SchoolRepository.cs*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-243">For example, try changing the code in the `GetDepartmentsByName` method in *SchoolRepository.cs*.</span></span> <span data-ttu-id="0aee0-244">Actualmente en que método tiene una consulta de objeto que tiene `Include` métodos para la `Person` y `Courses` propiedades de navegación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-244">Currently in that method you have an object query that has `Include` methods for the `Person` and `Courses` navigation properties.</span></span> <span data-ttu-id="0aee0-245">Reemplace el `return` instrucción con el código que realiza la carga explícita, como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0aee0-245">Replace the `return` statement with code that performs explicit loading, as shown in the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="0aee0-246">Ejecute el *Departments.aspx* página en el depurador y comprobar la **IntelliTrace** ventana nuevo como se hacía anteriormente.</span><span class="sxs-lookup"><span data-stu-id="0aee0-246">Run the *Departments.aspx* page in the debugger and check the **IntelliTrace** window again as you did before.</span></span> <span data-ttu-id="0aee0-247">Ahora, donde había una sola consulta antes, verá una secuencia larga de ellos.</span><span class="sxs-lookup"><span data-stu-id="0aee0-247">Now, where there was a single query before, you see a long sequence of them.</span></span>

<span data-ttu-id="0aee0-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="0aee0-249">Haga clic en la primera **ADO.NET** línea para ver lo que ha sucedido en la consulta compleja ve versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="0aee0-249">Click the first **ADO.NET** line to see what has happened to the complex query you viewed earlier.</span></span>

<span data-ttu-id="0aee0-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

<span data-ttu-id="0aee0-251">La consulta de departamentos se ha convertido en un sencillo `Select` de consulta y no tienen ninguna `Join` cláusula, pero va seguido de separar las consultas que recuperan cursos relacionados y un administrador, mediante un conjunto de dos consultas para cada departamento devuelto por la versión original consulta.</span><span class="sxs-lookup"><span data-stu-id="0aee0-251">The query from Departments has become a simple `Select` query with no `Join` clause, but it's followed by separate queries that retrieve related courses and an administrator, using a set of two queries for each department returned by the original query.</span></span>

> [!NOTE]
> <span data-ttu-id="0aee0-252">Si deja diferida carga habilitada, el patrón que ve aquí, con la misma consulta repetirse muchas veces, podría deberse a carga diferida.</span><span class="sxs-lookup"><span data-stu-id="0aee0-252">If you leave lazy loading enabled, the pattern you see here, with the same query repeated many times, might result from lazy loading.</span></span> <span data-ttu-id="0aee0-253">Un patrón que probablemente le interese evitar es carga diferida datos relacionados para cada fila de la tabla principal.</span><span class="sxs-lookup"><span data-stu-id="0aee0-253">A pattern that you typically want to avoid is lazy-loading related data for every row of the primary table.</span></span> <span data-ttu-id="0aee0-254">A menos que haya comprobado que una consulta de combinación única es demasiado compleja para ser eficaz, normalmente podrá mejorar el rendimiento en casos como este, cambie la consulta principal para utilizar carga diligente.</span><span class="sxs-lookup"><span data-stu-id="0aee0-254">Unless you've verified that a single join query is too complex to be efficient, you'd typically be able to improve performance in such cases by changing the primary query to use eager loading.</span></span>


## <a name="pre-generating-views"></a><span data-ttu-id="0aee0-255">La generación de vistas previas</span><span class="sxs-lookup"><span data-stu-id="0aee0-255">Pre-Generating Views</span></span>

<span data-ttu-id="0aee0-256">Cuando un `ObjectContext` primero se crea el objeto en un nuevo dominio de aplicación, Entity Framework genera un conjunto de clases que utiliza para tener acceso a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="0aee0-256">When an `ObjectContext` object is first created in a new application domain, the Entity Framework generates a set of classes that it uses to access the database.</span></span> <span data-ttu-id="0aee0-257">Estas clases se denominan *vistas*, y si tiene un modelo de datos muy grandes, generar estas vistas puede retrasar la respuesta del sitio web a la primera solicitud para una página después de que se inicializa un nuevo dominio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-257">These classes are called *views*, and if you have a very large data model, generating these views can delay the web site's response to the first request for a page after a new application domain is initialized.</span></span> <span data-ttu-id="0aee0-258">Puede reducir este retraso de la primera solicitud mediante la creación de las vistas en tiempo de compilación en lugar de en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="0aee0-258">You can reduce this first-request delay by creating the views at compile time rather than at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="0aee0-259">Si la aplicación no tiene un modelo de datos extremadamente grandes, o si tiene un modelo de datos de gran tamaño pero no le preocupa un problema de rendimiento que afecta a solo la primera solicitud de página después de que IIS se recicla, puede omitir esta sección.</span><span class="sxs-lookup"><span data-stu-id="0aee0-259">If your application doesn't have an extremely large data model, or if it does have a large data model but you aren't concerned about a performance problem that affects only the very first page request after IIS is recycled, you can skip this section.</span></span> <span data-ttu-id="0aee0-260">Vista de creación no se presenta cada vez que cree instancias de un `ObjectContext` de objeto, dado que las vistas se almacenan en caché en el dominio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="0aee0-260">View creation doesn't happen every time you instantiate an `ObjectContext` object, because the views are cached in the application domain.</span></span> <span data-ttu-id="0aee0-261">Por lo tanto, a menos que se está con frecuencia, el reciclaje de la aplicación en IIS muy pocas solicitudes de página se beneficiarían de vistas generadas previamente.</span><span class="sxs-lookup"><span data-stu-id="0aee0-261">Therefore, unless you're frequently recycling your application in IIS, very few page requests would benefit from pre-generated views.</span></span>


<span data-ttu-id="0aee0-262">Se pueden generar previamente las vistas mediante el *EdmGen.exe* herramienta de línea de comandos o mediante un *Kit de herramientas de transformación de plantillas de texto* plantilla (T4).</span><span class="sxs-lookup"><span data-stu-id="0aee0-262">You can pre-generate views using the *EdmGen.exe* command-line tool or by using a *Text Template Transformation Toolkit* (T4) template.</span></span> <span data-ttu-id="0aee0-263">En este tutorial usará una plantilla T4.</span><span class="sxs-lookup"><span data-stu-id="0aee0-263">In this tutorial you'll use a T4 template.</span></span>

<span data-ttu-id="0aee0-264">En el *DAL* carpeta, agregue un archivo mediante la **plantilla de texto** plantilla (está bajo la **General** nodo en el **plantillas instaladas** lista), y asígnele el nombre *SchoolModel.Views.tt*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-264">In the *DAL* folder, add a file using the **Text Template** template (it's under the **General** node in the **Installed Templates** list), and name it *SchoolModel.Views.tt*.</span></span> <span data-ttu-id="0aee0-265">Reemplace el código existente en el archivo con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="0aee0-265">Replace the existing code in the file with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

<span data-ttu-id="0aee0-266">Este código genera vistas para una *.edmx* archivo que se encuentra en la misma carpeta que la plantilla y que tiene el mismo nombre que el archivo de plantilla.</span><span class="sxs-lookup"><span data-stu-id="0aee0-266">This code generates views for an *.edmx* file that's located in the same folder as the template and that has the same name as the template file.</span></span> <span data-ttu-id="0aee0-267">Por ejemplo, si su archivo de plantilla se denomina *SchoolModel.Views.tt*, buscará un archivo de modelo de datos denominado *SchoolModel.edmx*.</span><span class="sxs-lookup"><span data-stu-id="0aee0-267">For example, if your template file is named *SchoolModel.Views.tt*, it will look for a data model file named *SchoolModel.edmx*.</span></span>

<span data-ttu-id="0aee0-268">Guarde el archivo, a continuación, haga clic en el archivo en **el Explorador de soluciones** y seleccione **ejecutar herramienta personalizada**.</span><span class="sxs-lookup"><span data-stu-id="0aee0-268">Save the file, then right-click the file in **Solution Explorer** and select **Run Custom Tool**.</span></span>

<span data-ttu-id="0aee0-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="0aee0-270">Visual Studio genera un archivo de código que crea las vistas, que se denomina *SchoolModel.Views.cs* basado en la plantilla.</span><span class="sxs-lookup"><span data-stu-id="0aee0-270">Visual Studio generates a code file that creates the views, which is named *SchoolModel.Views.cs* based on the template.</span></span> <span data-ttu-id="0aee0-271">(Es posible que haya observado que el archivo de código se genera antes de seleccionar **ejecutar herramienta personalizada**, tan pronto como se guarda el archivo de plantilla.)</span><span class="sxs-lookup"><span data-stu-id="0aee0-271">(You might have noticed that the code file is generated even before you select **Run Custom Tool**, as soon as you save the template file.)</span></span>

<span data-ttu-id="0aee0-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="0aee0-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="0aee0-273">Ahora puede ejecutar la aplicación y comprobar que funciona igual que antes.</span><span class="sxs-lookup"><span data-stu-id="0aee0-273">You can now run the application and verify that it works as it did before.</span></span>

<span data-ttu-id="0aee0-274">Para obtener más información acerca de las vistas generadas previamente, vea los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="0aee0-274">For more information about pre-generated views, see the following resources:</span></span>

- <span data-ttu-id="0aee0-275">[Cómo: generar previamente las vistas para mejorar el rendimiento de las consultas](https://msdn.microsoft.com/en-us/library/bb896240.aspx) en el sitio web MSDN.</span><span class="sxs-lookup"><span data-stu-id="0aee0-275">[How to: Pre-Generate Views to Improve Query Performance](https://msdn.microsoft.com/en-us/library/bb896240.aspx) on the MSDN web site.</span></span> <span data-ttu-id="0aee0-276">Explica cómo utilizar el `EdmGen.exe` herramienta de línea de comandos para generar previamente las vistas.</span><span class="sxs-lookup"><span data-stu-id="0aee0-276">Explains how to use the `EdmGen.exe` command-line tool to pre-generate views.</span></span>
- <span data-ttu-id="0aee0-277">[Aislar el rendimiento con precompilado/previa-generated vistas en Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) en el blog del equipo de asesoramiento de cliente de Windows Server AppFabric.</span><span class="sxs-lookup"><span data-stu-id="0aee0-277">[Isolating Performance with Precompiled/Pre-generated Views in the Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) on the Windows Server AppFabric Customer Advisory Team blog.</span></span>

<span data-ttu-id="0aee0-278">Con esto finaliza la introducción a mejorar el rendimiento en una aplicación web ASP.NET que utiliza Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="0aee0-278">This completes the introduction to improving performance in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="0aee0-279">Para obtener más información, vea los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="0aee0-279">For more information, see the following resources:</span></span>

- <span data-ttu-id="0aee0-280">[Consideraciones de rendimiento (Entity Framework)](https://msdn.microsoft.com/en-us/library/cc853327.aspx) en el sitio web MSDN.</span><span class="sxs-lookup"><span data-stu-id="0aee0-280">[Performance Considerations (Entity Framework)](https://msdn.microsoft.com/en-us/library/cc853327.aspx) on the MSDN web site.</span></span>
- <span data-ttu-id="0aee0-281">[Entradas relacionadas con el rendimiento en el blog del equipo de Entity Framework](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span><span class="sxs-lookup"><span data-stu-id="0aee0-281">[Performance-related posts on the Entity Framework Team blog](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span></span>
- <span data-ttu-id="0aee0-282">[EF opciones de combinación y consultas compiladas](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span><span class="sxs-lookup"><span data-stu-id="0aee0-282">[EF Merge Options and Compiled Queries](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span></span> <span data-ttu-id="0aee0-283">Entrada de blog que explica comportamientos inesperados de consultas compiladas y mezcla opciones tales como `NoTracking`.</span><span class="sxs-lookup"><span data-stu-id="0aee0-283">Blog post that explains unexpected behaviors of compiled queries and merge options such as `NoTracking`.</span></span> <span data-ttu-id="0aee0-284">Si planea usar consultas compiladas o manipular la configuración de la opción de combinación en la aplicación, lea esto primero.</span><span class="sxs-lookup"><span data-stu-id="0aee0-284">If you plan to use compiled queries or manipulate merge option settings in your application, read this first.</span></span>
- <span data-ttu-id="0aee0-285">[Entidad relacionada con el marco de trabajo se registra en el blog del equipo de asesoramiento al cliente de modelado y datos](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span><span class="sxs-lookup"><span data-stu-id="0aee0-285">[Entity Framework-related posts in the Data and Modeling Customer Advisory Team blog](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span></span> <span data-ttu-id="0aee0-286">Incluye entradas sobre las consultas compiladas y utilizar el generador de perfiles de Visual Studio 2010 para detectar problemas de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0aee0-286">Includes posts on compiled queries and using the Visual Studio 2010 Profiler to discover performance issues.</span></span>
- <span data-ttu-id="0aee0-287">[Subproceso del foro de Entity Framework con consejos sobre cómo mejorar el rendimiento de las consultas muy complejas](https://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span><span class="sxs-lookup"><span data-stu-id="0aee0-287">[Entity Framework forum thread with advice on improving performance of highly complex queries](https://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span></span>
- <span data-ttu-id="0aee0-288">[Recomendaciones de administración de estado de ASP.NET](https://msdn.microsoft.com/en-us/library/z1hkazw7.aspx).</span><span class="sxs-lookup"><span data-stu-id="0aee0-288">[ASP.NET State Management Recommendations](https://msdn.microsoft.com/en-us/library/z1hkazw7.aspx).</span></span>
- <span data-ttu-id="0aee0-289">[Con Entity Framework y ObjectDataSource: paginación personalizada](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span><span class="sxs-lookup"><span data-stu-id="0aee0-289">[Using the Entity Framework and the ObjectDataSource: Custom Paging](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span></span> <span data-ttu-id="0aee0-290">Entrada de blog que se basa en la aplicación de ContosoUniversity creada en estos tutoriales para explicar cómo implementar la paginación en el *Departments.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="0aee0-290">Blog post that builds on the ContosoUniversity application created in these tutorials to explain how to implement paging in the *Departments.aspx* page.</span></span>

<span data-ttu-id="0aee0-291">El siguiente tutorial revisa algunas de las mejoras importantes a Entity Framework que son nuevas en la versión 4.</span><span class="sxs-lookup"><span data-stu-id="0aee0-291">The next tutorial reviews some of the important enhancements to the Entity Framework that are new in version 4.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="0aee0-292">[Anterior](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
[Siguiente](what-s-new-in-the-entity-framework-4.md)</span><span class="sxs-lookup"><span data-stu-id="0aee0-292">[Previous](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
[Next](what-s-new-in-the-entity-framework-4.md)</span></span>
