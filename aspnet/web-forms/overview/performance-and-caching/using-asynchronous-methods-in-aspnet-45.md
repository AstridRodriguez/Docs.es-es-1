---
uid: web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
title: Usar métodos asíncronos en ASP.NET 4.5 | Documentos de Microsoft
author: Rick-Anderson
description: Este tutorial le enseñará los aspectos básicos de la creación de una aplicación de formularios Web Forms de ASP.NET asincrónica mediante Visual Studio Express 2012 para Web, que es una descarga...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/06/2012
ms.topic: article
ms.assetid: a585c9a2-7c8e-478b-9706-90f3739c50d1
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
msc.type: authoredcontent
ms.openlocfilehash: 839cfc39188a91b6674465b8ff8fe51804033295
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/06/2018
---
<a name="using-asynchronous-methods-in-aspnet-45"></a><span data-ttu-id="275a6-103">Usar métodos asíncronos en ASP.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="275a6-103">Using Asynchronous Methods in ASP.NET 4.5</span></span>
====================
<span data-ttu-id="275a6-104">por [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="275a6-104">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="275a6-105">Este tutorial le enseñará los aspectos básicos de la creación de una aplicación de formularios Web Forms de ASP.NET asincrónica utilizando [Visual Studio Express 2012 para Web](https://www.microsoft.com/visualstudio/11), que es una versión gratuita de Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="275a6-105">This tutorial will teach you the basics of building an asynchronous ASP.NET Web Forms application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="275a6-106">También puede usar [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="275a6-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span> <span data-ttu-id="275a6-107">En este tutorial se incluyen las siguientes secciones.</span><span class="sxs-lookup"><span data-stu-id="275a6-107">The following sections are included in this tutorial.</span></span>
> 
> - [<span data-ttu-id="275a6-108">Cómo se procesan las solicitudes por el grupo de subprocesos</span><span class="sxs-lookup"><span data-stu-id="275a6-108">How Requests Are Processed by the Thread Pool</span></span>](#HowRequestsProcessedByTP)
> - [<span data-ttu-id="275a6-109">Elegir los métodos sincrónicos o asincrónicos</span><span class="sxs-lookup"><span data-stu-id="275a6-109">Choosing Synchronous or Asynchronous Methods</span></span>](#ChoosingSyncVasync)
> - [<span data-ttu-id="275a6-110">La aplicación de ejemplo</span><span class="sxs-lookup"><span data-stu-id="275a6-110">The Sample Application</span></span>](#SampleApp)
> - [<span data-ttu-id="275a6-111">La página sincrónica chismes</span><span class="sxs-lookup"><span data-stu-id="275a6-111">The Gizmos Synchronous Page</span></span>](#GizmosSynch)
> - [<span data-ttu-id="275a6-112">Crear una página chismes asincrónica</span><span class="sxs-lookup"><span data-stu-id="275a6-112">Creating an Asynchronous Gizmos Page</span></span>](#CreatingAsynchGizmos)
> - [<span data-ttu-id="275a6-113">Realizar varias operaciones en paralelo</span><span class="sxs-lookup"><span data-stu-id="275a6-113">Performing Multiple Operations in Parallel</span></span>](#Parallel)
> - [<span data-ttu-id="275a6-114">Usar un Token de cancelación</span><span class="sxs-lookup"><span data-stu-id="275a6-114">Using a Cancellation Token</span></span>](#CancelToken)
> - [<span data-ttu-id="275a6-115">Configuración del servidor para llamadas a servicios Web alta simultaneidad/alta latencia</span><span class="sxs-lookup"><span data-stu-id="275a6-115">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>](#ServerConfig)
> 
> <span data-ttu-id="275a6-116">Se proporciona un ejemplo completo para este tutorial en</span><span class="sxs-lookup"><span data-stu-id="275a6-116">A complete sample is provided for this tutorial at</span></span>  
>  <span data-ttu-id="275a6-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) en el [GitHub](https://github.com/) sitio.</span><span class="sxs-lookup"><span data-stu-id="275a6-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) on the [GitHub](https://github.com/) site.</span></span>


<span data-ttu-id="275a6-118">Páginas Web ASP.NET 4.5 en combinación [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) permite registrar los métodos asincrónicos que devuelven un objeto del tipo [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="275a6-118">ASP.NET 4.5 Web Pages in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to register asynchronous methods that return an object of type [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="275a6-119">.NET Framework 4 se introdujo un concepto de programación asincrónico conocido como un [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) y ASP.NET 4.5 admite [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="275a6-119">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET 4.5 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="275a6-120">Las tareas se representan por el **tarea** tipo y los tipos relacionados en el [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="275a6-120">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="275a6-121">.NET Framework 4.5 se basa en esta compatibilidad asincrónica con el [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) palabras clave que facilitan el trabajo con [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objetos mucho menos complejos que anterior métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="275a6-121">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="275a6-122">El [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) palabra clave es una abreviatura sintáctica para indicar que debe esperar un fragmento de código de forma asincrónica en alguna otra parte del código.</span><span class="sxs-lookup"><span data-stu-id="275a6-122">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="275a6-123">El [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) palabra clave representa una sugerencia que puede usar para marcar los métodos como métodos asincrónicos basado en tareas.</span><span class="sxs-lookup"><span data-stu-id="275a6-123">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="275a6-124">La combinación de **await**, **async**y el **tarea** objeto, resulta más fácil de escribir código asincrónico en .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="275a6-124">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="275a6-125">El nuevo modelo para los métodos asincrónicos se denomina la *modelo asincrónico basado en tareas* (**pulse**).</span><span class="sxs-lookup"><span data-stu-id="275a6-125">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="275a6-126">Este tutorial se supone que dispone de cierta familiaridad con el uso de programación asincrónica [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) palabras clave y el [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="275a6-126">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="275a6-127">Para obtener más información sobre el uso de la [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) palabras clave y el [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espacio de nombres, vea las siguientes referencias.</span><span class="sxs-lookup"><span data-stu-id="275a6-127">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="275a6-128">Notas del producto: Asincronía en .NET</span><span class="sxs-lookup"><span data-stu-id="275a6-128">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="275a6-129">Preguntas más frecuentes de Async y Await</span><span class="sxs-lookup"><span data-stu-id="275a6-129">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="275a6-130">Programación asincrónica de Visual Studio</span><span class="sxs-lookup"><span data-stu-id="275a6-130">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a>  <span data-ttu-id="275a6-131">Cómo se procesan las solicitudes por el grupo de subprocesos</span><span class="sxs-lookup"><span data-stu-id="275a6-131">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="275a6-132">En el servidor web, .NET Framework mantiene un grupo de subprocesos que se usan para atender las solicitudes ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="275a6-132">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="275a6-133">Cuando llega una solicitud, se envía un subproceso del grupo para procesar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="275a6-133">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="275a6-134">Si la solicitud se procesa de forma sincrónica, el subproceso que procesa la solicitud está ocupado mientras la solicitud se está procesando y que el subproceso no puede atender otra solicitud.</span><span class="sxs-lookup"><span data-stu-id="275a6-134">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="275a6-135">Esto podría no ser un problema, porque el grupo de subprocesos se puede establecer lo suficientemente grande como para dar cabida a muchos subprocesos ocupados.</span><span class="sxs-lookup"><span data-stu-id="275a6-135">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="275a6-136">Sin embargo, se limita el número de subprocesos en el grupo de subprocesos (el valor máximo de .NET 4.5 predeterminado es 5000).</span><span class="sxs-lookup"><span data-stu-id="275a6-136">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="275a6-137">En las aplicaciones grandes con gran simultaneidad de las solicitudes de ejecución prolongada, todos los subprocesos disponibles pueden estar ocupados.</span><span class="sxs-lookup"><span data-stu-id="275a6-137">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="275a6-138">Esta condición se conoce como la falta de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="275a6-138">This condition is known as thread starvation.</span></span> <span data-ttu-id="275a6-139">Cuando se alcanza esta condición, el servidor web pone en cola las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="275a6-139">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="275a6-140">Si la cola de solicitudes se llena, el servidor web rechaza las solicitudes con estado HTTP 503 (Server Too Busy).</span><span class="sxs-lookup"><span data-stu-id="275a6-140">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="275a6-141">El grupo de subprocesos CLR tiene limitaciones en inyecciones de nuevo subproceso.</span><span class="sxs-lookup"><span data-stu-id="275a6-141">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="275a6-142">Si la simultaneidad es por ráfagas (es decir, el sitio web repentinamente puede obtener un gran número de solicitudes) y todos los subprocesos de solicitud disponibles están ocupados debido a llamadas de back-end con latencia alta, la velocidad de inserción limitado de subprocesos puede hacer que la aplicación responda muy bajo.</span><span class="sxs-lookup"><span data-stu-id="275a6-142">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="275a6-143">Además, cada subproceso nuevo que se agrega al grupo de subprocesos tiene sobrecarga (por ejemplo, 1 MB de memoria de la pila).</span><span class="sxs-lookup"><span data-stu-id="275a6-143">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="275a6-144">Una aplicación web con métodos sincrónicos para llamadas de latencia alta del servicio en el grupo de subprocesos aumenta con el valor predeterminado de .NET 4.5 admite un máximo de 5 000 subprocesos consumiría aproximadamente 5 GB más memoria que una aplicación pueda el servicio el mismo solicita utilizando métodos asincrónicos y solo 50 subprocesos.</span><span class="sxs-lookup"><span data-stu-id="275a6-144">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="275a6-145">Al realizar el trabajo asincrónico, no siempre está usando un subproceso.</span><span class="sxs-lookup"><span data-stu-id="275a6-145">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="275a6-146">Por ejemplo, al realizar una solicitud de servicio web asincrónico, ASP.NET no esté usando todos los subprocesos entre el **async** llamada al método y el **await**.</span><span class="sxs-lookup"><span data-stu-id="275a6-146">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="275a6-147">Usar el grupo de subprocesos para atender las solicitudes con una latencia elevada puede provocar un consumo de grandes cantidades de memoria y una mala utilización del hardware del servidor.</span><span class="sxs-lookup"><span data-stu-id="275a6-147">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="275a6-148">Procesar solicitudes asincrónicas</span><span class="sxs-lookup"><span data-stu-id="275a6-148">Processing Asynchronous Requests</span></span>

<span data-ttu-id="275a6-149">En las aplicaciones web que aparece un gran número de solicitudes simultáneas en el inicio o que tenga una carga por ráfagas (donde simultaneidad aumenta repentinamente), que realiza llamadas al servicio web asincrónica, aumentará la capacidad de respuesta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="275a6-149">In web applications that see a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous will increase the responsiveness of your application.</span></span> <span data-ttu-id="275a6-150">Una solicitud asincrónica tarda la misma cantidad de tiempo en procesarse que una solicitud sincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-150">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="275a6-151">Por ejemplo, si una solicitud realiza un servicio web llamada requiere dos segundos en completarse, la solicitud tardará dos segundos si se realiza de forma sincrónica o asincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-151">For example, if a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it is performed synchronously or asynchronously.</span></span> <span data-ttu-id="275a6-152">Sin embargo, durante una llamada asincrónica, no se bloquea un subproceso de responder a otras solicitudes mientras espera a que la primera solicitud que se complete.</span><span class="sxs-lookup"><span data-stu-id="275a6-152">However, during an asynchronous call, a thread is not blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="275a6-153">Por lo tanto, solicitudes asincrónicas evita el crecimiento del grupo de puesta en cola y el subproceso de solicitud cuando hay muchas solicitudes simultáneas que invocan operaciones de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="275a6-153">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a>  <span data-ttu-id="275a6-154">Elegir los métodos sincrónicos o asincrónicos</span><span class="sxs-lookup"><span data-stu-id="275a6-154">Choosing Synchronous or Asynchronous Methods</span></span>

<span data-ttu-id="275a6-155">En esta sección se muestra las directrices acerca de cuándo utilizar métodos sincrónicos o asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="275a6-155">This section lists guidelines for when to use synchronous or asynchronous Methods.</span></span> <span data-ttu-id="275a6-156">Se trata de meras directrices; Examinar individualmente cada aplicación para determinar si los métodos asincrónicos incrementar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="275a6-156">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="275a6-157">En general, utilice los métodos sincrónicos para las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="275a6-157">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="275a6-158">Las operaciones son simples o de ejecución breve.</span><span class="sxs-lookup"><span data-stu-id="275a6-158">The operations are simple or short-running.</span></span>
- <span data-ttu-id="275a6-159">La simplicidad es más importante que la eficacia.</span><span class="sxs-lookup"><span data-stu-id="275a6-159">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="275a6-160">Las operaciones son principalmente operaciones de la CPU en lugar de las operaciones que implican una amplia disco o una sobrecarga de la red.</span><span class="sxs-lookup"><span data-stu-id="275a6-160">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="275a6-161">Usar métodos asincrónicos en operaciones relacionadas con la CPU no proporciona ninguna ventaja y da lugar a mayor sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="275a6-161">Using asynchronous methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

  <span data-ttu-id="275a6-162">En general, utilice métodos asincrónicos en las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="275a6-162">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="275a6-163">Se están llamando a los servicios que se pueden utilizar en métodos asincrónicos, y usa .NET 4.5 o posterior.</span><span class="sxs-lookup"><span data-stu-id="275a6-163">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="275a6-164">Las operaciones están relacionadas con la red o enlazadas a E/s en lugar de límite de CPU.</span><span class="sxs-lookup"><span data-stu-id="275a6-164">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="275a6-165">El paralelismo es más importante que la simplicidad de código.</span><span class="sxs-lookup"><span data-stu-id="275a6-165">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="275a6-166">Desea proporcionar un mecanismo que permite a los usuarios cancelar una solicitud de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="275a6-166">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="275a6-167">Cuando la ventaja de cambiar subprocesos out compensa el costo de cambio de contexto.</span><span class="sxs-lookup"><span data-stu-id="275a6-167">When the benefit of switching threads out weights the cost of the context switch.</span></span> <span data-ttu-id="275a6-168">En general, debe crear un método asincrónico si el método sincrónico bloquea el subproceso de solicitud ASP.NET mientras no realiza ningún trabajo.</span><span class="sxs-lookup"><span data-stu-id="275a6-168">In general, you should make a method asynchronous if the synchronous method blocks the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="275a6-169">Al realizar la llamada asincrónica, el subproceso de solicitud ASP.NET no se impide que no se realiza ningún trabajo mientras se espera para que la solicitud de servicio web que se complete.</span><span class="sxs-lookup"><span data-stu-id="275a6-169">By making the call asynchronous, the ASP.NET request thread is not blocked doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="275a6-170">Las pruebas muestran que las operaciones bloqueo son un cuello de botella en el rendimiento del sitio y que IIS puede prestar servicio a más solicitudes mediante el uso de métodos asincrónicos para estas llamadas que causan bloqueos.</span><span class="sxs-lookup"><span data-stu-id="275a6-170">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

  <span data-ttu-id="275a6-171">El ejemplo descargable muestra cómo utilizar métodos asincrónicos de forma eficaz.</span><span class="sxs-lookup"><span data-stu-id="275a6-171">The downloadable sample shows how to use asynchronous methods effectively.</span></span> <span data-ttu-id="275a6-172">El ejemplo proporcionado se diseñó para proporcionar una sencilla demostración de la programación asincrónica en ASP.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="275a6-172">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET 4.5.</span></span> <span data-ttu-id="275a6-173">El ejemplo no pretende ser una arquitectura de referencia para la programación asincrónica en ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="275a6-173">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET.</span></span> <span data-ttu-id="275a6-174">El programa de ejemplo llama [ASP.NET Web API](../../../web-api/index.md) métodos que a su vez llaman a [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) para simular llamadas al servicio web de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="275a6-174">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="275a6-175">La mayoría de las aplicaciones de producción no mostrará ventajas tan evidentes al usar métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="275a6-175">Most production applications will not show such obvious benefits to using asynchronous Methods.</span></span>   
  
<span data-ttu-id="275a6-176">Pocas aplicaciones exigen que todos los métodos sea asincrónico.</span><span class="sxs-lookup"><span data-stu-id="275a6-176">Few applications require all methods to be asynchronous.</span></span> <span data-ttu-id="275a6-177">A menudo, proporciona la máxima eficacia para la cantidad de trabajo necesario convertir algunos métodos sincrónicos en métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="275a6-177">Often, converting a few synchronous methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a>  <span data-ttu-id="275a6-178">La aplicación de ejemplo</span><span class="sxs-lookup"><span data-stu-id="275a6-178">The Sample Application</span></span>

<span data-ttu-id="275a6-179">Puede descargar la aplicación de ejemplo de [ https://github.com/RickAndMSFT/Async-ASP.NET ](https://github.com/RickAndMSFT/Async-ASP.NET) en el [GitHub](https://github.com/) sitio.</span><span class="sxs-lookup"><span data-stu-id="275a6-179">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="275a6-180">El repositorio consta de tres proyectos:</span><span class="sxs-lookup"><span data-stu-id="275a6-180">The repository consists of three projects:</span></span>

- <span data-ttu-id="275a6-181">*WebAppAsync*: proyecto de ASP.NET Web Forms el que utiliza la API Web **WebAPIpwg** servicio.</span><span class="sxs-lookup"><span data-stu-id="275a6-181">*WebAppAsync*: The ASP.NET Web Forms project that consumes the Web API **WebAPIpwg** service.</span></span> <span data-ttu-id="275a6-182">La mayoría del código de este tutorial es desde este proyecto.</span><span class="sxs-lookup"><span data-stu-id="275a6-182">Most of the code for this tutorial is from the this project.</span></span>
- <span data-ttu-id="275a6-183">*WebAPIpgw*: proyecto de la API Web de ASP.NET MVC 4 que implementa el `Products, Gizmos and Widgets` controladores.</span><span class="sxs-lookup"><span data-stu-id="275a6-183">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="275a6-184">Proporciona los datos para la *WebAppAsync* proyecto y la *Mvc4Async* proyecto.</span><span class="sxs-lookup"><span data-stu-id="275a6-184">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="275a6-185">*Mvc4Async*: ASP.NET MVC 4 el proyecto que contiene el código utilizado en otro tutorial.</span><span class="sxs-lookup"><span data-stu-id="275a6-185">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in another tutorial.</span></span> <span data-ttu-id="275a6-186">Realiza llamadas de API Web a la **WebAPIpwg** servicio.</span><span class="sxs-lookup"><span data-stu-id="275a6-186">It makes Web API calls to the **WebAPIpwg** service.</span></span>

## <a id="GizmosSynch"></a>  <span data-ttu-id="275a6-187">La página sincrónica chismes</span><span class="sxs-lookup"><span data-stu-id="275a6-187">The Gizmos Synchronous Page</span></span>

 <span data-ttu-id="275a6-188">El código siguiente muestra el `Page_Load` método sincrónico que se utiliza para mostrar una lista de gizmos.</span><span class="sxs-lookup"><span data-stu-id="275a6-188">The following code shows the `Page_Load` synchronous method that is used to display a list of gizmos.</span></span> <span data-ttu-id="275a6-189">(En este artículo, un artículo tiene un es un dispositivo mecánico ficticio).</span><span class="sxs-lookup"><span data-stu-id="275a6-189">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample1.cs)]

<span data-ttu-id="275a6-190">El código siguiente muestra el `GetGizmos` método del artículo tiene un servicio.</span><span class="sxs-lookup"><span data-stu-id="275a6-190">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample2.cs)]

<span data-ttu-id="275a6-191">El `GizmoService GetGizmos` método pasa un URI a un servicio ASP.NET Web API HTTP que devuelve una lista de datos de gizmos.</span><span class="sxs-lookup"><span data-stu-id="275a6-191">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="275a6-192">El *WebAPIpgw* proyecto contiene la implementación de la API Web `gizmos, widget` y `product` controladores.</span><span class="sxs-lookup"><span data-stu-id="275a6-192">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="275a6-193">La siguiente imagen muestra la página chismes desde el proyecto de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="275a6-193">The following image shows the gizmos page from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-45/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a>  <span data-ttu-id="275a6-195">Crear una página chismes asincrónica</span><span class="sxs-lookup"><span data-stu-id="275a6-195">Creating an Asynchronous Gizmos Page</span></span>

<span data-ttu-id="275a6-196">El ejemplo usa el nuevo [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) y [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) palabras clave (disponible en .NET 4.5 y Visual Studio 2012) para permitir que el compilador ser responsable de mantener los necesarios para las transformaciones complejas programación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-196">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="275a6-197">El compilador le permite escribir código mediante que construcciones de flujo de control sincrónico de la de C# y el compilador aplica automáticamente las transformaciones necesarias para usar devoluciones de llamada con el fin de evitar el bloqueo de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="275a6-197">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="275a6-198">Páginas asincrónicas de ASP.NET deben incluir el [página](https://msdn.microsoft.com/library/ydy4x04a.aspx) directiva con la `Async` atributo establecido en "true".</span><span class="sxs-lookup"><span data-stu-id="275a6-198">ASP.NET asynchronous pages must include the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true".</span></span> <span data-ttu-id="275a6-199">El código siguiente muestra el [página](https://msdn.microsoft.com/library/ydy4x04a.aspx) directiva con la `Async` atributo establecido en "true" para el *GizmosAsync.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="275a6-199">The following code shows the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true" for the *GizmosAsync.aspx* page.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample3.aspx?highlight=1)]

<span data-ttu-id="275a6-200">El código siguiente muestra el `Gizmos` sincrónico `Page_Load` método y la `GizmosAsync` página asincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-200">The following code shows the `Gizmos` synchronous `Page_Load` method and the `GizmosAsync` asynchronous page.</span></span> <span data-ttu-id="275a6-201">Si el explorador admite el [HTML 5 &lt;marcar&gt; elemento](http://www.w3.org/wiki/HTML/Elements/mark), podrá ver los cambios en `GizmosAsync` en amarillo resaltado.</span><span class="sxs-lookup"><span data-stu-id="275a6-201">If your browser supports the [HTML 5 &lt;mark&gt; element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample4.cs)]

<span data-ttu-id="275a6-202">La versión asincrónica:</span><span class="sxs-lookup"><span data-stu-id="275a6-202">The asynchronous version:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample5.cs?highlight=3,6-7,9,11)]

 <span data-ttu-id="275a6-203">Se aplicaron los cambios siguientes para permitir la `GizmosAsync` página sea asincrónico.</span><span class="sxs-lookup"><span data-stu-id="275a6-203">The following changes were applied to allow the `GizmosAsync` page be asynchronous.</span></span>

- <span data-ttu-id="275a6-204">El [página](https://msdn.microsoft.com/library/ydy4x04a.aspx) directiva debe tener la `Async` atributo establecido en "true".</span><span class="sxs-lookup"><span data-stu-id="275a6-204">The [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive must have the `Async` attribute set to "true".</span></span>
- <span data-ttu-id="275a6-205">El `RegisterAsyncTask` método se usa para registrar una tarea asincrónica que contiene el código que se ejecuta de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-205">The `RegisterAsyncTask` method is used to register an asynchronous task containing the code which runs asynchronously.</span></span>
- <span data-ttu-id="275a6-206">El nuevo `GetGizmosSvcAsync` método está marcado con el [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) palabra clave, que indica al compilador para generar las devoluciones de llamada para las partes del cuerpo y para crear automáticamente un `Task` que se devuelve.</span><span class="sxs-lookup"><span data-stu-id="275a6-206">The new `GetGizmosSvcAsync` method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task` that is returned.</span></span>
- <span data-ttu-id="275a6-207">&quot;Async&quot; se anexa al nombre del método asincrónico.</span><span class="sxs-lookup"><span data-stu-id="275a6-207">&quot;Async&quot; was appended to the asynchronous method name.</span></span> <span data-ttu-id="275a6-208">Anexa "Async" no es necesario, pero es la convención al escribir métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="275a6-208">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="275a6-209">El tipo de valor devuelto de la nueva `GetGizmosSvcAsync` método es `Task`.</span><span class="sxs-lookup"><span data-stu-id="275a6-209">The return type of the new `GetGizmosSvcAsync` method is `Task`.</span></span> <span data-ttu-id="275a6-210">El tipo de valor devuelto de `Task` representa el trabajo en curso y proporciona a los llamadores del método con un identificador a través de la que se va a esperar a que finalice la operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-210">The return type of `Task` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span>
- <span data-ttu-id="275a6-211">El [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) palabra clave se aplicó al llamar al servicio web.</span><span class="sxs-lookup"><span data-stu-id="275a6-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="275a6-212">Se llamó a la API del servicio web asincrónica (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="275a6-212">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="275a6-213">Dentro de la `GetGizmosSvcAsync` otro método asincrónico, del cuerpo del método `GetGizmosAsync` se llama.</span><span class="sxs-lookup"><span data-stu-id="275a6-213">Inside of the `GetGizmosSvcAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="275a6-214">`GetGizmosAsync` devuelve inmediatamente un `Task<List<Gizmo>>` que finalmente se completará cuando los datos están disponibles.</span><span class="sxs-lookup"><span data-stu-id="275a6-214">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="275a6-215">Dado que no desea hacer nada más, hasta que tenga los datos de artículo tiene un, el código espera la tarea (mediante el **await** palabra clave).</span><span class="sxs-lookup"><span data-stu-id="275a6-215">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="275a6-216">Puede usar el **await** palabra clave solo en los métodos anotados con el **async** palabra clave.</span><span class="sxs-lookup"><span data-stu-id="275a6-216">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="275a6-217">El **await** palabra clave no bloquea el subproceso hasta que se complete la tarea.</span><span class="sxs-lookup"><span data-stu-id="275a6-217">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="275a6-218">Se suscribe el resto del método como una devolución de llamada en la tarea y devuelve inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="275a6-218">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="275a6-219">Cuando finalmente se completa la tarea en espera, se invoque esa devolución de llamada y, por tanto, reanudar la ejecución de la derecha del método donde se quedó.</span><span class="sxs-lookup"><span data-stu-id="275a6-219">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="275a6-220">Para obtener más información sobre el uso de la [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) palabras clave y el [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espacio de nombres, vea la [async referencias](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="275a6-220">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="275a6-221">El código siguiente muestra el `GetGizmos` y `GetGizmosAsync` métodos.</span><span class="sxs-lookup"><span data-stu-id="275a6-221">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample6.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample7.cs?highlight=1,4-8)]

 <span data-ttu-id="275a6-222">Los cambios asincrónicos son similares a los realizados en el **GizmosAsync** anteriormente.</span><span class="sxs-lookup"><span data-stu-id="275a6-222">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="275a6-223">La firma del método se anota con el [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) palabra clave, el tipo de valor devuelto se cambió a `Task<List<Gizmo>>`, y *Async* se anexa al nombre del método.</span><span class="sxs-lookup"><span data-stu-id="275a6-223">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="275a6-224">Asincrónico [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) clase se utiliza en lugar de sincrónico [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) clase.</span><span class="sxs-lookup"><span data-stu-id="275a6-224">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the synchronous [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="275a6-225">El [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) palabra clave se aplica a la [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) método asincrónico.</span><span class="sxs-lookup"><span data-stu-id="275a6-225">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) asynchronous method.</span></span>

<span data-ttu-id="275a6-226">La siguiente imagen muestra la vista asincrónica artículo tiene un.</span><span class="sxs-lookup"><span data-stu-id="275a6-226">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-45/_static/image2.png)

<span data-ttu-id="275a6-228">La presentación de los exploradores de los datos de chismes es idéntica a la vista creada por la llamada sincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-228">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="275a6-229">La única diferencia es que la versión asincrónica puede tener un mejor rendimiento con cargas elevadas.</span><span class="sxs-lookup"><span data-stu-id="275a6-229">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a name="registerasynctask-notes"></a><span data-ttu-id="275a6-230">Notas de RegisterAsyncTask</span><span class="sxs-lookup"><span data-stu-id="275a6-230">RegisterAsyncTask Notes</span></span>

<span data-ttu-id="275a6-231">Métodos enlazan con `RegisterAsyncTask` se ejecutará inmediatamente después de [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span><span class="sxs-lookup"><span data-stu-id="275a6-231">Methods hooked up with `RegisterAsyncTask` will run immediately after [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span></span> <span data-ttu-id="275a6-232">También puede usar eventos en una página void async directamente, tal como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="275a6-232">You can also use async void page events directly, as shown in the following code:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample8.cs)]

<span data-ttu-id="275a6-233">La desventaja de async void eventos es que los desarrolladores ya no tiene control total sobre cuándo ejecutan eventos.</span><span class="sxs-lookup"><span data-stu-id="275a6-233">The downside to async void events is that developers no longer has full control over when events execute.</span></span> <span data-ttu-id="275a6-234">Por ejemplo, si ambos .aspx y un. Definir master `Page_Load` eventos y uno o ambos son asincrónicas, no se puede garantizar el orden de ejecución.</span><span class="sxs-lookup"><span data-stu-id="275a6-234">For example, if both an .aspx and a .Master define `Page_Load` events and one or both of them are asynchronous, the order of execution can't be guaranteed.</span></span> <span data-ttu-id="275a6-235">El mismo orden de indeterminiate para controladores de eventos no (como `async void Button_Click` ) se aplica.</span><span class="sxs-lookup"><span data-stu-id="275a6-235">The same indeterminiate order for non event handlers (such as `async void Button_Click` ) applies.</span></span> <span data-ttu-id="275a6-236">Para la mayoría de los desarrolladores, esto debería ser aceptable, pero solo aquellos que requieren un control total sobre el orden de ejecución deben usar las API como `RegisterAsyncTask` que usan los métodos que devuelven un objeto de tarea.</span><span class="sxs-lookup"><span data-stu-id="275a6-236">For most developers this should be acceptable, but those who require full control over the order of execution should only use APIs like `RegisterAsyncTask` that consume methods which return a Task object.</span></span>

## <a id="Parallel"></a>  <span data-ttu-id="275a6-237">Realizar varias operaciones en paralelo</span><span class="sxs-lookup"><span data-stu-id="275a6-237">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="275a6-238">Métodos asincrónicos tienen una importante ventaja con respecto a los métodos sincrónicos cuando una acción debe realizar varias operaciones independientes.</span><span class="sxs-lookup"><span data-stu-id="275a6-238">Asynchronous Methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="275a6-239">En el ejemplo proporcionado, la página sincrónica *PWG.aspx*(para productos, Widgets y chismes) muestra los resultados de tres llamadas a servicios web para obtener una lista de productos, widgets y chismes.</span><span class="sxs-lookup"><span data-stu-id="275a6-239">In the sample provided, the synchronous page *PWG.aspx*(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="275a6-240">El [ASP.NET Web API](../../../web-api/index.md) proyecto que proporciona estos servicios utiliza [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) para simular red lenta o latencia de las llamadas.</span><span class="sxs-lookup"><span data-stu-id="275a6-240">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="275a6-241">Cuando se establece el retraso a 500 milisegundos, de forma asincrónica *PWGasync.aspx* página tarda un poco más de 500 milisegundos para completarse mientras sincrónico `PWG` versión asume 1.500 milisegundos.</span><span class="sxs-lookup"><span data-stu-id="275a6-241">When the delay is set to 500 milliseconds, the asynchronous *PWGasync.aspx* page takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="275a6-242">Sincrónico *PWG.aspx* página se muestra en el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="275a6-242">The synchronous *PWG.aspx* page is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample9.cs)]

<span data-ttu-id="275a6-243">Asincrónico `PWGasync` código subyacente se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="275a6-243">The asynchronous `PWGasync` code behind is shown below.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample10.cs?highlight=5,11,21)]

<span data-ttu-id="275a6-244">La siguiente imagen muestra la vista procedente de la asincrónica *PWGasync.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="275a6-244">The following image shows the view returned from the asynchronous *PWGasync.aspx* page.</span></span>

![](using-asynchronous-methods-in-aspnet-45/_static/image3.png)

## <a id="CancelToken"></a>  <span data-ttu-id="275a6-245">Usar un Token de cancelación</span><span class="sxs-lookup"><span data-stu-id="275a6-245">Using a Cancellation Token</span></span>

<span data-ttu-id="275a6-246">Los métodos asincrónicos que devuelven `Task`son cancelable, que es toman un [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parámetro cuando se proporciona uno con el `AsyncTimeout` atributo de la [página](https://msdn.microsoft.com/library/ydy4x04a.aspx) directiva.</span><span class="sxs-lookup"><span data-stu-id="275a6-246">Asynchronous Methods returning `Task`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the `AsyncTimeout` attribute of the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive.</span></span> <span data-ttu-id="275a6-247">El código siguiente muestra el *GizmosCancelAsync.aspx* página con un tiempo de espera de segundo.</span><span class="sxs-lookup"><span data-stu-id="275a6-247">The following code shows the *GizmosCancelAsync.aspx* page with a timeout of on second.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample11.aspx?highlight=1)]

<span data-ttu-id="275a6-248">El código siguiente muestra el *GizmosCancelAsync.aspx.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="275a6-248">The following code shows the *GizmosCancelAsync.aspx.cs* file.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample12.cs?highlight=6,9)]

<span data-ttu-id="275a6-249">En la aplicación de ejemplo proporcionada, seleccionando la *GizmosCancelAsync* vincular llamadas el *GizmosCancelAsync.aspx* página y muestra la cancelación (por el tiempo de espera) de la llamada asincrónica.</span><span class="sxs-lookup"><span data-stu-id="275a6-249">In the sample application provided, selecting the *GizmosCancelAsync* link calls the *GizmosCancelAsync.aspx* page and demonstrates the cancelation (by timing out) of the asynchronous call.</span></span> <span data-ttu-id="275a6-250">Dado que es el tiempo de retraso dentro de un intervalo aleatorio, debe actualizar la página de un par de veces para obtener el mensaje de error de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="275a6-250">Because the delay time is within a random range, you might need to refresh the page a couple times to get the time out error message.</span></span>

## <a id="ServerConfig"></a>  <span data-ttu-id="275a6-251">Configuración del servidor para llamadas a servicios Web alta simultaneidad/alta latencia</span><span class="sxs-lookup"><span data-stu-id="275a6-251">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="275a6-252">Para obtener los beneficios derivados de una aplicación web asincrónica, deberá realizar algunos cambios en la configuración predeterminada del servidor.</span><span class="sxs-lookup"><span data-stu-id="275a6-252">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="275a6-253">Tenga en cuenta al configurar y probar la aplicación web asincrónica de esfuerzo lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="275a6-253">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="275a6-254">Windows 7, Windows Vista, Windows 8 y todos los sistemas operativos de cliente de Windows tener un máximo de 10 solicitudes simultáneas.</span><span class="sxs-lookup"><span data-stu-id="275a6-254">Windows 7, Windows Vista, Window 8, and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="275a6-255">Necesitará un sistema operativo de Windows Server para ver las ventajas de los métodos asincrónicos bajo una carga excesiva.</span><span class="sxs-lookup"><span data-stu-id="275a6-255">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="275a6-256">Registrar .NET 4.5 con IIS desde un símbolo con privilegios elevados mediante el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="275a6-256">Register .NET 4.5 with IIS from an elevated command prompt using the following command:</span></span>  
  <span data-ttu-id="275a6-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span><span class="sxs-lookup"><span data-stu-id="275a6-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="275a6-258">Vea [herramienta de registro de IIS en ASP.NET (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="275a6-258">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="275a6-259">Tendrá que aumentar la [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) límite de la cola desde el valor predeterminado de 1.000 a 5000.</span><span class="sxs-lookup"><span data-stu-id="275a6-259">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="275a6-260">Si el valor es demasiado bajo, es posible que vea [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) rechazar las solicitudes con el estado HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="275a6-260">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="275a6-261">Para cambiar el límite de la cola de HTTP.sys:</span><span class="sxs-lookup"><span data-stu-id="275a6-261">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="275a6-262">Abra el Administrador de IIS y navegue hasta el panel de grupos de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="275a6-262">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="275a6-263">Haga clic con el botón secundario en el grupo de aplicaciones de destino y seleccione **configuración avanzada**.</span><span class="sxs-lookup"><span data-stu-id="275a6-263">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="275a6-264">![advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="275a6-264">![advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span></span>
    - <span data-ttu-id="275a6-265">En el **configuración avanzada** cuadro de diálogo, cambie *longitud de cola* de 1000 a 5000.</span><span class="sxs-lookup"><span data-stu-id="275a6-265">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="275a6-266">![Longitud de cola](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="275a6-266">![Queue length](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span></span>  
  
  <span data-ttu-id="275a6-267">Tenga en cuenta que en las ilustraciones anteriores, .NET framework se incluye como v4.0, incluso aunque el grupo de aplicaciones se use .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="275a6-267">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="275a6-268">Para entender esta discrepancia, vea lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="275a6-268">To understand this discrepancy, see the following:</span></span>

        - [.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
        - [How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
        - [.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)
- <span data-ttu-id="275a6-269">Si la aplicación está utilizando servicios web o System.NET para comunicarse con un back-end a través de HTTP que tenga que aumentar la [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) elemento.</span><span class="sxs-lookup"><span data-stu-id="275a6-269">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="275a6-270">Para las aplicaciones ASP.NET, esto está limitado por la característica de configuración automática en 12 veces el número de CPU.</span><span class="sxs-lookup"><span data-stu-id="275a6-270">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="275a6-271">Esto significa que en cuádruple, puede tener como máximo 12 \* 4 = 48 conexiones simultáneas a un punto de conexión IP.</span><span class="sxs-lookup"><span data-stu-id="275a6-271">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="275a6-272">Dado que esto está asociado a [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), la manera más fácil aumentar `maxconnection` en ASP.NET es establecer aplicación [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) mediante programación en el de `Application_Start` método en el *global.asax* archivo.</span><span class="sxs-lookup"><span data-stu-id="275a6-272">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="275a6-273">Vea el ejemplo de descarga para obtener un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="275a6-273">See the sample download for an example.</span></span>
- <span data-ttu-id="275a6-274">En .NET 4.5, el valor predeterminado es 5000 para [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) debiera estar bien.</span><span class="sxs-lookup"><span data-stu-id="275a6-274">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>

## <a name="contributors"></a><span data-ttu-id="275a6-275">Colaboradores</span><span class="sxs-lookup"><span data-stu-id="275a6-275">Contributors</span></span>

- [<span data-ttu-id="275a6-276">Levi Broderick</span><span class="sxs-lookup"><span data-stu-id="275a6-276">Levi Broderick</span></span>](http://stackoverflow.com/users/59641/levi)
- [<span data-ttu-id="275a6-277">Tom Dykstra</span><span class="sxs-lookup"><span data-stu-id="275a6-277">Tom Dykstra</span></span>](http://www.bing.com/search?q=site%3Aasp.net+%22Tom+Dykstra%22+-forums.asp.net&amp;qs=n&amp;form=QBRE&amp;pq=site%3Aasp.net+%22tom+dykstra%22+-forums.asp.net&amp;sc=8-42&amp;sp=-1&amp;sk=)
- [<span data-ttu-id="275a6-278">Brad Wilson</span><span class="sxs-lookup"><span data-stu-id="275a6-278">Brad Wilson</span></span>](http://bradwilson.typepad.com/)
- [<span data-ttu-id="275a6-279">Ge HongMei</span><span class="sxs-lookup"><span data-stu-id="275a6-279">HongMei Ge</span></span>](https://blogs.msdn.com/b/hongmeig/)
