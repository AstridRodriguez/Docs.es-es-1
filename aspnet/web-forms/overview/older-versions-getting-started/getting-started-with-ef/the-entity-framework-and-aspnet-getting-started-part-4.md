---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
title: Introducción a la base de datos de Entity Framework 4.0 en primer lugar y 4 de ASP.NET Web Forms - parte 4 | Documentos de Microsoft
author: tdykstra
description: La aplicación web de ejemplo de la Universidad de Contoso muestra cómo crear aplicaciones de formularios Web Forms de ASP.NET mediante Entity Framework. Es la aplicación de ejemplo...
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/03/2010
ms.topic: article
ms.assetid: ceb9e60f-957c-4d25-9331-cc527de96a33
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
msc.type: authoredcontent
ms.openlocfilehash: 6bea5f4faeb0a9c11a406a7e4e87c4929eda6a18
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/06/2018
---
<a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-4"></a><span data-ttu-id="16d2d-104">Introducción a la base de datos de Entity Framework 4.0 en primer lugar y ASP.NET 4 Web Forms - parte 4</span><span class="sxs-lookup"><span data-stu-id="16d2d-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 4</span></span>
====================
<span data-ttu-id="16d2d-105">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="16d2d-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="16d2d-106">La aplicación web de ejemplo de la Universidad de Contoso muestra cómo crear aplicaciones de formularios Web Forms de ASP.NET con el Entity Framework 4.0 y Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="16d2d-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="16d2d-107">Para obtener información acerca de la serie de tutoriales, vea [el primer tutorial de la serie](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="16d2d-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="working-with-related-data"></a><span data-ttu-id="16d2d-108">Trabajar con datos relacionados</span><span class="sxs-lookup"><span data-stu-id="16d2d-108">Working with Related Data</span></span>

<span data-ttu-id="16d2d-109">En el tutorial anterior ha utilizado el `EntityDataSource` control a filtrar, ordenar y agrupar los datos.</span><span class="sxs-lookup"><span data-stu-id="16d2d-109">In the previous tutorial you used the `EntityDataSource` control to filter, sort, and group data.</span></span> <span data-ttu-id="16d2d-110">En este tutorial podrá mostrar y actualizar datos relacionados.</span><span class="sxs-lookup"><span data-stu-id="16d2d-110">In this tutorial you'll display and update related data.</span></span>

<span data-ttu-id="16d2d-111">Podrá crear la página de instructores que muestra una lista de instructores.</span><span class="sxs-lookup"><span data-stu-id="16d2d-111">You'll create the Instructors page that shows a list of instructors.</span></span> <span data-ttu-id="16d2d-112">Cuando se selecciona un instructor, verá una lista de cursos imparten por ese instructor.</span><span class="sxs-lookup"><span data-stu-id="16d2d-112">When you select an instructor, you see a list of courses taught by that instructor.</span></span> <span data-ttu-id="16d2d-113">Cuando se selecciona un curso, puede ver detalles para el curso y una lista de estudiantes inscritos en el curso.</span><span class="sxs-lookup"><span data-stu-id="16d2d-113">When you select a course, you see details for the course and a list of students enrolled in the course.</span></span> <span data-ttu-id="16d2d-114">Puede editar el nombre del profesor, fecha de contratación y asignación de office.</span><span class="sxs-lookup"><span data-stu-id="16d2d-114">You can edit the instructor name, hire date, and office assignment.</span></span> <span data-ttu-id="16d2d-115">La asignación de office es un conjunto de entidades independientes que obtiene acceso mediante una propiedad de navegación.</span><span class="sxs-lookup"><span data-stu-id="16d2d-115">The office assignment is a separate entity set that you access through a navigation property.</span></span>

<span data-ttu-id="16d2d-116">Puede vincular datos maestros a los datos detallados en el marcado o en el código.</span><span class="sxs-lookup"><span data-stu-id="16d2d-116">You can link master data to detail data in markup or in code.</span></span> <span data-ttu-id="16d2d-117">En esta parte del tutorial, deberá usar ambos métodos.</span><span class="sxs-lookup"><span data-stu-id="16d2d-117">In this part of the tutorial, you'll use both methods.</span></span>

<span data-ttu-id="16d2d-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span></span>

## <a name="displaying-and-updating-related-entities-in-a-gridview-control"></a><span data-ttu-id="16d2d-119">Mostrar y actualizar las entidades relacionadas en un Control GridView</span><span class="sxs-lookup"><span data-stu-id="16d2d-119">Displaying and Updating Related Entities in a GridView Control</span></span>

<span data-ttu-id="16d2d-120">Crear una nueva página web denominada *Instructors.aspx* que usa el *Site.Master* página principal y agregue el siguiente marcado para la `Content` control denominado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="16d2d-120">Create a new web page named *Instructors.aspx* that uses the *Site.Master* master page, and add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample1.aspx)]

<span data-ttu-id="16d2d-121">Este marcado crea un `EntityDataSource` control que selecciona instructores y habilita las actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="16d2d-121">This markup creates an `EntityDataSource` control that selects instructors and enables updates.</span></span> <span data-ttu-id="16d2d-122">El `div` elemento configura marcado para representar a la izquierda para que posteriormente puede agregar una columna a la derecha.</span><span class="sxs-lookup"><span data-stu-id="16d2d-122">The `div` element configures markup to render on the left so that you can add a column on the right later.</span></span>

<span data-ttu-id="16d2d-123">Entre los `EntityDataSource` marcado y el cierre `</div>` etiqueta, agregue el siguiente marcado que crea un `GridView` control y un `Label` control que va a utilizar para los mensajes de error:</span><span class="sxs-lookup"><span data-stu-id="16d2d-123">Between the `EntityDataSource` markup and the closing `</div>` tag, add the following markup that creates a `GridView` control and a `Label` control that you'll use for error messages:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample2.aspx)]

<span data-ttu-id="16d2d-124">Esto `GridView` control permite la selección de fila, resalta la fila seleccionada con un color de fondo gris claro y especifica los controladores (que creará más adelante) para la `SelectedIndexChanged` y `Updating` eventos.</span><span class="sxs-lookup"><span data-stu-id="16d2d-124">This `GridView` control enables row selection, highlights the selected row with a light gray background color, and specifies handlers (which you'll create later) for the `SelectedIndexChanged` and `Updating` events.</span></span> <span data-ttu-id="16d2d-125">También especifica `PersonID` para el `DataKeyNames` propiedad, por lo que el valor de clave de la fila seleccionada se puede pasar a otro control que agregará más adelante.</span><span class="sxs-lookup"><span data-stu-id="16d2d-125">It also specifies `PersonID` for the `DataKeyNames` property, so that the key value of the selected row can be passed to another control that you'll add later.</span></span>

<span data-ttu-id="16d2d-126">La última columna contiene la asignación de oficina del instructor, que se almacena en una propiedad de navegación de la `Person` entidad porque se trata de una entidad asociada.</span><span class="sxs-lookup"><span data-stu-id="16d2d-126">The last column contains the instructor's office assignment, which is stored in a navigation property of the `Person` entity because it comes from an associated entity.</span></span> <span data-ttu-id="16d2d-127">Tenga en cuenta que la `EditItemTemplate` elemento especifica `Eval` en lugar de `Bind`, porque el `GridView` control no se puede enlazar directamente a las propiedades de navegación con el fin de actualizarlos.</span><span class="sxs-lookup"><span data-stu-id="16d2d-127">Notice that the `EditItemTemplate` element specifies `Eval` instead of `Bind`, because the `GridView` control cannot directly bind to navigation properties in order to update them.</span></span> <span data-ttu-id="16d2d-128">Se actualizará la asignación de office en el código.</span><span class="sxs-lookup"><span data-stu-id="16d2d-128">You'll update the office assignment in code.</span></span> <span data-ttu-id="16d2d-129">Para ello, necesitará una referencia a la `TextBox` control y se podrá obtener y guardar en el `TextBox` del control `Init` eventos.</span><span class="sxs-lookup"><span data-stu-id="16d2d-129">To do that, you'll need a reference to the `TextBox` control, and you'll get and save that in the `TextBox` control's `Init` event.</span></span>

<span data-ttu-id="16d2d-130">Después de la `GridView` control es un `Label` control que se usa para los mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="16d2d-130">Following the `GridView` control is a `Label` control that's used for error messages.</span></span> <span data-ttu-id="16d2d-131">El control `Visible` propiedad es `false`, y el estado de vista se ha desactivado, para que la etiqueta aparezca únicamente al código resulta visible en respuesta a un error.</span><span class="sxs-lookup"><span data-stu-id="16d2d-131">The control's `Visible` property is `false`, and view state is turned off, so that the label will appear only when code makes it visible in response to an error.</span></span>

<span data-ttu-id="16d2d-132">Abra la *Instructors.aspx.cs* de archivos y agregue las siguientes `using` instrucción:</span><span class="sxs-lookup"><span data-stu-id="16d2d-132">Open the *Instructors.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample3.cs)]

<span data-ttu-id="16d2d-133">Agregue un campo de clase privada inmediatamente después de la declaración de nombre de clase parcial para mantener una referencia al cuadro de texto de la asignación de office.</span><span class="sxs-lookup"><span data-stu-id="16d2d-133">Add a private class field immediately after the partial-class name declaration to hold a reference to the office assignment text box.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample4.cs)]

<span data-ttu-id="16d2d-134">Agregar un código auxiliar para el `SelectedIndexChanged` controlador de eventos que se agregará código para más tarde.</span><span class="sxs-lookup"><span data-stu-id="16d2d-134">Add a stub for the `SelectedIndexChanged` event handler that you'll add code for later.</span></span> <span data-ttu-id="16d2d-135">Agregar un controlador para la asignación de office `TextBox` del control `Init` eventos para que pueda almacenar una referencia a la `TextBox` control.</span><span class="sxs-lookup"><span data-stu-id="16d2d-135">Also add a handler for the office assignment `TextBox` control's `Init` event so that you can store a reference to the `TextBox` control.</span></span> <span data-ttu-id="16d2d-136">Usará esta referencia para obtener el valor especificado para actualizar la entidad asociada a la propiedad de navegación por el usuario.</span><span class="sxs-lookup"><span data-stu-id="16d2d-136">You'll use this reference to get the value the user entered in order to update the entity associated with the navigation property.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample5.cs)]

<span data-ttu-id="16d2d-137">Usará el `GridView` del control `Updating` evento para actualizar la `Location` propiedad del asociado `OfficeAssignment` entidad.</span><span class="sxs-lookup"><span data-stu-id="16d2d-137">You'll use the `GridView` control's `Updating` event to update the `Location` property of the associated `OfficeAssignment` entity.</span></span> <span data-ttu-id="16d2d-138">Agregue el siguiente controlador para el `Updating` eventos:</span><span class="sxs-lookup"><span data-stu-id="16d2d-138">Add the following handler for the `Updating` event:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample6.cs)]

<span data-ttu-id="16d2d-139">Este código se ejecuta cuando el usuario hace clic en **actualización** en un `GridView` fila.</span><span class="sxs-lookup"><span data-stu-id="16d2d-139">This code is run when the user clicks **Update** in a `GridView` row.</span></span> <span data-ttu-id="16d2d-140">El código usa LINQ to Entities para recuperar el `OfficeAssignment` entidad que está asociada a la actual `Person` entidad, usando la `PersonID` de la fila seleccionada en el argumento de evento.</span><span class="sxs-lookup"><span data-stu-id="16d2d-140">The code uses LINQ to Entities to retrieve the `OfficeAssignment` entity that's associated with the current `Person` entity, using the `PersonID` of the selected row from the event argument.</span></span>

<span data-ttu-id="16d2d-141">El código, a continuación, toma una de las siguientes acciones según el valor de la `InstructorOfficeTextBox` control:</span><span class="sxs-lookup"><span data-stu-id="16d2d-141">The code then takes one of the following actions depending on the value in the `InstructorOfficeTextBox` control:</span></span>

- <span data-ttu-id="16d2d-142">Si el cuadro de texto tiene un valor y no hay ningún `OfficeAssignment` entidad que se va a actualizar, crea uno.</span><span class="sxs-lookup"><span data-stu-id="16d2d-142">If the text box has a value and there's no `OfficeAssignment` entity to update, it creates one.</span></span>
- <span data-ttu-id="16d2d-143">Si el cuadro de texto tiene un valor y no hay un `OfficeAssignment` entidad, actualiza el `Location` valor de propiedad.</span><span class="sxs-lookup"><span data-stu-id="16d2d-143">If the text box has a value and there's an `OfficeAssignment` entity, it updates the `Location` property value.</span></span>
- <span data-ttu-id="16d2d-144">Si el cuadro de texto está vacío y un `OfficeAssignment` entidad existe, se elimina la entidad.</span><span class="sxs-lookup"><span data-stu-id="16d2d-144">If the text box is empty and an `OfficeAssignment` entity exists, it deletes the entity.</span></span>

<span data-ttu-id="16d2d-145">Después de esto, guarda los cambios en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="16d2d-145">After this, it saves the changes to the database.</span></span> <span data-ttu-id="16d2d-146">Si se produce una excepción, muestra un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="16d2d-146">If an exception occurs, it displays an error message.</span></span>

<span data-ttu-id="16d2d-147">Ejecute la página.</span><span class="sxs-lookup"><span data-stu-id="16d2d-147">Run the page.</span></span>

<span data-ttu-id="16d2d-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span></span>

<span data-ttu-id="16d2d-149">Haga clic en **editar** y cambian todos los campos a los cuadros de texto.</span><span class="sxs-lookup"><span data-stu-id="16d2d-149">Click **Edit** and all fields change to text boxes.</span></span>

<span data-ttu-id="16d2d-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span></span>

<span data-ttu-id="16d2d-151">Cambiar cualquiera de estos valores, incluidos los **Office asignación**.</span><span class="sxs-lookup"><span data-stu-id="16d2d-151">Change any of these values, including **Office Assignment**.</span></span> <span data-ttu-id="16d2d-152">Haga clic en **actualización** y podrá ver los cambios reflejados en la lista.</span><span class="sxs-lookup"><span data-stu-id="16d2d-152">Click **Update** and you'll see the changes reflected in the list.</span></span>

## <a name="displaying-related-entities-in-a-separate-control"></a><span data-ttu-id="16d2d-153">Mostrar las entidades relacionadas en un Control independiente</span><span class="sxs-lookup"><span data-stu-id="16d2d-153">Displaying Related Entities in a Separate Control</span></span>

<span data-ttu-id="16d2d-154">Cada profesor puede enseñar a uno o varios cursos, por lo que se va a agregar un `EntityDataSource` control y un `GridView` control para enumerar los cursos asociados con el instructor está seleccionado en los instructores `GridView` control.</span><span class="sxs-lookup"><span data-stu-id="16d2d-154">Each instructor can teach one or more courses, so you'll add an `EntityDataSource` control and a `GridView` control to list the courses associated with whichever instructor is selected in the instructors `GridView` control.</span></span> <span data-ttu-id="16d2d-155">Para crear un título y el `EntityDataSource` para entidades de cursos de control, agregue el siguiente marcado entre el mensaje de error `Label` control y el cierre `</div>` etiqueta:</span><span class="sxs-lookup"><span data-stu-id="16d2d-155">To create a heading and the `EntityDataSource` control for courses entities, add the following markup between the error message `Label` control and the closing `</div>` tag:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample7.aspx)]

<span data-ttu-id="16d2d-156">El `Where` parámetro contiene el valor de la `PersonID` del instructor cuya fila está seleccionada en el `InstructorsGridView` control.</span><span class="sxs-lookup"><span data-stu-id="16d2d-156">The `Where` parameter contains the value of the `PersonID` of the instructor whose row is selected in the `InstructorsGridView` control.</span></span> <span data-ttu-id="16d2d-157">El `Where` propiedad contiene un comando de Subselección que obtiene todos los asociados `Person` entidades de un `Course` la entidad `People` propiedad de navegación y selecciona el `Course` solo si de entidad uno de los asociados `Person`entidades contiene seleccionado `PersonID` valor.</span><span class="sxs-lookup"><span data-stu-id="16d2d-157">The `Where` property contains a subselect command that gets all associated `Person` entities from a `Course` entity's `People` navigation property and selects the `Course` entity only if one of the associated `Person` entities contains the selected `PersonID` value.</span></span>

<span data-ttu-id="16d2d-158">Para crear el `GridView` control., agregue el siguiente marcado inmediatamente después de la `CoursesEntityDataSource` control (antes del cierre `</div>` etiqueta):</span><span class="sxs-lookup"><span data-stu-id="16d2d-158">To create the `GridView` control., add the following markup immediately following the `CoursesEntityDataSource` control (before the closing `</div>` tag):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample8.aspx)]

<span data-ttu-id="16d2d-159">Dado que no hay cursos se mostrará si no se selecciona ningún instructor, un `EmptyDataTemplate` elemento se incluye.</span><span class="sxs-lookup"><span data-stu-id="16d2d-159">Because no courses will be displayed if no instructor is selected, an `EmptyDataTemplate` element is included.</span></span>

<span data-ttu-id="16d2d-160">Ejecute la página.</span><span class="sxs-lookup"><span data-stu-id="16d2d-160">Run the page.</span></span>

<span data-ttu-id="16d2d-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span></span>

<span data-ttu-id="16d2d-162">Seleccione un instructor que tenga uno o varios cursos asignados, y el curso o los cursos aparecen en la lista.</span><span class="sxs-lookup"><span data-stu-id="16d2d-162">Select an instructor who has one or more courses assigned, and the course or courses appear in the list.</span></span> <span data-ttu-id="16d2d-163">(Nota: aunque el esquema de base de datos permite varios cursos, en los datos de prueba proporcionados con la base de datos instructor realmente no tiene más de un curso.</span><span class="sxs-lookup"><span data-stu-id="16d2d-163">(Note: although the database schema allows multiple courses, in the test data supplied with the database no instructor actually has more than one course.</span></span> <span data-ttu-id="16d2d-164">Puede agregar cursos a la base de datos usted mismo utilizando la **Explorador de servidores** ventana o el *CoursesAdd.aspx* página, que agregará en un tutorial posterior.)</span><span class="sxs-lookup"><span data-stu-id="16d2d-164">You can add courses to the database yourself using the **Server Explorer** window or the *CoursesAdd.aspx* page, which you'll add in a later tutorial.)</span></span>

<span data-ttu-id="16d2d-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span></span>

<span data-ttu-id="16d2d-166">El `CoursesGridView` control muestra solo unos cuantos campos de curso.</span><span class="sxs-lookup"><span data-stu-id="16d2d-166">The `CoursesGridView` control shows only a few course fields.</span></span> <span data-ttu-id="16d2d-167">Para mostrar todos los detalles de un curso, usará un `DetailsView` control para el curso en el que el usuario seleccione.</span><span class="sxs-lookup"><span data-stu-id="16d2d-167">To display all the details for a course, you'll use a `DetailsView` control for the course that the user selects.</span></span> <span data-ttu-id="16d2d-168">En *Instructors.aspx*, agregue el siguiente marcado después del cierre `</div>` etiqueta (asegúrese de colocar este marcado **después** etiqueta div de cierre, no antes):</span><span class="sxs-lookup"><span data-stu-id="16d2d-168">In *Instructors.aspx*, add the following markup after the closing `</div>` tag (make sure you place this markup **after** the closing div tag, not before it):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample9.aspx)]

<span data-ttu-id="16d2d-169">Este marcado crea un `EntityDataSource` control que está enlazado a la `Courses` conjunto de entidades.</span><span class="sxs-lookup"><span data-stu-id="16d2d-169">This markup creates an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span> <span data-ttu-id="16d2d-170">El `Where` propiedad selecciona un curso utilizando la `CourseID` valor de la fila seleccionada en los cursos `GridView` control.</span><span class="sxs-lookup"><span data-stu-id="16d2d-170">The `Where` property selects a course using the `CourseID` value of the selected row in the courses `GridView` control.</span></span> <span data-ttu-id="16d2d-171">El marcado especifica un controlador para el `Selected` evento, que usará más adelante para mostrar alumnos, que es otro nivel inferior en la jerarquía.</span><span class="sxs-lookup"><span data-stu-id="16d2d-171">The markup specifies a handler for the `Selected` event, which you'll use later for displaying student grades, which is another level lower in the hierarchy.</span></span>

<span data-ttu-id="16d2d-172">En *Instructors.aspx.cs*, crear el código auxiliar siguiente para el `CourseDetailsEntityDataSource_Selected` método.</span><span class="sxs-lookup"><span data-stu-id="16d2d-172">In *Instructors.aspx.cs*, create the following stub for the `CourseDetailsEntityDataSource_Selected` method.</span></span> <span data-ttu-id="16d2d-173">(Deberá rellenar este código auxiliar más adelante en el tutorial; por ahora, tendrá que, para que se compilará y ejecutará la página).</span><span class="sxs-lookup"><span data-stu-id="16d2d-173">(You'll fill this stub out later in the tutorial; for now, you need it so that the page will compile and run.)</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample10.cs)]

<span data-ttu-id="16d2d-174">Ejecute la página.</span><span class="sxs-lookup"><span data-stu-id="16d2d-174">Run the page.</span></span>

<span data-ttu-id="16d2d-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span></span>

<span data-ttu-id="16d2d-176">Inicialmente, hay ninguna información de curso porque no se seleccionó ningún curso.</span><span class="sxs-lookup"><span data-stu-id="16d2d-176">Initially there are no course details because no course is selected.</span></span> <span data-ttu-id="16d2d-177">Seleccione un instructor que tenga un curso asignado y, a continuación, seleccione un curso para ver los detalles.</span><span class="sxs-lookup"><span data-stu-id="16d2d-177">Select an instructor who has a course assigned, and then select a course to see the details.</span></span>

<span data-ttu-id="16d2d-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span></span>

## <a name="using-the-entitydatasource-selected-event-to-display-related-data"></a><span data-ttu-id="16d2d-179">Usar el EntityDataSource "seleccionado" evento para mostrar datos relacionados</span><span class="sxs-lookup"><span data-stu-id="16d2d-179">Using the EntityDataSource "Selected" Event to Display Related Data</span></span>

<span data-ttu-id="16d2d-180">Por último, desea que aparezcan todos los alumnos inscritos y sus grados para el curso seleccionado.</span><span class="sxs-lookup"><span data-stu-id="16d2d-180">Finally, you want to show all of the enrolled students and their grades for the selected course.</span></span> <span data-ttu-id="16d2d-181">Para ello, deberá usar el `Selected` eventos de la `EntityDataSource` control se enlaza al curso `DetailsView`.</span><span class="sxs-lookup"><span data-stu-id="16d2d-181">To do this, you'll use the `Selected` event of the `EntityDataSource` control bound to the course `DetailsView`.</span></span>

<span data-ttu-id="16d2d-182">En *Instructors.aspx*, agregue el siguiente marcado después de la `DetailsView` control:</span><span class="sxs-lookup"><span data-stu-id="16d2d-182">In *Instructors.aspx*, add the following markup after the `DetailsView` control:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample11.aspx)]

<span data-ttu-id="16d2d-183">Este marcado crea un `ListView` control que muestra una lista de los alumnos y sus grados para el curso seleccionado.</span><span class="sxs-lookup"><span data-stu-id="16d2d-183">This markup creates a `ListView` control that displays a list of students and their grades for the selected course.</span></span> <span data-ttu-id="16d2d-184">Se especifica ningún origen de datos porque deberá enlazar el control en el código.</span><span class="sxs-lookup"><span data-stu-id="16d2d-184">No data source is specified because you'll databind the control in code.</span></span> <span data-ttu-id="16d2d-185">El `EmptyDataTemplate` elemento proporciona un mensaje que se mostrará cuando no se selecciona ningún curso, en ese caso, no hay ningún alumno para mostrar.</span><span class="sxs-lookup"><span data-stu-id="16d2d-185">The `EmptyDataTemplate` element provides a message to display when no course is selected—in that case, there are no students to display.</span></span> <span data-ttu-id="16d2d-186">El `LayoutTemplate` elemento crea una tabla HTML para mostrar la lista y el `ItemTemplate` especifica las columnas para mostrar.</span><span class="sxs-lookup"><span data-stu-id="16d2d-186">The `LayoutTemplate` element creates an HTML table to display the list, and the `ItemTemplate` specifies the columns to display.</span></span> <span data-ttu-id="16d2d-187">El Id. de estudiante y el grado de estudiante son de la `StudentGrade` proviene de entidad y el nombre del estudiante el `Person` entidad que Entity Framework hace que estén disponible en la `Person` propiedad de navegación de la `StudentGrade` entidad.</span><span class="sxs-lookup"><span data-stu-id="16d2d-187">The student ID and the student grade are from the `StudentGrade` entity, and the student name is from the `Person` entity that the Entity Framework makes available in the `Person` navigation property of the `StudentGrade` entity.</span></span>

<span data-ttu-id="16d2d-188">En *Instructors.aspx.cs*, reemplace el código auxiliar horizontal `CourseDetailsEntityDataSource_Selected` método por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="16d2d-188">In *Instructors.aspx.cs*, replace the stubbed-out `CourseDetailsEntityDataSource_Selected` method with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample12.cs)]

<span data-ttu-id="16d2d-189">El argumento de evento para este evento proporciona los datos seleccionados en el formulario de una colección, que tendrá un elemento o cero elementos si no se selecciona nada si un `Course` se selecciona la entidad.</span><span class="sxs-lookup"><span data-stu-id="16d2d-189">The event argument for this event provides the selected data in the form of a collection, which will have zero items if nothing is selected or one item if a `Course` entity is selected.</span></span> <span data-ttu-id="16d2d-190">Si un `Course` entidad está activada, el código usa el `First` método para convertir la colección en un único objeto.</span><span class="sxs-lookup"><span data-stu-id="16d2d-190">If a `Course` entity is selected, the code uses the `First` method to convert the collection to a single object.</span></span> <span data-ttu-id="16d2d-191">A continuación, se obtiene `StudentGrade` convierte a una colección de entidades de la propiedad de navegación y enlaza el `GradesListView` control a la colección.</span><span class="sxs-lookup"><span data-stu-id="16d2d-191">It then gets `StudentGrade` entities from the navigation property, converts them to a collection, and binds the `GradesListView` control to the collection.</span></span>

<span data-ttu-id="16d2d-192">Esto es suficiente mostrar grados, pero desea asegurarse de que el mensaje en la plantilla de datos vacía se muestra la primera vez que se muestra la página y siempre que no se selecciona un curso.</span><span class="sxs-lookup"><span data-stu-id="16d2d-192">This is sufficient to display grades, but you want to make sure that the message in the empty data template is displayed the first time the page is displayed and whenever a course is not selected.</span></span> <span data-ttu-id="16d2d-193">Para ello, cree el método siguiente, que llamaremos en dos lugares:</span><span class="sxs-lookup"><span data-stu-id="16d2d-193">To do that, create the following method, which you'll call from two places:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample13.cs)]

<span data-ttu-id="16d2d-194">Llamar a este método nuevo desde el `Page_Load` método para mostrar la hora de la primera plantilla de datos vacía se muestra la página.</span><span class="sxs-lookup"><span data-stu-id="16d2d-194">Call this new method from the `Page_Load` method to display the empty data template the first time the page is displayed.</span></span> <span data-ttu-id="16d2d-195">Y llámelo desde el `InstructorsGridView_SelectedIndexChanged` método porque ese evento se genera cuando se selecciona un instructor, lo que significa nuevos cursos se cargan en los cursos `GridView` control y ninguno está seleccionada todavía.</span><span class="sxs-lookup"><span data-stu-id="16d2d-195">And call it from the `InstructorsGridView_SelectedIndexChanged` method because that event is raised when an instructor is selected, which means new courses are loaded into the courses `GridView` control and none is selected yet.</span></span> <span data-ttu-id="16d2d-196">Estas son las dos llamadas:</span><span class="sxs-lookup"><span data-stu-id="16d2d-196">Here are the two calls:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample14.cs)]

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample15.cs)]

<span data-ttu-id="16d2d-197">Ejecute la página.</span><span class="sxs-lookup"><span data-stu-id="16d2d-197">Run the page.</span></span>

<span data-ttu-id="16d2d-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span></span>

<span data-ttu-id="16d2d-199">Seleccione un instructor que tiene un curso asignado y, a continuación, seleccione el curso.</span><span class="sxs-lookup"><span data-stu-id="16d2d-199">Select an instructor that has a course assigned, and then select the course.</span></span>

<span data-ttu-id="16d2d-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="16d2d-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span></span>

<span data-ttu-id="16d2d-201">Ya ha visto algunas maneras de trabajar con los datos relacionados.</span><span class="sxs-lookup"><span data-stu-id="16d2d-201">You have now seen a few ways to work with related data.</span></span> <span data-ttu-id="16d2d-202">En el siguiente tutorial, obtendrá información sobre cómo agregar las relaciones entre las entidades existentes, cómo quitar relaciones y cómo agregar una nueva entidad que tiene una relación con una entidad existente.</span><span class="sxs-lookup"><span data-stu-id="16d2d-202">In the following tutorial, you'll learn how to add relationships between existing entities, how to remove relationships, and how to add a new entity that has a relationship to an existing entity.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="16d2d-203">[Anterior](the-entity-framework-and-aspnet-getting-started-part-3.md)
> [Siguiente](the-entity-framework-and-aspnet-getting-started-part-5.md)</span><span class="sxs-lookup"><span data-stu-id="16d2d-203">[Previous](the-entity-framework-and-aspnet-getting-started-part-3.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-5.md)</span></span>
