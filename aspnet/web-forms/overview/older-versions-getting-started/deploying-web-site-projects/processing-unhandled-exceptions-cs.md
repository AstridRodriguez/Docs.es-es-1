---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
title: Procesar las excepciones no controladas (C#) | Documentos de Microsoft
author: rick-anderson
description: "Cuando se produce un error en tiempo de ejecución en una aplicación web en producción es importante para notificar a un desarrollador y registre el error para que se pueden diagnosticar en una la..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: 5bc1afd5-2484-4528-b158-ab218ba150e8
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 4c7f15053ca035a1df1222f88752b8243808bef0
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/10/2017
---
<a name="processing-unhandled-exceptions-c"></a><span data-ttu-id="ab5ec-103">Procesar las excepciones no controladas (C#)</span><span class="sxs-lookup"><span data-stu-id="ab5ec-103">Processing Unhandled Exceptions (C#)</span></span>
====================
<span data-ttu-id="ab5ec-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ab5ec-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ab5ec-105">[Descargar código](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_12_CS.zip) o [descarga de PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial12_ErrorHandling_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="ab5ec-105">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_12_CS.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial12_ErrorHandling_cs.pdf)</span></span>

> <span data-ttu-id="ab5ec-106">Cuando se produce un error en tiempo de ejecución en una aplicación web en producción es importante para notificar a un desarrollador y registre el error para que se pueden diagnosticar en un momento posterior en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="ab5ec-107">Este tutorial proporciona una visión general del proceso de ASP.NET procesa los errores en tiempo de ejecución y se examinan una manera de tener código personalizado se ejecute cada vez que un burbujas de excepción no controlada al tiempo de ejecución de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="ab5ec-108">Introducción</span><span class="sxs-lookup"><span data-stu-id="ab5ec-108">Introduction</span></span>

<span data-ttu-id="ab5ec-109">Cuando se produce una excepción no controlada en una aplicación ASP.NET, propaga hasta el tiempo de ejecución ASP.NET, que genera el `Error` eventos y muestra la página de error adecuado.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="ab5ec-110">Hay tres tipos diferentes de las páginas de error: el tiempo de ejecución Error amarillo pantalla de muerte (YSOD); los detalles de excepción YSOD; y páginas de errores personalizados.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="ab5ec-111">En el [tutorial anterior](displaying-a-custom-error-page-cs.md) hemos configurado la aplicación para utilizar una página de error personalizada para los usuarios remotos y la YSOD de detalles de excepción para los usuarios que visitan de forma local.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-111">In the [preceding tutorial](displaying-a-custom-error-page-cs.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="ab5ec-112">Mediante una página de error personalizado sencillo humanos que coincide con la apariencia y funcionamiento del sitio es preferible a la predeterminada YSOD de Error de tiempo de ejecución, pero mostrar una página de error personalizada es solo una parte de una completa solución de control de errores.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="ab5ec-113">Cuando se produce un error en una aplicación en producción, es importante que los desarrolladores se notificación el error para que puedan desenterrar la causa de la excepción y solucionarlo.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="ab5ec-114">Además, se deben registrar los detalles del error para que el error se puede examinar y diagnosticar en un momento posterior en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="ab5ec-115">Este tutorial muestra cómo obtener acceso a los detalles de una excepción no controlada para que se pueden registrar y un programador de una notificación.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="ab5ec-116">Los dos tutoriales siguiendo este exploran las bibliotecas de registro de errores que, después de un poco de configuración, notificar a los desarrolladores de errores en tiempo de ejecución y sus detalles de registro automáticamente.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="ab5ec-117">La información que se examinan en este tutorial es muy útil si tiene que procesar las excepciones no controladas de alguna manera único o personalizada.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="ab5ec-118">En casos en que solo tenga que registrar la excepción y notificar a un desarrollador, usando una biblioteca de registro de error es la mejor opción.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="ab5ec-119">Los siguientes dos tutoriales proporcionan una visión general de dos de estas bibliotecas.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="ab5ec-120">Ejecutar código cuando el`Error`evento se desencadena</span><span class="sxs-lookup"><span data-stu-id="ab5ec-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="ab5ec-121">Eventos proporcionan un mecanismo para señalar que se ha producido algo interesante y otro objeto que se va a ejecutar el código en respuesta de un objeto.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="ab5ec-122">Como desarrollador de ASP.NET está acostumbrado a pensar en eventos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="ab5ec-123">Si desea ejecutar el código cuando el visitante hace clic en un botón determinado, crear un controlador de eventos para ese botón `Click` eventos y coloque el código no existe.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="ab5ec-124">Dado que el tiempo de ejecución ASP.NET genera su [ `Error` eventos](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.error.aspx) siempre que se produce una excepción no controlada, se supone que el código para registrar los detalles del error saldría en un controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="ab5ec-125">Pero ¿cómo se crea un controlador de eventos para el `Error` eventos?</span><span class="sxs-lookup"><span data-stu-id="ab5ec-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="ab5ec-126">El `Error` evento es uno de muchos eventos en el [ `HttpApplication` clase](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.aspx) que se generan en determinadas fases de la canalización HTTP durante la duración de una solicitud.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="ab5ec-127">Por ejemplo, el `HttpApplication` la clase [ `BeginRequest` eventos](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.beginrequest.aspx) se desencadena al comienzo de cada solicitud; su [ `AuthenticateRequest` evento](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authenticaterequest.aspx) se genera cuando un módulo de seguridad ha identificado el solicitante.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="ab5ec-128">Estos `HttpApplication` eventos dan al desarrollador de la página a fin de ejecutar una lógica personalizada en varios puntos de la duración de una solicitud.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="ab5ec-129">Controladores de eventos para el `HttpApplication` eventos pueden colocarse en un archivo especial denominado `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="ab5ec-130">Para crear este archivo en su sitio Web, agregar un nuevo elemento a la raíz del sitio Web utilizando la plantilla de clase de aplicación Global con el nombre `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-cs/_static/image2.png)](processing-unhandled-exceptions-cs/_static/image1.png)

<span data-ttu-id="ab5ec-131">**Figura 1**: agregar `Global.asax` a la aplicación Web</span><span class="sxs-lookup"><span data-stu-id="ab5ec-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
<span data-ttu-id="ab5ec-132">([Haga clic aquí para ver la imagen a tamaño completo](processing-unhandled-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ab5ec-132">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="ab5ec-133">El contenido y la estructura de la `Global.asax` archivo creado por Visual Studio varían ligeramente en función de si usas un proyecto de aplicación Web (WAP) o un proyecto de sitio Web (WSP).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="ab5ec-134">Con un WAP, el `Global.asax` se implementa como dos archivos independientes - `Global.asax` y `Global.asax.cs`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.cs`.</span></span> <span data-ttu-id="ab5ec-135">El `Global.asax` archivo no contiene nada, pero un `@Application` directiva que hace referencia el `.cs` archivo; el evento se definen los controladores de interés en el `Global.asax.cs` archivo.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.cs` file; the event handlers of interest are defined in the `Global.asax.cs` file.</span></span> <span data-ttu-id="ab5ec-136">Para WSPs, se crea un único archivo, `Global.asax`, y los controladores de eventos se definen en un `<script runat="server">` bloque.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="ab5ec-137">El `Global.asax` archivo creado en un WAP por plantilla de clase de aplicación Global de Visual Studio incluye controladores de eventos denominados `Application_BeginRequest`, `Application_AuthenticateRequest`, y `Application_Error`, que son controladores de eventos para el `HttpApplication` eventos `BeginRequest`, `AuthenticateRequest`, y `Error`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="ab5ec-138">También hay controladores de eventos denominados `Application_Start`, `Session_Start`, `Application_End`, y `Session_End`, que son controladores de eventos que se desencadenan cuando la aplicación web se inicia, cuando se inicia una nueva sesión, cuando finaliza la aplicación y, cuando finaliza una sesión, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="ab5ec-139">El `Global.asax` archivo creado en un WSP por Visual Studio contiene solo el `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, y `Session_End` controladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="ab5ec-140">Al implementar la aplicación ASP.NET debe copiar el `Global.asax` archivo al entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="ab5ec-141">El `Global.asax.cs` no es necesario el archivo, que se crea en el WAP, que se copiará en producción porque este código se compila en el ensamblado del proyecto.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-141">The `Global.asax.cs` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="ab5ec-142">Los controladores de eventos creados por la plantilla de clase de aplicación Global de Visual Studio no son exhaustivos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="ab5ec-143">Puede agregar un controlador de eventos para cualquier `HttpApplication` evento por el controlador de eventos de nomenclatura `Application_EventName`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="ab5ec-144">Por ejemplo, podría agregar el código siguiente a la `Global.asax` archivo para crear un controlador de eventos para el [ `AuthorizeRequest` eventos](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="ab5ec-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-vb[Main](processing-unhandled-exceptions-cs/samples/sample1.vb)]

<span data-ttu-id="ab5ec-145">Igualmente, puede quitar los controladores de eventos creados por la plantilla de clase de aplicación Global que no son necesarios.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="ab5ec-146">En este tutorial sólo es necesario que un controlador de eventos para el `Error` eventos; Llamarme quitar los otros controladores de eventos desde el `Global.asax` archivo.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="ab5ec-147">*Módulos HTTP* ofrecen otra forma de definir controladores de eventos para `HttpApplication` eventos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="ab5ec-148">Los módulos HTTP se crean como un archivo de clase que se pueden colocar directamente en el proyecto de aplicación web o separarse en una biblioteca de clases independiente.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="ab5ec-149">Debido a que se pueden separar en una biblioteca de clases, módulos HTTP ofrecen un modelo más flexible y reutilizable para crear `HttpApplication` controladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="ab5ec-150">Mientras que la `Global.asax` archivo es específico a la aplicación web que se encuentra, se pueden compilar módulos HTTP en ensamblados, momento en que agregar el módulo HTTP a un sitio Web es tan sencillo como colocando el ensamblado el `Bin` carpeta y registrar el Módulo en `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="ab5ec-151">Este tutorial no se parece al crear y utilizar módulos HTTP, pero las bibliotecas de registro de errores en dos utilizadas en los siguientes dos tutoriales se implementan como módulos HTTP.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="ab5ec-152">Para obtener más información sobre las ventajas de los módulos HTTP, consulte [mediante módulos de HTTP y los controladores al crear componentes de ASP.NET conectables](https://msdn.microsoft.com/en-us/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/en-us/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="ab5ec-153">Al recuperar la información sobre la excepción no controlada</span><span class="sxs-lookup"><span data-stu-id="ab5ec-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="ab5ec-154">En este momento tenemos un archivo Global.asax con un `Application_Error` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="ab5ec-155">Cuando se ejecuta este controlador de eventos es necesario notificar a un desarrollador del error y los detalles de registro.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="ab5ec-156">Para realizar estas tareas, primero necesitamos determinar los detalles de la excepción que se ha producido.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="ab5ec-157">Usar el objeto de servidor [ `GetLastError` método](https://msdn.microsoft.com/en-us/library/system.web.httpserverutility.getlasterror.aspx) recuperar detalles de la excepción no controlada que produjo la `Error` activación del evento.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/en-us/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="ab5ec-158">El `GetLastError` método devuelve un objeto de tipo `Exception`, que es el tipo base para todas las excepciones en .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="ab5ec-159">Sin embargo, en el código anterior estoy convertir el objeto de excepción devolviendo por `GetLastError` en un `HttpException` objeto.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="ab5ec-160">Si el `Error` evento se desencadena porque se produjo una excepción durante el procesamiento de un recurso ASP.NET, a continuación, se ajusta dentro de la excepción que se produjo una `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="ab5ec-161">Para obtener la excepción real que motivó el uso de eventos de Error del `InnerException` propiedad.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="ab5ec-162">Si el `Error` se generó el evento debido a una excepción basada en HTTP, como una solicitud para una página inexistente, un `HttpException` se produce, pero no tiene una excepción interna.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="ab5ec-163">El siguiente código utiliza el `GetLastErrormessage` para recuperar información sobre la excepción que desencadenó la `Error` evento, almacenar el `HttpException` en una variable denominada `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="ab5ec-164">A continuación, almacena el tipo, el mensaje y el seguimiento de la pila de la excepción original en tres variables de cadena, comprueba si el `lastErrorWrapper` es la excepción real que desencadenó la `Error` evento (en el caso de excepciones basado en HTTP) o si es simplemente un contenedor para una excepción que se produjo al procesar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="ab5ec-165">En este momento tiene toda la información que necesita escribir código que se registrará los detalles de la excepción en una tabla de base de datos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="ab5ec-166">Puede crear una tabla de base de datos con columnas para cada uno de los detalles del error de interés - el tipo, el mensaje, el seguimiento de la pila y así sucesivamente - junto con otras piezas útiles de información, como la dirección URL de la página solicitada y el nombre del usuario que ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="ab5ec-167">En el `Application_Error` controlador de eventos, a continuación, podría conectarse a la base de datos e insertar un registro en la tabla.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="ab5ec-168">Del mismo modo, puede agregar código para un programador del error a través de correo electrónico de alerta.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-168">Likewise, you could add code to alert a developer of the error via e-mail.</span></span>

<span data-ttu-id="ab5ec-169">Las bibliotecas de registro de error examinadas en los siguientes dos tutoriales proporcionan esta funcionalidad de fábrica, por lo que no es necesario para compilar este registro de errores y la notificación.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="ab5ec-170">Sin embargo, para ilustrar que el `Error` se ha generado el evento y que la `Application_Error` controlador de eventos puede utilizarse para registrar los detalles del error y notificar a un programador, vamos a agregar código que notifica a un desarrollador cuando se produce un error.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="ab5ec-171">Notificar a un programador cuando se produce una excepción no controlada</span><span class="sxs-lookup"><span data-stu-id="ab5ec-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="ab5ec-172">Cuando se produce una excepción no controlada en el entorno de producción es importante avisar al equipo de desarrollo para que pueda evaluar el error y determinar qué acciones deben realizarse.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="ab5ec-173">Por ejemplo, si se produce un error en la conexión a la base de datos, deberá en tipo doble Compruebe la cadena de conexión y, quizás, abra una incidencia de soporte técnico con la empresa de hospedaje web.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="ab5ec-174">Si la excepción se produjo debido a un error de programación, código adicional ni una lógica de validación que necesite agregar para evitar estos errores en el futuro.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="ab5ec-175">Clases de .NET Framework en el [ `System.Net.Mail` espacio de nombres](https://msdn.microsoft.com/en-us/library/system.net.mail.aspx) resulta fácil enviar un correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/en-us/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="ab5ec-176">El [ `MailMessage` clase](https://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage.aspx) representa un mensaje de correo electrónico y tiene propiedades como `To`, `From`, `Subject`, `Body`, y `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-176">The [`MailMessage` class](https://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage.aspx) represents an e-mail message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="ab5ec-177">El `SmtpClass` se usa para enviar un `MailMessage` el objeto con un servidor SMTP especificado; se puede especificar la configuración del servidor SMTP mediante programación o mediante declaración en el [ `<system.net>` elemento](https://msdn.microsoft.com/en-us/library/6484zdc1.aspx) en el `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/en-us/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="ab5ec-178">Para obtener más información sobre el envío de correo electrónico mensajes de una aplicación ASP.NET Vea mi artículo [enviar correo electrónico en ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)y el [System.Net.Mail preguntas más frecuentes sobre](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-178">For more information on sending e-mail messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="ab5ec-179">El `<system.net>` elemento contiene la configuración del servidor SMTP utilizada por la `SmtpClient` clase al enviar un correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an e-mail.</span></span> <span data-ttu-id="ab5ec-180">Su empresa probable de hospedaje tiene un servidor SMTP que puede usar para enviar correo electrónico desde la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-180">Your web hosting company likely has an SMTP server that you can use to send e-mail from your application.</span></span> <span data-ttu-id="ab5ec-181">Consulte la sección de soporte técnico de su host de web para obtener información sobre la configuración del servidor SMTP que debe usar en la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="ab5ec-182">Agregue el código siguiente a la `Application_Error` controlador de eventos para enviar un correo electrónico de un desarrollador cuando se produce un error:</span><span class="sxs-lookup"><span data-stu-id="ab5ec-182">Add the following code to the `Application_Error` event handler to send a developer an e-mail when an error occurs:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample4.cs)]

<span data-ttu-id="ab5ec-183">Mientras que el código anterior es muy largo, la mayor parte del mismo crea el código HTML que aparece en el correo electrónico enviado al desarrollador de la.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the e-mail sent to the developer.</span></span> <span data-ttu-id="ab5ec-184">El código que se inicia haciendo referencia a la `HttpException` devuelto por la `GetLastError` (método) (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="ab5ec-185">La excepción que se produjo por la solicitud se recupera a través de `lastErrorWrapper.InnerException` y se asigna a la variable `lastError`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="ab5ec-186">El tipo, el mensaje y la pila se recupera información de seguimiento de `lastError` y se almacenan en tres variables de cadena.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="ab5ec-187">Después, un `MailMessage` objeto denominado `mm` se crea.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="ab5ec-188">El cuerpo del correo electrónico es HTML con formato y muestra la dirección URL de la página solicitada, el nombre del usuario con sesión iniciada actualmente y obtener información sobre la excepción (tipo, mensaje y seguimiento de la pila).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-188">The e-mail body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="ab5ec-189">Una de las cosas interesantes sobre la `HttpException` clase es que puede generar el código HTML utilizado para crear la excepción detalles amarillo pantalla de muerte (YSOD) mediante una llamada a la [GetHtmlErrorMessage método](https://msdn.microsoft.com/en-us/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/en-us/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="ab5ec-190">Este método se utiliza a continuación para recuperar el marcado YSOD de detalles de excepción y agregarlo al correo electrónico como datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="ab5ec-191">Una palabra de precaución: si la excepción que desencadenó la `Error` evento se produjo una excepción basada en HTTP (por ejemplo, una solicitud para una página inexistente) la `GetHtmlErrorMessage` método devolverá `null`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="ab5ec-192">El paso final consiste en enviar el `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="ab5ec-193">Esto se hace mediante la creación de un nuevo `SmtpClient` método y llamar a su `Send` método.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="ab5ec-194">Antes de usar este código en la aplicación web desea cambiar los valores de la `ToAddress` y `FromAddress` constantes de support@example.com a cualquier dirección de correo electrónico se debe enviar el correo electrónico de notificación de error y se originan en.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever e-mail address the error notification e-mail should be sent to and originate from.</span></span> <span data-ttu-id="ab5ec-195">También necesitará especificar la configuración del servidor SMTP en el `<system.net>` sección `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="ab5ec-196">Consulte a su proveedor de host de web para determinar la configuración del servidor SMTP para usar.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="ab5ec-197">Con este código en su lugar siempre que hay un error el programador se envía un mensaje de correo electrónico que resume el error e incluye el YSOD.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-197">With this code in place anytime there's an error the developer is sent an e-mail message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="ab5ec-198">En el tutorial anterior se muestra un error en tiempo de ejecución, visite Genre.aspx y se pasa una no es válido `ID` valor a través de la cadena de consulta, como `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="ab5ec-199">Visite la página con el `Global.asax` archivo en su lugar genera la misma experiencia de usuario, como en el tutorial anterior - en el entorno de desarrollo seguirá ver la excepción detalles amarillo pantalla de muerte, mientras que en el entorno de producción Consulte la página de error personalizado.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="ab5ec-200">Además de este comportamiento existente, el programador se envía un correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-200">In addition to this existing behavior, the developer is sent an e-mail.</span></span>

<span data-ttu-id="ab5ec-201">**Figura 2** muestra el correo electrónico recibido al visitar `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-201">**Figure 2** shows the e-mail received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="ab5ec-202">El cuerpo del correo electrónico resume la información de excepción, mientras que la `YSOD.htm` datos adjuntos muestra el contenido que se muestra en el YSOD de detalles de excepción (consulte **figura 3**).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-202">The e-mail body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image5.png)](processing-unhandled-exceptions-cs/_static/image4.png)

<span data-ttu-id="ab5ec-203">**Figura 2**: el programador se envía una notificación por correo electrónico cada vez que hay una excepción no controlada</span><span class="sxs-lookup"><span data-stu-id="ab5ec-203">**Figure 2**: The Developer Is Sent An E-Mail Notification Whenever There's An Unhandled Exception</span></span>  
<span data-ttu-id="ab5ec-204">([Haga clic aquí para ver la imagen a tamaño completo](processing-unhandled-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ab5ec-204">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-cs/_static/image8.png)](processing-unhandled-exceptions-cs/_static/image7.png)

<span data-ttu-id="ab5ec-205">**Figura 3**: la notificación de correo electrónico incluye los detalles de excepción YSOD como datos adjuntos</span><span class="sxs-lookup"><span data-stu-id="ab5ec-205">**Figure 3**: The E-Mail Notification Includes the Exception Details YSOD As An Attachment</span></span>  
<span data-ttu-id="ab5ec-206">([Haga clic aquí para ver la imagen a tamaño completo](processing-unhandled-exceptions-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="ab5ec-206">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="ab5ec-207">¿Qué ocurre con la página de Error personalizado?</span><span class="sxs-lookup"><span data-stu-id="ab5ec-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="ab5ec-208">Este tutorial ha mostrado cómo usar `Global.asax` y `Application_Error` controlador de eventos para ejecutar código cuando se produce una excepción no controlada.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="ab5ec-209">En concreto, se utiliza este controlador de eventos para notificar a un desarrollador de un error; podríamos ampliarlo para registrar también los detalles del error en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="ab5ec-210">La presencia de la `Application_Error` controlador de eventos no afecta a la experiencia del usuario final.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="ab5ec-211">Todavía verán la página de error configurado, ya sea la YSOD detalles del Error, el YSOD de Error en tiempo de ejecución o la página de error personalizado.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="ab5ec-212">Es natural que se pregunte si el `Global.asax` archivo y `Application_Error` eventos es necesario cuando se utiliza una página de error personalizada.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="ab5ec-213">Cuando se produce un error, el usuario se muestra la página de error personalizada por lo tanto ¿por qué no se coloque el código para notificar al desarrollador y registrar los detalles del error en la clase de código subyacente de la página de error personalizada?</span><span class="sxs-lookup"><span data-stu-id="ab5ec-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="ab5ec-214">Mientras que por supuesto, puede agregar código a la clase de código subyacente de la página de error personalizado no tiene acceso a los detalles de la excepción que desencadenó la `Error` eventos cuando se utiliza la técnica que se explora en el tutorial anterior.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="ab5ec-215">Llamar a la `GetLastError` método desde la página de error personalizado devuelve `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="ab5ec-216">El motivo de este comportamiento es porque se alcanza la página de error personalizada a través de una redirección.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="ab5ec-217">Cuando una excepción no controlada alcanza el tiempo de ejecución ASP.NET que el motor ASP.NET genera su `Error` evento (que se ejecuta el `Application_Error` controlador de eventos) y, a continuación, *redirige* al usuario a la página de error personalizado mediante la emisión de un `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="ab5ec-218">El `Response.Redirect` método envía una respuesta al cliente con un código de estado HTTP 302, que indica el explorador para solicitar una nueva dirección URL, es decir, la página de error personalizado.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="ab5ec-219">A continuación, el explorador solicita automáticamente esta nueva página.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="ab5ec-220">Puede indicar que la página de error personalizada solicitada por separado desde la página donde se originó el error porque la barra de direcciones del explorador cambia a la URL de la página de error personalizado (vea **figura 4**).</span><span class="sxs-lookup"><span data-stu-id="ab5ec-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image11.png)](processing-unhandled-exceptions-cs/_static/image10.png)

<span data-ttu-id="ab5ec-221">**Figura 4**: cuando se produce un Error, el explorador se redirige a la URL de la página de Error personalizado</span><span class="sxs-lookup"><span data-stu-id="ab5ec-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
<span data-ttu-id="ab5ec-222">([Haga clic aquí para ver la imagen a tamaño completo](processing-unhandled-exceptions-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ab5ec-222">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image12.png))</span></span>

<span data-ttu-id="ab5ec-223">El efecto neto es que la solicitud que se produjo la excepción no controlada finaliza cuando el servidor responde con la redirección HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="ab5ec-224">La solicitud posterior a la página de error personalizada es una solicitud nueva; Llegados a este punto ASP.NET motor ha descartado la información de error y, además, no tiene ninguna manera para asociar la excepción no controlada en la solicitud anterior a la nueva solicitud de la página de error personalizada.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="ab5ec-225">Se trata de por qué `GetLastError` devuelve `null` cuando se llama desde la página de error personalizado.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="ab5ec-226">Sin embargo, es posible que la página de error personalizada que se ejecutan durante la misma solicitud que produjo el error.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="ab5ec-227">El [ `Server.Transfer(url)` ](https://msdn.microsoft.com/en-us/library/system.web.httpserverutility.transfer.aspx) método transfiere la ejecución a la dirección URL especificada y lo procesa en la misma solicitud.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/en-us/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="ab5ec-228">Puede cambiar el código el `Application_Error` controlador de eventos para la clase de código subyacente de la página de error personalizada, reemplazarlo en `Global.asax` con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="ab5ec-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="ab5ec-229">Ahora cuando se produce una excepción no controlada del `Application_Error` controlador de eventos transfiere el control a la página de error personalizado apropiado en función del código de estado HTTP.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="ab5ec-230">Dado que el control se transfiere, la página de error personalizada tiene acceso a la información de excepción no controlada mediante `Server.GetLastError` y puede notificar a un desarrollador del error y los detalles de registro.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="ab5ec-231">El `Server.Transfer` llamada detiene el motor ASP.NET de redirigir al usuario a la página de error personalizado.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="ab5ec-232">En su lugar, se devuelve el contenido de la página de error personalizada como respuesta a la página que generó el error.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="ab5ec-233">Resumen</span><span class="sxs-lookup"><span data-stu-id="ab5ec-233">Summary</span></span>

<span data-ttu-id="ab5ec-234">Cuando se produce una excepción no controlada en una aplicación web ASP.NET en tiempo de ejecución ASP.NET genera el `Error` eventos y muestra la página de error configurado.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="ab5ec-235">Podemos notificar el desarrollador del error, los detalles de registro o procesar de otra forma, mediante la creación de un controlador de eventos para el evento de Error.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="ab5ec-236">Hay dos maneras de crear un controlador de eventos para `HttpApplication` eventos como `Error`: en el `Global.asax` archivo o desde un módulo HTTP.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="ab5ec-237">Este tutorial ha mostrado cómo crear un `Error` controlador de eventos en el `Global.asax` archivo que notifica a los desarrolladores de un error por medio de un mensaje de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an e-mail message.</span></span>

<span data-ttu-id="ab5ec-238">Crear un `Error` es útil si tiene que procesar las excepciones no controladas de alguna manera personalizada o un único controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="ab5ec-239">Sin embargo, crear su propio `Error` controlador de eventos para registrar la excepción o para notificar a un desarrollador no es el uso más eficaz del tiempo como ya existen las bibliotecas de registro de error gratuito y fácil de usar que se puede configurar en cuestión de minutos.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="ab5ec-240">Los siguientes dos tutoriales examinan dos de estas bibliotecas.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="ab5ec-241">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="ab5ec-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="ab5ec-242">Información adicional</span><span class="sxs-lookup"><span data-stu-id="ab5ec-242">Further Reading</span></span>

<span data-ttu-id="ab5ec-243">Para obtener más información sobre los temas tratados en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="ab5ec-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="ab5ec-244">Información general de los controladores HTTP y módulos HTTP de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ab5ec-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="ab5ec-245">Responde correctamente a las excepciones no controladas - procesar las excepciones no controladas</span><span class="sxs-lookup"><span data-stu-id="ab5ec-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="ab5ec-246">`HttpApplication`Clase y el objeto de aplicación de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ab5ec-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="ab5ec-247">Controladores HTTP y módulos HTTP de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ab5ec-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="ab5ec-248">Enviar correo electrónico en ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ab5ec-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="ab5ec-249">Descripción de la `Global.asax` archivo</span><span class="sxs-lookup"><span data-stu-id="ab5ec-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="ab5ec-250">Usar módulos HTTP y controladores para crear componentes ASP.NET conectables</span><span class="sxs-lookup"><span data-stu-id="ab5ec-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/en-us/library/aa479332.aspx)
- [<span data-ttu-id="ab5ec-251">Trabajar con ASP.NET `Global.asax` archivo</span><span class="sxs-lookup"><span data-stu-id="ab5ec-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="ab5ec-252">Trabajar con `HttpApplication` instancias</span><span class="sxs-lookup"><span data-stu-id="ab5ec-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/en-us/library/a0xez8f2.aspx)

>[!div class="step-by-step"]
<span data-ttu-id="ab5ec-253">[Anterior](displaying-a-custom-error-page-cs.md)
[Siguiente](logging-error-details-with-asp-net-health-monitoring-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ab5ec-253">[Previous](displaying-a-custom-error-page-cs.md)
[Next](logging-error-details-with-asp-net-health-monitoring-cs.md)</span></span>
