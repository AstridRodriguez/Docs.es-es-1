---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-cs
title: Crear y administrar Roles (C#) | Documentos de Microsoft
author: rick-anderson
description: "Este tutorial examina los pasos necesarios para configurar el marco de trabajo de Roles. A continuación, crearemos páginas web para crear y eliminar roles."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/24/2008
ms.topic: article
ms.assetid: 113f10b3-a19a-471b-8ff6-db3c79ce8a91
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-cs
msc.type: authoredcontent
ms.openlocfilehash: b2b13a2a3b242877060aaec2257b2a742ac8d674
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/24/2018
---
<a name="creating-and-managing-roles-c"></a><span data-ttu-id="9c63d-104">Crear y administrar Roles (C#)</span><span class="sxs-lookup"><span data-stu-id="9c63d-104">Creating and Managing Roles (C#)</span></span>
====================
<span data-ttu-id="9c63d-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9c63d-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9c63d-106">[Descargar código](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.09.zip) o [descarga de PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="9c63d-106">[Download Code](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.09.zip) or [Download PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_cs.pdf)</span></span>

> <span data-ttu-id="9c63d-107">Este tutorial examina los pasos necesarios para configurar el marco de trabajo de Roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="9c63d-108">A continuación, crearemos páginas web para crear y eliminar roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-108">Following that, we will build web pages to create and delete roles.</span></span>


## <a name="introduction"></a><span data-ttu-id="9c63d-109">Introducción</span><span class="sxs-lookup"><span data-stu-id="9c63d-109">Introduction</span></span>

<span data-ttu-id="9c63d-110">En el <a id="_msoanchor_1"> </a> [ *autorización basada en usuario* ](../membership/user-based-authorization-cs.md) tutorial se examinó el uso de autorizaciones de direcciones URL para impedir que determinados usuarios de un conjunto de páginas y explorado declarativa y técnicas de programación para ajustar la funcionalidad de una página ASP.NET según el usuario visitante.</span><span class="sxs-lookup"><span data-stu-id="9c63d-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="9c63d-111">Conceder el permiso de acceso a la página o la funcionalidad de forma por usuario, sin embargo, puede convertirse en una pesadilla de mantenimiento en escenarios donde hay muchas cuentas de usuario o cuando los privilegios de los usuarios cambian con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="9c63d-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="9c63d-112">Siempre que un usuario obtiene o pierde la autorización para realizar una tarea determinada, el administrador debe actualizar las reglas de autorización de dirección URL adecuadas, el marcado declarativo y el código.</span><span class="sxs-lookup"><span data-stu-id="9c63d-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="9c63d-113">Normalmente es útil para clasificar a los usuarios en los grupos o *roles* y, a continuación, aplicar permisos según una función por función.</span><span class="sxs-lookup"><span data-stu-id="9c63d-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="9c63d-114">Por ejemplo, la mayoría de las aplicaciones web tiene un determinado conjunto de páginas o tareas que se han reservado solo para los usuarios administrativos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="9c63d-115">Mediante las técnicas que aprendió en el *autorización basada en usuario* tutorial, se agregaría el reglas de autorización de dirección URL adecuadas, el marcado declarativo y el código para permitir que las cuentas de usuario especificado realizar tareas administrativas.</span><span class="sxs-lookup"><span data-stu-id="9c63d-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="9c63d-116">Pero si se agregó un nuevo administrador o administrador existente necesaria para que sus derechos de administración revocados, se tendría que devolver y actualizar los archivos de configuración y páginas web.</span><span class="sxs-lookup"><span data-stu-id="9c63d-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="9c63d-117">Sin embargo, con roles, se podríamos crear una función que llama a los administradores y asignar los usuarios de confianza a la función de los administradores.</span><span class="sxs-lookup"><span data-stu-id="9c63d-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="9c63d-118">A continuación, se agregaría el reglas de autorización de dirección URL adecuadas, el marcado declarativo y el código para permitir que el rol de administradores realizar las diversas tareas administrativas.</span><span class="sxs-lookup"><span data-stu-id="9c63d-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="9c63d-119">Con esta infraestructura en su lugar, es tan sencillo como incluir o quitar el usuario de la función Administradores de agregar nuevos administradores para el sitio o eliminar los existentes.</span><span class="sxs-lookup"><span data-stu-id="9c63d-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="9c63d-120">Ninguna configuración, marcado declarativo o cambios de código son necesarios.</span><span class="sxs-lookup"><span data-stu-id="9c63d-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="9c63d-121">ASP.NET proporciona un marco de Roles para definir roles y asociarlos con las cuentas de usuario.</span><span class="sxs-lookup"><span data-stu-id="9c63d-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="9c63d-122">Con el marco de trabajo de Roles podemos crear y eliminar roles, agregar usuarios a o quitar usuarios de un rol y determinar el conjunto de usuarios que pertenecen a un rol determinado y saber si un usuario pertenece a un rol determinado.</span><span class="sxs-lookup"><span data-stu-id="9c63d-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="9c63d-123">Una vez que se ha configurado el marco de trabajo de Roles, se podemos limitar el acceso a las páginas según una función por función a través de las reglas de autorización de dirección URL y mostrar u ocultar información adicional o funcionalidad en una página basada en roles del usuario ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="9c63d-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="9c63d-124">Este tutorial examina los pasos necesarios para configurar el marco de trabajo de Roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="9c63d-125">A continuación, crearemos páginas web para crear y eliminar roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="9c63d-126">En el <a id="_msoanchor_2"> </a> [ *asignar Roles a los usuarios* ](assigning-roles-to-users-cs.md) tutorial, veremos cómo agregar y quitar usuarios de roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-cs.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="9c63d-127">Y en el <a id="_msoanchor_3"> </a> [ *autorización basada en roles* ](role-based-authorization-cs.md) tutorial veremos cómo limitar el acceso a las páginas según una función por función junto con cómo se ajusta dependiendo de la funcionalidad en la página en función del usuario visitando.</span><span class="sxs-lookup"><span data-stu-id="9c63d-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="9c63d-128">Comencemos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="9c63d-129">Paso 1: Agregar nuevas páginas ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9c63d-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="9c63d-130">En este tutorial y los dos siguientes analizaremos diversas funciones relacionadas con las funciones y capacidades.</span><span class="sxs-lookup"><span data-stu-id="9c63d-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="9c63d-131">Necesitamos una serie de páginas ASP.NET que se va a implementar en los temas que se examinan a lo largo de estos tutoriales.</span><span class="sxs-lookup"><span data-stu-id="9c63d-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="9c63d-132">Vamos a crear estas páginas y actualizar el mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="9c63d-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="9c63d-133">Empiece por crear una nueva carpeta en el proyecto denominado `Roles`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="9c63d-134">A continuación, agregar cuatro nuevas páginas ASP.NET para la `Roles` carpeta, vincular cada página con el `Site.master` página maestra.</span><span class="sxs-lookup"><span data-stu-id="9c63d-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="9c63d-135">Nombre de las páginas:</span><span class="sxs-lookup"><span data-stu-id="9c63d-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="9c63d-136">En este momento, el Explorador de soluciones del proyecto debe ser similar a la pantalla se muestra en la figura 1.</span><span class="sxs-lookup"><span data-stu-id="9c63d-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>


<span data-ttu-id="9c63d-137">[![Se agregaron cuatro nuevas páginas a la carpeta Roles](creating-and-managing-roles-cs/_static/image2.png)](creating-and-managing-roles-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9c63d-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-cs/_static/image2.png)](creating-and-managing-roles-cs/_static/image1.png)</span></span>

<span data-ttu-id="9c63d-138">**Figura 1**: cuatro nuevas páginas se han agregado a la `Roles` carpeta ([haga clic aquí para ver la imagen a tamaño completo](creating-and-managing-roles-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9c63d-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image3.png))</span></span>


<span data-ttu-id="9c63d-139">Cada página en este punto, debe tener los dos controles de contenido, uno para cada uno de ContentPlaceHolders la página maestra: `MainContent` y `LoginContent`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample1.aspx)]

<span data-ttu-id="9c63d-140">Recuerde que el `LoginContent` marcado de forma predeterminada del ContentPlaceHolder muestra un vínculo para iniciar sesión o cerrar la sesión del sitio, dependiendo de si el usuario está autenticado.</span><span class="sxs-lookup"><span data-stu-id="9c63d-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="9c63d-141">La presencia de la `Content2` contenido de control en la página ASP.NET, sin embargo, invalida el marcado de la página maestra predeterminada.</span><span class="sxs-lookup"><span data-stu-id="9c63d-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="9c63d-142">Como se explicó en <a id="_msoanchor_4"> </a> [ *una visión general de autenticación mediante formularios* ](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, reemplazar el código predeterminado es útil en las páginas donde no queremos mostrar relacionados con el inicio de sesión opciones en la columna izquierda.</span><span class="sxs-lookup"><span data-stu-id="9c63d-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="9c63d-143">Para estos cuatro páginas, sin embargo, queremos que aparezca marcado de la página maestra predeterminada para el `LoginContent` ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="9c63d-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="9c63d-144">Por lo tanto, quite el marcado declarativo para la `Content2` control de contenido.</span><span class="sxs-lookup"><span data-stu-id="9c63d-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="9c63d-145">Una vez hecho esto, cada uno de los cuatro marcado de la página debe contener un solo control de contenido.</span><span class="sxs-lookup"><span data-stu-id="9c63d-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="9c63d-146">Por último, vamos a actualizar el mapa del sitio (`Web.sitemap`) para incluir estas nuevas páginas web.</span><span class="sxs-lookup"><span data-stu-id="9c63d-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="9c63d-147">Agregue el siguiente código XML después de la `<siteMapNode>` hemos agregado para los tutoriales de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="9c63d-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample2.xml)]

<span data-ttu-id="9c63d-148">Con el mapa del sitio actualizado, visite el sitio a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="9c63d-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="9c63d-149">Como se muestra en la figura 2, la navegación de la izquierda incluye elementos para los tutoriales de Roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>


<span data-ttu-id="9c63d-150">[![Se agregaron cuatro nuevas páginas a la carpeta Roles](creating-and-managing-roles-cs/_static/image5.png)](creating-and-managing-roles-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9c63d-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-cs/_static/image5.png)](creating-and-managing-roles-cs/_static/image4.png)</span></span>

<span data-ttu-id="9c63d-151">**Figura 2**: cuatro nuevas páginas se han agregado a la `Roles` carpeta ([haga clic aquí para ver la imagen a tamaño completo](creating-and-managing-roles-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9c63d-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image6.png))</span></span>


## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="9c63d-152">Paso 2: Especificar y configurar el proveedor de Framework de Roles</span><span class="sxs-lookup"><span data-stu-id="9c63d-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="9c63d-153">Al igual que el marco de trabajo de pertenencia, el marco de Roles se basa sobre el modelo de proveedor.</span><span class="sxs-lookup"><span data-stu-id="9c63d-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="9c63d-154">Como se describe en el <a id="_msoanchor_5"> </a> [ *principios básicos de seguridad y compatibilidad con ASP.NET* ](../introduction/security-basics-and-asp-net-support-cs.md) tutorial, .NET Framework incluye tres proveedores de funciones integrados: [ `AuthorizationStoreRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx) , [ `WindowsTokenRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), y [ `SqlRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c63d-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-cs.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="9c63d-155">Esta serie de tutoriales se centra en la `SqlRoleProvider`, que utiliza una base de datos de Microsoft SQL Server como almacén de roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="9c63d-156">Interiormente el marco de trabajo de Roles y `SqlRoleProvider` funcionan igual que el marco de trabajo de pertenencia y `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="9c63d-157">.NET Framework contiene un `Roles` clase que actúa como la API para el marco de trabajo de Roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="9c63d-158">El `Roles` clase tiene métodos estáticos como `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="9c63d-158">The `Roles` class has static methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="9c63d-159">Cuando se invoca uno de estos métodos, el `Roles` clase delega la llamada a los proveedores configurados.</span><span class="sxs-lookup"><span data-stu-id="9c63d-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="9c63d-160">El `SqlRoleProvider` funciona con las tablas específicas de las funciones (`aspnet_Roles` y `aspnet_UsersInRoles`) en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="9c63d-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="9c63d-161">Para poder usar el `SqlRoleProvider` proveedor en nuestra aplicación, es preciso especificar qué base de datos que se usará como el almacén.</span><span class="sxs-lookup"><span data-stu-id="9c63d-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="9c63d-162">El `SqlRoleProvider` espera tener determinadas tablas de base de datos, vistas y procedimientos almacenados en el almacén de rol especificado.</span><span class="sxs-lookup"><span data-stu-id="9c63d-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="9c63d-163">Estos objetos de base de datos necesarios se pueden agregar utilizando la [ `aspnet_regsql.exe` herramienta](https://msdn.microsoft.com/library/ms229862.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c63d-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="9c63d-164">En este momento ya tenemos una base de datos con el esquema necesario para el `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="9c63d-165">En el <a id="_msoanchor_6"> </a> [ *crear el esquema de pertenencia en SQL Server* ](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial hemos creado una base de datos denominada `SecurityTutorials.mdf` y usar `aspnet_regsql.exe` para agregar la aplicación servicios, que incluye los objetos de base de datos requeridos por la `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="9c63d-166">Por lo tanto, solo es necesario indicar al marco de Roles para habilitar la compatibilidad con el rol y usar el `SqlRoleProvider` con el `SecurityTutorials.mdf` base de datos como el almacén de roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="9c63d-167">El marco de trabajo de Roles se configura mediante la &lt; `roleManager` &gt; elemento de la aplicación `Web.config` archivo.</span><span class="sxs-lookup"><span data-stu-id="9c63d-167">The Roles framework is configured via the &lt;`roleManager`&gt; element in the application's `Web.config` file.</span></span> <span data-ttu-id="9c63d-168">De forma predeterminada, está deshabilitada la compatibilidad con el rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-168">By default, role support is disabled.</span></span> <span data-ttu-id="9c63d-169">Para habilitarla, debe establecer el [ &lt; `roleManager` &gt; ](https://msdn.microsoft.com/library/ms164660.aspx) del elemento `enabled` atribuir a `true` así:</span><span class="sxs-lookup"><span data-stu-id="9c63d-169">To enable it, you must set the [&lt;`roleManager`&gt;](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample3.xml)]

<span data-ttu-id="9c63d-170">De forma predeterminada, todas las aplicaciones web tienen un proveedor de Roles denominado `AspNetSqlRoleProvider` de tipo `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="9c63d-171">Este proveedor predeterminado está registrado en `machine.config` (ubicado en `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span><span class="sxs-lookup"><span data-stu-id="9c63d-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample4.xml)]

<span data-ttu-id="9c63d-172">El proveedor `connectionStringName` atributo especifica el almacén de roles que se utiliza.</span><span class="sxs-lookup"><span data-stu-id="9c63d-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="9c63d-173">El `AspNetSqlRoleProvider` proveedor establece este atributo en `LocalSqlServer`, que también se define en `machine.config` puntos y, de forma predeterminada, una base de datos de SQL Server 2005 Express Edition en el `App_Data` carpeta denominada `aspnet.mdf`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="9c63d-174">Por lo tanto, si se habilita simplemente el marco de trabajo de funciones sin especificar ninguna información de proveedor en nuestra aplicación `Web.config` archivo, la aplicación utiliza el proveedor de Roles predeterminado registrado, `AspNetSqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="9c63d-175">Si el `~/App_Data/aspnet.mdf` base de datos no existe, el tiempo de ejecución ASP.NET creará automáticamente y agregue el esquema de servicios de aplicación.</span><span class="sxs-lookup"><span data-stu-id="9c63d-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="9c63d-176">Sin embargo, no queremos usar el `aspnet.mdf` base de datos; en su lugar, desea usar el `SecurityTutorials.mdf` base de datos que ya hemos creado y agrega el esquema de servicios de aplicación para.</span><span class="sxs-lookup"><span data-stu-id="9c63d-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="9c63d-177">Esta modificación puede realizarse de dos maneras:</span><span class="sxs-lookup"><span data-stu-id="9c63d-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="9c63d-178">**Especifique un valor para el****`LocalSqlServer`****nombre de cadena de conexión en****`Web.config`****.**</span><span class="sxs-lookup"><span data-stu-id="9c63d-178">**Specify a value for the****`LocalSqlServer`****connection string name in****`Web.config`****.**</span></span> <span data-ttu-id="9c63d-179">Sobrescribiendo el `LocalSqlServer` valor de nombre de la cadena de conexión en `Web.config`, podemos utilizar el proveedor de Roles predeterminado registrado (`AspNetSqlRoleProvider`) y hacer que funcione correctamente con el `SecurityTutorials.mdf` base de datos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="9c63d-180">Para obtener más información sobre esta técnica, consulte [Scott Guthrie](https://weblogs.asp.net/scottgu/)de entrada de blog, [configurar servicios de aplicación de ASP.NET 2.0 para utilizar SQL Server 2000 o SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c63d-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="9c63d-181">**Agregar un nuevo proveedor registrado del tipo****`SqlRoleProvider`****y configurar su****`connectionStringName`****configuración para que apunte a la****`SecurityTutorials.mdf`****base de datos.**</span><span class="sxs-lookup"><span data-stu-id="9c63d-181">**Add a new registered provider of type****`SqlRoleProvider`****and configure its****`connectionStringName`****setting to point to the****`SecurityTutorials.mdf`****database.**</span></span> <span data-ttu-id="9c63d-182">Éste es el enfoque recomienda y se utiliza en el <a id="_msoanchor_7"></a>[*crear el esquema de pertenencia en SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial y es el enfoque que usará en este tutorial también.</span><span class="sxs-lookup"><span data-stu-id="9c63d-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="9c63d-183">Agregue el siguiente marcado de configuración de Roles para la `Web.config` archivo.</span><span class="sxs-lookup"><span data-stu-id="9c63d-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="9c63d-184">Este marcado registra un proveedor nuevo denominado `SecurityTutorialsSqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider`.</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample5.xml)]

<span data-ttu-id="9c63d-185">El marcado anterior define la `SecurityTutorialsSqlRoleProvider` como proveedor predeterminado (a través de la `defaultProvider` atributo el `<roleManager>` elemento).</span><span class="sxs-lookup"><span data-stu-id="9c63d-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="9c63d-186">También establece la `SecurityTutorialsSqlRoleProvider`del `applicationName` si se establece en `SecurityTutorials`, que es el mismo `applicationName` valor utilizado por el proveedor de pertenencia (`SecurityTutorialsSqlMembershipProvider`).</span><span class="sxs-lookup"><span data-stu-id="9c63d-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="9c63d-187">Mientras no se muestra aquí, el [ `<add>` elemento](https://msdn.microsoft.com/library/ms164662.aspx) para el `SqlRoleProvider` también puede contener una `commandTimeout` atributo para especificar la duración de tiempo de espera de la base de datos, en segundos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="9c63d-188">El valor predeterminado es 30.</span><span class="sxs-lookup"><span data-stu-id="9c63d-188">The default value is 30.</span></span>

<span data-ttu-id="9c63d-189">Con esta marca de configuración en su lugar, estamos preparados para empezar a usar la funcionalidad de rol dentro de nuestra aplicación.</span><span class="sxs-lookup"><span data-stu-id="9c63d-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="9c63d-190">El marcado de la configuración anterior se muestra cómo utilizar el &lt; `roleManager` &gt; del elemento `enabled` y `defaultProvider` atributos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-190">The above configuration markup illustrates using the &lt;`roleManager`&gt; element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="9c63d-191">Hay una serie de otros atributos que afectan al modo en que el marco de trabajo de Roles asocia información de funciones de usuario por usuario.</span><span class="sxs-lookup"><span data-stu-id="9c63d-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="9c63d-192">Examinaremos esta configuración en el <a id="_msoanchor_8"> </a> [ *autorización basada en roles* ](role-based-authorization-cs.md) tutorial.</span><span class="sxs-lookup"><span data-stu-id="9c63d-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial.</span></span>


## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="9c63d-193">Paso 3: Examinar las funciones de API</span><span class="sxs-lookup"><span data-stu-id="9c63d-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="9c63d-194">Funcionalidad de las funciones del marco de trabajo se expone a través de la [ `Roles` clase](https://msdn.microsoft.com/library/system.web.security.roles.aspx), que contiene métodos estáticos trece para realizar operaciones basadas en rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen static methods for performing role-based operations.</span></span> <span data-ttu-id="9c63d-195">Cuando miramos creación y eliminación de roles en los pasos 4 y 6 se usará el [ `CreateRole` ](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) y [ `DeleteRole` ](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) métodos, que agregar o quitar un rol del sistema.</span><span class="sxs-lookup"><span data-stu-id="9c63d-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="9c63d-196">Para obtener una lista de todos los roles en el sistema, use la [ `GetAllRoles` método](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (vea el paso 5).</span><span class="sxs-lookup"><span data-stu-id="9c63d-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="9c63d-197">El [ `RoleExists` método](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) devuelve un valor booleano que indica si existe un rol especificado.</span><span class="sxs-lookup"><span data-stu-id="9c63d-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="9c63d-198">En el siguiente tutorial examinaremos cómo asociar usuarios a roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="9c63d-199">El `Roles` la clase [ `AddUserToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [ `AddUserToRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [ `AddUsersToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), y [ `AddUsersToRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) métodos de agregan uno o más usuarios a uno o varios roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="9c63d-200">Para quitar los usuarios de roles, use la [ `RemoveUserFromRole` ](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [ `RemoveUserFromRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [ `RemoveUsersFromRole` ](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), o [ `RemoveUsersFromRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) métodos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="9c63d-201">En el <a id="_msoanchor_9"> </a> [ *autorización basada en roles* ](role-based-authorization-cs.md) tutorial veremos formas para mostrar u ocultar según la función del usuario actualmente registrado en la funcionalidad de mediante programación.</span><span class="sxs-lookup"><span data-stu-id="9c63d-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="9c63d-202">Para ello, podemos usar la `Role` la clase [ `FindUsersInRole` ](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [ `GetRolesForUser` ](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [ `GetUsersInRole` ](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), o [ `IsUserInRole` ](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) métodos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-202">To accomplish this, we can use the `Role` class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="9c63d-203">Tenga en cuenta que se invoca siempre que uno de estos métodos, el `Roles` clase delega la llamada a los proveedores configurados.</span><span class="sxs-lookup"><span data-stu-id="9c63d-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="9c63d-204">En nuestro caso, esto significa que la llamada se están enviando a la `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="9c63d-205">El `SqlRoleProvider` , a continuación, realiza la operación de base de datos adecuada en función del método invocado.</span><span class="sxs-lookup"><span data-stu-id="9c63d-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="9c63d-206">Por ejemplo, el código `Roles.CreateRole("Administrators")` da como resultado la `SqlRoleProvider` ejecutando el `aspnet_Roles_CreateRole` procedimiento almacenado, que inserta un nuevo registro en el `aspnet_Roles` tabla con el nombre de los administradores.</span><span class="sxs-lookup"><span data-stu-id="9c63d-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>


<span data-ttu-id="9c63d-207">El resto de este tutorial se examina utilizando la `Roles` la clase `CreateRole`, `GetAllRoles`, y `DeleteRole` métodos para administrar los roles en el sistema.</span><span class="sxs-lookup"><span data-stu-id="9c63d-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="9c63d-208">Paso 4: Crear nuevos Roles</span><span class="sxs-lookup"><span data-stu-id="9c63d-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="9c63d-209">Roles proporcionan una manera arbitrariamente los usuarios del grupo y normalmente se utiliza esta agrupación de una manera más conveniente aplicar las reglas de autorización.</span><span class="sxs-lookup"><span data-stu-id="9c63d-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="9c63d-210">Pero para poder usar funciones como un mecanismo de autorización, primero hay que definir qué roles existen en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9c63d-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="9c63d-211">Por desgracia, ASP.NET no incluye un control CreateRoleWizard.</span><span class="sxs-lookup"><span data-stu-id="9c63d-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="9c63d-212">Para agregar nuevas funciones necesitamos crear una interfaz de usuario adecuado e invocar la API de Roles nosotros mismos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="9c63d-213">Lo bueno es que es muy fácil llevar a cabo.</span><span class="sxs-lookup"><span data-stu-id="9c63d-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="9c63d-214">Aunque no hay ningún control CreateRoleWizard Web, hay la [herramienta de administración de sitios Web de ASP.NET](https://msdn.microsoft.com/library/ms228053.aspx), que es una aplicación ASP.NET local diseñada para ayudar a ver y administrar la configuración de su aplicación web.</span><span class="sxs-lookup"><span data-stu-id="9c63d-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="9c63d-215">Sin embargo, no soy un ventilador grande de la herramienta de administración de sitios Web de ASP.NET por dos motivos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="9c63d-216">En primer lugar, es un poco con errores y la experiencia del usuario deja un lote al que se desee.</span><span class="sxs-lookup"><span data-stu-id="9c63d-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="9c63d-217">En segundo lugar, la herramienta de administración de sitios Web de ASP.NET está diseñada para que funcione sólo localmente, lo que significa que tendrá que crear su propio rol páginas web de administración si tiene que administrar roles en un sitio en vivo de forma remota.</span><span class="sxs-lookup"><span data-stu-id="9c63d-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="9c63d-218">Por estos dos motivos, este tutorial y la siguiente instrucción se centrarán en crear el rol es necesario herramientas de administración en una página web, en lugar de depender de la herramienta de administración de sitios Web de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9c63d-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>


<span data-ttu-id="9c63d-219">Abra la `ManageRoles.aspx` página en el `Roles` carpeta y agregue un cuadro de texto y un control Button Web a la página.</span><span class="sxs-lookup"><span data-stu-id="9c63d-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="9c63d-220">Establecer el control de cuadro de texto `ID` propiedad `RoleName` y el botón `ID` y `Text` propiedades para `CreateRoleButton` y Create Role, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="9c63d-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="9c63d-221">En este momento, el marcado declarativo de la página debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="9c63d-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample6.aspx)]

<span data-ttu-id="9c63d-222">A continuación, haga doble clic en el `CreateRoleButton` botón control en el diseñador para crear un `Click` controlador de eventos y, a continuación, agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="9c63d-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample7.cs)]

<span data-ttu-id="9c63d-223">El código anterior inicia asignando el nombre de rol recortada especificado en el `RoleName` cuadro de texto para el `newRoleName` variable.</span><span class="sxs-lookup"><span data-stu-id="9c63d-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="9c63d-224">Después, el `Roles` la clase `RoleExists` método se llama para determinar si el rol `newRoleName` ya existe en el sistema.</span><span class="sxs-lookup"><span data-stu-id="9c63d-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="9c63d-225">Si el rol no existe, se crea mediante una llamada a la `CreateRole` método.</span><span class="sxs-lookup"><span data-stu-id="9c63d-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="9c63d-226">Si el `CreateRole` método se pasa un nombre de rol que ya existe en el sistema, un `ProviderException` se produce la excepción.</span><span class="sxs-lookup"><span data-stu-id="9c63d-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="9c63d-227">Por lo tanto, el código comprueba en primer lugar para asegurarse de que el rol no existe ya en el sistema antes de llamar a `CreateRole`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="9c63d-228">El `Click` controlador de eventos concluya borrando la `RoleName` del cuadro de texto `Text` propiedad.</span><span class="sxs-lookup"><span data-stu-id="9c63d-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="9c63d-229">Quizás se pregunte lo que ocurrirá si el usuario no especifica ningún valor en la `RoleName` cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="9c63d-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="9c63d-230">Si el valor pasado en el `CreateRole` método es `null` o se produce una cadena vacía, una excepción.</span><span class="sxs-lookup"><span data-stu-id="9c63d-230">If the value passed into the `CreateRole` method is `null` or an empty string, an exception is raised.</span></span> <span data-ttu-id="9c63d-231">Del mismo modo, si el nombre de la función contiene una coma, se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="9c63d-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="9c63d-232">Por lo tanto, la página debe contener los controles de validación para asegurarse de que el usuario especifica un rol y que no contiene ninguna coma.</span><span class="sxs-lookup"><span data-stu-id="9c63d-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="9c63d-233">Dejar como un ejercicio para el lector.</span><span class="sxs-lookup"><span data-stu-id="9c63d-233">I leave as an exercise for the reader.</span></span>


<span data-ttu-id="9c63d-234">Vamos a crear un rol denominado Administradores.</span><span class="sxs-lookup"><span data-stu-id="9c63d-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="9c63d-235">Visite la `ManageRoles.aspx` página a través de un explorador, tipos de administradores en el cuadro de texto (consulte la figura 3) y, a continuación, haga clic en el botón Create Role.</span><span class="sxs-lookup"><span data-stu-id="9c63d-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>


<span data-ttu-id="9c63d-236">[![Crear un rol de administradores](creating-and-managing-roles-cs/_static/image8.png)](creating-and-managing-roles-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9c63d-236">[![Create an Administrators Role](creating-and-managing-roles-cs/_static/image8.png)](creating-and-managing-roles-cs/_static/image7.png)</span></span>

<span data-ttu-id="9c63d-237">**Figura 3**: crear un rol de administradores ([haga clic aquí para ver la imagen a tamaño completo](creating-and-managing-roles-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="9c63d-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image9.png))</span></span>


<span data-ttu-id="9c63d-238">¿Qué sucede?</span><span class="sxs-lookup"><span data-stu-id="9c63d-238">What happens?</span></span> <span data-ttu-id="9c63d-239">Se produce un postback, pero no hay ninguna indicación visual que la función realmente se ha agregado al sistema.</span><span class="sxs-lookup"><span data-stu-id="9c63d-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="9c63d-240">Actualizaremos esta página en el paso 5 para incluir comentarios visuales.</span><span class="sxs-lookup"><span data-stu-id="9c63d-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="9c63d-241">Por ahora, sin embargo, puede comprobar que se creó el rol yendo a la `SecurityTutorials.mdf` base de datos y mostrar los datos de la `aspnet_Roles` tabla.</span><span class="sxs-lookup"><span data-stu-id="9c63d-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="9c63d-242">Como se muestra en la figura 4, la `aspnet_Roles` tabla contiene un registro para los roles de administradores recién agregados.</span><span class="sxs-lookup"><span data-stu-id="9c63d-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>


<span data-ttu-id="9c63d-243">[![La tabla aspnet_Roles tiene una fila para los administradores](creating-and-managing-roles-cs/_static/image11.png)](creating-and-managing-roles-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9c63d-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-cs/_static/image11.png)](creating-and-managing-roles-cs/_static/image10.png)</span></span>

<span data-ttu-id="9c63d-244">**Figura 4**: el `aspnet_Roles` tabla tiene una fila para los administradores ([haga clic aquí para ver la imagen a tamaño completo](creating-and-managing-roles-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9c63d-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image12.png))</span></span>


## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="9c63d-245">Paso 5: Mostrar los Roles en el sistema</span><span class="sxs-lookup"><span data-stu-id="9c63d-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="9c63d-246">Vamos a aumentar la `ManageRoles.aspx` página para incluir una lista de los roles actuales en el sistema.</span><span class="sxs-lookup"><span data-stu-id="9c63d-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="9c63d-247">Para ello, agregue un control GridView a la página y establezca su `ID` propiedad `RoleList`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="9c63d-248">A continuación, agregue un método a la clase de código subyacente de la página denominada `DisplayRolesInGrid` utilizando el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="9c63d-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample8.cs)]

<span data-ttu-id="9c63d-249">El `Roles` la clase `GetAllRoles` método devuelve todos los roles del sistema como una matriz de cadenas.</span><span class="sxs-lookup"><span data-stu-id="9c63d-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="9c63d-250">Esta matriz de cadenas, a continuación, se enlaza a la GridView.</span><span class="sxs-lookup"><span data-stu-id="9c63d-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="9c63d-251">Para enlazar la lista de roles en GridView cuando se carga la página por primera vez, debe llamar a la `DisplayRolesInGrid` método desde la página `Page_Load` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="9c63d-252">El código siguiente llama a este método cuando se visita la página por primera vez, pero no en postbacks posteriores.</span><span class="sxs-lookup"><span data-stu-id="9c63d-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample9.cs)]

<span data-ttu-id="9c63d-253">Con este código en su lugar, visite la página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="9c63d-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="9c63d-254">Como se muestra en la figura 5, verá una cuadrícula con una sola columna de la etiqueta de elemento.</span><span class="sxs-lookup"><span data-stu-id="9c63d-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="9c63d-255">La cuadrícula incluye una fila para la función de los administradores que se agrega en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="9c63d-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>


<span data-ttu-id="9c63d-256">[![GridView muestra las funciones en una sola columna](creating-and-managing-roles-cs/_static/image14.png)](creating-and-managing-roles-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9c63d-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-cs/_static/image14.png)](creating-and-managing-roles-cs/_static/image13.png)</span></span>

<span data-ttu-id="9c63d-257">**Figura 5**: GridView muestra las funciones en una sola columna ([haga clic aquí para ver la imagen a tamaño completo](creating-and-managing-roles-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="9c63d-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image15.png))</span></span>


<span data-ttu-id="9c63d-258">GridView muestra una única columna con la etiqueta elemento porque la GridView `AutoGenerateColumns` propiedad está establecida en True (valor predeterminado), lo que hace que el control GridView crear automáticamente una columna para cada propiedad en su `DataSource`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="9c63d-259">Una matriz tiene una propiedad única que representa los elementos de la matriz, por lo tanto, la única columna en GridView.</span><span class="sxs-lookup"><span data-stu-id="9c63d-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="9c63d-260">Para mostrar datos con un control GridView, prefiero definir mi columnas explícitamente en lugar de hacer que se generen implícitamente por el control GridView.</span><span class="sxs-lookup"><span data-stu-id="9c63d-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="9c63d-261">Al definir explícitamente las columnas es mucho más fácil dar formato a los datos, reorganizar las columnas y realizar otras tareas habituales.</span><span class="sxs-lookup"><span data-stu-id="9c63d-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="9c63d-262">Por lo tanto, vamos a actualizar marcado declarativo de GridView para que sus columnas se definen explícitamente.</span><span class="sxs-lookup"><span data-stu-id="9c63d-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="9c63d-263">Empezar configurando la GridView `AutoGenerateColumns` propiedad en False.</span><span class="sxs-lookup"><span data-stu-id="9c63d-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="9c63d-264">A continuación, agregue un TemplateField a la cuadrícula, establezca su `HeaderText` propiedad a los Roles y configurar su `ItemTemplate` para que se muestre el contenido de la matriz.</span><span class="sxs-lookup"><span data-stu-id="9c63d-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="9c63d-265">Para ello, agregue un control de etiqueta Web denominado `RoleNameLabel` a la `ItemTemplate` y enlazar sus `Text` propiedad `Container.DataItem`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem`.</span></span>

<span data-ttu-id="9c63d-266">Estas propiedades y la `ItemTemplate`del contenido se puede establecer mediante declaración o a través de cuadro de diálogo campos de GridView e interfaz editar plantillas.</span><span class="sxs-lookup"><span data-stu-id="9c63d-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="9c63d-267">Para llegar a los campos de cuadro de diálogo, haga clic en el vínculo Editar columnas de etiqueta inteligente de GridView.</span><span class="sxs-lookup"><span data-stu-id="9c63d-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="9c63d-268">A continuación, desactive la casilla de campos de generación automática para establecer el `AutoGenerateColumns` propiedad en False y agregar TemplateField a GridView, estableciendo su `HeaderText` propiedad al rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="9c63d-269">Para definir la `ItemTemplate`del contenido, elija la opción de editar plantillas de etiqueta inteligente de GridView.</span><span class="sxs-lookup"><span data-stu-id="9c63d-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="9c63d-270">Arrastre un control Web Label la `ItemTemplate`, establezca su `ID` propiedad `RoleNameLabel`y configurar la configuración de enlace de datos para que su `Text` propiedad está enlazada a `Container.DataItem`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="9c63d-271">Independientemente de qué método utilizado, marcado declarativo de GridView resultante debe ser similar al siguiente cuando haya terminado.</span><span class="sxs-lookup"><span data-stu-id="9c63d-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="9c63d-272">Contenido de la matriz se muestra utilizando la sintaxis de enlace de datos `<%# Container.DataItem %>`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="9c63d-273">Una descripción detallada de por qué se utiliza esta sintaxis al mostrar el contenido de una matriz enlaza a GridView queda fuera del ámbito de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="9c63d-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="9c63d-274">Para obtener más información sobre este asunto, consulte [una matriz escalar de enlace a un Control Web de datos](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c63d-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>


<span data-ttu-id="9c63d-275">Actualmente, el `RoleList` GridView solo se enlaza a la lista de roles cuando se visita la página por primera vez.</span><span class="sxs-lookup"><span data-stu-id="9c63d-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="9c63d-276">Es necesario actualizar la cuadrícula siempre que se agrega un nuevo rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="9c63d-277">Para ello, actualice el `CreateRoleButton` del botón `Click` controlador de eventos para que llama el `DisplayRolesInGrid` método si se crea un nuevo rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample11.cs)]

<span data-ttu-id="9c63d-278">Ahora, cuando el usuario agrega un nuevo rol de la `RoleList` GridView muestra la función de agregado just en devolución de datos, proporcionar comentarios visuales que el rol se creó correctamente.</span><span class="sxs-lookup"><span data-stu-id="9c63d-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="9c63d-279">Para ilustrar esto, visite la `ManageRoles.aspx` página a través de un explorador y agregue un rol denominado los supervisores.</span><span class="sxs-lookup"><span data-stu-id="9c63d-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="9c63d-280">Al hacer clic en el botón Create Role, surgirán una devolución de datos y la cuadrícula se actualizará para incluir los administradores, así como el nuevo rol, los supervisores.</span><span class="sxs-lookup"><span data-stu-id="9c63d-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>


<span data-ttu-id="9c63d-281">[![El rol de los supervisores tiene ha agregado](creating-and-managing-roles-cs/_static/image17.png)](creating-and-managing-roles-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="9c63d-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-cs/_static/image17.png)](creating-and-managing-roles-cs/_static/image16.png)</span></span>

<span data-ttu-id="9c63d-282">**Figura 6**: el rol de los supervisores se ha agregado ([haga clic aquí para ver la imagen a tamaño completo](creating-and-managing-roles-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9c63d-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image18.png))</span></span>


## <a name="step-6-deleting-roles"></a><span data-ttu-id="9c63d-283">Paso 6: Eliminar Roles</span><span class="sxs-lookup"><span data-stu-id="9c63d-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="9c63d-284">En este momento en que un usuario puede crear un nuevo rol y ver todos los roles existentes de la `ManageRoles.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="9c63d-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="9c63d-285">Vamos a permitir a los usuarios eliminar roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="9c63d-286">El `Roles.DeleteRole` método tiene dos sobrecargas:</span><span class="sxs-lookup"><span data-stu-id="9c63d-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="9c63d-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx)-elimina la función *roleName*.</span><span class="sxs-lookup"><span data-stu-id="9c63d-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="9c63d-288">Se produce una excepción si la función contiene a uno o más miembros.</span><span class="sxs-lookup"><span data-stu-id="9c63d-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="9c63d-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx)-elimina la función *roleName*.</span><span class="sxs-lookup"><span data-stu-id="9c63d-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="9c63d-290">Si *throwOnPopulateRole* es `true`, a continuación, se produce una excepción si la función contiene uno o más miembros.</span><span class="sxs-lookup"><span data-stu-id="9c63d-290">If *throwOnPopulateRole* is `true`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="9c63d-291">Si *throwOnPopulateRole* es `false`, a continuación, se elimina la función si contiene ningún miembro o no.</span><span class="sxs-lookup"><span data-stu-id="9c63d-291">If *throwOnPopulateRole* is `false`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="9c63d-292">Internamente, la `DeleteRole(roleName)` llamadas al método `DeleteRole(roleName, true)`.</span><span class="sxs-lookup"><span data-stu-id="9c63d-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, true)`.</span></span>

<span data-ttu-id="9c63d-293">El `DeleteRole` método también iniciará una excepción si *roleName* es `null` o una cadena vacía o si *roleName* contiene una coma.</span><span class="sxs-lookup"><span data-stu-id="9c63d-293">The `DeleteRole` method will also throw an exception if *roleName* is `null` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="9c63d-294">Si *roleName* no existe en el sistema, `DeleteRole` se produce un error en modo silencioso, sin que se produzca una excepción.</span><span class="sxs-lookup"><span data-stu-id="9c63d-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="9c63d-295">Vamos a aumentar la GridView en `ManageRoles.aspx` para incluir una eliminación botón que, al hacer clic, elimina el rol seleccionado.</span><span class="sxs-lookup"><span data-stu-id="9c63d-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="9c63d-296">Empiece por agregar un botón Eliminar a GridView, vaya al cuadro de diálogo campos y agregar un botón Eliminar, que se encuentra bajo la opción CommandField.</span><span class="sxs-lookup"><span data-stu-id="9c63d-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="9c63d-297">Realizar la eliminación de botón de la columna izquierda y establezca su `DeleteText` propiedad al eliminar rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>


<span data-ttu-id="9c63d-298">[![Agregar un botón Eliminar a RoleList GridView](creating-and-managing-roles-cs/_static/image20.png)](creating-and-managing-roles-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9c63d-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-cs/_static/image20.png)](creating-and-managing-roles-cs/_static/image19.png)</span></span>

<span data-ttu-id="9c63d-299">**Figura 7**: agregar un botón Eliminar para el `RoleList` GridView ([haga clic aquí para ver la imagen a tamaño completo](creating-and-managing-roles-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9c63d-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image21.png))</span></span>


<span data-ttu-id="9c63d-300">Después de agregar el botón Eliminar, marcado declarativo de la GridView debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="9c63d-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample12.aspx)]

<span data-ttu-id="9c63d-301">A continuación, cree un controlador de eventos del control de GridView `RowDeleting` eventos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="9c63d-302">Éste es el evento que se desencadena en la devolución de datos cuando se hace clic en el botón Eliminar rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="9c63d-303">Agregue el siguiente código al controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="9c63d-303">Add the following code to the event handler.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample13.cs)]

<span data-ttu-id="9c63d-304">El código se inicia mediante programación que hacen referencia a la `RoleNameLabel` Web control de la fila cuyo botón Eliminar rol se hizo clic.</span><span class="sxs-lookup"><span data-stu-id="9c63d-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="9c63d-305">El `Roles.DeleteRole` , a continuación, se invoca el método, pasando el `Text` de la `RoleNameLabel` y `false`, con lo que se eliminar el rol independientemente de si hay algún usuario asociado con el rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `false`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="9c63d-306">Por último, el `RoleList` GridView se actualiza para que la función de just-eliminado ya no aparece en la cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="9c63d-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="9c63d-307">El botón Eliminar rol no requiere a ningún tipo de confirmación del usuario antes de eliminar el rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="9c63d-308">Una de las formas más sencillas para confirmar una acción es a través de un cuadro de diálogo de confirmación del lado cliente.</span><span class="sxs-lookup"><span data-stu-id="9c63d-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="9c63d-309">Para obtener más información sobre esta técnica, consulte [Agregar cliente confirmación cuando se elimina](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c63d-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span></span>


## <a name="summary"></a><span data-ttu-id="9c63d-310">Resumen</span><span class="sxs-lookup"><span data-stu-id="9c63d-310">Summary</span></span>

<span data-ttu-id="9c63d-311">Muchas aplicaciones web tienen ciertas reglas de autorización o funcionalidad en el nivel de página que solo está disponible para determinadas clases de usuarios.</span><span class="sxs-lookup"><span data-stu-id="9c63d-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="9c63d-312">Por ejemplo, puede haber un conjunto de páginas web que sólo los administradores pueden tener acceso.</span><span class="sxs-lookup"><span data-stu-id="9c63d-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="9c63d-313">En lugar de definir estas reglas de autorización en forma de usuario por el usuario, a menudo es más útil definir las reglas según un rol.</span><span class="sxs-lookup"><span data-stu-id="9c63d-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="9c63d-314">Es decir, en lugar de permitir explícitamente a los usuarios tener acceso a las páginas web administrativas Scott y Jisun, un enfoque más fácil de mantener permitir que los miembros de la función Administradores para tener acceso a estas páginas y, a continuación, para denotar Scott y Jisun como los usuarios que pertenecen a la Rol de administradores.</span><span class="sxs-lookup"><span data-stu-id="9c63d-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="9c63d-315">El marco de trabajo de funciones resulta muy sencillo crear y administrar roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="9c63d-316">En este tutorial se examina cómo configurar el marco de trabajo de Roles para utilizar el `SqlRoleProvider`, que utiliza una base de datos de Microsoft SQL Server como almacén de roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="9c63d-317">También se crean una página web que se enumeran las funciones existentes en el sistema y permite que se creen nuevas funciones y los existentes se eliminarán.</span><span class="sxs-lookup"><span data-stu-id="9c63d-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="9c63d-318">En los tutoriales posteriores veremos cómo asignar a usuarios a roles y cómo aplicar la autorización basada en roles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="9c63d-319">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="9c63d-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="9c63d-320">Información adicional</span><span class="sxs-lookup"><span data-stu-id="9c63d-320">Further Reading</span></span>

<span data-ttu-id="9c63d-321">Para obtener más información sobre los temas tratados en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="9c63d-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="9c63d-322">Examen de ASP.NET del 2.0 perfil, Roles y pertenencia</span><span class="sxs-lookup"><span data-stu-id="9c63d-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="9c63d-323">Cómo: Utilizar el Administrador de roles en ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="9c63d-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="9c63d-324">Proveedores de funciones</span><span class="sxs-lookup"><span data-stu-id="9c63d-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="9c63d-325">Poner su propia herramienta de administración de sitios Web</span><span class="sxs-lookup"><span data-stu-id="9c63d-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="9c63d-326">Documentación técnica de la `<roleManager>` elemento</span><span class="sxs-lookup"><span data-stu-id="9c63d-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="9c63d-327">Uso de la pertenencia y la API del Administrador de roles</span><span class="sxs-lookup"><span data-stu-id="9c63d-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="9c63d-328">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="9c63d-328">About the Author</span></span>

<span data-ttu-id="9c63d-329">Scott Mitchell, autor de varios libros sobre ASP/ASP.NET y fundador de 4GuysFromRolla.com, ha trabajado con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="9c63d-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9c63d-330">Scott funciona como un consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="9c63d-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9c63d-331">Su último libro es *[SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="9c63d-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="9c63d-332">Puede ponerse en contacto Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) o a través de su blog en [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="9c63d-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="9c63d-333">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="9c63d-333">Special Thanks To</span></span>

<span data-ttu-id="9c63d-334">Esta serie de tutoriales se revisó por varios revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="9c63d-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9c63d-335">Los revisores iniciales para este tutorial incluyen Alicja Maziarz, Suchi Banerjee y Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="9c63d-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="9c63d-336">¿Está interesado en revisar mi próximos artículos MSDN?</span><span class="sxs-lookup"><span data-stu-id="9c63d-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9c63d-337">Si es así, me quitar una línea en[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9c63d-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="9c63d-338">Siguiente</span><span class="sxs-lookup"><span data-stu-id="9c63d-338">Next</span></span>](assigning-roles-to-users-cs.md)
