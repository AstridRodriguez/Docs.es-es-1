---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
title: Almacenar información de usuario adicional (VB) | Documentos de Microsoft
author: rick-anderson
description: En este tutorial se responderá a esta pregunta mediante la creación de una aplicación de libro de visitas muy rudimentarios. Si lo hace, veremos distintas opciones para modeli...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: ee4b924e-8002-4dc3-819f-695fca1ff867
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
msc.type: authoredcontent
ms.openlocfilehash: 9a8673e764ae94b12fbc01f81ef12ea4c133b7d5
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/10/2018
ms.locfileid: "30891986"
---
<a name="storing-additional-user-information-vb"></a><span data-ttu-id="c6eed-104">Almacenar información de usuario adicional (VB)</span><span class="sxs-lookup"><span data-stu-id="c6eed-104">Storing Additional User Information (VB)</span></span>
====================
<span data-ttu-id="c6eed-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c6eed-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c6eed-106">[Descargar código](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip) o [descarga de PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c6eed-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span></span>

> <span data-ttu-id="c6eed-107">En este tutorial se responderá a esta pregunta mediante la creación de una aplicación de libro de visitas muy rudimentarios.</span><span class="sxs-lookup"><span data-stu-id="c6eed-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="c6eed-108">Si lo hace, se consultamos diferentes opciones para el modelado de información de usuario en una base de datos y, a continuación, consulte how to associate estos datos con las cuentas de usuario creado por el marco de trabajo de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="c6eed-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>


## <a name="introduction"></a><span data-ttu-id="c6eed-109">Introducción</span><span class="sxs-lookup"><span data-stu-id="c6eed-109">Introduction</span></span>

<span data-ttu-id="c6eed-110">ASP. Framework de pertenencia de .NET ofrece una interfaz flexible para administrar los usuarios.</span><span class="sxs-lookup"><span data-stu-id="c6eed-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="c6eed-111">La API de pertenencia incluye métodos para validar las credenciales, recuperar información sobre el usuario ha iniciado sesión actualmente, crear una nueva cuenta de usuario y eliminar una cuenta de usuario, entre otros.</span><span class="sxs-lookup"><span data-stu-id="c6eed-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="c6eed-112">Cada cuenta de usuario en el marco de trabajo de pertenencia contiene solo las propiedades necesarias para validar las credenciales y realizar tareas relacionadas con la cuenta de usuario esenciales.</span><span class="sxs-lookup"><span data-stu-id="c6eed-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="c6eed-113">Esto se hace patente en los métodos y propiedades de la [ `MembershipUser` clase](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), que modela una cuenta de usuario en el marco de trabajo de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="c6eed-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="c6eed-114">Esta clase tiene propiedades como [ `UserName` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [ `Email` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), y [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), y métodos como [ `GetPassword` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) y [ `UnlockUser` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6eed-114">This class has properties like [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="c6eed-115">A menudo, las aplicaciones deben almacenar información de usuario adicional que no se incluye en el marco de trabajo de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="c6eed-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="c6eed-116">Por ejemplo, necesite un comerciante en línea para que cada usuario pueda almacenar sus direcciones de envío y facturación, información de pago y las preferencias de entrega y póngase en contacto con el número de teléfono.</span><span class="sxs-lookup"><span data-stu-id="c6eed-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="c6eed-117">Además, cada pedido en el sistema está asociado a una cuenta de usuario determinada.</span><span class="sxs-lookup"><span data-stu-id="c6eed-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="c6eed-118">El `MembershipUser` clase no incluye las propiedades como `PhoneNumber` o `DeliveryPreferences` o `PastOrders`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="c6eed-119">Entonces, ¿cómo se realizar un seguimiento de la información de usuario necesaria para la aplicación y hacer que se integran con el marco de trabajo de la pertenencia a?</span><span class="sxs-lookup"><span data-stu-id="c6eed-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="c6eed-120">En este tutorial se responderá a esta pregunta mediante la creación de una aplicación de libro de visitas muy rudimentarios.</span><span class="sxs-lookup"><span data-stu-id="c6eed-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="c6eed-121">Si lo hace, se consultamos diferentes opciones para el modelado de información de usuario en una base de datos y, a continuación, consulte how to associate estos datos con las cuentas de usuario creado por el marco de trabajo de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="c6eed-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="c6eed-122">Comencemos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="c6eed-123">Paso 1: Crear el modelo de datos de la aplicación libro de visitas</span><span class="sxs-lookup"><span data-stu-id="c6eed-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="c6eed-124">Hay diversas técnicas que se pueden emplear para capturar la información de usuario en una base de datos y asociarlo con las cuentas de usuario creado por el marco de trabajo de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="c6eed-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="c6eed-125">Para ilustrar estas técnicas, necesitaremos intensificar la aplicación web tutorial para que capture a algún tipo de datos relacionados con el usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="c6eed-126">(Actualmente, el modelo de datos de la aplicación contiene solo la aplicación de servicios de las tablas que necesita la `SqlMembershipProvider`.)</span><span class="sxs-lookup"><span data-stu-id="c6eed-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="c6eed-127">Vamos a crear una aplicación de libro de visitas muy simple donde un usuario autenticado puede dejar un comentario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="c6eed-128">Además de almacenar el libro de visitas comentarios, vamos a permitir que cada usuario almacenar su ciudad natal, la página principal y la firma.</span><span class="sxs-lookup"><span data-stu-id="c6eed-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="c6eed-129">Si se proporciona, ciudad natal del usuario, página principal y la firma aparecerá en cada mensaje que ha dejado en el libro de visitas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="c6eed-130">Agregar el`GuestbookComments`tabla</span><span class="sxs-lookup"><span data-stu-id="c6eed-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="c6eed-131">Para capturar los comentarios del libro de visitas, necesitamos crear una tabla de base de datos denominada `GuestbookComments` que tiene columnas como `CommentId`, `Subject`, `Body`, y `CommentDate`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="c6eed-132">También es necesario que cada registro en el `GuestbookComments` referencia al usuario que deja el comentario de la tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="c6eed-133">Para agregar esta tabla a nuestra base de datos, vaya al explorador de base de datos en Visual Studio y explorar en profundidad el `SecurityTutorials` base de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="c6eed-134">Haga doble clic en la carpeta de tablas y elija Agregar nueva tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="c6eed-135">Se abrirá una interfaz que nos permite definir las columnas para la nueva tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-135">This brings up an interface that allows us to define the columns for the new table.</span></span>


<span data-ttu-id="c6eed-136">[![Agregar una nueva tabla a la base de datos SecurityTutorials](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span></span>

<span data-ttu-id="c6eed-137">**Figura 1**: agregar una nueva tabla a la `SecurityTutorials` base de datos ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-vb/_static/image3.png))</span></span>


<span data-ttu-id="c6eed-138">A continuación, defina el `GuestbookComments`de columnas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="c6eed-139">Empiece por agregar una columna denominada `CommentId` de tipo `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="c6eed-140">Esta columna se identificar de forma exclusiva cada comentario en el libro de visitas, por lo que no permitir `NULL` s y marcarla como clave principal de la tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="c6eed-141">En lugar de proporcionar un valor para el `CommentId` campo en cada `INSERT`, podemos indicar que un nuevo `uniqueidentifier` valor se debe generar automáticamente para este campo en `INSERT` estableciendo el valor predeterminado de la columna en `NEWID()`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="c6eed-142">Después de agregar este primer campo, marcarlo como la clave principal y la configuración de su valor predeterminado, la pantalla debe ser similar a la pantalla se muestra en la figura 2.</span><span class="sxs-lookup"><span data-stu-id="c6eed-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>


<span data-ttu-id="c6eed-143">[![Agregar una columna principal denominada CommentId](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span></span>

<span data-ttu-id="c6eed-144">**Figura 2**: agregar una columna principal denomina `CommentId` ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-vb/_static/image6.png))</span></span>


<span data-ttu-id="c6eed-145">A continuación, agregue una columna denominada `Subject` de tipo `nvarchar(50)` y una columna denominada `Body` de tipo `nvarchar(MAX)`, desautorizar `NULL` s en ambas columnas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="c6eed-146">A continuación, agregar una columna denominada `CommentDate` de tipo `datetime`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="c6eed-147">No permitir `NULL` s y establezca el `CommentDate` valor predeterminado de la columna a `getdate()`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="c6eed-148">Todo lo que queda es agregar una columna que se asocia a una cuenta de usuario de cada libro de visitas comentario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="c6eed-149">Sería una opción Agregar una columna denominada `UserName` de tipo `nvarchar(256)`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="c6eed-150">Esto es una opción apropiada cuando se usa un proveedor de pertenencia distinto de la `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="c6eed-151">Pero si se usa el `SqlMembershipProvider`, tal y como se encuentran en esta serie de tutoriales, la `UserName` columna en el `aspnet_Users` tabla no se garantiza que sea único.</span><span class="sxs-lookup"><span data-stu-id="c6eed-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="c6eed-152">El `aspnet_Users` clave principal de la tabla es `UserId` y es del tipo `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="c6eed-153">Por lo tanto, la `GuestbookComments` tabla tiene una columna denominada `UserId` de tipo `uniqueidentifier` (no se permiten `NULL` valores).</span><span class="sxs-lookup"><span data-stu-id="c6eed-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="c6eed-154">Continúe y agregar esta columna.</span><span class="sxs-lookup"><span data-stu-id="c6eed-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="c6eed-155">Como se explicó en la [ *crear el esquema de pertenencia en SQL Server* ](creating-the-membership-schema-in-sql-server-vb.md) tutorial, el marco de trabajo de pertenencia está diseñado para permitir que varias aplicaciones web con distintas cuentas de usuario para que compartan el mismo almacén de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="c6eed-156">Hace esto mediante la partición de las cuentas de usuario en aplicaciones diferentes.</span><span class="sxs-lookup"><span data-stu-id="c6eed-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="c6eed-157">Y mientras se garantiza que cada nombre de usuario que ser únicos dentro de una aplicación, puede usar el mismo nombre de usuario en diferentes aplicaciones usando el mismo almacén de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="c6eed-158">Hay un compuesto `UNIQUE` restricción en la `aspnet_Users` de tabla en la `UserName` y `ApplicationId` campos, pero no en simplemente el `UserName` campo.</span><span class="sxs-lookup"><span data-stu-id="c6eed-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="c6eed-159">Por lo tanto, es posible que aspnet\_tabla a los usuarios tener dos (o más) de los registros con el mismo `UserName` valor.</span><span class="sxs-lookup"><span data-stu-id="c6eed-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="c6eed-160">Sin embargo, hay un `UNIQUE` restricción en la `aspnet_Users` la tabla `UserId` campo (ya que es la clave principal).</span><span class="sxs-lookup"><span data-stu-id="c6eed-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="c6eed-161">A `UNIQUE` restricción es importante porque sin se puede establecer una restricción de clave externa entre la `GuestbookComments` y `aspnet_Users` tablas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>


<span data-ttu-id="c6eed-162">Después de agregar la `UserId` columna, guarde la tabla haciendo clic en el icono Guardar en la barra de herramientas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="c6eed-163">Llame a la nueva tabla `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="c6eed-164">Tenemos un último problema que ocuparse de con el `GuestbookComments` tabla: se necesita crear un [restricción foreign key](https://msdn.microsoft.com/library/ms175464.aspx) entre el `GuestbookComments.UserId` columna y la `aspnet_Users.UserId` columna.</span><span class="sxs-lookup"><span data-stu-id="c6eed-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="c6eed-165">Para ello, haga clic en el icono de relación en la barra de herramientas para iniciar el cuadro de diálogo de relaciones de clave externa.</span><span class="sxs-lookup"><span data-stu-id="c6eed-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="c6eed-166">(Como alternativa, puede iniciar este cuadro de diálogo, en el menú Diseñador de tablas y elija relaciones.)</span><span class="sxs-lookup"><span data-stu-id="c6eed-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="c6eed-167">Haga clic en el botón Agregar en la esquina inferior izquierda del cuadro de diálogo de relaciones de clave externa.</span><span class="sxs-lookup"><span data-stu-id="c6eed-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="c6eed-168">Esto agregará una nueva restricción foreign key, aunque todavía necesitamos definir las tablas que participan en la relación.</span><span class="sxs-lookup"><span data-stu-id="c6eed-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>


<span data-ttu-id="c6eed-169">[![Utilice el cuadro de diálogo de relaciones de clave externa para administrar las restricciones de clave externa de una tabla](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span></span>

<span data-ttu-id="c6eed-170">**Figura 3**: usar el cuadro de diálogo de relaciones de clave externa para administrar las restricciones de clave externa de una tabla ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-vb/_static/image9.png))</span></span>


<span data-ttu-id="c6eed-171">A continuación, haga clic en el icono de botón de puntos suspensivos en la fila "Especificaciones de tablas y columnas" a la derecha.</span><span class="sxs-lookup"><span data-stu-id="c6eed-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="c6eed-172">Esto iniciará el cuadro de diálogo tablas y columnas, desde el que se puede especificar la tabla de clave principal y de columna y de la columna de clave externa de la `GuestbookComments` tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="c6eed-173">En particular, seleccione `aspnet_Users` y `UserId` como la tabla de clave principal y la columna, y `UserId` desde el `GuestbookComments` tabla como columna de clave externa (consulte la figura 4).</span><span class="sxs-lookup"><span data-stu-id="c6eed-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="c6eed-174">Después de definir las tablas de clave principales y externas y columnas, haga clic en Aceptar para volver al cuadro de diálogo de relaciones de clave externa.</span><span class="sxs-lookup"><span data-stu-id="c6eed-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>


<span data-ttu-id="c6eed-175">[![Establecer un Foreign Key restricción entre el aspnet_Users y tablas GuesbookComments](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span></span>

<span data-ttu-id="c6eed-176">**Figura 4**: establecer un Foreign Key restricción entre el `aspnet_Users` y `GuesbookComments` tablas ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image12.png))</span></span>


<span data-ttu-id="c6eed-177">En este momento se ha establecido la restricción foreign key.</span><span class="sxs-lookup"><span data-stu-id="c6eed-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="c6eed-178">La presencia de esta restricción garantiza [integridad relacional](http://en.wikipedia.org/wiki/Referential_integrity) entre las dos tablas al garantizar que nunca habrá una entrada de libro de visitas que hace referencia a una cuenta de usuario no existe.</span><span class="sxs-lookup"><span data-stu-id="c6eed-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="c6eed-179">De forma predeterminada, una restricción foreign key prohibir un registro principal para eliminarse si hay registros secundarios correspondientes.</span><span class="sxs-lookup"><span data-stu-id="c6eed-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="c6eed-180">Es decir, si un usuario realiza uno o más comentarios de libro de visitas y, a continuación, se intenta eliminar la cuenta de usuario, se producirá un error en la eliminación a menos que sus comentarios de libro de visitas se eliminan primero.</span><span class="sxs-lookup"><span data-stu-id="c6eed-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="c6eed-181">Restricciones de clave externa se pueden configurar para que elimine automáticamente los registros secundarios asociados cuando se elimina un registro primario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="c6eed-182">En otras palabras, se puede configurar esta restricción de clave externa para que las entradas de libro de visitas de un usuario se eliminan automáticamente cuando se elimina su cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="c6eed-183">Para lograr esto, expanda la sección "INSERCIÓN y actualización especificación" y establezca la propiedad "Eliminar la regla" en cascada.</span><span class="sxs-lookup"><span data-stu-id="c6eed-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>


<span data-ttu-id="c6eed-184">[![Configurar la restricción Foreign Key para las eliminaciones en cascada](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span></span>

<span data-ttu-id="c6eed-185">**Figura 5**: configurar la restricción de clave externa para eliminaciones en cascada ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-vb/_static/image15.png))</span></span>


<span data-ttu-id="c6eed-186">Para guardar la restricción foreign key, haga clic en el botón Cerrar para salir de las relaciones de clave externa.</span><span class="sxs-lookup"><span data-stu-id="c6eed-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="c6eed-187">A continuación, haga clic en el icono Guardar en la barra de herramientas para guardar la tabla y esta relación.</span><span class="sxs-lookup"><span data-stu-id="c6eed-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="c6eed-188">Almacenar Pueblo principal del usuario, página de inicio y firma</span><span class="sxs-lookup"><span data-stu-id="c6eed-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="c6eed-189">El `GuestbookComments` tabla ilustra cómo almacenar la información que comparte una relación uno a varios con cuentas de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="c6eed-190">Dado que cada cuenta de usuario puede tener un número arbitrario de comentarios asociados, esta relación se modela mediante la creación de una tabla que contenga el conjunto de comentarios que incluye una columna que vínculos copia cada comentario a un usuario determinado.</span><span class="sxs-lookup"><span data-stu-id="c6eed-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="c6eed-191">Cuando se usa el `SqlMembershipProvider`, este vínculo esté establecido mejor mediante la creación de una columna denominada `UserId` de tipo `uniqueidentifier` y una restricción foreign key entre esta columna y `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="c6eed-192">Ahora necesitamos asociar tres columnas con cada cuenta de usuario para almacenar la ciudad natal, página de inicio y firma, que aparecerá en sus libro de visitas comentarios del usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="c6eed-193">Hay números de diferentes formas de lograr esto:</span><span class="sxs-lookup"><span data-stu-id="c6eed-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="c6eed-194"><strong>Agregar nuevas columnas a la</strong><strong>`aspnet_Users`</strong><strong>o</strong><strong>`aspnet_Membership`</strong><strong>tablas.</strong></span><span class="sxs-lookup"><span data-stu-id="c6eed-194"><strong>Add new columns to the</strong><strong>`aspnet_Users`</strong><strong>or</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span></span> <span data-ttu-id="c6eed-195">No recomendamos este enfoque porque modifica el esquema utilizado por el `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="c6eed-196">Esta decisión puede reanudarse en su contra cabeza.</span><span class="sxs-lookup"><span data-stu-id="c6eed-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="c6eed-197">Por ejemplo, ¿qué ocurre si una versión futura de ASP.NET usa otra `SqlMembershipProvider` esquema.</span><span class="sxs-lookup"><span data-stu-id="c6eed-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="c6eed-198">Microsoft puede incluir una herramienta para migrar la versión 2.0 de ASP.NET `SqlMembershipProvider` datos al nuevo esquema, pero si ha modificado la versión 2.0 de ASP.NET `SqlMembershipProvider` esquema, este tipo de conversión puede no ser posible.</span><span class="sxs-lookup"><span data-stu-id="c6eed-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="c6eed-199">**Use ASP. Framework de perfil de .NET, definir una propiedad de perfil para la ciudad natal, la página principal y la firma.**</span><span class="sxs-lookup"><span data-stu-id="c6eed-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="c6eed-200">ASP.NET incluye un marco de perfil que está diseñado para almacenar datos específicos de los usuarios adicionales.</span><span class="sxs-lookup"><span data-stu-id="c6eed-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="c6eed-201">Al igual que el marco de trabajo de pertenencia, el marco de trabajo de perfil se crea sobre el modelo de proveedor.</span><span class="sxs-lookup"><span data-stu-id="c6eed-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="c6eed-202">.NET Framework se suministra con un `SqlProfileProvider` que almacena los datos en una base de datos de SQL Server de perfil.</span><span class="sxs-lookup"><span data-stu-id="c6eed-202">The .NET Framework ships with a `SqlProfileProvider` that stores profile data in a SQL Server database.</span></span> <span data-ttu-id="c6eed-203">De hecho, nuestra base de datos ya tiene la tabla utilizada por el `SqlProfileProvider` (`aspnet_Profile`), tal y como se agregó al agregar los servicios de aplicación de nuevo en el [ *crear el esquema de pertenencia en SQL Server* ](creating-the-membership-schema-in-sql-server-vb.md)tutorial.</span><span class="sxs-lookup"><span data-stu-id="c6eed-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial.</span></span>   
  <span data-ttu-id="c6eed-204">La principal ventaja del marco de trabajo de perfil es que permite a los programadores definir las propiedades del perfil en `Web.config` : ningún código debe escribirse para serializar los datos del perfil a y desde el almacén de datos subyacente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="c6eed-205">En resumen, es muy fácil para definir un conjunto de propiedades de perfil y trabajar con ellos en el código.</span><span class="sxs-lookup"><span data-stu-id="c6eed-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="c6eed-206">Sin embargo, el sistema del perfil deja mucho que se desee en cuanto a control de versiones, por lo que si tiene una aplicación que esperar nuevas propiedades específicas del usuario para agregarse a un momento posterior, o las existentes para quitar o modificar, a continuación, el marco de trabajo de perfil no puede ser el  mejor opción.</span><span class="sxs-lookup"><span data-stu-id="c6eed-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="c6eed-207">Además, la `SqlProfileProvider` almacena las propiedades de perfil en un modo sin normalizar alta, lo que casi imposible ejecutar consultas directamente en los datos de perfil (por ejemplo, ¿cuántos usuarios tienen una versión particular ciudad de Nueva York).</span><span class="sxs-lookup"><span data-stu-id="c6eed-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
  <span data-ttu-id="c6eed-208">Para obtener más información sobre el marco de trabajo de perfil, consulte la sección "Lecturas adicionales" al final de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c6eed-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="c6eed-209"><strong>Agregue estas tres columnas a una nueva tabla en la base de datos y establecer una relación uno a uno entre esta tabla y</strong><strong>`aspnet_Users`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="c6eed-209"><strong>Add these three columns to a new table in the database and establish a one-to-one relationship between this table and</strong><strong>`aspnet_Users`</strong><strong>.</strong></span></span> <span data-ttu-id="c6eed-210">Este enfoque implica un poco más trabajo con el marco de trabajo de perfil, pero proporciona la máxima flexibilidad en cómo se modelan las propiedades de usuario adicionales en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="c6eed-211">Esta es la opción que se usará en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c6eed-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="c6eed-212">Se creará una nueva tabla denominada `UserProfiles` para guardar la ciudad natal, la página de inicio y la firma para cada usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="c6eed-213">Haga doble clic en la carpeta de tablas en la ventana Explorador de base de datos y elija crear una nueva tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="c6eed-214">Nombre de la primera columna `UserId` y establezca su tipo en `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="c6eed-215">No permitir `NULL` valores y marcar la columna como una clave principal.</span><span class="sxs-lookup"><span data-stu-id="c6eed-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="c6eed-216">A continuación, agregue las columnas denominadas: `HomeTown` de tipo `nvarchar(50)`; `HomepageUrl` de tipo `nvarchar(100)`; y la firma del tipo `nvarchar(500)`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="c6eed-217">Cada una de estas tres columnas puede aceptar un `NULL` valor.</span><span class="sxs-lookup"><span data-stu-id="c6eed-217">Each of these three columns can accept a `NULL` value.</span></span>


<span data-ttu-id="c6eed-218">[![Crear la tabla UserProfiles](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-218">[![Create the UserProfiles Table](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span></span>

<span data-ttu-id="c6eed-219">**Figura 6**: crear el `UserProfiles` tabla ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image18.png))</span></span>


<span data-ttu-id="c6eed-220">Guarde la tabla y asígnele el nombre `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="c6eed-221">Por último, establecer una restricción de clave externa entre la `UserProfiles` la tabla `UserId` campo y `aspnet_Users.UserId` campo.</span><span class="sxs-lookup"><span data-stu-id="c6eed-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="c6eed-222">Igual que hicimos con la restricción de clave externa entre la `GuestbookComments` y `aspnet_Users` tablas, tienen esta restricción eliminaciones en cascada.</span><span class="sxs-lookup"><span data-stu-id="c6eed-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="c6eed-223">Puesto que la `UserId` campo `UserProfiles` es el principal clave, esto garantiza que habrá no más de un registro en el `UserProfiles` tabla para cada cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="c6eed-224">Este tipo de relación se conoce como uno a uno.</span><span class="sxs-lookup"><span data-stu-id="c6eed-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="c6eed-225">Ahora que tenemos el modelo de datos creado, estamos preparados para utilizarlo.</span><span class="sxs-lookup"><span data-stu-id="c6eed-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="c6eed-226">En los pasos 2 y 3, veremos cómo puede ver y editar su información principal de ciudad, la firma y la página principal del usuario con sesión iniciada actualmente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="c6eed-227">En el paso 4, se creará la interfaz para los usuarios autenticados enviar comentarios nuevos en el libro de visitas y ver los archivos existentes.</span><span class="sxs-lookup"><span data-stu-id="c6eed-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="c6eed-228">Paso 2: Mostrar Pueblo principal del usuario, página de inicio y firma</span><span class="sxs-lookup"><span data-stu-id="c6eed-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="c6eed-229">Hay varias maneras de permitir que el usuario ha iniciado sesión actualmente ver y editar su información principal de la ciudad, la firma y la página principal.</span><span class="sxs-lookup"><span data-stu-id="c6eed-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="c6eed-230">Podríamos crear manualmente la interfaz de usuario con el cuadro de texto y controles de etiqueta o se podríamos usar uno de los controles Web, como el control DetailsView de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="c6eed-231">Para realizar la base de datos `SELECT` y `UPDATE` instrucciones podríamos escribir ADO.NET en la clase de código subyacente de nuestra página de código o, alternativamente, emplean un enfoque declarativo con SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="c6eed-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="c6eed-232">Lo ideal es que nuestra aplicación contendría una arquitectura en capas, que se pudo invocar mediante programación desde la clase de código subyacente de la página o de manera declarativa mediante el control ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="c6eed-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="c6eed-233">Puesto que esta serie de tutoriales se centra en la autenticación de formularios, autorización, cuentas de usuario y roles, no habrá una discusión detallada de estas opciones de acceso de datos diferente o por qué una arquitectura en capas es preferible ejecutar instrucciones SQL directamente en la página ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c6eed-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="c6eed-234">Voy a recorrer mediante un DetailsView y SqlDataSource: la opción más rápida y sencilla: pero por supuesto, se pueden aplicar los conceptos tratados alternativo Web controles y datos de lógica de acceso.</span><span class="sxs-lookup"><span data-stu-id="c6eed-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="c6eed-235">Para obtener más información sobre cómo trabajar con datos en ASP.NET, consulte mi *[trabajar con datos en ASP.NET 2.0](../../data-access/index.md)* serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="c6eed-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="c6eed-236">Abra la `AdditionalUserInfo.aspx` página en el `Membership` carpeta y agregar un control DetailsView a la página, si se establece su propiedad ID en `UserProfile` y borrando su `Width` y `Height` propiedades.</span><span class="sxs-lookup"><span data-stu-id="c6eed-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its ID property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="c6eed-237">Expanda la etiqueta inteligente de DetailsView y elija enlazar a un nuevo control de origen de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="c6eed-238">Se iniciará el Asistente para configuración de origen de datos (consulte la figura 7).</span><span class="sxs-lookup"><span data-stu-id="c6eed-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="c6eed-239">El primer paso en el que se le pide que especifique el tipo de origen de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="c6eed-240">Puesto que vamos a conectar directamente a la `SecurityTutorials` base de datos, elija el icono de la base de datos, especificar el `ID` como `UserProfileDataSource`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>


<span data-ttu-id="c6eed-241">[![Agregar un nuevo Control SqlDataSource denominado UserProfileDataSource](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span></span>

<span data-ttu-id="c6eed-242">**Figura 7**: agregar un nuevo Control SqlDataSource denominado `UserProfileDataSource` ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-vb/_static/image21.png))</span></span>


<span data-ttu-id="c6eed-243">La siguiente pantalla solicita la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="c6eed-244">Ya hemos definido una cadena de conexión en `Web.config` para el `SecurityTutorials` base de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="c6eed-245">Este nombre de la cadena de conexión: `SecurityTutorialsConnectionString` : debe estar en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="c6eed-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="c6eed-246">Seleccione esta opción y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-246">Select this option and click Next.</span></span>


<span data-ttu-id="c6eed-247">[![Elija SecurityTutorialsConnectionString en la lista desplegable](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span></span>

<span data-ttu-id="c6eed-248">**Figura 8**: elija `SecurityTutorialsConnectionString` en la lista desplegable ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-vb/_static/image24.png))</span></span>


<span data-ttu-id="c6eed-249">La pantalla posterior en el que se le pide que especifique la tabla y columnas de la consulta.</span><span class="sxs-lookup"><span data-stu-id="c6eed-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="c6eed-250">Elija la `UserProfiles` de la tabla en la lista desplegable y compruebe todas las columnas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>


<span data-ttu-id="c6eed-251">[![Poner hacer copia de todas las columnas de la tabla UserProfiles](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span></span>

<span data-ttu-id="c6eed-252">**Figura 9**: poner todo en espera de las columnas de la `UserProfiles` tabla ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image27.png))</span></span>


<span data-ttu-id="c6eed-253">La consulta actual en la figura 9 devuelve *todos los* de los registros de `UserProfiles`, pero solo estamos interesados en el registro del usuario ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="c6eed-254">Para agregar una `WHERE` cláusula, haga clic en el `WHERE` botón para que aparezca el complemento `WHERE` cuadro de diálogo de la cláusula (consulte la figura 10).</span><span class="sxs-lookup"><span data-stu-id="c6eed-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="c6eed-255">Aquí puede seleccionar la columna que se va a filtrar, el operador y el origen del parámetro filter.</span><span class="sxs-lookup"><span data-stu-id="c6eed-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="c6eed-256">Seleccione `UserId` como la columna y "=" como el operador.</span><span class="sxs-lookup"><span data-stu-id="c6eed-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="c6eed-257">Lamentablemente, no hay ningún origen de los parámetros integrados para devolver el usuario ha iniciado sesión actualmente `UserId` valor.</span><span class="sxs-lookup"><span data-stu-id="c6eed-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="c6eed-258">Necesitamos agarre este valor mediante programación.</span><span class="sxs-lookup"><span data-stu-id="c6eed-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="c6eed-259">Por tanto, establecer la lista desplegable de origen en "None", haga clic en Agregar botón para agregar el parámetro y, a continuación, haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>


<span data-ttu-id="c6eed-260">[![Agregar un parámetro de filtro en la columna de identificador de usuario](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span></span>

<span data-ttu-id="c6eed-261">**Figura 10**: agregar un parámetro de filtro en el `UserId` columna ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-vb/_static/image30.png))</span></span>


<span data-ttu-id="c6eed-262">Tras hacer clic en Aceptar volverá a la pantalla que se muestra en la figura 9.</span><span class="sxs-lookup"><span data-stu-id="c6eed-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="c6eed-263">Esta vez, sin embargo, la consulta SQL en la parte inferior de la pantalla debe incluir un `WHERE` cláusula.</span><span class="sxs-lookup"><span data-stu-id="c6eed-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="c6eed-264">Haga clic en siguiente para pasar a la pantalla de "Consulta de prueba".</span><span class="sxs-lookup"><span data-stu-id="c6eed-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="c6eed-265">Aquí puede ejecutar la consulta y ver los resultados.</span><span class="sxs-lookup"><span data-stu-id="c6eed-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="c6eed-266">Haga clic en Finalizar para completar al asistente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="c6eed-267">Al finalizar al Asistente de configuración de origen de datos, Visual Studio crea el control SqlDataSource según la configuración especificada en el asistente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="c6eed-268">Además, agrega manualmente BoundFields a DetailsView para cada columna devuelta por la SqlDataSource `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="c6eed-269">No es necesario para mostrar el `UserId` campo DetailsView, puesto que el usuario no necesita conocer este valor.</span><span class="sxs-lookup"><span data-stu-id="c6eed-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="c6eed-270">Puede quitar este campo directamente desde el marcado declarativo del control DetailsView o haciendo clic en "Editar campos" vincular desde su etiqueta inteligente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="c6eed-271">En este momento marcado declarativo de la página debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample1.aspx)]

<span data-ttu-id="c6eed-272">Es necesario establecer mediante programación el control SqlDataSource `UserId` parámetro para el usuario conectado actualmente `UserId` antes de que los datos están seleccionados.</span><span class="sxs-lookup"><span data-stu-id="c6eed-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="c6eed-273">Esto puede realizarse mediante la creación de un controlador de eventos para el SqlDataSource `Selecting` eventos y agregar el siguiente código no existe:</span><span class="sxs-lookup"><span data-stu-id="c6eed-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample2.vb)]

<span data-ttu-id="c6eed-274">El código anterior se inicia mediante la obtención de una referencia al usuario con sesión iniciada actualmente mediante una llamada a la `Membership` la clase `GetUser` método.</span><span class="sxs-lookup"><span data-stu-id="c6eed-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="c6eed-275">Esto devuelve un `MembershipUser` objeto cuya `ProviderUserKey` propiedad contiene el `UserId`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="c6eed-276">El `UserId` , a continuación, se asigna el valor a la SqlDataSource `@UserId` parámetro.</span><span class="sxs-lookup"><span data-stu-id="c6eed-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="c6eed-277">El `Membership.GetUser()` método devuelve información sobre el usuario ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="c6eed-278">Si un usuario anónimo visita la página, devolverá un valor de `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-278">If an anonymous user is visiting the page, it will return a value of `Nothing`.</span></span> <span data-ttu-id="c6eed-279">En tal caso, esto dará lugar a un `NullReferenceException` en la siguiente línea de código al intentar leer la `ProviderUserKey` propiedad.</span><span class="sxs-lookup"><span data-stu-id="c6eed-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="c6eed-280">Por supuesto, no es necesario preocuparse de `Membership.GetUser()` devolver nada en la `AdditionalUserInfo.aspx` página porque hemos configurado autorizaciones de direcciones URL en un tutorial anterior, por lo que sólo los usuarios autenticados podrían tener acceso a los recursos ASP.NET en esta carpeta.</span><span class="sxs-lookup"><span data-stu-id="c6eed-280">Of course, we don't have to worry about `Membership.GetUser()` returning Nothing in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="c6eed-281">Si necesita tener acceso a información sobre el usuario ha iniciado sesión actualmente en una página donde se permite el acceso anónimo, asegúrese de comprobar que la `MembershipUser` objeto devuelto desde el `GetUser()` método no es nada antes de hacer referencia a sus propiedades.</span><span class="sxs-lookup"><span data-stu-id="c6eed-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that the `MembershipUser` object returned from the `GetUser()` method is not Nothing before referencing its properties.</span></span>


<span data-ttu-id="c6eed-282">Si visita el `AdditionalUserInfo.aspx` página a través de un explorador verá una página en blanco porque todavía tenemos que agregar ninguna fila para el `UserProfiles` tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="c6eed-283">En el paso 6, veremos cómo personalizar el control CreateUserWizard para agregar automáticamente una nueva fila a la `UserProfiles` cuando se crea una nueva cuenta de usuario de la tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="c6eed-284">Por ahora, sin embargo, se tendrá que crear manualmente un registro en la tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="c6eed-285">Navegue hasta el Explorador de base de datos en Visual Studio y expanda la carpeta tablas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="c6eed-286">Haga doble clic en el `aspnet_Users` de tabla y elegir "Mostrar datos de tabla" para ver los registros en la tabla; hacer lo mismo la `UserProfiles` tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="c6eed-287">La figura 11 muestra estos resultados cuando se coloca en mosaico vertical.</span><span class="sxs-lookup"><span data-stu-id="c6eed-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="c6eed-288">En mi base de datos hay actualmente `aspnet_Users` registros para Bruce, Fred y Tito, pero no hay registros en la `UserProfiles` tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>


<span data-ttu-id="c6eed-289">[![Se muestran el contenido de la aspnet_Users y tablas UserProfiles](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span></span>

<span data-ttu-id="c6eed-290">**Figura 11**: el contenido de la `aspnet_Users` y `UserProfiles` se mostrarán las tablas ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-vb/_static/image33.png))</span></span>


<span data-ttu-id="c6eed-291">Agregue un nuevo registro a la `UserProfiles` tabla escribiendo manualmente en los valores para la `HomeTown`, `HomepageUrl`, y `Signature` campos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="c6eed-292">La manera más fácil de obtener válido `UserId` valor en el nuevo `UserProfiles` registro consiste en seleccionar la `UserId` arrastrándolo desde una cuenta de usuario determinada en el `aspnet_Users` de tabla y copiar y pegar en el `UserId` campo `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="c6eed-293">La figura 12 muestra el `UserProfiles` tabla después de que se ha agregado un nuevo registro para Bruce.</span><span class="sxs-lookup"><span data-stu-id="c6eed-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>


<span data-ttu-id="c6eed-294">[![Se agregó un registro a UserProfiles para Bruce](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span></span>

<span data-ttu-id="c6eed-295">**Figura 12**: se agregó un registro a `UserProfiles` para Bruce ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-vb/_static/image36.png))</span></span>


<span data-ttu-id="c6eed-296">Vuelva a la `AdditionalUserInfo.aspx page`, ha iniciado sesión como Bruce.</span><span class="sxs-lookup"><span data-stu-id="c6eed-296">Return to the `AdditionalUserInfo.aspx page`, logged in as Bruce.</span></span> <span data-ttu-id="c6eed-297">Tal y como se muestra en la figura 13, se muestran los valores de Bruce.</span><span class="sxs-lookup"><span data-stu-id="c6eed-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>


<span data-ttu-id="c6eed-298">[![El usuario visita actualmente es la configuración de His se muestra](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span></span>

<span data-ttu-id="c6eed-299">**Figura 13**: el de usuario actualmente visitar es se muestra la configuración His ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-vb/_static/image39.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c6eed-300">Ir hacia delante y manualmente agregar registros en la `UserProfiles` tabla para cada usuario de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="c6eed-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="c6eed-301">En el paso 6, veremos cómo personalizar el control CreateUserWizard para agregar automáticamente una nueva fila a la `UserProfiles` cuando se crea una nueva cuenta de usuario de la tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>


## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="c6eed-302">Paso 3: Permitir al usuario editar su ciudad principal, la página principal y la firma</span><span class="sxs-lookup"><span data-stu-id="c6eed-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="c6eed-303">En este momento puede ver el usuario que ha iniciado en su ciudad natal, la página principal y la configuración de firma, pero aún no pueden modificar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="c6eed-304">Vamos a actualizar el control DetailsView para que se pueden editar los datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="c6eed-305">Lo primero que debemos hacer es agregar un `UpdateCommand` para SqlDataSource, especificando el `UPDATE` instrucción que se ejecutará y sus correspondientes parámetros.</span><span class="sxs-lookup"><span data-stu-id="c6eed-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="c6eed-306">Seleccione el SqlDataSource y, desde la ventana Propiedades, haga clic en el botón de puntos suspensivos situado junto a la propiedad UpdateQuery para que aparezca el cuadro de diálogo Editor de parámetros y comandos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="c6eed-307">Escriba el siguiente `UPDATE` instrucción en el cuadro de texto:</span><span class="sxs-lookup"><span data-stu-id="c6eed-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-vb/samples/sample3.sql)]

<span data-ttu-id="c6eed-308">A continuación, haga clic en el botón "Actualizar parámetros", lo cual creará un parámetro en el control SqlDataSource `UpdateParameters` recopilación para cada uno de los parámetros en el `UPDATE` instrucción.</span><span class="sxs-lookup"><span data-stu-id="c6eed-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="c6eed-309">Deje el origen para todos los parámetros establecidos en ninguno y haga clic en el botón Aceptar para completar el cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="c6eed-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>


<span data-ttu-id="c6eed-310">[![Especifique el SqlDataSource UpdateCommand y UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span></span>

<span data-ttu-id="c6eed-311">**Figura 14**: especifique el SqlDataSource `UpdateCommand` y `UpdateParameters` ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-vb/_static/image42.png))</span></span>


<span data-ttu-id="c6eed-312">Debido a las adiciones hemos realizado para el control SqlDataSource, DetailsView control puede ahora admite la edición.</span><span class="sxs-lookup"><span data-stu-id="c6eed-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="c6eed-313">De las etiquetas inteligentes de DetailsView, active la casilla "Habilitar edición".</span><span class="sxs-lookup"><span data-stu-id="c6eed-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="c6eed-314">Esto agrega un CommandField para el control `Fields` colección con su `ShowEditButton` propiedad establecida en True.</span><span class="sxs-lookup"><span data-stu-id="c6eed-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="c6eed-315">Esto hace que un botón Editar cuando DetailsView se muestra en modo de solo lectura y actualización y los botones Cancelar cuando se muestre en el modo de edición.</span><span class="sxs-lookup"><span data-stu-id="c6eed-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="c6eed-316">En lugar de requerir al usuario que haga clic en Editar, sin embargo, podemos tenemos la presentación de DetailsView en un estado "siempre editable" estableciendo el control DetailsView [ `DefaultMode` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) a `Edit`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="c6eed-317">Con estos cambios, el marcado declarativo del control DetailsView debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample4.aspx)]

<span data-ttu-id="c6eed-318">Tenga en cuenta la adición de la CommandField y `DefaultMode` propiedad.</span><span class="sxs-lookup"><span data-stu-id="c6eed-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="c6eed-319">Continúe y probar esta página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="c6eed-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="c6eed-320">Cuando se visita con un usuario que tiene un registro correspondiente en `UserProfiles`, la configuración del usuario se muestra en una interfaz editable.</span><span class="sxs-lookup"><span data-stu-id="c6eed-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>


<span data-ttu-id="c6eed-321">[![DetailsView representa una interfaz Editable](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span></span>

<span data-ttu-id="c6eed-322">**Figura 15**: DetailsView representa una interfaz Editable ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-vb/_static/image45.png))</span></span>


<span data-ttu-id="c6eed-323">Intente cambiar los valores y haga clic en el botón de actualización.</span><span class="sxs-lookup"><span data-stu-id="c6eed-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="c6eed-324">Parece como si no ocurre nada.</span><span class="sxs-lookup"><span data-stu-id="c6eed-324">It appears as if nothing happens.</span></span> <span data-ttu-id="c6eed-325">Hay una devolución de datos y los valores se guardan en la base de datos, pero no aparece ningún indicador visual que se produjeron al guardar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="c6eed-326">Para solucionarlo, vuelva a Visual Studio y agregar un control de etiqueta por encima de DetailsView.</span><span class="sxs-lookup"><span data-stu-id="c6eed-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="c6eed-327">Establecer su `ID` a `SettingsUpdatedMessage`, sus `Text` propiedad "se ha actualizado la configuración de" y su `Visible` y `EnableViewState` propiedades para `False`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `False`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample5.aspx)]

<span data-ttu-id="c6eed-328">Es necesario mostrar el `SettingsUpdatedMessage` etiquetar cada vez que se actualiza el DetailsView.</span><span class="sxs-lookup"><span data-stu-id="c6eed-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="c6eed-329">Para ello, cree un controlador de eventos para el DetailsView `ItemUpdated` eventos y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample6.vb)]

<span data-ttu-id="c6eed-330">Vuelva a la `AdditionalUserInfo.aspx` página a través de un explorador y actualizar los datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="c6eed-331">Esta vez, se muestra un mensaje de estado útil.</span><span class="sxs-lookup"><span data-stu-id="c6eed-331">This time, a helpful status message is displayed.</span></span>


<span data-ttu-id="c6eed-332">[![Un mensaje breve es aparece cuando los valores se actualizan](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span></span>

<span data-ttu-id="c6eed-333">**Figura 16**: un breve mensaje se muestra cuando la configuración se actualiza ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-vb/_static/image48.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c6eed-334">El control DetailsView de edición del interfaz deja mucho que se desee.</span><span class="sxs-lookup"><span data-stu-id="c6eed-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="c6eed-335">Usa cuadros de texto de tamaño estándar, pero el campo de firma probablemente debe ser un cuadro de texto de varias líneas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="c6eed-336">Un control RegularExpressionValidator debe usarse para asegurarse de que la dirección URL de página principal, si no escribe, comienza con "http://" o "https://".</span><span class="sxs-lookup"><span data-stu-id="c6eed-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="c6eed-337">Además, desde el DetailsView control tiene su `DefaultMode` propiedad establecida en `Edit`, el botón Cancelar no hace nada.</span><span class="sxs-lookup"><span data-stu-id="c6eed-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="c6eed-338">Debería cualquiera quitarse o, al hacer clic, redirigirá al usuario a otra página (como `~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="c6eed-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="c6eed-339">Estas mejoras deja como un ejercicio para el lector.</span><span class="sxs-lookup"><span data-stu-id="c6eed-339">I leave these enhancements as an exercise for the reader.</span></span>


### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="c6eed-340">Agregar un vínculo a la`AdditionalUserInfo.aspx`página en la página maestra</span><span class="sxs-lookup"><span data-stu-id="c6eed-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="c6eed-341">Actualmente, el sitio Web no proporciona los vínculos a la `AdditionalUserInfo.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="c6eed-342">La única forma de llegar a él consiste en especificar dirección URL de la página directamente en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="c6eed-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="c6eed-343">Vamos a agregar un vínculo a esta página en la `Site.master` página maestra.</span><span class="sxs-lookup"><span data-stu-id="c6eed-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="c6eed-344">Recuerde que la página maestra contiene un control LoginView Web en su `LoginContent` ContentPlaceHolder que muestra un marcado diferente para los visitantes autenticados y anónimos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="c6eed-345">Actualizar el control LoginView `LoggedInTemplate` para incluir un vínculo a la `AdditionalUserInfo.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="c6eed-346">Después de realizar estos cambios el LoginView marcado declarativo del control debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample7.aspx)]

<span data-ttu-id="c6eed-347">Tenga en cuenta la adición de la `lnkUpdateSettings` control de hipervínculo para el `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="c6eed-348">Con este vínculo en su lugar, los usuarios autenticados pueden saltar rápidamente a la página para ver y modificar su configuración particular de ciudad, la firma y la página principal.</span><span class="sxs-lookup"><span data-stu-id="c6eed-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="c6eed-349">Paso 4: Agregar comentarios nuevos de libro de visitas</span><span class="sxs-lookup"><span data-stu-id="c6eed-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="c6eed-350">La `Guestbook.aspx` página es donde los usuarios autenticados pueden ver el libro de visitas y deje un comentario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="c6eed-351">Puede empezar con la creación de la interfaz para agregar comentarios de libro de visitas de nuevo.</span><span class="sxs-lookup"><span data-stu-id="c6eed-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="c6eed-352">Abra la `Guestbook.aspx` página en Visual Studio y crear una interfaz de usuario que se compone de dos controles de cuadro de texto, uno para el sujeto del nuevo comentario y otro para el cuerpo.</span><span class="sxs-lookup"><span data-stu-id="c6eed-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="c6eed-353">Configurar el primer control de cuadro de texto `ID` propiedad `Subject` y su `Columns` propiedad a 40; establezca segundo `ID` a `Body`, sus `TextMode` a `MultiLine`y su `Width` y `Rows` propiedades para "95%" y 8, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="c6eed-354">Para completar la interfaz de usuario, agregue un control de botón Web denominado `PostCommentButton` y establecer su `Text` propiedad en "Comment Your" Post".</span><span class="sxs-lookup"><span data-stu-id="c6eed-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="c6eed-355">Puesto que cada comentario del libro de visitas requiere un asunto y al cuerpo, agregue un control RequiredFieldValidator para cada uno de los cuadros de texto.</span><span class="sxs-lookup"><span data-stu-id="c6eed-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="c6eed-356">Establecer el `ValidationGroup` propiedad de estos controles para "EnterComment"; del mismo modo, establezca la `PostCommentButton` del control `ValidationGroup` propiedad a "EnterComment".</span><span class="sxs-lookup"><span data-stu-id="c6eed-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="c6eed-357">Para obtener más información acerca de ASP. Controles de validación de NET, consulte [validación del formulario en ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Diseccionando los controles de validación en ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)y el [Tutorial de controles de servidor de validación](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) en [W3Schools](http://www.w3schools.com/).</span><span class="sxs-lookup"><span data-stu-id="c6eed-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="c6eed-358">Después de diseñar la interfaz de usuario marcado declarativo de la página debe tener un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample8.aspx)]

<span data-ttu-id="c6eed-359">Con la interfaz de usuario completa, la siguiente tarea consiste en Insertar un nuevo registro en el `GuestbookComments` tabla cuando el `PostCommentButton` se hace clic en.</span><span class="sxs-lookup"><span data-stu-id="c6eed-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="c6eed-360">Esto puede realizarse de varias maneras: podemos escribir código de ADO.NET en el botón `Click` controlador de eventos; se puede agregar un control SqlDataSource a la página, configure su `InsertCommand`y, a continuación, llame a su `Insert` método desde el `Click` eventos controlador; o podríamos crear un nivel intermedio que era responsable de insertar nuevos comentarios de libro de visitas y esta funcionalidad invocar desde el `Click` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="c6eed-361">Puesto que analizamos utilizando un SqlDataSource en el paso 3, vamos a usar código de ADO.NET aquí.</span><span class="sxs-lookup"><span data-stu-id="c6eed-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="c6eed-362">Las clases ADO.NET permiten el acceso mediante programación a datos desde una base de datos de Microsoft SQL Server se encuentran en el `System.Data.SqlClient` espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="c6eed-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="c6eed-363">Puede que necesite importar este espacio de nombres en la clase de código subyacente de la página (es decir, `Imports System.Data.SqlClient`).</span><span class="sxs-lookup"><span data-stu-id="c6eed-363">You may need to import this namespace into your page's code-behind class (i.e., `Imports System.Data.SqlClient`).</span></span>


<span data-ttu-id="c6eed-364">Crear un controlador de eventos para el `PostCommentButton`de `Click` eventos y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample9.vb)]

<span data-ttu-id="c6eed-365">El `Click` controlador de eventos se inicia mediante la comprobación de que los datos proporcionados por el usuario están válidos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="c6eed-366">Si no es así, el controlador de eventos se cierra antes de insertar un registro.</span><span class="sxs-lookup"><span data-stu-id="c6eed-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="c6eed-367">Suponiendo que los datos proporcionados son válidos, el usuario ha iniciado sesión actualmente `UserId` valor se recuperan y almacenan en la `currentUserId` variable local.</span><span class="sxs-lookup"><span data-stu-id="c6eed-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="c6eed-368">Este valor es necesario porque se debemos proporcionar un `UserId` valor al insertar un registro en `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="c6eed-369">A continuación, la cadena de conexión para el `SecurityTutorials` base de datos se recupera de `Web.config` y `INSERT` se especifica la instrucción SQL.</span><span class="sxs-lookup"><span data-stu-id="c6eed-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="c6eed-370">Un `SqlConnection` objeto, a continuación, se crea y se abre.</span><span class="sxs-lookup"><span data-stu-id="c6eed-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="c6eed-371">Después, un `SqlCommand` se construye el objeto y los valores de los parámetros que se usan en el `INSERT` consulta se han asignado.</span><span class="sxs-lookup"><span data-stu-id="c6eed-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="c6eed-372">El `INSERT` , a continuación, se ejecuta la instrucción y cierra la conexión.</span><span class="sxs-lookup"><span data-stu-id="c6eed-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="c6eed-373">Al final del controlador de eventos, el `Subject` y `Body` cuadros de texto `Text` se borran propiedades para que no se conservan los valores del usuario a través de la devolución de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="c6eed-374">Continúe y pruebe esta página en un explorador.</span><span class="sxs-lookup"><span data-stu-id="c6eed-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="c6eed-375">Puesto que esta página en el `Membership` la carpeta no es accesible para los visitantes anónimos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="c6eed-376">Por lo tanto, debe iniciar sesión (si aún no lo tiene).</span><span class="sxs-lookup"><span data-stu-id="c6eed-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="c6eed-377">Especifique un valor para el `Subject` y `Body` cuadros de texto y haga clic en el `PostCommentButton` botón.</span><span class="sxs-lookup"><span data-stu-id="c6eed-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="c6eed-378">Esto hará que un nuevo registro va a agregar a `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="c6eed-379">En la devolución de datos, el asunto y cuerpo proporcionada se borran de los cuadros de texto.</span><span class="sxs-lookup"><span data-stu-id="c6eed-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="c6eed-380">Tras hacer clic en el `PostCommentButton` no existe el botón no aparece ningún indicador visual que se agregó el comentario en el libro de visitas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="c6eed-381">Necesitamos actualizar esta página para mostrar los comentarios del libro de visitas existentes, lo hará en el paso 5.</span><span class="sxs-lookup"><span data-stu-id="c6eed-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="c6eed-382">Una vez que lo, el comentario just-agregado aparecerá en la lista de los comentarios, proporcionar comentarios visuales adecuados.</span><span class="sxs-lookup"><span data-stu-id="c6eed-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="c6eed-383">Por ahora, confirme que se guardó el comentario del libro de visitas examinando el contenido de la `GuestbookComments` tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="c6eed-384">Figura 17 muestra el contenido de la `GuestbookComments` tabla después de que se han dejado dos comentarios.</span><span class="sxs-lookup"><span data-stu-id="c6eed-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>


<span data-ttu-id="c6eed-385">[![Puede ver los comentarios del libro de visitas en la tabla GuestbookComments](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span></span>

<span data-ttu-id="c6eed-386">**Figura 17**: puede ver los comentarios del libro de visitas en el `GuestbookComments` tabla ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image51.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c6eed-387">Si un usuario intenta insertar un comentario de libro de visitas que contiene potencialmente peligroso marcado: por ejemplo, HTML, ASP.NET producirá una `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="c6eed-388">Para obtener más información sobre esta excepción, ¿por qué se produce, y cómo permitir a los usuarios enviar valores potencialmente peligrosos, consulte el [solicitar notas del producto validación](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="c6eed-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>


## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="c6eed-389">Paso 5: Mostrar los comentarios existentes de libro de visitas</span><span class="sxs-lookup"><span data-stu-id="c6eed-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="c6eed-390">Además de dejar comentarios, un usuario que visita el `Guestbook.aspx` página también podrá ver los comentarios existentes del libro de visitas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="c6eed-391">Para ello, agregue un control ListView denominado `CommentList` a la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="c6eed-392">ListView (control) es nuevo en ASP.NET versión 3.5.</span><span class="sxs-lookup"><span data-stu-id="c6eed-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="c6eed-393">Está diseñado para mostrar una lista de elementos en un diseño muy flexible y personalizable, pero aún siguen ofreciendo integrados editar, insertar, eliminar, paginación y ordenación funcionalidades como GridView.</span><span class="sxs-lookup"><span data-stu-id="c6eed-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="c6eed-394">Si usa ASP.NET 2.0, debe utilizar el control DataList o repetidor en su lugar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="c6eed-395">Para obtener más información sobre el uso de la vista de lista, vea [Scott Guthrie](https://weblogs.asp.net/scottgu/)de entrada de blog, [asp: ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)y el artículo [mostrar datos con el ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6eed-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>


<span data-ttu-id="c6eed-396">Abra la etiqueta inteligente de la vista de lista y, en la lista desplegable Elegir origen de datos, enlazar el control a un nuevo origen de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="c6eed-397">Como vimos en el paso 2, se iniciará al Asistente para configuración de orígenes de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="c6eed-398">Seleccione el icono de la base de datos, asigne el nombre resultante SqlDataSource `CommentsDataSource`y haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="c6eed-399">A continuación, seleccione la `SecurityTutorialsConnectionString` conexión cadena en la lista desplegable y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="c6eed-400">En este momento en el paso 2 se especificó los datos para consultar por selección la `UserProfiles` de la tabla en la lista desplegable y seleccione las columnas que se va a devolver (hacen referencia a la figura 9).</span><span class="sxs-lookup"><span data-stu-id="c6eed-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="c6eed-401">Esta vez, sin embargo, desea elaborar una instrucción SQL que extrae los no solo los registros de `GuestbookComments`, pero también del comentarista ciudad natal, página principal, la firma y nombre de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="c6eed-402">Por lo tanto, seleccione el botón de opción "Especificar una instrucción SQL personalizada o un procedimiento almacenado" y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="c6eed-403">Se abrirá la pantalla "Definir instrucciones o procedimientos almacenados personalizados".</span><span class="sxs-lookup"><span data-stu-id="c6eed-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="c6eed-404">Haga clic en el botón Generador de consultas para crear gráficamente la consulta.</span><span class="sxs-lookup"><span data-stu-id="c6eed-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="c6eed-405">El generador de consultas, empiece por pide para especificar las tablas que desea consultar en.</span><span class="sxs-lookup"><span data-stu-id="c6eed-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="c6eed-406">Seleccione el `GuestbookComments`, `UserProfiles`, y `aspnet_Users` tablas y haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="c6eed-407">Esto agregará las tres tablas a la superficie de diseño.</span><span class="sxs-lookup"><span data-stu-id="c6eed-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="c6eed-408">Dado que hay restricciones de clave externa entre la `GuestbookComments`, `UserProfiles`, y `aspnet_Users` tablas, el generador de consultas automáticamente `JOIN` s estas tablas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="c6eed-409">Todo lo que queda es para especificar las columnas que se va a devolver.</span><span class="sxs-lookup"><span data-stu-id="c6eed-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="c6eed-410">Desde el `GuestbookComments` tabla seleccione la `Subject`, `Body`, y `CommentDate` columnas; devuelven el `HomeTown`, `HomepageUrl`, y `Signature` columnas de la `UserProfiles` tabla; y devolver `UserName` desde `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="c6eed-411">Además, agregue "`ORDER BY CommentDate DESC`" al final de la `SELECT` consultas de modo que los mensajes más recientes se devuelvan en primer lugar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="c6eed-412">Después de realizar estas selecciones, la interfaz del generador de consultas debe ser similar a la pantalla en la figura 18.</span><span class="sxs-lookup"><span data-stu-id="c6eed-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>


<span data-ttu-id="c6eed-413">[![La consulta construidos combina el GuestbookComments, UserProfiles y aspnet_Users tablas](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span></span>

<span data-ttu-id="c6eed-414">**Figura 18**: la consulta construye `JOIN` s el `GuestbookComments`, `UserProfiles`, y `aspnet_Users` tablas ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image54.png))</span></span>


<span data-ttu-id="c6eed-415">Haga clic en Aceptar para cerrar la ventana del generador de consultas y volver a la pantalla "Definir instrucciones o procedimientos almacenados personalizados".</span><span class="sxs-lookup"><span data-stu-id="c6eed-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="c6eed-416">Haga clic en siguiente para avanzar a la pantalla de "Consulta de prueba", donde puede ver los resultados de la consulta haciendo clic en el botón de consulta de prueba.</span><span class="sxs-lookup"><span data-stu-id="c6eed-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="c6eed-417">Cuando esté listo, haga clic en Finalizar para completar al Asistente para configurar orígenes de datos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="c6eed-418">Cuando se completa el asistente Configurar origen de datos en el paso 2, el control DetailsView asociado `Fields` recopilación se actualizó para incluir un BoundField para cada columna devuelta por la `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="c6eed-419">Sin embargo, el control ListView, permanece intacto; es necesario definir su diseño.</span><span class="sxs-lookup"><span data-stu-id="c6eed-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="c6eed-420">Diseño de la vista de lista se puede construir manualmente a través de su marcado declarativo o desde la opción "Configurar ListView" en su etiqueta inteligente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="c6eed-421">Normalmente prefieren definir manualmente el marcado pero use el método que resulte más natural.</span><span class="sxs-lookup"><span data-stu-id="c6eed-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="c6eed-422">Ha terminado con los siguientes `LayoutTemplate`, `ItemTemplate`, y `ItemSeparatorTemplate` para mi control ListView de formularios:</span><span class="sxs-lookup"><span data-stu-id="c6eed-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample10.aspx)]

<span data-ttu-id="c6eed-423">El `LayoutTemplate` define el marcado emitidos por el control, mientras el `ItemTemplate` procesa cada elemento devuelto por la SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="c6eed-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="c6eed-424">El `ItemTemplate`del marcado resultante se coloca en el `LayoutTemplate`del `itemPlaceholder` control.</span><span class="sxs-lookup"><span data-stu-id="c6eed-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="c6eed-425">Además el `itemPlaceholder`, el `LayoutTemplate` incluye un control DataPager, lo que limita la vista de lista para mostrar solo 10 comentarios de libro de visitas por página (valor predeterminado) y representa una interfaz de paginación.</span><span class="sxs-lookup"><span data-stu-id="c6eed-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="c6eed-426">Mi `ItemTemplate` muestra el asunto del comentario de cada libro de visitas en un `<h4>` elemento con el cuerpo situado por debajo del sujeto.</span><span class="sxs-lookup"><span data-stu-id="c6eed-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="c6eed-427">Tenga en cuenta que la sintaxis utilizada para mostrar el cuerpo de la toma los datos devueltos por la `Eval("Body")` instrucción de enlace de datos, lo convierte en una cadena y los saltos de línea reemplaza con la `<br />` elemento.</span><span class="sxs-lookup"><span data-stu-id="c6eed-427">Note that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="c6eed-428">Esta conversión es necesario para mostrar los saltos de línea especificados al enviar el comentario, ya que omite el espacio en blanco HTML.</span><span class="sxs-lookup"><span data-stu-id="c6eed-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="c6eed-429">Firma del usuario se muestra debajo el cuerpo en cursiva, seguido por ciudad natal del usuario, un vínculo a su página de inicio, la fecha y hora en que se realiza el comentario y el nombre de usuario de la persona que deja el comentario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="c6eed-430">Tómese un momento para ver la página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="c6eed-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="c6eed-431">Debería ver los comentarios que agregó en el libro de visitas en el paso 5 aparecerá aquí.</span><span class="sxs-lookup"><span data-stu-id="c6eed-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>


<span data-ttu-id="c6eed-432">[![GuesBook.aspx ahora muestra los comentarios del libro de visitas](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span></span>

<span data-ttu-id="c6eed-433">**Figura 19**: `Guestbook.aspx` ahora muestra los comentarios del libro de visitas ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-vb/_static/image57.png))</span></span>


<span data-ttu-id="c6eed-434">Intente agregar un nuevo comentario para el libro de visitas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="c6eed-435">Al hacer clic en el `PostCommentButton` responde botón de la página y el comentario se agrega a la base de datos, pero el control ListView no se actualiza para mostrar el nuevo comentario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="c6eed-436">Esto puede corregirse, ya sea:</span><span class="sxs-lookup"><span data-stu-id="c6eed-436">This can be fixed by either:</span></span>

- <span data-ttu-id="c6eed-437">Actualizando el `PostCommentButton` del botón `Click` controlador de eventos para el control ListView, invoca ese TI `DataBind()` método después de insertar el nuevo comentario en la base de datos, o</span><span class="sxs-lookup"><span data-stu-id="c6eed-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="c6eed-438">Al establecer el control ListView `EnableViewState` propiedad `False`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-438">Setting the ListView control's `EnableViewState` property to `False`.</span></span> <span data-ttu-id="c6eed-439">Este enfoque funciona porque al deshabilitar el estado de vista del control, debe volver a enlazar a los datos subyacentes en cada postback.</span><span class="sxs-lookup"><span data-stu-id="c6eed-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="c6eed-440">El sitio Web del tutorial descargable de este tutorial muestra ambas técnicas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="c6eed-441">El control ListView `EnableViewState` propiedad a `False` y el código necesario para enlazar mediante programación los datos a la vista de lista está presente en el `Click` controlador de eventos, pero está comentada.</span><span class="sxs-lookup"><span data-stu-id="c6eed-441">The ListView control's `EnableViewState` property to `False` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="c6eed-442">Actualmente la `AdditionalUserInfo.aspx` página permite al usuario ver y editar su configuración particular de ciudad, la firma y la página principal.</span><span class="sxs-lookup"><span data-stu-id="c6eed-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="c6eed-443">Sería estupendo actualizar `AdditionalUserInfo.aspx` para mostrar el inicio de sesión en los comentarios del libro de visitas del usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="c6eed-444">Es decir, además de examinar y modificar sus datos, un usuario puede visitar el `AdditionalUserInfo.aspx` página para ver el libro de visitas comentarios que se realiza en el pasado.</span><span class="sxs-lookup"><span data-stu-id="c6eed-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="c6eed-445">Dejar este como un ejercicio para el lector interesado.</span><span class="sxs-lookup"><span data-stu-id="c6eed-445">I leave this as an exercise for the interested reader.</span></span>


## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="c6eed-446">Paso 6: Personalizar el Control CreateUserWizard para incluir una interfaz para la ciudad de inicio, la página principal y la firma</span><span class="sxs-lookup"><span data-stu-id="c6eed-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="c6eed-447">El `SELECT` consulta usada por la `Guestbook.aspx` página usa un `INNER JOIN` para combinar los registros relacionados entre el `GuestbookComments`, `UserProfiles`, y `aspnet_Users` tablas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="c6eed-448">Si un usuario que no tiene ningún registro en `UserProfiles` hace un libro de visitas de comentario, el comentario no se mostrarán en la vista de lista porque la `INNER JOIN` sólo devuelve `GuestbookComments` registros cuando hay registros coincidentes en `UserProfiles` y `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="c6eed-449">Y como hemos visto en el paso 3, si un usuario no tiene un registro `UserProfiles` no se puede ver o editar su configuración en la `AdditionalUserInfo.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="c6eed-450">Sobra decir debido a nuestro diseño decisiones es importante que cada cuenta de usuario en el sistema de pertenencia tiene la correspondiente registran en el `UserProfiles` tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="c6eed-451">Lo que queremos es para que un registro correspondiente para agregarse a `UserProfiles` cada vez que se crea una nueva cuenta de usuario de pertenencia a través de CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="c6eed-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="c6eed-452">Como se describe en el [ *crear cuentas de usuario* ](creating-user-accounts-vb.md) tutorial, después de la nueva cuenta de usuario de pertenencia se crea el control CreateUserWizard genera su [ `CreatedUser` eventos](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6eed-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="c6eed-453">Podemos crear un controlador de eventos para este evento, obtener el identificador de usuario para el usuario recién creado y, a continuación, insertar un registro en el `UserProfiles` tabla con valores predeterminados para la `HomeTown`, `HomepageUrl`, y `Signature` columnas.</span><span class="sxs-lookup"><span data-stu-id="c6eed-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="c6eed-454">Es más, es posible solicitar al usuario para estos valores mediante la personalización de la interfaz del control CreateUserWizard para incluir cuadros de texto adicionales.</span><span class="sxs-lookup"><span data-stu-id="c6eed-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="c6eed-455">Veamos primero cómo agregar una nueva fila a la `UserProfiles` tabla el `CreatedUser` controlador de eventos con valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="c6eed-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="c6eed-456">A continuación, veremos cómo personalizar la interfaz de usuario del control CreateUserWizard para incluir campos de formulario adicionales para recopilar ciudad natal del nuevo usuario, página de inicio y la firma.</span><span class="sxs-lookup"><span data-stu-id="c6eed-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="c6eed-457">Agregar una fila predeterminada para`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="c6eed-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="c6eed-458">En el [ *crear cuentas de usuario* ](creating-user-accounts-vb.md) tutorial hemos agregado un control CreateUserWizard a la `CreatingUserAccounts.aspx` página en el `Membership` carpeta.</span><span class="sxs-lookup"><span data-stu-id="c6eed-458">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="c6eed-459">Para disponer de CreateUserWizard control agregar un registro a `UserProfiles` tabla tras la creación de cuentas de usuario, deberá actualizar la funcionalidad del control CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="c6eed-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="c6eed-460">En lugar de realizar estos cambios a la `CreatingUserAccounts.aspx` página, vamos a agregar en su lugar un nuevo control CreateUserWizard a `EnhancedCreateUserWizard.aspx` página y realice las modificaciones para este tutorial no existe.</span><span class="sxs-lookup"><span data-stu-id="c6eed-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="c6eed-461">Abra la `EnhancedCreateUserWizard.aspx` página en Visual Studio y arrastre un control CreateUserWizard del cuadro de herramientas hasta la página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="c6eed-462">Establecer el control CreateUserWizard `ID` propiedad `NewUserWizard`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="c6eed-463">Como se explicó en la [ *crear cuentas de usuario* ](creating-user-accounts-vb.md) tutorial, interfaz de usuario predeterminada del control CreateUserWizard pide al visitante la información necesaria.</span><span class="sxs-lookup"><span data-stu-id="c6eed-463">As we discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="c6eed-464">Una vez que se ha proporcionado esta información, el control crea internamente una nueva cuenta de usuario en el marco de trabajo de pertenencia, todo ello sin nos tener que escribir una sola línea de código.</span><span class="sxs-lookup"><span data-stu-id="c6eed-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="c6eed-465">El control CreateUserWizard eleva un número de eventos durante su flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c6eed-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="c6eed-466">Después de un visitante proporciona información sobre la solicitud y envía el formulario, el control CreateUserWizard inicialmente se activa su [ `CreatingUser` eventos](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6eed-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="c6eed-467">Si hay un problema durante el proceso de creación, el [ `CreateUserError` eventos](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) se activa; sin embargo, si el usuario se creó correctamente, la [ `CreatedUser` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) se genera.</span><span class="sxs-lookup"><span data-stu-id="c6eed-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="c6eed-468">En el [ *crear cuentas de usuario* ](creating-user-accounts-vb.md) tutorial hemos creado un controlador de eventos para el `CreatingUser` eventos para asegurarse de que el nombre de usuario proporcionado no contiene cualquier iniciales o finales espacios y que el nombre de usuario no ha aparecido en cualquier parte en la contraseña.</span><span class="sxs-lookup"><span data-stu-id="c6eed-468">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="c6eed-469">Para agregar una fila en la `UserProfiles` tabla para el usuario recién creado, es necesario crear un controlador de eventos para el `CreatedUser` eventos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="c6eed-470">En el momento en el `CreatedUser` se desencadena el evento, la cuenta de usuario ya se ha creado en el marco de trabajo de pertenencia, lo que nos permite recuperar el valor de identificador de usuario de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="c6eed-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="c6eed-471">Crear un controlador de eventos para el `NewUserWizard`de `CreatedUser` eventos y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample11.vb)]

<span data-ttu-id="c6eed-472">Seres de código anterior al recuperar el identificador de usuario de la cuenta de usuario recién agregados.</span><span class="sxs-lookup"><span data-stu-id="c6eed-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="c6eed-473">Esto se logra mediante la `Membership.GetUser(username)` método para devolver información sobre un usuario determinado y, a continuación, usar el `ProviderUserKey` propiedad que recupere su identificador de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="c6eed-474">El nombre de usuario especificado por el usuario en el control CreateUserWizard está disponible a través de su [ `UserName` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6eed-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="c6eed-475">A continuación, se recupera la cadena de conexión de `Web.config` y `INSERT` se especifica la instrucción.</span><span class="sxs-lookup"><span data-stu-id="c6eed-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="c6eed-476">Se crean instancias de los objetos necesarios de ADO.NET y ejecuta el comando.</span><span class="sxs-lookup"><span data-stu-id="c6eed-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="c6eed-477">El código asigna un [ `DBNull` ](https://msdn.microsoft.com/library/system.dbnull.aspx) de instancia para la `@HomeTown`, `@HomepageUrl`, y `@Signature` parámetros, que tiene el efecto de inserción de base de datos `NULL` los valores para el `HomeTown`, `HomepageUrl`, y `Signature` campos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="c6eed-478">Visite la `EnhancedCreateUserWizard.aspx` página a través de un explorador y crear una nueva cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="c6eed-479">Una vez hecho esto, vuelva a Visual Studio y examine el contenido de la `aspnet_Users` y `UserProfiles` tablas (al igual que hicimos en la figura 12).</span><span class="sxs-lookup"><span data-stu-id="c6eed-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="c6eed-480">Debería ver la nueva cuenta de usuario en `aspnet_Users` y su correspondiente `UserProfiles` fila (con `NULL` los valores de `HomeTown`, `HomepageUrl`, y `Signature`).</span><span class="sxs-lookup"><span data-stu-id="c6eed-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>


<span data-ttu-id="c6eed-481">[![Se han agregado una nueva cuenta de usuario y el registro UserProfiles](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span></span>

<span data-ttu-id="c6eed-482">**Figura 20**: una cuenta de usuario nueva y `UserProfiles` registro se han agregado ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-vb/_static/image60.png))</span></span>


<span data-ttu-id="c6eed-483">Después de que el visitante ha proporcionado la información de su cuenta nueva y hace clic en el botón "Crear usuario", la cuenta de usuario se crea y agrega una fila a la `UserProfiles` tabla.</span><span class="sxs-lookup"><span data-stu-id="c6eed-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="c6eed-484">CreateUserWizard, a continuación, muestra su `CompleteWizardStep`, que muestra un mensaje de confirmación y un botón Continuar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="c6eed-485">Al hacer clic en el botón Continuar provoca una devolución de datos, pero no se realiza ninguna acción, dejando el usuario atascados en la `EnhancedCreateUserWizard.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="c6eed-486">Se puede especificar una dirección URL para enviar al usuario cuando se hace clic en el botón Continuar a través del control CreateUserWizard [ `ContinueDestinationPageUrl` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6eed-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="c6eed-487">Establecer el `ContinueDestinationPageUrl` propiedad en "~ / Membership/AdditionalUserInfo.aspx".</span><span class="sxs-lookup"><span data-stu-id="c6eed-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="c6eed-488">Esto lleva al usuario nuevo a `AdditionalUserInfo.aspx`, donde podrán ver y actualizar su configuración.</span><span class="sxs-lookup"><span data-stu-id="c6eed-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="c6eed-489">Personalización de interfaz de CreateUserWizard a preguntar por el nuevo usuario Pueblo de inicio, página principal y la firma</span><span class="sxs-lookup"><span data-stu-id="c6eed-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="c6eed-490">Interfaz predeterminada del control CreateUserWizard es suficiente para escenarios de creación de cuenta simple donde necesita recopilarán solo información de cuenta de usuario básica como nombre de usuario, contraseña y correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="c6eed-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="c6eed-491">Pero ¿qué ocurre si deseamos solicitar el visitante que escribir su ciudad natal, la página de inicio y la firma al crear su cuenta de usuario?</span><span class="sxs-lookup"><span data-stu-id="c6eed-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="c6eed-492">Es posible personalizar la interfaz del control CreateUserWizard para recopilar información adicional durante el registro, y esta información puede usarse en el `CreatedUser` controlador de eventos para insertar registros adicionales en la base de datos subyacente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="c6eed-493">El control CreateUserWizard extiende el control de Asistente de ASP.NET, que es un control que permite a un programador de la página Definir una serie de ordenada `WizardSteps`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="c6eed-494">El control de asistente representa el paso activo y proporciona una interfaz de navegación que permite el visitante para moverse a través de estos pasos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="c6eed-495">El control Wizard es ideal para dividir una tarea larga en varios pasos cortos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="c6eed-496">Para obtener más información sobre el control del asistente, consulte [crear una interfaz de usuario de paso a paso con el Control de Asistente de ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6eed-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="c6eed-497">Marcado de predeterminado del control CreateUserWizard define dos `WizardSteps`: `CreateUserWizardStep` y `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample12.aspx)]

<span data-ttu-id="c6eed-498">La primera `WizardStep`, `CreateUserWizardStep`, representa la interfaz que solicita el nombre de usuario, contraseña, correo electrónico y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="c6eed-499">Después de que el visitante proporciona esta información y haga clic en "Create User", se muestra el `CompleteWizardStep`, que muestra el mensaje de confirmación y un botón Continuar.</span><span class="sxs-lookup"><span data-stu-id="c6eed-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="c6eed-500">Para personalizar la interfaz del control CreateUserWizard para incluir campos de formulario adicionales, se puede:</span><span class="sxs-lookup"><span data-stu-id="c6eed-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="c6eed-501"><strong>Crear uno o varios nuevos</strong><strong>`WizardStep`</strong><strong>s para contener los elementos de la interfaz de usuario adicionales</strong>.</span><span class="sxs-lookup"><span data-stu-id="c6eed-501"><strong>Create one or more new</strong><strong>`WizardStep`</strong><strong>s to contain the additional user interface elements</strong>.</span></span> <span data-ttu-id="c6eed-502">Para agregar un nuevo `WizardStep` a CreateUserWizard, haga clic en el "Agregar o quitar `WizardStep` s" vínculo desde su etiqueta inteligente para iniciar la `WizardStep` Editor de la colección.</span><span class="sxs-lookup"><span data-stu-id="c6eed-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardStep` s" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="c6eed-503">Desde ahí puede agregar, quitar o reordenar los pasos del asistente.</span><span class="sxs-lookup"><span data-stu-id="c6eed-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="c6eed-504">Éste es el enfoque que se usará para este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c6eed-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="c6eed-505"><strong>Convertir el</strong><strong>`CreateUserWizardStep`</strong><strong>en un modo editable</strong><strong>`WizardStep`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="c6eed-505"><strong>Convert the</strong><strong>`CreateUserWizardStep`</strong><strong>into an editable</strong><strong>`WizardStep`</strong><strong>.</strong></span></span> <span data-ttu-id="c6eed-506">Esto reemplaza el `CreateUserWizardStep` con un equivalente `WizardStep` cuyo marcado define una interfaz de usuario que coincida con el `CreateUserWizardStep`' s.</span><span class="sxs-lookup"><span data-stu-id="c6eed-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="c6eed-507">Convirtiendo el `CreateUserWizardStep` en un `WizardStep` podemos cambiar la posición de los controles o agregar elementos de la interfaz de usuario adicionales a este paso.</span><span class="sxs-lookup"><span data-stu-id="c6eed-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="c6eed-508">Para convertir el `CreateUserWizardStep` o `CompleteWizardStep` en un modo editable `WizardStep`, haga clic en el "personalizar crear usuario paso a paso" o "Personalizar paso completo" vincular de etiquetas inteligentes del control.</span><span class="sxs-lookup"><span data-stu-id="c6eed-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="c6eed-509">**Usar una combinación de las dos opciones anteriores.**</span><span class="sxs-lookup"><span data-stu-id="c6eed-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="c6eed-510">Algo importante a tener en cuenta es que el control CreateUserWizard ejecuta su proceso de creación de la cuenta de usuario cuando se hace clic en el botón "Create User" desde su `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="c6eed-511">No importa si no hay más `WizardStep` s después de la `CreateUserWizardStep` o no.</span><span class="sxs-lookup"><span data-stu-id="c6eed-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="c6eed-512">Al agregar un personalizado `WizardStep` al control CreateUserWizard para recopilar una entrada de usuario adicionales, personalizado `WizardStep` puede colocarse antes o después de la `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="c6eed-513">Si se trata de antes de la `CreateUserWizardStep` , a continuación, se recopilan los datos proporcionados por el usuario adicionales de personalizado `WizardStep` está disponible para el `CreatedUser` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="c6eed-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="c6eed-514">Sin embargo, si personalizado `WizardStep` viene después de `CreateUserWizardStep` , a continuación, en el momento personalizado `WizardStep` se muestra la nueva cuenta de usuario ya ha creado y el `CreatedUser` ya ha activado el evento.</span><span class="sxs-lookup"><span data-stu-id="c6eed-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="c6eed-515">Figura 21 muestra el flujo de trabajo cuando el agregado `WizardStep` precede a la `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="c6eed-516">Puesto que se han recopilado la información de usuario adicional cuando la `CreatedUser` desencadena el evento, lo único que debemos hacer es actualizar la `CreatedUser` controlador de eventos para recuperar estas entradas y úselos para el `INSERT` valores de parámetro de la instrucción (en lugar de `DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="c6eed-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>


<span data-ttu-id="c6eed-517">[![El flujo de trabajo de CreateUserWizard cuando un WizardStep adicional precede el CreateUserWizardStep](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span></span>

<span data-ttu-id="c6eed-518">**Figura 21**: The CreateUserWizard flujo de trabajo cuando una adicionales `WizardStep` Precedes el `CreateUserWizardStep` ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image63.png))</span></span>


<span data-ttu-id="c6eed-519">Si la opción de instalación `WizardStep` se coloca *después* la `CreateUserWizardStep`, sin embargo, el proceso de cuenta de usuario de creación se produce antes de que el usuario haya tenido una oportunidad para escribir su ciudad natal, la página principal o la firma.</span><span class="sxs-lookup"><span data-stu-id="c6eed-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="c6eed-520">En tal caso, esta información adicional debe insertarse en la base de datos una vez creada la cuenta de usuario, como se muestra en la figura 22.</span><span class="sxs-lookup"><span data-stu-id="c6eed-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>


<span data-ttu-id="c6eed-521">[![El flujo de trabajo de CreateUserWizard cuando llega un WizardStep adicional tras el CreateUserWizardStep](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span></span>

<span data-ttu-id="c6eed-522">**Figura 22**: The CreateUserWizard flujo de trabajo cuando una adicionales `WizardStep` viene después la `CreateUserWizardStep` ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image66.png))</span></span>


<span data-ttu-id="c6eed-523">Espera a que el flujo de trabajo se muestra en la figura 22 para insertar un registro en el `UserProfiles` tabla hasta que finalice el paso 2.</span><span class="sxs-lookup"><span data-stu-id="c6eed-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="c6eed-524">Si el visitante cierre su explorador después del paso 1, sin embargo, se habrá alcanzado un estado donde se creó una cuenta de usuario, pero no hay ningún registro se agregó a `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="c6eed-525">Una solución es tener un registro con `NULL` o los valores predeterminados de los valores insertados en `UserProfiles` en el `CreatedUser` controlador de eventos (que se desencadena después del paso 1) y actualice este registrar después de que se complete el paso 2.</span><span class="sxs-lookup"><span data-stu-id="c6eed-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="c6eed-526">Esto garantiza que un `UserProfiles` se agregará el registro para la cuenta de usuario incluso si el usuario sale de la mitad del proceso de registro a través de.</span><span class="sxs-lookup"><span data-stu-id="c6eed-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="c6eed-527">Para este tutorial vamos a crear un nuevo `WizardStep` que tiene lugar tras el `CreateUserWizardStep` pero antes del `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="c6eed-528">Vamos a obtenga primero la WizardStep en colocar y configurado y, a continuación, examinará el código.</span><span class="sxs-lookup"><span data-stu-id="c6eed-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="c6eed-529">En la etiqueta inteligente del control CreateUserWizard, seleccione el "Agregar o quitar `WizardStep` s", que abrirá el `WizardStep` cuadro de diálogo Editor de la colección.</span><span class="sxs-lookup"><span data-stu-id="c6eed-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="c6eed-530">Agregue un nuevo `WizardStep`, y establece su `ID` a `UserSettings`, sus `Title` a "La configuración" y su `StepType` a `Step`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="c6eed-531">Colóquelo para que va después de la `CreateUserWizardStep` ("suscribirse para obtener una cuenta nueva") y antes de la `CompleteWizardStep` ("completar"), tal como se muestra en la figura 23.</span><span class="sxs-lookup"><span data-stu-id="c6eed-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>


<span data-ttu-id="c6eed-532">[![Agregar un nuevo WizardStep al Control CreateUserWizard](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="c6eed-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span></span>

<span data-ttu-id="c6eed-533">**Figura 23**: agregar un nuevo `WizardStep` al CreateUserWizard Control ([haga clic aquí para ver la imagen a tamaño completo](storing-additional-user-information-vb/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="c6eed-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-vb/_static/image69.png))</span></span>


<span data-ttu-id="c6eed-534">Haga clic en Aceptar para cerrar el `WizardStep` cuadro de diálogo Editor de la colección.</span><span class="sxs-lookup"><span data-stu-id="c6eed-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="c6eed-535">El nuevo `WizardStep` se pone de manifiesto marcado declarativo del control CreateUserWizard actualizado:</span><span class="sxs-lookup"><span data-stu-id="c6eed-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample13.aspx)]

<span data-ttu-id="c6eed-536">Tenga en cuenta las nuevas `<asp:WizardStep>` elemento.</span><span class="sxs-lookup"><span data-stu-id="c6eed-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="c6eed-537">Tenemos que agregar la interfaz de usuario para recopilar ciudad natal del nuevo usuario, página de inicio y firma aquí.</span><span class="sxs-lookup"><span data-stu-id="c6eed-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="c6eed-538">Puede escribir este contenido en la sintaxis declarativa o a través del diseñador.</span><span class="sxs-lookup"><span data-stu-id="c6eed-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="c6eed-539">Para utilizar el diseñador, seleccione el paso de "Configuración de la" en la lista desplegable de la etiqueta inteligente para ver el paso en el diseñador.</span><span class="sxs-lookup"><span data-stu-id="c6eed-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="c6eed-540">Al seleccionar un paso a través de la lista de desplegable de la etiqueta inteligente actualiza el control CreateUserWizard [ `ActiveStepIndex` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), que especifica el índice del paso inicial.</span><span class="sxs-lookup"><span data-stu-id="c6eed-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="c6eed-541">Por lo tanto, si usa esta lista desplegable para editar el paso de "Configuración de la" en el diseñador, asegúrese de volver a darle "Inicio de sesión a una nueva cuenta" para que este paso se muestra cuando los usuarios visiten primero la `EnhancedCreateUserWizard.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>


<span data-ttu-id="c6eed-542">Crear una interfaz de usuario en el paso de "Configuración de la" que contiene tres controles de cuadro de texto denominados `HomeTown`, `HomepageUrl`, y `Signature`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="c6eed-543">Después de crear esta interfaz, el marcado declarativo del control CreateUserWizard debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample14.aspx)]

<span data-ttu-id="c6eed-544">Continúe y visite esta página a través de un explorador y crear una nueva cuenta de usuario, especificar valores para la ciudad natal, la página principal y la firma.</span><span class="sxs-lookup"><span data-stu-id="c6eed-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="c6eed-545">Después de completar la `CreateUserWizardStep` se crea la cuenta de usuario en el marco de trabajo de pertenencia y el `CreatedUser` ejecuciones de controlador de eventos, que agrega una nueva fila a `UserProfiles`, pero con una base de datos `NULL` valor `HomeTown`, `HomepageUrl`, y `Signature`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="c6eed-546">Nunca se usan los valores especificados para la ciudad natal, la página principal y la firma.</span><span class="sxs-lookup"><span data-stu-id="c6eed-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="c6eed-547">El resultado neto es una nueva cuenta de usuario con un `UserProfiles` grabar cuya `HomeTown`, `HomepageUrl`, y `Signature` campos todavía tienen que especificarse.</span><span class="sxs-lookup"><span data-stu-id="c6eed-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="c6eed-548">Es necesario ejecutar el código después del paso de "Configuración de la" que toma los valores de ciudad, honepage y firma principales especificados por el usuario y actualiza la correspondiente `UserProfiles` registro.</span><span class="sxs-lookup"><span data-stu-id="c6eed-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="c6eed-549">Cada vez que el usuario se mueve entre los pasos de un asistente de control, el asistente [ `ActiveStepChanged` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) se activa.</span><span class="sxs-lookup"><span data-stu-id="c6eed-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="c6eed-550">Podemos crear un controlador de eventos para este evento y la actualización del `UserProfiles` tabla cuando se haya completado el paso de "Configuración de la".</span><span class="sxs-lookup"><span data-stu-id="c6eed-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="c6eed-551">Agregar un controlador de eventos para el CreateUserWizard `ActiveStepChanged` eventos y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="c6eed-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample15.vb)]

<span data-ttu-id="c6eed-552">El código anterior se inicia mediante la determinación de si hemos llegado el paso "Completar".</span><span class="sxs-lookup"><span data-stu-id="c6eed-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="c6eed-553">Puesto que el paso "Completar" se produce inmediatamente después del paso de "Configuración de la", a continuación, cuando se alcanza el visitante "Completa" paso a paso que quiere decir que acaba de finalizar el paso de "Configuración de la".</span><span class="sxs-lookup"><span data-stu-id="c6eed-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="c6eed-554">En tal caso, es necesario hacer referencia mediante programación a los controles de cuadro de texto dentro de la `UserSettings WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="c6eed-555">Esto se logra utilizando primero la `FindControl` método mediante programación que hacen referencia a la `UserSettings WizardStep`y, a continuación, vuelva a hacer referencia a los cuadros de texto desde el `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="c6eed-556">Una vez que se ha hecho referencia a los cuadros de texto, estamos listos para ejecutar el `UPDATE` instrucción.</span><span class="sxs-lookup"><span data-stu-id="c6eed-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="c6eed-557">El `UPDATE` instrucción tiene el mismo número de parámetros como el `INSERT` instrucción en el `CreatedUser` controlador de eventos, pero aquí usamos los valores de ciudad, la página principal y la firma particulares suministrados por el usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="c6eed-558">Con este controlador de eventos en su lugar, visite la `EnhancedCreateUserWizard.aspx` página a través de un explorador y crear una nueva cuenta de usuario especificar valores para la ciudad natal, la página principal y la firma.</span><span class="sxs-lookup"><span data-stu-id="c6eed-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="c6eed-559">Después de crear la nueva cuenta debe redirigir a la `AdditionalUserInfo.aspx` página, donde introducidas doméstica ciudad, la firma y la página principal se muestra la información.</span><span class="sxs-lookup"><span data-stu-id="c6eed-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="c6eed-560">Nuestro sitio Web actualmente tiene dos páginas desde el que un visitante puede crear una nueva cuenta: `CreatingUserAccounts.aspx` y `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="c6eed-561">Mapa del sitio del sitio Web y la página de inicio de sesión apuntan a la `CreatingUserAccounts.aspx` página, pero la `CreatingUserAccounts.aspx` página no solicita al usuario su información de ciudad, la página principal y la firma particular y no se agregará una fila correspondiente a `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="c6eed-562">Por lo tanto, actualizar la `CreatingUserAccounts.aspx` página por lo que ofrece esta funcionalidad o actualizar la página del mapa del sitio y de inicio de sesión para hacer referencia a `EnhancedCreateUserWizard.aspx` en lugar de `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c6eed-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="c6eed-563">Si elige esta última opción, asegúrese de actualizar la `Membership` la carpeta `Web.config` archivo con el fin de permitir el acceso a los usuarios anónimos el `EnhancedCreateUserWizard.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="c6eed-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>


## <a name="summary"></a><span data-ttu-id="c6eed-564">Resumen</span><span class="sxs-lookup"><span data-stu-id="c6eed-564">Summary</span></span>

<span data-ttu-id="c6eed-565">En este tutorial, observamos técnicas para el modelado de datos que está relacionada con las cuentas de usuario en el marco de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="c6eed-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="c6eed-566">En concreto, analizamos modelado entidades que compartan una relación uno a varios con cuentas de usuario, así como datos que comparte una relación uno a uno.</span><span class="sxs-lookup"><span data-stu-id="c6eed-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="c6eed-567">Además, hemos visto cómo se relacionan información podría mostrar, insertar y actualizada, con algunos ejemplos de uso del control SqlDataSource y otros con el código de ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="c6eed-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="c6eed-568">Este tutorial completa nuestro aspecto en cuentas de usuario.</span><span class="sxs-lookup"><span data-stu-id="c6eed-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="c6eed-569">Empezando por el siguiente tutorial se mostrará en color nuestra atención a los roles.</span><span class="sxs-lookup"><span data-stu-id="c6eed-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="c6eed-570">En los próximos varios tutoriales, veremos el marco de trabajo de Roles, vea cómo crear nuevos roles, cómo asignar roles a los usuarios, para determinar qué roles de un usuario pertenece a y cómo debe aplicar la autorización basada en roles.</span><span class="sxs-lookup"><span data-stu-id="c6eed-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="c6eed-571">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="c6eed-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c6eed-572">Información adicional</span><span class="sxs-lookup"><span data-stu-id="c6eed-572">Further Reading</span></span>

<span data-ttu-id="c6eed-573">Para obtener más información sobre los temas tratados en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="c6eed-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c6eed-574">Obtener acceso y actualizar datos en ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="c6eed-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="c6eed-575">Control de asistente 2.0 de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c6eed-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="c6eed-576">Crear una interfaz de usuario de paso a paso con el Control de asistente 2.0 de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c6eed-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="c6eed-577">Crear parámetros de Control de origen de datos personalizado</span><span class="sxs-lookup"><span data-stu-id="c6eed-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="c6eed-578">Personalizar el Control CreateUserWizard</span><span class="sxs-lookup"><span data-stu-id="c6eed-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="c6eed-579">Tutoriales del Control DetailsView</span><span class="sxs-lookup"><span data-stu-id="c6eed-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="c6eed-580">Mostrar datos con el Control ListView</span><span class="sxs-lookup"><span data-stu-id="c6eed-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="c6eed-581">Si examinamos los controles de validación en ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="c6eed-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="c6eed-582">Edición de inserción y eliminación de datos</span><span class="sxs-lookup"><span data-stu-id="c6eed-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="c6eed-583">Validación del formulario en ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c6eed-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="c6eed-584">Recopilar información de registro de usuario personalizada</span><span class="sxs-lookup"><span data-stu-id="c6eed-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="c6eed-585">Perfiles de ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="c6eed-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="c6eed-586">El Control de asp: ListView</span><span class="sxs-lookup"><span data-stu-id="c6eed-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="c6eed-587">Inicio rápido de perfiles de usuario</span><span class="sxs-lookup"><span data-stu-id="c6eed-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="c6eed-588">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="c6eed-588">About the Author</span></span>

<span data-ttu-id="c6eed-589">Scott Mitchell, autor de varios libros sobre ASP/ASP.NET y fundador de 4GuysFromRolla.com, ha trabajado con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="c6eed-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c6eed-590">Scott funciona como un consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="c6eed-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c6eed-591">Su último libro es *[SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="c6eed-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c6eed-592">Puede ponerse en contacto Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) o a través de su blog en [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="c6eed-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c6eed-593">Agradecimientos especiales a...</span><span class="sxs-lookup"><span data-stu-id="c6eed-593">Special Thanks To…</span></span>

<span data-ttu-id="c6eed-594">Esta serie de tutoriales se revisó por varios revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="c6eed-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c6eed-595">¿Está interesado en revisar mi próximos artículos MSDN?</span><span class="sxs-lookup"><span data-stu-id="c6eed-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c6eed-596">Si es así, me quitar una línea en [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="c6eed-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="c6eed-597">Anterior</span><span class="sxs-lookup"><span data-stu-id="c6eed-597">Previous</span></span>](user-based-authorization-vb.md)
