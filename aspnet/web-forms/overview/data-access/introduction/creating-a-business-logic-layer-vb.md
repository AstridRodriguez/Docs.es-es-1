---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-vb
title: "Creación de una capa de lógica de negocios (VB) | Documentos de Microsoft"
author: rick-anderson
description: "En este tutorial veremos cómo centralizar sus reglas de negocios en una capa de lógica empresarial (BLL) que actúa como intermediario para el intercambio de datos entre t..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/31/2010
ms.topic: article
ms.assetid: 142e5181-29ce-4bb9-907b-2a0becf7928b
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-vb
msc.type: authoredcontent
ms.openlocfilehash: 858383203ddbaa9cb895c3368705f90546c8c974
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/24/2018
---
<a name="creating-a-business-logic-layer-vb"></a><span data-ttu-id="e5643-103">Creación de una capa de lógica de negocios (VB)</span><span class="sxs-lookup"><span data-stu-id="e5643-103">Creating a Business Logic Layer (VB)</span></span>
====================
<span data-ttu-id="e5643-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e5643-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e5643-105">[Descargar la aplicación de ejemplo](http://download.microsoft.com/download/5/d/7/5d7571fc-d0b7-4798-ad4a-c976c02363ce/ASPNET_Data_Tutorial_2_VB.exe) o [descarga de PDF](creating-a-business-logic-layer-vb/_static/datatutorial02vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e5643-105">[Download Sample App](http://download.microsoft.com/download/5/d/7/5d7571fc-d0b7-4798-ad4a-c976c02363ce/ASPNET_Data_Tutorial_2_VB.exe) or [Download PDF](creating-a-business-logic-layer-vb/_static/datatutorial02vb1.pdf)</span></span>

> <span data-ttu-id="e5643-106">En este tutorial veremos cómo centralizar sus reglas de negocios en una capa de lógica empresarial (BLL) que actúa como intermediario para el intercambio de datos entre la capa de presentación y la capa DAL.</span><span class="sxs-lookup"><span data-stu-id="e5643-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="e5643-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="e5643-107">Introduction</span></span>

<span data-ttu-id="e5643-108">La capa de acceso a datos (DAL) creado en el [primer tutorial](creating-a-data-access-layer-vb.md) correctamente separa los datos de acceso lógica de la lógica de presentación.</span><span class="sxs-lookup"><span data-stu-id="e5643-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-vb.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="e5643-109">Sin embargo, mientras que la capa DAL separa claramente los detalles de acceso a datos de la capa de presentación, no aplica las reglas de negocio que se pueden aplicar.</span><span class="sxs-lookup"><span data-stu-id="e5643-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="e5643-110">Por ejemplo, para la aplicación que podríamos desear no permitir la `CategoryID` o `SupplierID` campos de la `Products` tabla modificarse cuando el `Discontinued` campo se establece en 1 o que queramos aplicar reglas de antigüedad, prohibición de situaciones en las que un empleado está administrado por alguien que se contrató a continuación de ellos.</span><span class="sxs-lookup"><span data-stu-id="e5643-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="e5643-111">Otro escenario común es autorización quizás solo los usuarios en un rol determinado, pueden eliminar los productos o pueden cambiar la `UnitPrice` valor.</span><span class="sxs-lookup"><span data-stu-id="e5643-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="e5643-112">En este tutorial veremos cómo centralizar estas reglas de negocios en una capa de lógica empresarial (BLL) que actúa como intermediario para el intercambio de datos entre la capa de presentación y la capa DAL.</span><span class="sxs-lookup"><span data-stu-id="e5643-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="e5643-113">En una aplicación del mundo real, la capa BLL se debería implementar como un proyecto de biblioteca de clases independiente; Sin embargo, para estos tutoriales implementaremos el BLL como una serie de clases en nuestra `App_Code` carpeta con el fin de simplificar la estructura del proyecto.</span><span class="sxs-lookup"><span data-stu-id="e5643-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="e5643-114">Figura 1 muestra las relaciones de arquitectura entre la capa de presentación, BLL y DAL.</span><span class="sxs-lookup"><span data-stu-id="e5643-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![La capa BLL separa el nivel de presentación de la capa de acceso a datos e impone las reglas de negocios](creating-a-business-logic-layer-vb/_static/image1.png)

<span data-ttu-id="e5643-116">**Figura 1**: BLL separa el nivel de presentación de la capa de acceso a datos e impone las reglas de negocios</span><span class="sxs-lookup"><span data-stu-id="e5643-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


<span data-ttu-id="e5643-117">En lugar de crear clases independientes para implementar nuestro [lógica de negocios](http://en.wikipedia.org/wiki/Business_logic), o bien se puede colocar esta lógica directamente en el conjunto de datos con tipo con clases parciales.</span><span class="sxs-lookup"><span data-stu-id="e5643-117">Rather than creating separate classes to implement our [business logic](http://en.wikipedia.org/wiki/Business_logic), we could alternatively place this logic directly in the Typed DataSet with partial classes.</span></span> <span data-ttu-id="e5643-118">Para obtener un ejemplo de crear y ampliar un conjunto de datos con tipo, consulte el primer tutorial.</span><span class="sxs-lookup"><span data-stu-id="e5643-118">For an example of creating and extending a Typed DataSet, refer back to the first tutorial.</span></span>

## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="e5643-119">Paso 1: Crear las clases BLL</span><span class="sxs-lookup"><span data-stu-id="e5643-119">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="e5643-120">Nuestro BLL podría estar compuesta por cuatro clases, uno para cada TableAdapter en la capa DAL; cada una de estas clases BLL tendrá métodos para recuperar, insertar, actualizar y eliminar del TableAdapter respectivo en la capa DAL, aplicar las reglas de negocios adecuada.</span><span class="sxs-lookup"><span data-stu-id="e5643-120">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="e5643-121">Para más correctamente separar las clases relacionadas con DAL y BLL, vamos a crear dos subcarpetas en la `App_Code` carpeta, `DAL` y `BLL`.</span><span class="sxs-lookup"><span data-stu-id="e5643-121">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="e5643-122">Simplemente haga doble clic en el `App_Code` carpeta en el Explorador de soluciones y elija la nueva carpeta.</span><span class="sxs-lookup"><span data-stu-id="e5643-122">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="e5643-123">Después de crear estas dos carpetas, mover el conjunto de datos con tipo creados en el primer tutorial en el `DAL` subcarpeta.</span><span class="sxs-lookup"><span data-stu-id="e5643-123">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="e5643-124">A continuación, cree los cuatro archivos de clase BLL en el `BLL` subcarpeta.</span><span class="sxs-lookup"><span data-stu-id="e5643-124">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="e5643-125">Para ello, haga doble clic en el `BLL` subcarpeta, elija Agregar un nuevo elemento y elija la plantilla de clase.</span><span class="sxs-lookup"><span data-stu-id="e5643-125">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="e5643-126">El nombre de las cuatro clases `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, y `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="e5643-126">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![Agregar cuatro nuevas clases a la carpeta App_Code](creating-a-business-logic-layer-vb/_static/image2.png)

<span data-ttu-id="e5643-128">**Figura 2**: agregar cuatro nuevas clases para el `App_Code` carpeta</span><span class="sxs-lookup"><span data-stu-id="e5643-128">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="e5643-129">A continuación, vamos a agregar métodos a cada una de las clases que simplemente encapsulan los métodos definidos para los TableAdapters del primer tutorial.</span><span class="sxs-lookup"><span data-stu-id="e5643-129">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="e5643-130">Por ahora, estos métodos simplemente llamará directamente en la capa DAL; se tendrá que volver más tarde para agregar cualquier lógica de negocios necesaria.</span><span class="sxs-lookup"><span data-stu-id="e5643-130">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="e5643-131">Si usa Visual Studio Standard Edition o una versión posterior (es decir, está *no* con Visual Web Developer), si lo desea puede diseñar sus clases visualmente usando el [Diseñador de clases](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="e5643-131">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="e5643-132">Hacer referencia a la [clase diseñador Blog](https://blogs.msdn.com/classdesigner/default.aspx) para obtener más información sobre esta nueva característica en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e5643-132">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="e5643-133">Para el `ProductsBLL` que necesitamos agregar un total de siete métodos de clase:</span><span class="sxs-lookup"><span data-stu-id="e5643-133">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="e5643-134">`GetProducts()`Devuelve todos los productos</span><span class="sxs-lookup"><span data-stu-id="e5643-134">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="e5643-135">`GetProductByProductID(productID)`Devuelve el producto con el identificador de producto especificado</span><span class="sxs-lookup"><span data-stu-id="e5643-135">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="e5643-136">`GetProductsByCategoryID(categoryID)`Devuelve todos los productos de la categoría especificada</span><span class="sxs-lookup"><span data-stu-id="e5643-136">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="e5643-137">`GetProductsBySupplier(supplierID)`Devuelve todos los productos del proveedor especificado</span><span class="sxs-lookup"><span data-stu-id="e5643-137">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="e5643-138">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)`Inserta un nuevo producto en la base de datos con los valores pasados de; Devuelve el `ProductID` valor del registro recién insertado</span><span class="sxs-lookup"><span data-stu-id="e5643-138">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="e5643-139">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)`actualiza un producto existente en la base de datos utilizando los valores en el pasado; Devuelve `True` si se ha actualizado con precisión una fila, `False` en caso contrario</span><span class="sxs-lookup"><span data-stu-id="e5643-139">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `True` if precisely one row was updated, `False` otherwise</span></span>
- <span data-ttu-id="e5643-140">`DeleteProduct(productID)`Elimina el producto especificado de la base de datos</span><span class="sxs-lookup"><span data-stu-id="e5643-140">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="e5643-141">ProductsBLL.vb</span><span class="sxs-lookup"><span data-stu-id="e5643-141">ProductsBLL.vb</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample1.vb)]

<span data-ttu-id="e5643-142">Los métodos que simplemente devuelven datos `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, y `GetProductBySuppliersID` son bastante sencilla basta con llamar a hacia abajo en la capa DAL.</span><span class="sxs-lookup"><span data-stu-id="e5643-142">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="e5643-143">Aunque en algunos escenarios pueden existir reglas de negocios que necesitan para implementarse en este nivel (por ejemplo, las reglas de autorización basada en el usuario ha iniciado sesión actualmente o el rol al que pertenece el usuario), simplemente dejaremos estos métodos como-es.</span><span class="sxs-lookup"><span data-stu-id="e5643-143">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="e5643-144">De estos métodos, a continuación, la capa BLL sirve simplemente como un proxy a través del cual el nivel de presentación, tiene acceso a los datos subyacentes de la capa de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="e5643-144">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="e5643-145">El `AddProduct` y `UpdateProduct` métodos tanto toman como parámetros de los valores para los distintos campos de producto y agregar un nuevo producto o actualizar una ya existente, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="e5643-145">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="e5643-146">Dado que muchas de las `Product` pueden aceptar las columnas de tabla `NULL` valores (`CategoryID`, `SupplierID`, y `UnitPrice`, por nombrar algunos), los parámetros de entrada `AddProduct` y `UpdateProduct` que se asignan a dicho uso de columnas [tipos que aceptan valores NULL](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="e5643-146">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="e5643-147">Tipos que aceptan valores NULL son nuevos para .NET 2.0 y proporcionar una técnica para que indica si un tipo de valor debe, en su lugar, ser `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="e5643-147">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `Nothing`.</span></span> <span data-ttu-id="e5643-148">Hacer referencia a la [Paul Vick](http://www.panopticoncentral.net/)de entrada de blog [la verdad acerca de tipos que aceptan valores NULL y VB](http://www.panopticoncentral.net/archive/2004/06/04/1180.aspx) y la documentación técnica de la [acepta valores NULL](https://msdn.microsoft.com/library/b3h38hb0%28VS.80%29.aspx) estructura para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="e5643-148">Refer to the [Paul Vick](http://www.panopticoncentral.net/)'s blog entry [The Truth About Nullable Types and VB](http://www.panopticoncentral.net/archive/2004/06/04/1180.aspx) and the technical documentation for the [Nullable](https://msdn.microsoft.com/library/b3h38hb0%28VS.80%29.aspx) structure for more information.</span></span>

<span data-ttu-id="e5643-149">Los tres métodos devuelven un valor booleano que indica si una fila se ha insertado, actualizada o eliminado porque no está penada por la operación en una fila afectada.</span><span class="sxs-lookup"><span data-stu-id="e5643-149">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="e5643-150">Por ejemplo, si el desarrollador de páginas llama `DeleteProduct` pasando un `ProductID` para un producto inexistente, el `DELETE` instrucción emitida a la base de datos no tendrá efecto alguno y, por tanto, la `DeleteProduct` método devolverá `False`.</span><span class="sxs-lookup"><span data-stu-id="e5643-150">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `False`.</span></span>

<span data-ttu-id="e5643-151">Tenga en cuenta que al agregar un nuevo producto o actualizar uno existente se toman en los valores de campo nuevos o modificados del producto como una lista de valores escalares en lugar de aceptar un `ProductsRow` instancia.</span><span class="sxs-lookup"><span data-stu-id="e5643-151">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="e5643-152">Este enfoque se ha elegido porque la `ProductsRow` clase se deriva de ADO.NET `DataRow` (clase), que no tiene un constructor sin parámetros predeterminado.</span><span class="sxs-lookup"><span data-stu-id="e5643-152">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="e5643-153">Para crear un nuevo `ProductsRow` instancia, debemos crear primero un `ProductsDataTable` de instancia y, a continuación, invocar su `NewProductRow()` (método) (lo que hacemos en `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="e5643-153">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="e5643-154">Este inconveniente rears su cabeza cuando es necesario para insertar y actualizar los productos a través de ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e5643-154">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="e5643-155">En resumen, ObjectDataSource intentará crear una instancia de los parámetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="e5643-155">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="e5643-156">Si se espera que el método BLL un `ProductsRow` instancia, ObjectDataSource intentará crear uno, pero producirá un error debido a la falta de un constructor sin parámetros predeterminado.</span><span class="sxs-lookup"><span data-stu-id="e5643-156">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="e5643-157">Para obtener más información sobre este problema, consulte las siguientes dos entradas de foros de ASP.NET: [ObjectDataSources actualizar con conjuntos de datos de Strongly-Typed](https://forums.asp.net/1098630/ShowPost.aspx), y [problema con ObjectDataSource y conjunto de datos de Strongly-Typed](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="e5643-157">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="e5643-158">Después, tanto en `AddProduct` y `UpdateProduct`, el código crea un `ProductsRow` de instancia y la rellena con los valores que pasa simplemente en.</span><span class="sxs-lookup"><span data-stu-id="e5643-158">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="e5643-159">Al asignar valores a los objetos DataColumn de una fila de datos pueden producirse varias comprobaciones de validación de nivel de campo.</span><span class="sxs-lookup"><span data-stu-id="e5643-159">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="e5643-160">Por lo tanto, pasar manualmente los valores pasados en una fila de datos le ayuda a garantizar la validez de los datos que se pasan al método BLL.</span><span class="sxs-lookup"><span data-stu-id="e5643-160">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="e5643-161">Lamentablemente las clases de DataRow fuertemente tipado generadas por Visual Studio no utilizan tipos que aceptan valores NULL.</span><span class="sxs-lookup"><span data-stu-id="e5643-161">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="e5643-162">En su lugar, para indicar que un objeto DataColumn determinado en un objeto DataRow debe corresponder a un `NULL` valor debemos usar la base de datos la `SetColumnNameNull()` método.</span><span class="sxs-lookup"><span data-stu-id="e5643-162">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="e5643-163">En `UpdateProduct` cargamos en primer lugar en el producto que desea actualizar con `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="e5643-163">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="e5643-164">Aunque puede parecer un viaje innecesario a la base de datos, este viaje adicional demostrará merece la pena en tutoriales futuros que exploran la simultaneidad optimista.</span><span class="sxs-lookup"><span data-stu-id="e5643-164">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="e5643-165">Simultaneidad optimista es una técnica para asegurarse de que dos usuarios que trabajan simultáneamente en los mismos datos no sobrescriban accidentalmente cambios de los demás.</span><span class="sxs-lookup"><span data-stu-id="e5643-165">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="e5643-166">Arrastrar todo el registro también resulta más fácil crear métodos de actualización en la capa BLL que modifican solo un subconjunto de columnas de DataRow.</span><span class="sxs-lookup"><span data-stu-id="e5643-166">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="e5643-167">Cuando se explora la `SuppliersBLL` , veremos un ejemplo de este tipo de clase.</span><span class="sxs-lookup"><span data-stu-id="e5643-167">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="e5643-168">Por último, tenga en cuenta que la `ProductsBLL` clase tiene la [atributo DataObject](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) aplicado (la `[System.ComponentModel.DataObject]` sintaxis inmediatamente anterior a la instrucción class en la parte superior del archivo) y los métodos tienen [ Atributos de DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="e5643-168">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="e5643-169">El `DataObject` atributo marca la clase como un objeto adecuado para enlazarlo a un [control ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), mientras que la `DataObjectMethodAttribute` indica el propósito del método.</span><span class="sxs-lookup"><span data-stu-id="e5643-169">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="e5643-170">Como en el futuro, veremos tutoriales, ObjectDataSource de ASP.NET 2.0 facilita la forma declarativa tener acceso a datos de una clase.</span><span class="sxs-lookup"><span data-stu-id="e5643-170">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="e5643-171">Con el fin de filtrar la lista de posibles clases para enlazar en el Asistente de ObjectDataSource, de forma predeterminada sólo esas clases marcadas como `DataObjects` se muestran en la lista desplegable del asistente.</span><span class="sxs-lookup"><span data-stu-id="e5643-171">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="e5643-172">La `ProductsBLL` clase funcionará igual de bien sin estos atributos, pero agrega resulta más fácil trabajar en el Asistente de ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e5643-172">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="e5643-173">Adición de las otras clases</span><span class="sxs-lookup"><span data-stu-id="e5643-173">Adding the Other Classes</span></span>

<span data-ttu-id="e5643-174">Con el `ProductsBLL` clase completa, todavía tenemos que agregar las clases para trabajar con categorías, proveedores y empleados.</span><span class="sxs-lookup"><span data-stu-id="e5643-174">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="e5643-175">Dedique unos minutos para crear las siguientes clases y métodos con los conceptos descritos en el ejemplo anterior:</span><span class="sxs-lookup"><span data-stu-id="e5643-175">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="e5643-176">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="e5643-176">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="e5643-177">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="e5643-177">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="e5643-178">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="e5643-178">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="e5643-179">El método debe tener en cuenta es el `SuppliersBLL` la clase `UpdateSupplierAddress` método.</span><span class="sxs-lookup"><span data-stu-id="e5643-179">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="e5643-180">Este método proporciona una interfaz para actualizar solo la información de dirección del proveedor.</span><span class="sxs-lookup"><span data-stu-id="e5643-180">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="e5643-181">Internamente, este método lee de la `SupplierDataRow` objeto para el elemento especificado `supplierID` (mediante `GetSupplierBySupplierID`), establece sus propiedades relacionadas con la dirección y, a continuación, llama a hacia abajo en la `SupplierDataTable`del `Update` método.</span><span class="sxs-lookup"><span data-stu-id="e5643-181">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="e5643-182">El `UpdateSupplierAddress` método se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="e5643-182">The `UpdateSupplierAddress` method follows:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample2.vb)]

<span data-ttu-id="e5643-183">Hacer referencia a la descarga de este artículo para mi implementación completa de las clases BLL.</span><span class="sxs-lookup"><span data-stu-id="e5643-183">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="e5643-184">Paso 2: Obtener acceso a los conjuntos de datos con tipo a través de las clases BLL</span><span class="sxs-lookup"><span data-stu-id="e5643-184">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="e5643-185">En el primer tutorial hemos visto algunos ejemplos de trabajar directamente con el conjunto de datos con tipo mediante programación, pero con la adición de nuestras clases BLL, el nivel de presentación debe funcionar con la capa BLL en su lugar.</span><span class="sxs-lookup"><span data-stu-id="e5643-185">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="e5643-186">En el `AllProducts.aspx` ejemplo desde el primer tutorial, el `ProductsTableAdapter` se usa para enlazar la lista de productos para un control GridView, tal como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="e5643-186">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample3.vb)]

<span data-ttu-id="e5643-187">Para usar el nuevo BLL clases, todo lo que debe cambiarse es la primera línea de código simplemente reemplace el `ProductsTableAdapter` objeto con un `ProductBLL` objeto:</span><span class="sxs-lookup"><span data-stu-id="e5643-187">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample4.vb)]

<span data-ttu-id="e5643-188">Las clases BLL también son accesibles mediante declaración (como el conjunto de datos con tipo) mediante el uso de ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e5643-188">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="e5643-189">Se explicará el ObjectDataSource con más detalle en los siguientes tutoriales.</span><span class="sxs-lookup"><span data-stu-id="e5643-189">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="e5643-190">[![Se muestra la lista de productos en un control GridView](creating-a-business-logic-layer-vb/_static/image4.png)](creating-a-business-logic-layer-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e5643-190">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-vb/_static/image4.png)](creating-a-business-logic-layer-vb/_static/image3.png)</span></span>

<span data-ttu-id="e5643-191">**Figura 3**: se muestra la lista de productos en un GridView ([haga clic aquí para ver la imagen a tamaño completo](creating-a-business-logic-layer-vb/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="e5643-191">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-vb/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="e5643-192">Paso 3: Agregar validación de nivel de campo a las clases de DataRow</span><span class="sxs-lookup"><span data-stu-id="e5643-192">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="e5643-193">Validación de nivel de campo son los cheques que pertenece a los valores de propiedad de los objetos de negocio al insertar o actualizar.</span><span class="sxs-lookup"><span data-stu-id="e5643-193">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="e5643-194">Algunas reglas de validación de nivel de campo para los productos incluyen:</span><span class="sxs-lookup"><span data-stu-id="e5643-194">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="e5643-195">El `ProductName` campo debe ser una longitud máxima de 40 caracteres</span><span class="sxs-lookup"><span data-stu-id="e5643-195">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="e5643-196">El `QuantityPerUnit` campo debe ser una longitud máxima de 20 caracteres</span><span class="sxs-lookup"><span data-stu-id="e5643-196">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="e5643-197">El `ProductID`, `ProductName`, y `Discontinued` campos son obligatorios, pero todos los demás campos son opcionales</span><span class="sxs-lookup"><span data-stu-id="e5643-197">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="e5643-198">El `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, y `ReorderLevel` campos deben ser mayor o igual a cero.</span><span class="sxs-lookup"><span data-stu-id="e5643-198">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="e5643-199">Estas reglas pueden y se deben expresar en el nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="e5643-199">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="e5643-200">El límite de caracteres en el `ProductName` y `QuantityPerUnit` campos se capturan en los tipos de datos de las columnas de la `Products` tabla (`nvarchar(40)` y `nvarchar(20)`, respectivamente).</span><span class="sxs-lookup"><span data-stu-id="e5643-200">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="e5643-201">Si los campos son obligatorios y opcionales se expresan por si la columna de tabla de base de datos permite `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="e5643-201">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="e5643-202">Cuatro [restricciones check](https://msdn.microsoft.com/library/ms188258.aspx) existe que asegurarse de que solo los valores iguales a cero o mayores que pueden realizar en el `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, o `ReorderLevel` columnas.</span><span class="sxs-lookup"><span data-stu-id="e5643-202">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="e5643-203">Además de aplicar estas reglas en la base de datos debe aplicarse también en el nivel de conjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="e5643-203">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="e5643-204">De hecho, conjunto de cada DataTable de objetos DataColumn ya capturan la longitud de campo y si un valor es obligatorio u opcional.</span><span class="sxs-lookup"><span data-stu-id="e5643-204">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="e5643-205">Para ver la validación de nivel de campo existente proporciona automáticamente, vaya al diseñador de DataSet, seleccione un campo de una de las tablas de datos y, a continuación, vaya a la ventana Propiedades.</span><span class="sxs-lookup"><span data-stu-id="e5643-205">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="e5643-206">Como se muestra en la figura 4, el `QuantityPerUnit` DataColumn en el `ProductsDataTable` tiene una longitud máxima de 20 caracteres y admite `NULL` valores.</span><span class="sxs-lookup"><span data-stu-id="e5643-206">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="e5643-207">Si se intenta establecer el `ProductsDataRow`del `QuantityPerUnit` propiedad con un valor de cadena más de 20 caracteres un `ArgumentException` se iniciará.</span><span class="sxs-lookup"><span data-stu-id="e5643-207">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="e5643-208">[![DataColumn proporciona validación básica de nivel de campo](creating-a-business-logic-layer-vb/_static/image7.png)](creating-a-business-logic-layer-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="e5643-208">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-vb/_static/image7.png)](creating-a-business-logic-layer-vb/_static/image6.png)</span></span>

<span data-ttu-id="e5643-209">**Figura 4**: el objeto DataColumn proporciona nivel de campo una validación básica ([haga clic aquí para ver la imagen a tamaño completo](creating-a-business-logic-layer-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="e5643-209">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-vb/_static/image8.png))</span></span>


<span data-ttu-id="e5643-210">Por desgracia, no podemos especificamos comprobaciones de los límites, como el `UnitPrice` valor debe ser mayor que o igual a cero, a través de la ventana Propiedades.</span><span class="sxs-lookup"><span data-stu-id="e5643-210">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="e5643-211">Para proporcionar este tipo de validación de nivel de campo es necesario crear un controlador de eventos para la DataTable [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) eventos.</span><span class="sxs-lookup"><span data-stu-id="e5643-211">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="e5643-212">Como se mencionó en la [tutorial anterior](creating-a-data-access-layer-vb.md), los objetos DataSet, DataTable y DataRow creados por el conjunto de datos con tipo se pueden extender mediante el uso de clases parciales.</span><span class="sxs-lookup"><span data-stu-id="e5643-212">As mentioned in the [preceding tutorial](creating-a-data-access-layer-vb.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="e5643-213">Con esta técnica podemos crear un `ColumnChanging` controlador de eventos para el `ProductsDataTable` clase.</span><span class="sxs-lookup"><span data-stu-id="e5643-213">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="e5643-214">Empiece por crear una clase en el `App_Code` carpeta denominada `ProductsDataTable.ColumnChanging.vb`.</span><span class="sxs-lookup"><span data-stu-id="e5643-214">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.vb`.</span></span>


<span data-ttu-id="e5643-215">[![Agregue una nueva clase a la carpeta App_Code](creating-a-business-logic-layer-vb/_static/image10.png)](creating-a-business-logic-layer-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e5643-215">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-vb/_static/image10.png)](creating-a-business-logic-layer-vb/_static/image9.png)</span></span>

<span data-ttu-id="e5643-216">**Figura 5**: agregar una nueva clase para la `App_Code` carpeta ([haga clic aquí para ver la imagen a tamaño completo](creating-a-business-logic-layer-vb/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="e5643-216">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-vb/_static/image11.png))</span></span>


<span data-ttu-id="e5643-217">A continuación, cree un controlador de eventos para el `ColumnChanging` eventos que garantiza que la `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, y `ReorderLevel` valores de columna (si no `NULL`) son mayores o iguales a cero.</span><span class="sxs-lookup"><span data-stu-id="e5643-217">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="e5643-218">Si cualquier columna de este tipo está fuera del intervalo, inicie un `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="e5643-218">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="e5643-219">ProductsDataTable.ColumnChanging.vb</span><span class="sxs-lookup"><span data-stu-id="e5643-219">ProductsDataTable.ColumnChanging.vb</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample5.vb)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="e5643-220">Paso 4: Agregar reglas de negocios a las clases de la capa BLL</span><span class="sxs-lookup"><span data-stu-id="e5643-220">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="e5643-221">Además de la validación de nivel de campo, puede haber reglas de negocios alto nivel que implican distintas entidades o conceptos no se puede expresar en el nivel de columna única, como:</span><span class="sxs-lookup"><span data-stu-id="e5643-221">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="e5643-222">Si un producto ya no está disponible, su `UnitPrice` no se puede actualizar</span><span class="sxs-lookup"><span data-stu-id="e5643-222">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="e5643-223">País de un empleado de residencia debe coincidir con el país de su administrador de residencia</span><span class="sxs-lookup"><span data-stu-id="e5643-223">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="e5643-224">Un producto no se suspenderá si es el único producto proporcionado por el proveedor</span><span class="sxs-lookup"><span data-stu-id="e5643-224">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="e5643-225">Las clases BLL deben contener comprobaciones para garantizar su conformidad con las reglas de negocios de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e5643-225">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="e5643-226">Estas comprobaciones pueden agregarse directamente a los métodos a los que aplicará.</span><span class="sxs-lookup"><span data-stu-id="e5643-226">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="e5643-227">Imagine que nuestro reglas de negocios dictan que un producto no se pudieron marcar discontinuo si era el único producto de un proveedor determinado.</span><span class="sxs-lookup"><span data-stu-id="e5643-227">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="e5643-228">Es decir, si producto *X* fue el producto solo se adquirió de proveedor *Y*, no se pudo marcar *X* como discontinuo; si, sin embargo, proveedor *Y*nos suministrados con tres productos *A*, *B*, y *C*, a continuación, se puede marcar cualquier y todos ellos como desparecido.</span><span class="sxs-lookup"><span data-stu-id="e5643-228">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="e5643-229">Una regla de negocios impar, pero las reglas de negocios y el sentido común siempre no están alineadas.</span><span class="sxs-lookup"><span data-stu-id="e5643-229">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="e5643-230">Para aplicar esta regla de negocios en el `UpdateProducts` método comenzamos comprobando si `Discontinued` se estableció en `True` y, si es así, se llamaría a `GetProductsBySupplierID` para determinar cuántos productos se adquirió de proveedor de este producto.</span><span class="sxs-lookup"><span data-stu-id="e5643-230">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `True` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="e5643-231">Si solo se adquiere un producto de este proveedor, iniciamos una `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="e5643-231">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample6.vb)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="e5643-232">Responder a errores de validación en el nivel de presentación</span><span class="sxs-lookup"><span data-stu-id="e5643-232">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="e5643-233">Al llamar a la capa BLL desde el nivel de presentación se puede decidir si se intenta controlar las excepciones que puedan generarse o de permitir que ascienden a ASP.NET (que se producirá la `HttpApplication`del `Error` evento).</span><span class="sxs-lookup"><span data-stu-id="e5643-233">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="e5643-234">Para controlar una excepción cuando se trabaja con la capa BLL mediante programación, podemos usar un [intente... Detectar](https://msdn.microsoft.com/library/fk6t46tz%28VS.80%29.aspx) bloque, como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e5643-234">To handle an exception when working with the BLL programmatically, we can use a [Try...Catch](https://msdn.microsoft.com/library/fk6t46tz%28VS.80%29.aspx) block, as the following example shows:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample7.vb)]

<span data-ttu-id="e5643-235">Tal y como veremos en tutoriales futuros, controlar las excepciones que surjan de BLL al usar datos de un control Web para insertar, actualizar, o eliminar los datos puede controlarse directamente en un controlador de eventos en lugar de tener que ajustar el código en `Try...Catch` bloques.</span><span class="sxs-lookup"><span data-stu-id="e5643-235">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `Try...Catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="e5643-236">Resumen</span><span class="sxs-lookup"><span data-stu-id="e5643-236">Summary</span></span>

<span data-ttu-id="e5643-237">Una aplicación bien diseñada está diseñada en niveles distintos, cada uno de los cuales encapsula una función concreta.</span><span class="sxs-lookup"><span data-stu-id="e5643-237">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="e5643-238">En el primer tutorial de esta serie de artículos, creamos una capa de acceso a datos mediante conjuntos de datos con tipo; en este tutorial se compila una capa de lógica empresarial como una serie de clases en nuestra aplicación `App_Code` carpeta que llama a nuestro DAL.</span><span class="sxs-lookup"><span data-stu-id="e5643-238">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="e5643-239">La capa BLL implementa la lógica de nivel de campo y de nivel de negocio para nuestra aplicación.</span><span class="sxs-lookup"><span data-stu-id="e5643-239">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="e5643-240">Además de crear un BLL independiente, como hicimos en este tutorial, otra opción es ampliar los métodos de los TableAdapters mediante el uso de clases parciales.</span><span class="sxs-lookup"><span data-stu-id="e5643-240">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="e5643-241">Sin embargo, con esta técnica no nos permiten invalidar los métodos existentes ni lo separar nuestro DAL y nuestro BLL más limpio el enfoque que hemos llevado en este artículo.</span><span class="sxs-lookup"><span data-stu-id="e5643-241">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="e5643-242">Con la capa DAL y BLL completa, se está listos para iniciar en el nivel de presentación.</span><span class="sxs-lookup"><span data-stu-id="e5643-242">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="e5643-243">En el [siguiente tutorial](master-pages-and-site-navigation-vb.md) comenzaremos tomar un desvío breve de los temas de acceso a datos y definir un diseño de página coherente para su uso a lo largo de los tutoriales.</span><span class="sxs-lookup"><span data-stu-id="e5643-243">In the [next tutorial](master-pages-and-site-navigation-vb.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="e5643-244">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="e5643-244">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e5643-245">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="e5643-245">About the Author</span></span>

<span data-ttu-id="e5643-246">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros sobre ASP/ASP.NET y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha trabajado con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="e5643-246">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e5643-247">Scott funciona como un consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="e5643-247">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e5643-248">Su último libro es [*SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="e5643-248">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e5643-249">Puede ponerse en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) o a través de su blog, que se pueden encontrar en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="e5643-249">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e5643-250">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="e5643-250">Special Thanks To</span></span>

<span data-ttu-id="e5643-251">Esta serie de tutoriales se revisó por varios revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="e5643-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e5643-252">Los revisores iniciales para este tutorial fueron Liz Shulok, Dennis Patterson, Carlos Santos y Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="e5643-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="e5643-253">¿Está interesado en revisar mi próximos artículos MSDN?</span><span class="sxs-lookup"><span data-stu-id="e5643-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e5643-254">Si es así, me quitar una línea en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e5643-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="e5643-255">[Anterior](creating-a-data-access-layer-vb.md)
[Siguiente](master-pages-and-site-navigation-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e5643-255">[Previous](creating-a-data-access-layer-vb.md)
[Next](master-pages-and-site-navigation-vb.md)</span></span>
