---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: "Crear una aplicación de formularios Web Forms de ASP.NET segura con el registro de usuario, enviar por correo electrónico de confirmación y restablecimiento de contraseña (C#) | Documentos de Microsoft"
author: Erikre
description: "Este tutorial muestra cómo compilar una aplicación de formularios Web Forms de ASP.NET con el registro de usuario, confirmación por correo electrónico y contraseña restablecer mediante el miembro de la identidad de ASP.NET..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/02/2014
ms.topic: article
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: b6f3821a8022daa26f5efcc009ab3e6283a76a19
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/10/2017
---
<a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="af421-103">Crear una aplicación de formularios Web Forms de ASP.NET segura con el registro de usuario, enviar por correo electrónico de confirmación y restablecimiento de contraseña (C#)</span><span class="sxs-lookup"><span data-stu-id="af421-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>
====================
<span data-ttu-id="af421-104">Por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="af421-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="af421-105">Este tutorial muestra cómo compilar una aplicación de formularios Web Forms de ASP.NET con el registro de usuario, confirmación por correo electrónico y con el sistema de pertenencia de ASP.NET Identity de restablecimiento de contraseña.</span><span class="sxs-lookup"><span data-stu-id="af421-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="af421-106">Este tutorial se basa en de Rick Anderson [tutorial MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="af421-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>


## <a name="introduction"></a><span data-ttu-id="af421-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="af421-107">Introduction</span></span>

<span data-ttu-id="af421-108">Este tutorial le guiará por los pasos necesarios para crear una aplicación de formularios Web Forms de ASP.NET con Visual Studio y ASP.NET 4.5 para crear una aplicación de formularios Web Forms segura con el registro de usuario, el restablecimiento de contraseña y de confirmación de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="af421-109">Tareas del tutorial e información:</span><span class="sxs-lookup"><span data-stu-id="af421-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="af421-110">Crear un sitio Web de ASP.NET aplicación de formularios</span><span class="sxs-lookup"><span data-stu-id="af421-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="af421-111">Enlazar SendGrid</span><span class="sxs-lookup"><span data-stu-id="af421-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="af421-112">Requerir confirmación por correo electrónico antes de inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="af421-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="af421-113">Restablecimiento y recuperación de contraseñas</span><span class="sxs-lookup"><span data-stu-id="af421-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="af421-114">Vínculo de confirmación de correo electrónico de reenvío</span><span class="sxs-lookup"><span data-stu-id="af421-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="af421-115">Solución de problemas de la aplicación</span><span class="sxs-lookup"><span data-stu-id="af421-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="af421-116">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="af421-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="af421-117">Crear una aplicación de formularios Web de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="af421-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="af421-118">Empiece por instalar y ejecutar [Visual Studio Express 2013 para Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="af421-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="af421-119">Instalar [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versiones posteriores también.</span><span class="sxs-lookup"><span data-stu-id="af421-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="af421-120">Advertencia: Debe instalar [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o superior para completar este tutorial.</span><span class="sxs-lookup"><span data-stu-id="af421-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>


1. <span data-ttu-id="af421-121">Cree un nuevo proyecto (**archivo**  - &gt; **nuevo proyecto**) y seleccione el **aplicación Web ASP.NET** plantilla y la versión más reciente de .NET Framework versión de la **nuevo proyecto** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="af421-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="af421-122">Desde el **nuevo proyecto ASP.NET** cuadro de diálogo, seleccione la **formularios Web Forms** plantilla.</span><span class="sxs-lookup"><span data-stu-id="af421-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="af421-123">Deje la autenticación predeterminada como **cuentas de usuario individuales**.</span><span class="sxs-lookup"><span data-stu-id="af421-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="af421-124">Si desea hospedar la aplicación en Azure, deje el **Host en la nube** casilla activada.</span><span class="sxs-lookup"><span data-stu-id="af421-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="af421-125">A continuación, haga clic en **Aceptar** para crear el nuevo proyecto.</span><span class="sxs-lookup"><span data-stu-id="af421-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="af421-126">![Cuadro de diálogo nuevo proyecto de ASP.NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="af421-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="af421-127">Habilitar capa de Sockets seguros (SSL) para el proyecto.</span><span class="sxs-lookup"><span data-stu-id="af421-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="af421-128">Siga los pasos disponibles en el **habilitar SSL para el proyecto** sección de la [Introducción a la serie de tutoriales de formularios Web Forms](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="af421-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="af421-129">Ejecutar la aplicación, haga clic en el **registrar** vincular y registrar un nuevo usuario.</span><span class="sxs-lookup"><span data-stu-id="af421-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="af421-130">En este momento, la validación sola en el correo electrónico se basa en el [[EmailAddress]](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) atributo para asegurarse de que la dirección de correo electrónico está bien formada.</span><span class="sxs-lookup"><span data-stu-id="af421-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="af421-131">Se modificará el código para agregar la confirmación por correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="af421-132">Cierre la ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="af421-132">Close the browser window.</span></span>
5. <span data-ttu-id="af421-133">En **Explorador de servidores** de Visual Studio (**vista**  - &gt; **Explorador de servidores**), vaya a **Connections\ de datos DefaultConnection\Tables\AspNetUsers**, haga clic en y seleccione **Abrir definición de tabla**.</span><span class="sxs-lookup"><span data-stu-id="af421-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="af421-134">La siguiente imagen muestra la `AspNetUsers` esquema de tabla:</span><span class="sxs-lookup"><span data-stu-id="af421-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Esquema de la tabla de AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="af421-136">En **Explorador de servidores**, haga doble clic en el **AspNetUsers** de tabla y seleccione **mostrar datos de tabla**.</span><span class="sxs-lookup"><span data-stu-id="af421-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Datos de la tabla de AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="af421-138">En este momento, no se ha confirmado el correo electrónico para el usuario registrado.</span><span class="sxs-lookup"><span data-stu-id="af421-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="af421-139">Haga clic en la fila y seleccione Eliminar para eliminar el usuario.</span><span class="sxs-lookup"><span data-stu-id="af421-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="af421-140">Podrá agregar este correo electrónico nuevo en el paso siguiente y envíe un mensaje de confirmación a la dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="af421-141">Confirmación por correo electrónico</span><span class="sxs-lookup"><span data-stu-id="af421-141">Email Confirmation</span></span>

<span data-ttu-id="af421-142">Es una práctica recomendada para confirmar el correo electrónico durante el registro de un nuevo usuario para comprobar que no utiliza la suplantación otra persona (es decir, no ha registrado con el correo electrónico de otra persona).</span><span class="sxs-lookup"><span data-stu-id="af421-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="af421-143">Supongamos que tenemos un foro de discusión, puede que desee evitar `"bob@cpandl.com"` al registrar como `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="af421-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="af421-144">Sin confirmación por correo electrónico, `"joe@contoso.com"` pudo obtener el correo electrónico no deseado de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="af421-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="af421-145">Suponga que Roberto accidentalmente registrado como `"bib@cpandl.com"` y no vio, no podrá usar la recuperación de contraseñas porque la aplicación no tiene su correo electrónico correcto.</span><span class="sxs-lookup"><span data-stu-id="af421-145">Suppose Bob accidently registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="af421-146">Confirmación por correo electrónico proporciona sólo una protección limitada de robots y no proporciona protección de correo basura determinado.</span><span class="sxs-lookup"><span data-stu-id="af421-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="af421-147">En general conveniente evitar que los nuevos usuarios se registren todos los datos del sitio Web antes de que se han confirmado por cualquier correo electrónico, un mensaje de texto SMS u otro mecanismo.</span><span class="sxs-lookup"><span data-stu-id="af421-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="af421-148">En las secciones siguientes, se habilitará la confirmación por correo electrónico y modificar el código para evitar que los usuarios recién registrados el registro hasta que se ha confirmado el correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="af421-149">En este tutorial, usará el servicio de correo electrónico SendGrid.</span><span class="sxs-lookup"><span data-stu-id="af421-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="af421-150">Enlazar SendGrid</span><span class="sxs-lookup"><span data-stu-id="af421-150">Hook up SendGrid</span></span>

<span data-ttu-id="af421-151">Aunque este tutorial solo muestra cómo agregar la notificación de correo electrónico a través de [SendGrid](http://sendgrid.com/), puede enviar correo electrónico mediante SMTP y otros mecanismos (vea [recursos adicionales](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="af421-151">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="af421-152">En Visual Studio, abra el **Package Manager Console** (**herramientas**  - &gt; **Administrador de paquetes de NuGet**  - &gt; **Package Manager Console**) y escriba el comando siguiente:</span><span class="sxs-lookup"><span data-stu-id="af421-152">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="af421-153">Vaya a la [página de suscripción de Azure SendGrid](https://azure.microsoft.com/en-us/gallery/store/sendgrid/sendgrid-azure/) y se registra de forma gratuita cuenta de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="af421-153">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/en-us/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="af421-154">Puede también registrarse para obtener una cuenta gratuita de SendGrid directamente en [sitio de SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="af421-154">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="af421-155">De **el Explorador de soluciones** abrir la *IdentityConfig.cs* un archivo en el *aplicación\_iniciar* carpeta y agregue el código siguiente aparecen resaltado en amarillo en el `EmailService` clase para configurar **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="af421-155">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="af421-156">Además, agregue el siguiente `using` instrucciones al principio de la *IdentityConfig.cs* archivo:</span><span class="sxs-lookup"><span data-stu-id="af421-156">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="af421-157">Para simplificar este ejemplo, va a almacenar los valores de cuenta de servicio de correo electrónico en el `appSettings` sección de la *web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="af421-157">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="af421-158">Agregue el siguiente XML aparecen resaltado en amarillo en el *web.config* archivo en la raíz del proyecto:</span><span class="sxs-lookup"><span data-stu-id="af421-158">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="af421-159">Seguridad - nunca almacenar los datos confidenciales en el código fuente.</span><span class="sxs-lookup"><span data-stu-id="af421-159">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="af421-160">En este ejemplo, la cuenta y las credenciales se almacenan en la **appSetting** sección de la *Web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="af421-160">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="af421-161">En Azure, puede almacenar con seguridad estos valores en el  **[configurar](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)**  ficha en el portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="af421-161">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="af421-162">Para obtener información relacionada, vea tema de Rick Anderson [las prácticas recomendadas para implementar las contraseñas y otros datos confidenciales en ASP.NET y Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="af421-162">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="af421-163">Agregue los valores de servicio de correo electrónico para reflejar los valores de autenticación de SendGrid (nombre de usuario y contraseña) para que pueda correcta envían correo electrónico desde la aplicación.</span><span class="sxs-lookup"><span data-stu-id="af421-163">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="af421-164">Asegúrese de usar el nombre de la cuenta de SendGrid en lugar de la dirección de correo electrónico que proporcionó SendGrid.</span><span class="sxs-lookup"><span data-stu-id="af421-164">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="af421-165">Habilitar la confirmación por correo electrónico</span><span class="sxs-lookup"><span data-stu-id="af421-165">Enable Email Confirmation</span></span>

 <span data-ttu-id="af421-166">Para habilitar la confirmación por correo electrónico, deberá modificar el código de registro mediante los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="af421-166">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  
 

1. <span data-ttu-id="af421-167">En el *cuenta* carpeta, abra el *Register.aspx.cs* código subyacente y actualizar el `CreateUser_Click` método para permitir a los siguientes cambios resaltados:</span><span class="sxs-lookup"><span data-stu-id="af421-167">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="af421-168">En **el Explorador de soluciones**, haga clic en *Default.aspx* y seleccione **establecer como página principal**.</span><span class="sxs-lookup"><span data-stu-id="af421-168">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="af421-169">Ejecute la aplicación presionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="af421-169">Run the app by pressing **F5.**</span></span> <span data-ttu-id="af421-170">Cuando se muestre la página, haga clic en el **registrar** vínculo para mostrar la página de registro.</span><span class="sxs-lookup"><span data-stu-id="af421-170">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="af421-171">Escriba su correo electrónico y contraseña, a continuación, haga clic en el **registrar** botón para enviar un mensaje de correo electrónico a través de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="af421-171">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
 <span data-ttu-id="af421-172">El estado actual de su proyecto y de código le permitirá al usuario iniciar sesión una vez que complete el formulario de registro, incluso si aún no lo ha confirmado que su cuenta.</span><span class="sxs-lookup"><span data-stu-id="af421-172">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="af421-173">Compruebe su cuenta de correo electrónico y haga clic en el vínculo para confirmar su correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-173">Check your email account and click on the link to confirm your email.</span></span>  
 <span data-ttu-id="af421-174">Una vez que se envía el formulario de registro, se grabará en.</span><span class="sxs-lookup"><span data-stu-id="af421-174">Once you submit the registration form, you will be logged in.</span></span>  
    ![Sitio Web de ejemplo - iniciado sesión](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="af421-176">Requerir confirmación por correo electrónico antes de inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="af421-176">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="af421-177">Aunque se haya confirmado la cuenta de correo electrónico, en este momento no necesitaría hacer clic en el vínculo situado en el correo electrónico de comprobación sea totalmente con sesión iniciada.</span><span class="sxs-lookup"><span data-stu-id="af421-177">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="af421-178">En la sección siguiente, modificará el código que requieren nuevos usuarios para que tenga un correo electrónico confirmado antes de que se registran en (autenticado).</span><span class="sxs-lookup"><span data-stu-id="af421-178">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="af421-179">En **el Explorador de soluciones** de Visual Studio, actualizar el `CreateUser_Click` evento en el *Register.aspx.cs* código subyacente contenida en el *cuentas* carpeta con el cambios resaltados siguientes:</span><span class="sxs-lookup"><span data-stu-id="af421-179">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="af421-180">Actualización de la `LogIn` método en el *Login.aspx.cs* con los siguientes cambios resaltados de código subyacente:</span><span class="sxs-lookup"><span data-stu-id="af421-180">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="af421-181">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="af421-181">Run the Application</span></span>

 <span data-ttu-id="af421-182">Ahora que ha implementado el código para comprobar si se ha confirmado la dirección de correo electrónico de un usuario, puede comprobar la funcionalidad tanto la **registrar** y **inicio de sesión** páginas.</span><span class="sxs-lookup"><span data-stu-id="af421-182">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="af421-183">Elimine las cuentas en el **AspNetUsers** tabla que contenga el alias de correo electrónico que se va a probar.</span><span class="sxs-lookup"><span data-stu-id="af421-183">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="af421-184">Ejecutar la aplicación (**F5**) y compruebe que no se puede registrar como un usuario hasta que se haya confirmado la dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-184">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="af421-185">Antes de confirmar la nueva cuenta a través del correo electrónico que acabamos de enviar, intenta iniciar sesión con la nueva cuenta.</span><span class="sxs-lookup"><span data-stu-id="af421-185">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="af421-186">Verá que no es posible iniciar sesión y que debe tener una cuenta de correo electrónico confirmado.</span><span class="sxs-lookup"><span data-stu-id="af421-186">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="af421-187">Una vez que confirme la dirección de correo electrónico, inicie sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="af421-187">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="af421-188">Restablecimiento y recuperación de contraseñas</span><span class="sxs-lookup"><span data-stu-id="af421-188">Password Recovery and Reset</span></span>

1. <span data-ttu-id="af421-189">En Visual Studio, quite los caracteres de comentario de la `Forgot` método en el *Forgot.aspx.cs* código subyacente contenida en el *cuenta* carpeta, por lo que el método aparece como sigue:</span><span class="sxs-lookup"><span data-stu-id="af421-189">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="af421-190">Abra la *Login.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="af421-190">Open the *Login.aspx* page.</span></span> <span data-ttu-id="af421-191">Reemplace el marcado cerca del final de la **loginForm** sección como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="af421-191">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="af421-192">Abra la *Login.aspx.cs* código subyacente y elimine la línea siguiente de código aparecen resaltada en amarillo de la `Page_Load` controlador de eventos:</span><span class="sxs-lookup"><span data-stu-id="af421-192">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="af421-193">Ejecute la aplicación presionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="af421-193">Run the app by pressing **F5.**</span></span> <span data-ttu-id="af421-194">Cuando se muestre la página, haga clic en el **sesión** vínculo.</span><span class="sxs-lookup"><span data-stu-id="af421-194">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="af421-195">Haga clic en el **¿olvidó su contraseña?** vínculo para mostrar la **contraseña olvidada** página.</span><span class="sxs-lookup"><span data-stu-id="af421-195">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="af421-196">Escriba su dirección de correo electrónico y haga clic en el **enviar** botón para enviar un correo electrónico a la dirección que le permitirá restablecer su contraseña.</span><span class="sxs-lookup"><span data-stu-id="af421-196">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
 <span data-ttu-id="af421-197">Compruebe su cuenta de correo electrónico y haga clic en el vínculo para mostrar la **restablecer contraseña** página.</span><span class="sxs-lookup"><span data-stu-id="af421-197">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="af421-198">En el **restablecer contraseña** página, escriba su correo electrónico, la contraseña y la contraseña confirmada.</span><span class="sxs-lookup"><span data-stu-id="af421-198">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="af421-199">A continuación, presione la **restablecer** botón.</span><span class="sxs-lookup"><span data-stu-id="af421-199">Then, press the **Reset** button.</span></span>  
 <span data-ttu-id="af421-200">Cuando se restableció correctamente la contraseña, el **cambiar contraseña** se mostrará la página.</span><span class="sxs-lookup"><span data-stu-id="af421-200">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="af421-201">Ahora puede iniciar sesión con la nueva contraseña.</span><span class="sxs-lookup"><span data-stu-id="af421-201">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="af421-202">Vínculo de confirmación de correo electrónico de reenvío</span><span class="sxs-lookup"><span data-stu-id="af421-202">Resend Email Confirmation Link</span></span>

<span data-ttu-id="af421-203">Una vez que un usuario crea una nueva cuenta local, reciben un correo electrónico un vínculo de confirmación que son necesarios para usar antes de que puedan iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="af421-203">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="af421-204">Si el usuario accidentalmente elimina el correo electrónico de confirmación o nunca llega el correo electrónico, necesitará el vínculo de confirmación que se envíen de nuevo.</span><span class="sxs-lookup"><span data-stu-id="af421-204">If the user accidently deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="af421-205">Los cambios de código siguientes muestran cómo habilitarlo.</span><span class="sxs-lookup"><span data-stu-id="af421-205">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="af421-206">En Visual Studio, abra el **Login.aspx.cs** código subyacente y agregue el siguiente controlador de eventos después de la `LogIn` controlador de eventos:</span><span class="sxs-lookup"><span data-stu-id="af421-206">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="af421-207">Modificar el `LogIn` controlador de eventos en el *Login.aspx.cs* código subyacente, cambie el código que se resalta en amarillo, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="af421-207">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="af421-208">Actualización de la *Login.aspx* página agregando el código que se resalta en amarillo, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="af421-208">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="af421-209">Elimine las cuentas en el **AspNetUsers** tabla que contenga el alias de correo electrónico que se va a probar.</span><span class="sxs-lookup"><span data-stu-id="af421-209">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="af421-210">Ejecutar la aplicación (**F5**) y registrar su dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-210">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="af421-211">Antes de confirmar la nueva cuenta a través del correo electrónico que acabamos de enviar, intenta iniciar sesión con la nueva cuenta.</span><span class="sxs-lookup"><span data-stu-id="af421-211">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="af421-212">Verá que no es posible iniciar sesión y que debe tener una cuenta de correo electrónico confirmado.</span><span class="sxs-lookup"><span data-stu-id="af421-212">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="af421-213">Además, ahora puede reenviar un mensaje de confirmación a su cuenta de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="af421-213">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="af421-214">Escriba su dirección de correo electrónico y contraseña, a continuación, presione la **Enviar confirmación** botón.</span><span class="sxs-lookup"><span data-stu-id="af421-214">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="af421-215">Una vez que confirme la dirección de correo electrónico basada en el mensaje de correo electrónico enviados recientemente, inicie sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="af421-215">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="af421-216">Solución de problemas de la aplicación</span><span class="sxs-lookup"><span data-stu-id="af421-216">Troubleshooting the App</span></span>

<span data-ttu-id="af421-217">Si no recibe un correo electrónico con el vínculo para comprobar las credenciales:</span><span class="sxs-lookup"><span data-stu-id="af421-217">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="af421-218">Compruebe la carpeta correo no deseado o spam.</span><span class="sxs-lookup"><span data-stu-id="af421-218">Check your junk or spam folder.</span></span>
- <span data-ttu-id="af421-219">Inicie sesión en la cuenta de SendGrid y haga clic en el [vínculo de actividad de correo electrónico](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="af421-219">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="af421-220">Asegúrese de que usa el nombre de cuenta de usuario de SendGrid como un *Web.config* valor en lugar de su dirección de correo electrónico de la cuenta de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="af421-220">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="af421-221">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="af421-221">Additional Resources</span></span>

- [<span data-ttu-id="af421-222">Vínculos a la identidad de ASP.NET de los recursos recomendados</span><span class="sxs-lookup"><span data-stu-id="af421-222">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="af421-223">Confirmación de cuenta y contraseña de recuperación con la identidad de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="af421-223">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="af421-224">Serie de tutoriales de formularios Web Forms ASP.NET: agregar un proveedor de OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="af421-224">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="af421-225">Implementar una aplicación de formularios Web de ASP.NET segura con pertenencia, OAuth y base de datos SQL en el servicio de aplicaciones de Azure</span><span class="sxs-lookup"><span data-stu-id="af421-225">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/en-us/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="af421-226">Serie de tutoriales de formularios Web Forms ASP.NET - habilitar SSL para el proyecto</span><span class="sxs-lookup"><span data-stu-id="af421-226">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
