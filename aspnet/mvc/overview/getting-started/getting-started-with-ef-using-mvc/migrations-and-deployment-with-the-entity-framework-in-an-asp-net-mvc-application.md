---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
title: Code First Migrations e implementación con Entity Framework en una aplicación ASP.NET MVC | Microsoft Docs
author: tdykstra
description: La aplicación web de Contoso University muestra cómo crear aplicaciones de ASP.NET MVC 5 con Entity Framework 6 Code First y Visual Studio...
ms.author: riande
ms.date: 10/08/2018
ms.assetid: d4dfc435-bda6-4621-9762-9ba270f8de4e
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 5c926c61cec5c7de43e2c3f0e377023b8ee799d0
ms.sourcegitcommit: a4dcca4f1cb81227c5ed3c92dc0e28be6e99447b
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/10/2018
ms.locfileid: "48913026"
---
<a name="code-first-migrations-and-deployment-with-the-entity-framework-in-an-aspnet-mvc-application"></a><span data-ttu-id="90eca-103">Código de la primera implementación con Entity Framework en una aplicación ASP.NET MVC y migraciones</span><span class="sxs-lookup"><span data-stu-id="90eca-103">Code First migrations and deployment with the Entity Framework in an ASP.NET MVC application</span></span>
====================
<span data-ttu-id="90eca-104">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="90eca-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="90eca-105">Descargue el proyecto completado</span><span class="sxs-lookup"><span data-stu-id="90eca-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8)

> <span data-ttu-id="90eca-106">La aplicación web de Contoso University muestra cómo crear aplicaciones de ASP.NET MVC 5 con Entity Framework 6 Code First y Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="90eca-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 5 applications using the Entity Framework 6 Code First and Visual Studio.</span></span> <span data-ttu-id="90eca-107">Para obtener información sobre la serie de tutoriales, consulte [el primer tutorial de la serie](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="90eca-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>

<span data-ttu-id="90eca-108">Hasta ahora la aplicación se ejecutaba localmente en IIS Express en el equipo de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="90eca-108">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="90eca-109">Para que una aplicación real disponible para otras personas a través de Internet, tendrá que implementarlo en un proveedor de hospedaje web.</span><span class="sxs-lookup"><span data-stu-id="90eca-109">To make a real application available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="90eca-110">En este tutorial, implementará la aplicación Contoso University en la nube en Azure.</span><span class="sxs-lookup"><span data-stu-id="90eca-110">In this tutorial, you'll deploy the Contoso University application to the cloud in Azure.</span></span>

<span data-ttu-id="90eca-111">El tutorial contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="90eca-111">The tutorial contains the following sections:</span></span>

- <span data-ttu-id="90eca-112">Habilitar migraciones de Code First.</span><span class="sxs-lookup"><span data-stu-id="90eca-112">Enable Code First Migrations.</span></span> <span data-ttu-id="90eca-113">La característica de migraciones le permite cambiar el modelo de datos e implementar los cambios en producción mediante la actualización del esquema de base de datos sin tener que quitar y volver a crear la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-113">The Migrations feature enables you to change the data model and deploy your changes to production by updating the database schema without having to drop and re-create the database.</span></span>
- <span data-ttu-id="90eca-114">Implementar en Azure.</span><span class="sxs-lookup"><span data-stu-id="90eca-114">Deploy to Azure.</span></span> <span data-ttu-id="90eca-115">Este paso es opcional; se puede continuar con el resto de los tutoriales sin necesidad de implementar el proyecto.</span><span class="sxs-lookup"><span data-stu-id="90eca-115">This step is optional; you can continue with the remaining tutorials without having deployed the project.</span></span>

<span data-ttu-id="90eca-116">Se recomienda que utilice un proceso de integración continua con control de código fuente para la implementación, pero en este tutorial no se trata esos temas.</span><span class="sxs-lookup"><span data-stu-id="90eca-116">We recommend that you use a continuous integration process with source control for deployment, but this tutorial does not cover those topics.</span></span> <span data-ttu-id="90eca-117">Para obtener más información, consulte el [control de código fuente](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) y [integración continua](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) capítulos de [Building Real-World Cloud Apps with Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span><span class="sxs-lookup"><span data-stu-id="90eca-117">For more information, see the [source control](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) and [continuous integration](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) chapters of [Building Real-World Cloud Apps with Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span></span>

## <a name="enable-code-first-migrations"></a><span data-ttu-id="90eca-118">Habilitación de migraciones de Code First</span><span class="sxs-lookup"><span data-stu-id="90eca-118">Enable Code First migrations</span></span>

<span data-ttu-id="90eca-119">Al desarrollar una aplicación nueva, el modelo de datos cambia con frecuencia y, cada vez que lo hace, se deja de sincronizar con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-119">When you develop a new application, your data model changes frequently, and each time the model changes, it gets out of sync with the database.</span></span> <span data-ttu-id="90eca-120">Ha configurado el Entity Framework para quitar y volver a crear la base de datos cada vez que cambie el modelo de datos automáticamente.</span><span class="sxs-lookup"><span data-stu-id="90eca-120">You have configured the Entity Framework to automatically drop and re-create the database each time you change the data model.</span></span> <span data-ttu-id="90eca-121">Al agregar, quitar, o cambiar las clases de entidad o cambiar su `DbContext` clase, la próxima vez que ejecute la aplicación se elimina la base de datos automáticamente, se crea uno nuevo que coincide con el modelo y la inicializa con datos de prueba.</span><span class="sxs-lookup"><span data-stu-id="90eca-121">When you add, remove, or change entity classes or change your `DbContext` class, the next time you run the application it automatically deletes your existing database, creates a new one that matches the model, and seeds it with test data.</span></span>

<span data-ttu-id="90eca-122">Este método para mantener la base de datos sincronizada con el modelo de datos funciona bien hasta que la aplicación se implemente en producción.</span><span class="sxs-lookup"><span data-stu-id="90eca-122">This method of keeping the database in sync with the data model works well until you deploy the application to production.</span></span> <span data-ttu-id="90eca-123">Cuando se ejecuta la aplicación en producción, normalmente está almacenando datos que desea mantener, y no desea perder todo lo que cada vez que realice un cambio, como agregar una nueva columna.</span><span class="sxs-lookup"><span data-stu-id="90eca-123">When the application is running in production, it is usually storing data that you want to keep, and you don't want to lose everything each time you make a change such as adding a new column.</span></span> <span data-ttu-id="90eca-124">El [migraciones de Code First](https://msdn.microsoft.com/data/jj591621) característica soluciona este problema habilitando el Code First actualizar el esquema de base de datos en lugar de quitar y volver a crear la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-124">The [Code First Migrations](https://msdn.microsoft.com/data/jj591621) feature solves this problem by enabling Code First to update the database schema instead of dropping and re-creating the database.</span></span> <span data-ttu-id="90eca-125">En este tutorial, va a implementar la aplicación y preparar para la deberá habilitar migraciones.</span><span class="sxs-lookup"><span data-stu-id="90eca-125">In this tutorial, you'll deploy the application, and to prepare for that you'll enable Migrations.</span></span>

1. <span data-ttu-id="90eca-126">Deshabilitar el inicializador que configuró anteriormente al marcar como comentario o eliminar el `contexts` elemento que ha agregado al archivo Web.config de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-126">Disable the initializer that you set up earlier by commenting out or deleting the `contexts` element that you added to the application Web.config file.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.xml?highlight=2,6)]
2. <span data-ttu-id="90eca-127">También en la aplicación *Web.config* de archivo, cambie el nombre de la base de datos en la cadena de conexión a ContosoUniversity2.</span><span class="sxs-lookup"><span data-stu-id="90eca-127">Also in the application *Web.config* file, change the name of the database in the connection string to ContosoUniversity2.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.xml?highlight=2)]

    <span data-ttu-id="90eca-128">Este cambio configura el proyecto para que la primera migración cree una nueva base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-128">This change sets up the project so that the first migration creates a new database.</span></span> <span data-ttu-id="90eca-129">Esto no es obligatorio, pero más adelante verá por qué es una buena idea.</span><span class="sxs-lookup"><span data-stu-id="90eca-129">This isn't required but you'll see later why it's a good idea.</span></span>
3. <span data-ttu-id="90eca-130">En el menú **Herramientas**, seleccione **Administrador de paquetes NuGet** > **Consola del Administrador de paquetes**.</span><span class="sxs-lookup"><span data-stu-id="90eca-130">From the **Tools** menu, select **NuGet Package Manager** > **Package Manager Console**.</span></span>

1. <span data-ttu-id="90eca-131">En el `PM>` símbolo del sistema escriba los siguientes comandos:</span><span class="sxs-lookup"><span data-stu-id="90eca-131">At the `PM>` prompt enter the following commands:</span></span>

    ```text
    enable-migrations
    add-migration InitialCreate
    ```

    ![comando Enable-migrations](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

    <span data-ttu-id="90eca-133">El `enable-migrations` comando crea un *migraciones* carpeta del proyecto ContosoUniversity, y lo coloca en esa carpeta un *Configuration.cs* archivo que se puede editar para configurar las migraciones.</span><span class="sxs-lookup"><span data-stu-id="90eca-133">The `enable-migrations` command creates a *Migrations* folder in the ContosoUniversity project, and it puts in that folder a *Configuration.cs* file that you can edit to configure Migrations.</span></span>

    <span data-ttu-id="90eca-134">(Si se perdió el paso anterior que le indica que cambie el nombre de la base de datos, las migraciones se encuentra la base de datos existente y realizar automáticamente la `add-migration` comando.</span><span class="sxs-lookup"><span data-stu-id="90eca-134">(If you missed the step above that directs you to change the database name, Migrations will find the existing database and automatically do the `add-migration` command.</span></span> <span data-ttu-id="90eca-135">Eso está bien, simplemente significa que no ejecuta una prueba del código de migraciones antes de implementar la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-135">That's okay, it just means you won't run a test of the migrations code before you deploy the database.</span></span> <span data-ttu-id="90eca-136">Más adelante al ejecutar el `update-database` comando no sucederá nada porque ya existe la base de datos.)</span><span class="sxs-lookup"><span data-stu-id="90eca-136">Later when you run the `update-database` command nothing will happen because the database already exists.)</span></span>

    ![Carpeta de migraciones](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

    <span data-ttu-id="90eca-138">Al igual que la clase de inicializador que vio anteriormente, el `Configuration` clase incluye un `Seed` método.</span><span class="sxs-lookup"><span data-stu-id="90eca-138">Like the initializer class that you saw earlier, the `Configuration` class includes a `Seed` method.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

    <span data-ttu-id="90eca-139">El propósito de la [inicialización](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) método es para que pueda insertar o actualizar los datos de prueba después de que Code First crea o actualiza la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-139">The purpose of the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is to enable you to insert or update test data after Code First creates or updates the database.</span></span> <span data-ttu-id="90eca-140">Se llama al método cuando se crea la base de datos y cada vez que se actualiza el esquema de base de datos después de cambiar de un modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-140">The method is called when the database is created and every time the database schema is updated after a data model change.</span></span>

### <a name="set-up-the-seed-method"></a><span data-ttu-id="90eca-141">Configurar el método de inicialización</span><span class="sxs-lookup"><span data-stu-id="90eca-141">Set up the Seed method</span></span>

<span data-ttu-id="90eca-142">Al quitar y volver a crear la base de datos para cada cambio de modelo de datos, utilice la clase de inicializador `Seed` método para insertar datos de prueba, porque después de cada cambio de modelo se quita la base de datos y todos los datos de prueba se pierde.</span><span class="sxs-lookup"><span data-stu-id="90eca-142">When you drop and re-create the database for every data model change, you use the initializer class's `Seed` method to insert test data, because after every model change the database is dropped and all the test data is lost.</span></span> <span data-ttu-id="90eca-143">Con migraciones de Code First, prueba los datos se conservan después de realizar cambios de la base de datos, por lo que incluso los datos de prueba de la [inicialización](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) método normalmente no es necesario.</span><span class="sxs-lookup"><span data-stu-id="90eca-143">With Code First Migrations, test data is retained after database changes, so including test data in the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is typically not necessary.</span></span> <span data-ttu-id="90eca-144">De hecho, no desea que el `Seed` método para insertar datos de prueba si va a usar las migraciones para implementar la base de datos en producción, porque el `Seed` método se ejecutará en producción.</span><span class="sxs-lookup"><span data-stu-id="90eca-144">In fact, you don't want the `Seed` method to insert test data if you'll be using Migrations to deploy the database to production, because the `Seed` method will run in production.</span></span> <span data-ttu-id="90eca-145">En ese caso, desea que el `Seed` método para insertar en la base de datos solo los datos que necesita en producción.</span><span class="sxs-lookup"><span data-stu-id="90eca-145">In that case, you want the `Seed` method to insert into the database only the data that you need in production.</span></span> <span data-ttu-id="90eca-146">Por ejemplo, es posible que desee incluir nombres de departamento real en la base de datos la `Department` tabla cuando la aplicación esté disponible en producción.</span><span class="sxs-lookup"><span data-stu-id="90eca-146">For example, you might want the database to include actual department names in the `Department` table when the application becomes available in production.</span></span>

<span data-ttu-id="90eca-147">Para este tutorial, usará las migraciones para la implementación, pero su `Seed` método insertará datos de prueba de todos modos para que resulte más fácil ver cómo funciona la funcionalidad de la aplicación sin tener que insertar manualmente una gran cantidad de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-147">For this tutorial, you'll be using Migrations for deployment, but your `Seed` method will insert test data anyway in order to make it easier to see how application functionality works without having to manually insert a lot of data.</span></span>

1. <span data-ttu-id="90eca-148">Reemplace el contenido de la *Configuration.cs* archivo con el código siguiente, que carga los datos de prueba en la nueva base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-148">Replace the contents of the *Configuration.cs* file with the following code, which loads test data into the new database.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

    <span data-ttu-id="90eca-149">El [inicialización](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) método toma el objeto de contexto de base de datos como un parámetro de entrada y el código en el método utiliza ese objeto para agregar nuevas entidades a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-149">The [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method takes the database context object as an input parameter, and the code in the method uses that object to add new entities to the database.</span></span> <span data-ttu-id="90eca-150">Para cada tipo de entidad, el código crea una colección de nuevas entidades, los agrega a la correspondiente [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) propiedad y, a continuación, guarda los cambios en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-150">For each entity type, the code creates a collection of new entities, adds them to the appropriate [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) property, and then saves the changes to the database.</span></span> <span data-ttu-id="90eca-151">No es necesario llamar a la [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) método después de cada grupo de entidades, como se hizo aquí, pero hacerlo le ayuda a localizar el origen de un problema si se produce una excepción mientras se está escribiendo el código en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-151">It isn't necessary to call the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method after each group of entities, as is done here, but doing that helps you locate the source of a problem if an exception occurs while the code is writing to the database.</span></span>

    <span data-ttu-id="90eca-152">Algunas de las instrucciones que insertan datos utilizan el [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) método para realizar una operación "upsert".</span><span class="sxs-lookup"><span data-stu-id="90eca-152">Some of the statements that insert data use the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method to perform an "upsert" operation.</span></span> <span data-ttu-id="90eca-153">Dado que el `Seed` método se ejecuta cada vez que ejecute la `update-database` comando, normalmente después de cada migración, simplemente no se puede insertar datos, porque las filas que se está intentando agregar ya estarán allí después de la primera migración que crea la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-153">Because the `Seed` method runs every time you execute the `update-database` command, typically after each migration, you can't just insert data, because the rows you are trying to add will already be there after the first migration that creates the database.</span></span> <span data-ttu-id="90eca-154">La operación "upsert" evita los errores que sucedería si se intenta insertar una fila que ya existe, pero ***invalida*** cualquier cambio en los datos que ha realizado durante las pruebas de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-154">The "upsert" operation prevents errors that would happen if you try to insert a row that already exists, but it ***overrides*** any changes to data that you may have made while testing the application.</span></span> <span data-ttu-id="90eca-155">Con datos de prueba en algunas tablas puede no ser conveniente que esto ocurra: en algunos casos cuando cambien los datos durante las pruebas que desee los cambios tras las actualizaciones de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-155">With test data in some tables you might not want that to happen: in some cases when you change data while testing you want your changes to remain after database updates.</span></span> <span data-ttu-id="90eca-156">En ese caso en el que desea realizar una operación de inserción condicional: insertar una fila solo si ya no existe.</span><span class="sxs-lookup"><span data-stu-id="90eca-156">In that case you want to do a conditional insert operation: insert a row only if it doesn't already exist.</span></span> <span data-ttu-id="90eca-157">El método de inicialización usa ambos enfoques.</span><span class="sxs-lookup"><span data-stu-id="90eca-157">The Seed method uses both approaches.</span></span>

    <span data-ttu-id="90eca-158">El primer parámetro pasado a la [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) método especifica la propiedad que se utilizará para comprobar si ya existe una fila.</span><span class="sxs-lookup"><span data-stu-id="90eca-158">The first parameter passed to the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method specifies the property to use to check if a row already exists.</span></span> <span data-ttu-id="90eca-159">Para los datos de estudiante de prueba que se va a proporcionar, el `LastName` propiedad puede usarse para este propósito, puesto que cada apellido en la lista es único:</span><span class="sxs-lookup"><span data-stu-id="90eca-159">For the test student data that you are providing, the `LastName` property can be used for this purpose since each last name in the list is unique:</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

    <span data-ttu-id="90eca-160">Este código supone que los apellidos son únicos.</span><span class="sxs-lookup"><span data-stu-id="90eca-160">This code assumes that last names are unique.</span></span> <span data-ttu-id="90eca-161">Si agrega manualmente un alumno con un nombre último duplicado, obtendrá la próxima vez que se realiza una migración a la siguiente excepción:</span><span class="sxs-lookup"><span data-stu-id="90eca-161">If you manually add a student with a duplicate last name, you'll get the following exception the next time you perform a migration:</span></span>

    <span data-ttu-id="90eca-162">**La secuencia contiene más de un elemento**</span><span class="sxs-lookup"><span data-stu-id="90eca-162">**Sequence contains more than one element**</span></span>

    <span data-ttu-id="90eca-163">Para obtener información sobre cómo controlar los datos redundantes, como dos estudiantes denominados "Alexander Carson", consulte [Seeding y bases de datos de depuración de Entity Framework (EF)](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) en el blog de Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="90eca-163">For information about how to handle redundant data such as two students named "Alexander Carson", see [Seeding and Debugging Entity Framework (EF) DBs](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) on Rick Anderson's blog.</span></span> <span data-ttu-id="90eca-164">Para obtener más información sobre la `AddOrUpdate` método, consulte [tener cuidado con el método de EF 4.3 AddOrUpdate](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) en el blog de Julie.</span><span class="sxs-lookup"><span data-stu-id="90eca-164">For more information about the `AddOrUpdate` method, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

    <span data-ttu-id="90eca-165">El código que crea `Enrollment` entidades se supone que tiene el `ID` valor en las entidades en el `students` colección, aunque no establece esta propiedad en el código que crea la colección.</span><span class="sxs-lookup"><span data-stu-id="90eca-165">The code that creates `Enrollment` entities assumes you have the `ID` value in the entities in the `students` collection, although you didn't set that property in the code that creates the collection.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs?highlight=2)]

    <span data-ttu-id="90eca-166">Puede usar el `ID` propiedad aquí porque el `ID` valor se establece cuando se llama a `SaveChanges` para el `students` colección.</span><span class="sxs-lookup"><span data-stu-id="90eca-166">You can use the `ID` property here because the `ID` value is set when you call `SaveChanges` for the `students` collection.</span></span> <span data-ttu-id="90eca-167">EF obtiene automáticamente el valor de clave principal cuando inserta una entidad en la base de datos, y actualiza el `ID` propiedad de la entidad en la memoria.</span><span class="sxs-lookup"><span data-stu-id="90eca-167">EF automatically gets the primary key value when it inserts an entity into the database, and it updates the `ID` property of the entity in memory.</span></span>

    <span data-ttu-id="90eca-168">El código que agrega cada `Enrollment` entidad a la `Enrollments` no usa el conjunto de entidades la `AddOrUpdate` método.</span><span class="sxs-lookup"><span data-stu-id="90eca-168">The code that adds each `Enrollment` entity to the `Enrollments` entity set doesn't use the `AddOrUpdate` method.</span></span> <span data-ttu-id="90eca-169">Comprueba si una entidad ya existe y que inserta la entidad si no existe.</span><span class="sxs-lookup"><span data-stu-id="90eca-169">It checks if an entity already exists and inserts the entity if it doesn't exist.</span></span> <span data-ttu-id="90eca-170">Este enfoque, conservará los cambios que realice en un nivel de inscripción mediante el uso de la interfaz de usuario de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-170">This approach will preserve changes you make to an enrollment grade by using the application UI.</span></span> <span data-ttu-id="90eca-171">El código establece bucles en cada miembro de la `Enrollment` [lista](https://msdn.microsoft.com/library/6sh2ey19.aspx) y si la inscripción no se encuentra en la base de datos, agrega la inscripción a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-171">The code loops through each member of the `Enrollment`[List](https://msdn.microsoft.com/library/6sh2ey19.aspx) and if the enrollment is not found in the database, it adds the enrollment to the database.</span></span> <span data-ttu-id="90eca-172">La primera vez que actualice la base de datos, la base de datos estará vacío, por lo que se va a agregar cada inscripción.</span><span class="sxs-lookup"><span data-stu-id="90eca-172">The first time you update the database, the database will be empty, so it will add each enrollment.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

2. <span data-ttu-id="90eca-173">Compile el proyecto.</span><span class="sxs-lookup"><span data-stu-id="90eca-173">Build the project.</span></span>

### <a name="execute-the-first-migration"></a><span data-ttu-id="90eca-174">Ejecutar la primera migración</span><span class="sxs-lookup"><span data-stu-id="90eca-174">Execute the first migration</span></span>

<span data-ttu-id="90eca-175">Cuando ejecutó el `add-migration` de comandos, las migraciones generan el código que desea crear la base de datos desde el principio.</span><span class="sxs-lookup"><span data-stu-id="90eca-175">When you executed the `add-migration` command, Migrations generated the code that would create the database from scratch.</span></span> <span data-ttu-id="90eca-176">Este código también está disponible en el *migraciones* carpeta, en el archivo denominado  *&lt;timestamp&gt;\_InitialCreate.cs*.</span><span class="sxs-lookup"><span data-stu-id="90eca-176">This code is also in the *Migrations* folder, in the file named *&lt;timestamp&gt;\_InitialCreate.cs*.</span></span> <span data-ttu-id="90eca-177">El `Up` método de la `InitialCreate` clase crea las tablas de base de datos que corresponden a los conjuntos de entidades del modelo de datos, y el `Down` método elimina.</span><span class="sxs-lookup"><span data-stu-id="90eca-177">The `Up` method of the `InitialCreate` class creates the database tables that correspond to the data model entity sets, and the `Down` method deletes them.</span></span>

[!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="90eca-178">Las migraciones llaman al método `Up` para implementar los cambios del modelo de datos para una migración.</span><span class="sxs-lookup"><span data-stu-id="90eca-178">Migrations calls the `Up` method to implement the data model changes for a migration.</span></span> <span data-ttu-id="90eca-179">Cuando se escribe un comando para revertir la actualización, las migraciones llaman al método `Down`.</span><span class="sxs-lookup"><span data-stu-id="90eca-179">When you enter a command to roll back the update, Migrations calls the `Down` method.</span></span>

<span data-ttu-id="90eca-180">Se trata de la migración inicial que se creó cuando se escribió el `add-migration InitialCreate` comando.</span><span class="sxs-lookup"><span data-stu-id="90eca-180">This is the initial migration that was created when you entered the `add-migration InitialCreate` command.</span></span> <span data-ttu-id="90eca-181">El parámetro (`InitialCreate` en el ejemplo) se usa para el archivo de nombre y puede ser lo que quiera; normalmente, elegir una palabra o frase que resuma lo que se hace en la migración.</span><span class="sxs-lookup"><span data-stu-id="90eca-181">The parameter (`InitialCreate` in the example) is used for the file name and can be whatever you want; you typically choose a word or phrase that summarizes what is being done in the migration.</span></span> <span data-ttu-id="90eca-182">Por ejemplo, podría denominar una migración posterior &quot;AddDepartmentTable&quot;.</span><span class="sxs-lookup"><span data-stu-id="90eca-182">For example, you might name a later migration &quot;AddDepartmentTable&quot;.</span></span>

<span data-ttu-id="90eca-183">Si creó la migración inicial cuando la base de datos ya existía, se genera el código de creación de la base de datos pero no es necesario ejecutarlo porque la base de datos ya coincide con el modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-183">If you created the initial migration when the database already exists, the database creation code is generated but it doesn't have to run because the database already matches the data model.</span></span> <span data-ttu-id="90eca-184">Al implementar la aplicación en otro entorno donde la base de datos todavía no existe, se ejecutará este código para crear la base de datos, por lo que es recomendable probarlo primero.</span><span class="sxs-lookup"><span data-stu-id="90eca-184">When you deploy the app to another environment where the database doesn't exist yet, this code will run to create your database, so it's a good idea to test it first.</span></span> <span data-ttu-id="90eca-185">Por eso ha cambiado el nombre de la base de datos en la cadena de conexión anteriormente&mdash;para que las migraciones puedan crear uno nuevo desde cero.</span><span class="sxs-lookup"><span data-stu-id="90eca-185">That's why you changed the name of the database in the connection string earlier&mdash;so that migrations can create a new one from scratch.</span></span>

1. <span data-ttu-id="90eca-186">En el **Package Manager Console** ventana, escriba el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="90eca-186">In the **Package Manager Console** window, enter the following command:</span></span>

    `update-database`

    ![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

    <span data-ttu-id="90eca-187">El `update-database` comando ejecuta el `Up` método para crear la base de datos y, a continuación, se ejecuta el `Seed` método para rellenar la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-187">The `update-database` command runs the `Up` method to create the database and then it runs the `Seed` method to populate the database.</span></span> <span data-ttu-id="90eca-188">El mismo proceso se ejecutará automáticamente en producción después de implementar la aplicación, como verá en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="90eca-188">The same process will run automatically in production after you deploy the application, as you'll see in the following section.</span></span>
2. <span data-ttu-id="90eca-189">Use **Explorador de servidores** para inspeccionar la base de datos como hizo en el primer tutorial y ejecutar la aplicación para comprobar que todo funciona igual que antes.</span><span class="sxs-lookup"><span data-stu-id="90eca-189">Use **Server Explorer** to inspect the database as you did in the first tutorial, and run the application to verify that everything still works the same as before.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="90eca-190">Implementar en Azure</span><span class="sxs-lookup"><span data-stu-id="90eca-190">Deploy to Azure</span></span>

<span data-ttu-id="90eca-191">Hasta ahora la aplicación se ejecutaba localmente en IIS Express en el equipo de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="90eca-191">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="90eca-192">Para que esté disponible para otras personas a través de Internet, tendrá que implementarlo en un proveedor de hospedaje web.</span><span class="sxs-lookup"><span data-stu-id="90eca-192">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="90eca-193">En esta sección del tutorial, va a implementar en Azure.</span><span class="sxs-lookup"><span data-stu-id="90eca-193">In this section of the tutorial, you'll deploy it to Azure.</span></span> <span data-ttu-id="90eca-194">Esta sección es opcional; puede omitir este paso y continuar con el tutorial siguiente, o puede adaptar las instrucciones de esta sección para otro proveedor de hospedaje de su elección.</span><span class="sxs-lookup"><span data-stu-id="90eca-194">This section is optional; you can skip this and continue with the following tutorial, or you can adapt the instructions in this section for a different hosting provider of your choice.</span></span>

### <a name="use-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="90eca-195">Usar migraciones de Code First para implementar la base de datos</span><span class="sxs-lookup"><span data-stu-id="90eca-195">Use Code First migrations to deploy the database</span></span>

<span data-ttu-id="90eca-196">Para implementar la base de datos, deberá usar migraciones de Code First.</span><span class="sxs-lookup"><span data-stu-id="90eca-196">To deploy the database, you'll use Code First Migrations.</span></span> <span data-ttu-id="90eca-197">Cuando se crea el perfil de publicación que usar para configurar las opciones de implementación desde Visual Studio, seleccionará una casilla denominada **Actualizar base de datos**.</span><span class="sxs-lookup"><span data-stu-id="90eca-197">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box labeled **Update Database**.</span></span> <span data-ttu-id="90eca-198">Esta configuración hace que el proceso de implementación configurar automáticamente la aplicación *Web.config* de archivos en el servidor de destino para que utilice Code First la `MigrateDatabaseToLatestVersion` clase de inicializador.</span><span class="sxs-lookup"><span data-stu-id="90eca-198">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="90eca-199">Visual Studio no hace nada con la base de datos durante el proceso de implementación mientras se está copiando el proyecto en el servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="90eca-199">Visual Studio doesn't do anything with the database during the deployment process while it is copying your project to the destination server.</span></span> <span data-ttu-id="90eca-200">Cuando se ejecuta la aplicación implementada y tiene acceso a la base de datos por primera vez después de la implementación, Code First comprueba si la base de datos coincide con el modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-200">When you run the deployed application and it accesses the database for the first time after deployment, Code First checks if the database matches the data model.</span></span> <span data-ttu-id="90eca-201">Si se produce un error de coincidencia, Code First crea automáticamente la base de datos (si aún no existe) o actualiza el esquema de base de datos a la versión más reciente (si existe una base de datos, pero no coincide con el modelo).</span><span class="sxs-lookup"><span data-stu-id="90eca-201">If there's a mismatch, Code First automatically creates the database (if it doesn't exist yet) or updates the database schema to the latest version (if a database exists but doesn't match the model).</span></span> <span data-ttu-id="90eca-202">Si la aplicación implementa un migraciones `Seed` método, se ejecuta el método después de la base de datos se crea o actualiza el esquema.</span><span class="sxs-lookup"><span data-stu-id="90eca-202">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="90eca-203">Las migraciones `Seed` método inserta datos de prueba.</span><span class="sxs-lookup"><span data-stu-id="90eca-203">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="90eca-204">Si se implementa en un entorno de producción, tendría que cambiar el `Seed` método por lo que TI sólo inserta los datos que se van a insertarse en la base de datos de producción.</span><span class="sxs-lookup"><span data-stu-id="90eca-204">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="90eca-205">Por ejemplo, en el modelo de datos actual es posible que desee tener cursos real pero estudiantes ficticios en la base de datos de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="90eca-205">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="90eca-206">Puede escribir un `Seed` método para cargar ambos en el desarrollo y, a continuación, marque como comentario los alumnos ficticios antes de implementar en producción.</span><span class="sxs-lookup"><span data-stu-id="90eca-206">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="90eca-207">También se puede escribir un `Seed` método para cargar solo los cursos y escribir manualmente los alumnos ficticios en la base de datos de prueba mediante el uso de la interfaz de usuario de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-207">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-an-azure-account"></a><span data-ttu-id="90eca-208">Obtener una cuenta de Azure</span><span class="sxs-lookup"><span data-stu-id="90eca-208">Get an Azure account</span></span>

<span data-ttu-id="90eca-209">Necesitará una cuenta de Azure.</span><span class="sxs-lookup"><span data-stu-id="90eca-209">You'll need an Azure account.</span></span> <span data-ttu-id="90eca-210">Si aún no tiene uno, pero tiene una suscripción de Visual Studio, puede [activar los beneficios de suscripción](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span><span class="sxs-lookup"><span data-stu-id="90eca-210">If you don't already have one, but you do have a Visual Studio subscription, you can [activate your subscription benefits](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span></span> <span data-ttu-id="90eca-211">En caso contrario, puede crear una cuenta de evaluación gratuita en tan solo unos minutos.</span><span class="sxs-lookup"><span data-stu-id="90eca-211">Otherwise, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="90eca-212">Para obtener más información, consulte [evaluación gratuita de Azure](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="90eca-212">For details, see [Azure Free Trial](https://azure.microsoft.com/free/).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-azure"></a><span data-ttu-id="90eca-213">Crear un sitio web y una base de datos SQL en Azure</span><span class="sxs-lookup"><span data-stu-id="90eca-213">Create a web site and a SQL database in Azure</span></span>

<span data-ttu-id="90eca-214">La aplicación web en Azure se ejecutará en un entorno de hospedaje compartido, lo que significa que se ejecuta en máquinas virtuales (VM) que se comparten con otros clientes de Azure.</span><span class="sxs-lookup"><span data-stu-id="90eca-214">Your web app in Azure will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Azure clients.</span></span> <span data-ttu-id="90eca-215">Un entorno de hospedaje compartido es una manera de bajo costo para empezar a trabajar en la nube.</span><span class="sxs-lookup"><span data-stu-id="90eca-215">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="90eca-216">Más adelante, si aumenta el tráfico web, la aplicación puede escalar para satisfacer las necesidades de forma que se ejecutan en máquinas virtuales dedicadas.</span><span class="sxs-lookup"><span data-stu-id="90eca-216">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="90eca-217">Para obtener más información sobre opciones de precios para Azure App Service, lea [precios de App Service](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="90eca-217">To learn more about Pricing Options for Azure App Service, read [App Service pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<span data-ttu-id="90eca-218">Implementará la base de datos a Azure SQL database.</span><span class="sxs-lookup"><span data-stu-id="90eca-218">You'll deploy the database to Azure SQL database.</span></span> <span data-ttu-id="90eca-219">SQL database es un servicio de base de datos relacional basado en la nube que se basa en tecnologías de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="90eca-219">SQL database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="90eca-220">Herramientas y aplicaciones que funcionan con SQL Server también funcionan con SQL database.</span><span class="sxs-lookup"><span data-stu-id="90eca-220">Tools and applications that work with SQL Server also work with SQL database.</span></span>

1. <span data-ttu-id="90eca-221">En el [Portal de administración de Azure](https://portal.azure.com), elija **crear un recurso** en la izquierda ficha y, a continuación, elija **ver todo** en el **New** panel (o *hoja*) para ver todos los recursos disponibles.</span><span class="sxs-lookup"><span data-stu-id="90eca-221">In the [Azure Management Portal](https://portal.azure.com), choose **Create a resource** in the left tab and then choose **See all** on the **New** pane (or *blade*) to see all available resources.</span></span> <span data-ttu-id="90eca-222">Elija **aplicación Web + SQL** en el **Web** sección de la **todo** hoja.</span><span class="sxs-lookup"><span data-stu-id="90eca-222">Choose **Web App + SQL** in the **Web** section of the **Everything** blade.</span></span> <span data-ttu-id="90eca-223">Por último, elija **crear**.</span><span class="sxs-lookup"><span data-stu-id="90eca-223">Finally, choose **Create**.</span></span>

    ![Crear un recurso en Azure portal](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-azure-resource.png)

   <span data-ttu-id="90eca-225">El formulario para crear un nuevo **nueva aplicación Web + SQL** abre recursos.</span><span class="sxs-lookup"><span data-stu-id="90eca-225">The form to create a new **New Web App + SQL** resource opens.</span></span>

2. <span data-ttu-id="90eca-226">Escriba una cadena en el **nombre de la aplicación** cuadro que se usará como la dirección URL única para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-226">Enter a string in the **App name** box to use as the unique URL for your application.</span></span> <span data-ttu-id="90eca-227">La dirección URL completa consistirá en lo que escriba aquí además el dominio predeterminado de Azure App Services (. azurewebsites.net).</span><span class="sxs-lookup"><span data-stu-id="90eca-227">The complete URL will consist of what you enter here plus the default domain of Azure App Services (.azurewebsites.net).</span></span> <span data-ttu-id="90eca-228">Si el **nombre de la aplicación** ya está en uso, el asistente le proporcionará una roja *el nombre de la aplicación no está disponible* mensaje.</span><span class="sxs-lookup"><span data-stu-id="90eca-228">If the **App name** is already taken, the Wizard notifies you with a red *The app name is not available* message.</span></span> <span data-ttu-id="90eca-229">Si el **nombre de la aplicación** está disponible, verá una marca de verificación verde.</span><span class="sxs-lookup"><span data-stu-id="90eca-229">If the **App name** is available, you see a green checkmark.</span></span>

    ![Creación de vínculo de la base de datos en el Portal de administración](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-web-app-sql-resource.png)

3. <span data-ttu-id="90eca-231">En el **suscripción** , seleccione la suscripción de Azure en el que desea que el **App Service** residir.</span><span class="sxs-lookup"><span data-stu-id="90eca-231">In the **Subscription** box, choose the Azure Subscription in which you want the **App Service** to reside.</span></span>

4. <span data-ttu-id="90eca-232">En el **grupo de recursos** cuadro de texto, elija un grupo de recursos o cree uno nuevo.</span><span class="sxs-lookup"><span data-stu-id="90eca-232">In the **Resource Group** text box, choose a Resource Group or create a new one.</span></span> <span data-ttu-id="90eca-233">Esta configuración especifica el sitio web se ejecutará en el centro de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-233">This setting specifies which data center your web site will run in.</span></span> <span data-ttu-id="90eca-234">Para obtener más información acerca de los grupos de recursos, consulte [grupos de recursos](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span><span class="sxs-lookup"><span data-stu-id="90eca-234">For more information about Resource Groups, see [Resource groups](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span></span>

5. <span data-ttu-id="90eca-235">Cree un nuevo **Plan de App Service** haciendo clic en el *sección App Service*, **crear nuevo**y rellene **plan de App Service** (puede ser mismo nombre que App Service), **ubicación**, y **tarifa** (hay una opción gratuita).</span><span class="sxs-lookup"><span data-stu-id="90eca-235">Create a new **App Service Plan** by clicking the *App Service section*, **Create New**, and fill in **App Service plan** (can be same name as App Service), **Location**, and **Pricing tier** (there is a free option).</span></span>

6. <span data-ttu-id="90eca-236">Haga clic en **base de datos SQL**y, a continuación, elija **crear una nueva base de datos** o seleccione una base de datos existente.</span><span class="sxs-lookup"><span data-stu-id="90eca-236">Click **SQL Database**, and then choose **Create a new database** or select an existing database.</span></span>

    ![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/new-sql-database.png)

7. <span data-ttu-id="90eca-237">En el **nombre** , escriba un nombre para la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-237">In the **Name** box, enter a name for your database.</span></span>
8. <span data-ttu-id="90eca-238">Haga clic en el **TargetServer** cuadro y, a continuación, seleccione **crear un nuevo servidor**.</span><span class="sxs-lookup"><span data-stu-id="90eca-238">Click the **Target Server** box, and then select **Create a new server**.</span></span> <span data-ttu-id="90eca-239">Como alternativa, si ha creado anteriormente un servidor, puede seleccionar ese servidor en la lista de servidores disponibles.</span><span class="sxs-lookup"><span data-stu-id="90eca-239">Alternatively, if you previously created a server, you can select that server from list of available servers.</span></span>
9. <span data-ttu-id="90eca-240">Elija **tarifa** sección, elija *gratis*.</span><span class="sxs-lookup"><span data-stu-id="90eca-240">Choose **Pricing tier** section, choose *Free*.</span></span> <span data-ttu-id="90eca-241">Si se necesitan recursos adicionales, la base de datos se puede escalar verticalmente en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="90eca-241">If additional resources are needed, the database can be scaled up at any time.</span></span> <span data-ttu-id="90eca-242">Para más información sobre los precios de SQL Azure, consulte [precios de Azure SQL Database](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span><span class="sxs-lookup"><span data-stu-id="90eca-242">To learn more on Azure SQL Pricing, see [Azure SQL Database pricing](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span></span>
10. <span data-ttu-id="90eca-243">Modificar [intercalación](/sql/relational-databases/collations/collation-and-unicode-support) según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="90eca-243">Modify [collation](/sql/relational-databases/collations/collation-and-unicode-support) as needed.</span></span>
11. <span data-ttu-id="90eca-244">Especifique un administrador **SQL Admin Username** y **contraseña de administrador de SQL**.</span><span class="sxs-lookup"><span data-stu-id="90eca-244">Enter an administrator **SQL Admin Username** and **SQL Admin Password**.</span></span>

   - <span data-ttu-id="90eca-245">Si seleccionó **el servidor de base de datos SQL nueva**, defina un nuevo nombre y una contraseña que usará más adelante cuando acceda a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-245">If you selected **New SQL Database server**, define a new name and password that you'll use later when you access the database.</span></span>
   - <span data-ttu-id="90eca-246">Si ha seleccionado un servidor que creó anteriormente, escriba las credenciales para ese servidor.</span><span class="sxs-lookup"><span data-stu-id="90eca-246">If you selected a server that you created previously, enter credentials for that server.</span></span>

12. <span data-ttu-id="90eca-247">Recopilación de telemetría puede habilitarse para App Service con Application Insights.</span><span class="sxs-lookup"><span data-stu-id="90eca-247">Telemetry collection can be enabled for App Service using Application Insights.</span></span> <span data-ttu-id="90eca-248">Con muy poca configuración, Application Insights recopila eventos valiosa, excepción, dependencia, solicitud y la información de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="90eca-248">With little configuration, Application Insights collects valuable event, exception, dependency, request, and trace information.</span></span> <span data-ttu-id="90eca-249">Para obtener más información acerca de Application Insights, consulte [Azure Monitor](https://azure.microsoft.com/services/monitor/).</span><span class="sxs-lookup"><span data-stu-id="90eca-249">To learn more about Application Insights, see [Azure Monitor](https://azure.microsoft.com/services/monitor/).</span></span>
13. <span data-ttu-id="90eca-250">Haga clic en **crear** en la parte inferior para indicar que haya terminado.</span><span class="sxs-lookup"><span data-stu-id="90eca-250">Click **Create** at the bottom to indicate that you're finished.</span></span>

    <span data-ttu-id="90eca-251">El Portal de administración que se devuelve a la página panel y el **notificaciones** área situada en la parte superior de la página de muestra que se está creando el sitio.</span><span class="sxs-lookup"><span data-stu-id="90eca-251">The Management Portal returns to the Dashboard page, and the **Notifications** area at the top of the page shows that the site is being created.</span></span> <span data-ttu-id="90eca-252">Después de un tiempo (normalmente menos de un minuto), hay una notificación de que la implementación se realizó correctamente.</span><span class="sxs-lookup"><span data-stu-id="90eca-252">After a while (typically less than a minute), there's a notification that the Deployment succeeded.</span></span> <span data-ttu-id="90eca-253">En la barra de navegación a la izquierda, el nuevo servicio de aplicación aparece en el **App Services** sección y la nueva base de datos SQL aparece en la **bases de datos SQL** sección.</span><span class="sxs-lookup"><span data-stu-id="90eca-253">In the navigation bar at the left, the new App Service appears in the **App Services** section and the new SQL database appears in the **SQL databases** section.</span></span>

### <a name="deploy-the-app-to-azure"></a><span data-ttu-id="90eca-254">Implementación de la aplicación en Azure</span><span class="sxs-lookup"><span data-stu-id="90eca-254">Deploy the app to Azure</span></span>

1. <span data-ttu-id="90eca-255">En Visual Studio, haga clic en el proyecto en **el Explorador de soluciones** y seleccione **publicar** en el menú contextual.</span><span class="sxs-lookup"><span data-stu-id="90eca-255">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

    ![Publicar el elemento de menú en el Explorador de soluciones](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

2. <span data-ttu-id="90eca-257">En el **elegir un destino de publicación** página, elija **App Service** y, a continuación, **seleccionar existente**y, a continuación, elija **publicar**.</span><span class="sxs-lookup"><span data-stu-id="90eca-257">On the **Pick a publish target** page, choose **App Service** and then **Select Existing**, and then choose **Publish**.</span></span>

    ![Seleccionar una página de destino de publicación](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-select-existing-azure-app-service.png)

3. <span data-ttu-id="90eca-259">Si anteriormente no ha agregado la suscripción de Azure en Visual Studio, realice los pasos en la pantalla.</span><span class="sxs-lookup"><span data-stu-id="90eca-259">If you haven't previously added your Azure subscription in Visual Studio, perform the steps on the screen.</span></span> <span data-ttu-id="90eca-260">Estos pasos habilitan Visual Studio para conectarse a su suscripción de Azure hasta que la lista de **App Services** incluirá su sitio web.</span><span class="sxs-lookup"><span data-stu-id="90eca-260">These steps enable Visual Studio to connect to your Azure subscription so that the list of **App Services** will include your web site.</span></span>

4. <span data-ttu-id="90eca-261">En el **App Service** página, seleccione el **suscripción** agrega el servicio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-261">On the **App Service** page, select the **Subscription** you added the App Service to.</span></span> <span data-ttu-id="90eca-262">En **vista**, seleccione **grupo de recursos**.</span><span class="sxs-lookup"><span data-stu-id="90eca-262">Under **View**, select **Resource Group**.</span></span> <span data-ttu-id="90eca-263">Expanda el grupo de recursos que agregó el servicio de aplicación y, a continuación, seleccione el servicio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-263">Expand the resource group you added the App Service to, and then select the App Service.</span></span> <span data-ttu-id="90eca-264">Elija **Aceptar** para publicar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-264">Choose **OK** to publish the app.</span></span>

    ![Seleccione el servicio de aplicación](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/app-service-page.png)

5. <span data-ttu-id="90eca-266">El **salida** ventana muestra qué acciones de implementación se realizaron e informa la correcta finalización de la implementación.</span><span class="sxs-lookup"><span data-stu-id="90eca-266">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>

    ![Ventana de salida de informes de implementación correcta](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-output.png)

6. <span data-ttu-id="90eca-268">Tras una implementación correcta, el explorador predeterminado se abre automáticamente en la dirección URL del sitio web implementado.</span><span class="sxs-lookup"><span data-stu-id="90eca-268">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>

    ![Students_index_page_with_paging](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/cloud-app-browser.png)

    <span data-ttu-id="90eca-270">La aplicación se ejecuta ahora en la nube.</span><span class="sxs-lookup"><span data-stu-id="90eca-270">Your app is now running in the cloud.</span></span>

<span data-ttu-id="90eca-271">En este momento, el *SchoolContext* base de datos se ha creado en la base de datos SQL de Azure porque seleccionó **ejecutar migraciones de Code First (se ejecuta al iniciarse la aplicación)**.</span><span class="sxs-lookup"><span data-stu-id="90eca-271">At this point, the *SchoolContext* database has been created in the Azure SQL database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="90eca-272">El *Web.config* en el sitio web implementado, ha sido modificado para que la [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) inicializador ejecuta la primera vez que el código lee o escribe datos en la base de datos (lo que sucedió Si seleccionó la **estudiantes** pestaña):</span><span class="sxs-lookup"><span data-stu-id="90eca-272">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer runs the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![Fragmento del archivo Web.config](https://asp.net/media/4367421/mig.png)

<span data-ttu-id="90eca-274">El proceso de implementación también crea una nueva cadena de conexión *(SchoolContext\_DatabasePublish*) para migraciones de Code First que se usará para actualizar el esquema de base de datos y la propagación de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-274">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Cadena de conexión en el archivo Web.config](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)

<span data-ttu-id="90eca-276">Puede encontrar la versión implementada del archivo Web.config en su propio equipo en *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. Puede acceder a implementado *Web.config* propio archivo mediante FTP.</span><span class="sxs-lookup"><span data-stu-id="90eca-276">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="90eca-277">Para obtener instrucciones, consulte [implementación Web de ASP.NET con Visual Studio: implementar una actualización de código](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span><span class="sxs-lookup"><span data-stu-id="90eca-277">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span></span> <span data-ttu-id="90eca-278">Siga las instrucciones que comienzan con "para usar una herramienta FTP, necesita tres cosas: la dirección URL de FTP, el nombre de usuario y la contraseña."</span><span class="sxs-lookup"><span data-stu-id="90eca-278">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="90eca-279">La aplicación web no implementa la seguridad, por lo que cualquier persona que encuentre la dirección URL puede cambiar los datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-279">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="90eca-280">Para obtener instrucciones sobre cómo proteger el sitio web, consulte [implementar una aplicación ASP.NET MVC segura con pertenencia, OAuth y SQL database en Azure](/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="90eca-280">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL database to Azure](/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="90eca-281">Puede impedir que otras personas mediante el sitio, detenga el servicio mediante el Portal de administración de Azure o **Explorador de servidores** en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="90eca-281">You can prevent other people from using the site by stopping the service using the Azure Management Portal or **Server Explorer** in Visual Studio.</span></span>

![Detener el elemento de menú de servicio de aplicación](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/server-explorer-stop-app-service.png)

## <a name="advanced-migrations-scenarios"></a><span data-ttu-id="90eca-283">Escenarios de migración avanzada</span><span class="sxs-lookup"><span data-stu-id="90eca-283">Advanced migrations scenarios</span></span>

<span data-ttu-id="90eca-284">Si implementa una base de datos mediante la ejecución de migraciones automáticamente como se muestra en este tutorial, y va a implementar en un sitio web que se ejecuta en varios servidores, podría obtener varios servidores al intentar ejecutar migraciones al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="90eca-284">If you deploy a database by running migrations automatically as shown in this tutorial, and you are deploying to a web site that runs on multiple servers, you could get multiple servers trying to run migrations at the same time.</span></span> <span data-ttu-id="90eca-285">Las migraciones son atómicas, por lo que si dos servidores intentan ejecutar la migración del mismo, uno se realizará correctamente y el otro se producirá un error (suponiendo que las operaciones no se puede realizar dos veces).</span><span class="sxs-lookup"><span data-stu-id="90eca-285">Migrations are atomic, so if two servers try to run the same migration, one will succeed and the other will fail (assuming the operations can't be done twice).</span></span> <span data-ttu-id="90eca-286">En ese escenario si desea evitar estos problemas, puede llamar manualmente a las migraciones y configurar su propio código para que solo sucede una vez.</span><span class="sxs-lookup"><span data-stu-id="90eca-286">In that scenario if you want to avoid those issues, you can call migrations manually and set up your own code so that it only happens once.</span></span> <span data-ttu-id="90eca-287">Para obtener más información, consulte [ejecución y las migraciones de secuencias de comandos desde el código](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) en el blog de Rowan Miller y [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (para ejecutar las migraciones desde la línea de comandos).</span><span class="sxs-lookup"><span data-stu-id="90eca-287">For more information, see [Running and Scripting Migrations from Code](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) on Rowan Miller's blog and [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (for executing migrations from the command line).</span></span>

<span data-ttu-id="90eca-288">Para obtener información sobre otros escenarios de migración, consulte [migraciones Screencast serie](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span><span class="sxs-lookup"><span data-stu-id="90eca-288">For information about other migrations scenarios, see [Migrations Screencast Series](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span></span>

## <a name="code-first-initializers"></a><span data-ttu-id="90eca-289">Inicializadores de primer código</span><span class="sxs-lookup"><span data-stu-id="90eca-289">Code First initializers</span></span>

<span data-ttu-id="90eca-290">En la sección de implementación, vio la [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) inicializador que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="90eca-290">In the deployment section, you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="90eca-291">Código primero también proporciona otros inicializadores, incluidos [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (valor predeterminado), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (que usó anteriormente) y [ DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="90eca-291">Code First also provides other initializers, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (which you used earlier) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="90eca-292">El `DropCreateAlways` inicializador puede ser útil para configurar las condiciones para las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="90eca-292">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="90eca-293">También puede escribir a sus propios inicializadores, y se puede llamar a un inicializador explícitamente si no desea esperar hasta que la aplicación lee o escribe en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-293">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span>

<span data-ttu-id="90eca-294">Para obtener más información sobre los inicializadores, vea [descripción inicializadores de base de datos en Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) y el capítulo 6 del libro [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) , Julie Lerman y Rowan Miller.</span><span class="sxs-lookup"><span data-stu-id="90eca-294">For more information about initializers, see [Understanding Database Initializers in Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) and chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="summary"></a><span data-ttu-id="90eca-295">Resumen</span><span class="sxs-lookup"><span data-stu-id="90eca-295">Summary</span></span>

<span data-ttu-id="90eca-296">En este tutorial, aprendió a habilitar migraciones e implementar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="90eca-296">In this tutorial, you learned how to enable migrations and deploy the application.</span></span> <span data-ttu-id="90eca-297">En el siguiente, comenzará examinando temas más avanzados expandiendo el modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="90eca-297">In the next tutorial, you'll begin looking at more advanced topics by expanding the data model.</span></span>

<span data-ttu-id="90eca-298">Deje comentarios sobre cómo le gustó de este tutorial y que podíamos mejorar.</span><span class="sxs-lookup"><span data-stu-id="90eca-298">Please leave feedback on how you liked this tutorial and what we could improve.</span></span>

<span data-ttu-id="90eca-299">Pueden encontrar vínculos a otros recursos de Entity Framework en [acceso a datos de ASP.NET - recursos recomendados](xref:whitepapers/aspnet-data-access-content-map).</span><span class="sxs-lookup"><span data-stu-id="90eca-299">Links to other Entity Framework resources can be found in [ASP.NET Data Access - Recommended Resources](xref:whitepapers/aspnet-data-access-content-map).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="90eca-300">[Anterior](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application)
> [Siguiente](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-a-more-complex-data-model-for-an-asp-net-mvc-application)</span><span class="sxs-lookup"><span data-stu-id="90eca-300">[Previous](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application)
[Next](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-a-more-complex-data-model-for-an-asp-net-mvc-application)</span></span>
