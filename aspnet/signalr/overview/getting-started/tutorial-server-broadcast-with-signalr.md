---
uid: signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
title: 'Tutorial: Difusión de servidores con SignalR 2 | Microsoft Docs'
author: tdykstra
description: Este tutorial muestra cómo crear una aplicación web que usa ASP.NET SignalR 2 para proporcionar funcionalidad de difusión de servidor. Difusión de servidor significa que común...
ms.author: riande
ms.date: 10/13/2014
ms.assetid: 1568247f-60b5-4eca-96e0-e661fbb2b273
msc.legacyurl: /signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 7a85a704dc5d830ec793540fbc44a3ce7ec8c934
ms.sourcegitcommit: a4dcca4f1cb81227c5ed3c92dc0e28be6e99447b
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/10/2018
ms.locfileid: "48911551"
---
<a name="tutorial-server-broadcast-with-signalr-2"></a><span data-ttu-id="1aa7f-104">Tutorial: Difusión de servidores con SignalR 2</span><span class="sxs-lookup"><span data-stu-id="1aa7f-104">Tutorial: Server Broadcast with SignalR 2</span></span>
====================
<span data-ttu-id="1aa7f-105">por [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="1aa7f-105">by [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="1aa7f-106">Este tutorial muestra cómo crear una aplicación web que usa ASP.NET SignalR 2 para proporcionar funcionalidad de difusión de servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-106">This tutorial shows how to create a web application that uses ASP.NET SignalR 2 to provide server broadcast functionality.</span></span> <span data-ttu-id="1aa7f-107">Difusión de servidor significa que se inician las comunicaciones enviadas a los clientes por el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="1aa7f-108">Este escenario requiere un método de programación distinto a escenarios punto a punto, como aplicaciones de chat, en el que se inician las comunicaciones enviadas a los clientes por uno o varios de los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
>
> <span data-ttu-id="1aa7f-109">La aplicación que creará en este tutorial simula un tablero de cotizaciones, un escenario típico para la funcionalidad de difusión de servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
>
> <span data-ttu-id="1aa7f-110">En este tema se escribió originalmente por Patrick Fletcher.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-110">This topic was originally written by Patrick Fletcher.</span></span>
>
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="1aa7f-111">Versiones de software que se usa en el tutorial</span><span class="sxs-lookup"><span data-stu-id="1aa7f-111">Software versions used in the tutorial</span></span>
>
>
> - [<span data-ttu-id="1aa7f-112">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="1aa7f-112">Visual Studio 2013</span></span>](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - <span data-ttu-id="1aa7f-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="1aa7f-113">.NET 4.5</span></span>
> - <span data-ttu-id="1aa7f-114">Versión 2 de SignalR</span><span class="sxs-lookup"><span data-stu-id="1aa7f-114">SignalR version 2</span></span>
>
>
>
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a><span data-ttu-id="1aa7f-115">Uso de Visual Studio 2012 con este tutorial</span><span class="sxs-lookup"><span data-stu-id="1aa7f-115">Using Visual Studio 2012 with this tutorial</span></span>
>
>
> <span data-ttu-id="1aa7f-116">Para usar Visual Studio 2012 con este tutorial, realice lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-116">To use Visual Studio 2012 with this tutorial, do the following:</span></span>
>
> - <span data-ttu-id="1aa7f-117">Actualización de su [Administrador de paquetes](http://docs.nuget.org/docs/start-here/installing-nuget) a la versión más reciente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-117">Update your [Package Manager](http://docs.nuget.org/docs/start-here/installing-nuget) to the latest version.</span></span>
> - <span data-ttu-id="1aa7f-118">Instalar el [instalador de plataforma Web](https://www.microsoft.com/web/downloads/platform.aspx).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-118">Install the [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span></span>
> - <span data-ttu-id="1aa7f-119">En el instalador de plataforma Web, buscar e instalar **ASP.NET y Web Tools 2013.1 para Visual Studio 2012**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-119">In the Web Platform Installer, search for and install **ASP.NET and Web Tools 2013.1 for Visual Studio 2012**.</span></span> <span data-ttu-id="1aa7f-120">Este modo instalará como plantillas de Visual Studio para las clases de SignalR **concentrador**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-120">This will install Visual Studio templates for SignalR classes such as **Hub**.</span></span>
> - <span data-ttu-id="1aa7f-121">Algunas plantillas (como **clase de inicio OWIN**) no estará disponible; para ello, use un archivo de clase en su lugar.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-121">Some templates (such as **OWIN Startup Class**) will not be available; for these, use a Class file instead.</span></span>
>
>
> ## <a name="tutorial-versions"></a><span data-ttu-id="1aa7f-122">Versiones de tutoriales</span><span class="sxs-lookup"><span data-stu-id="1aa7f-122">Tutorial Versions</span></span>
>
> <span data-ttu-id="1aa7f-123">Para obtener información acerca de las versiones anteriores de SignalR, consulte [versiones anteriores de SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-123">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
>
> ## <a name="questions-and-comments"></a><span data-ttu-id="1aa7f-124">Preguntas y comentarios</span><span class="sxs-lookup"><span data-stu-id="1aa7f-124">Questions and comments</span></span>
>
> <span data-ttu-id="1aa7f-125">Deje comentarios sobre cómo le gustó de este tutorial y que podíamos mejorar en los comentarios en la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-125">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="1aa7f-126">Si tiene preguntas que no están directamente relacionados con el tutorial, puede publicarlos en el [foro de ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) o [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-126">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>


## <a name="overview"></a><span data-ttu-id="1aa7f-127">Información general</span><span class="sxs-lookup"><span data-stu-id="1aa7f-127">Overview</span></span>

<span data-ttu-id="1aa7f-128">En este tutorial, podrá crear una aplicación de cotización bursátil que sea representativo de aplicaciones en tiempo real en el que desee "Insertar" periódicamente o difundir notificaciones desde el servidor a todos los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-128">In this tutorial, you'll create a stock ticker application that is representative of real-time applications in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span> <span data-ttu-id="1aa7f-129">En la primera parte de este tutorial, creará una versión simplificada de la aplicación desde cero.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-129">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="1aa7f-130">En el resto del tutorial, deberá instalar un paquete de NuGet que contiene características adicionales y revisar el código para dichas características.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-130">In the remainder of the tutorial, you'll install a NuGet package that contains additional features, and review the code for those features.</span></span>

<span data-ttu-id="1aa7f-131">La aplicación que va a compilar en la primera parte de este tutorial muestra una cuadrícula con datos de acciones.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-131">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Versión inicial de StockTicker](tutorial-server-broadcast-with-signalr/_static/image1.png)

<span data-ttu-id="1aa7f-133">Periódicamente el servidor de forma aleatoria actualiza cotizaciones bursátiles e inserta las actualizaciones en todos los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-133">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="1aa7f-134">En el explorador los números y símbolos en el **cambiar** y **%** columnas cambian dinámicamente en respuesta a las notificaciones desde el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-134">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="1aa7f-135">Si abre los exploradores adicionales a la misma dirección URL, todos ellos muestran los mismos datos y los mismos cambios a los datos simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-135">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="1aa7f-136">Este tutorial contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-136">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="1aa7f-137">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="1aa7f-137">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="1aa7f-138">Crear el proyecto</span><span class="sxs-lookup"><span data-stu-id="1aa7f-138">Create the project</span></span>](#createproject)
- [<span data-ttu-id="1aa7f-139">Configurar el código de servidor</span><span class="sxs-lookup"><span data-stu-id="1aa7f-139">Set up the server code</span></span>](#server)
- [<span data-ttu-id="1aa7f-140">Configurar el código de cliente</span><span class="sxs-lookup"><span data-stu-id="1aa7f-140">Set up the client code</span></span>](#client)
- [<span data-ttu-id="1aa7f-141">Probar la aplicación</span><span class="sxs-lookup"><span data-stu-id="1aa7f-141">Test the application</span></span>](#test)
- [<span data-ttu-id="1aa7f-142">Habilitar el registro</span><span class="sxs-lookup"><span data-stu-id="1aa7f-142">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="1aa7f-143">Instalar y revise el ejemplo StockTicker completo</span><span class="sxs-lookup"><span data-stu-id="1aa7f-143">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="1aa7f-144">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="1aa7f-144">Next steps</span></span>](#nextsteps)

<span data-ttu-id="1aa7f-145">El [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) paquete NuGet instala una aplicación de tablero de cotizaciones de ejemplo simulada en un proyecto de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-145">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span>

> [!NOTE]
> <span data-ttu-id="1aa7f-146">Si no desea trabajar con los pasos de la creación de la aplicación, puede instalar el paquete SignalR.Sample en un nuevo proyecto de aplicación Web ASP.NET vacía.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-146">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new Empty ASP.NET Web Application project.</span></span> <span data-ttu-id="1aa7f-147">Si instala el paquete de NuGet sin realizar los pasos de este tutorial, **debe seguir las instrucciones que aparecen en el archivo readme.txt**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-147">If you install the NuGet package without performing the steps in this tutorial, **you must follow the instructions in the readme.txt file**.</span></span> <span data-ttu-id="1aa7f-148">Para ejecutar el paquete que tiene que agregar una clase de inicio OWIN que se llama al método ConfigureSignalR en el paquete instalado.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-148">To run the package you need to add an OWIN startup class which calls the ConfigureSignalR method in the installed package.</span></span> <span data-ttu-id="1aa7f-149">Recibirá un error si no se agrega la clase de inicio OWIN.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-149">You will receive an error if you do not add the OWIN startup class.</span></span>


<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="1aa7f-150">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="1aa7f-150">Prerequisites</span></span>

<span data-ttu-id="1aa7f-151">Antes de empezar, asegúrese de que haya instalado en el equipo de Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-151">Before you start, make sure that you have Visual Studio 2013 installed on your computer.</span></span> <span data-ttu-id="1aa7f-152">Si no tiene Visual Studio, consulte [descargas de ASP.NET](https://www.asp.net/downloads) para obtener la versión gratuita Visual Studio 2013 Express.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-152">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2013 Express.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="1aa7f-153">Crear el proyecto</span><span class="sxs-lookup"><span data-stu-id="1aa7f-153">Create the project</span></span>

1. <span data-ttu-id="1aa7f-154">Desde el **archivo** menú, haga clic en **nuevo proyecto**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-154">From the **File** menu, click **New Project**.</span></span>
2. <span data-ttu-id="1aa7f-155">En el **nuevo proyecto** cuadro de diálogo, expanda **C#** en **plantillas** y seleccione **Web**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-155">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="1aa7f-156">Seleccione el **aplicación Web ASP.NET vacía** plantilla, el nombre del proyecto *SignalR.StockTicker*y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-156">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Cuadro de diálogo Nuevo proyecto](tutorial-server-broadcast-with-signalr/_static/image2.png)
4. <span data-ttu-id="1aa7f-158">En el **ASP.NET nueva** ventana del proyecto, deje **vacía** seleccionado y haga clic en **crear proyecto**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-158">In the **New ASP.NET** Project window, leave **Empty** selected and click **Create Project**.</span></span>

    ![Cuadro de diálogo nuevo proyecto de ASP](tutorial-server-broadcast-with-signalr/_static/image3.png)

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="1aa7f-160">Configurar el código de servidor</span><span class="sxs-lookup"><span data-stu-id="1aa7f-160">Set up the server code</span></span>

<span data-ttu-id="1aa7f-161">En esta sección se establece el código que se ejecuta en el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-161">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="1aa7f-162">Crear la clase de Stock</span><span class="sxs-lookup"><span data-stu-id="1aa7f-162">Create the Stock class</span></span>

<span data-ttu-id="1aa7f-163">Empiece por crear la clase de modelo de Stock que va a usar para almacenar y transmitir información sobre una acción.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-163">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="1aa7f-164">Cree un nuevo archivo de clase en la carpeta del proyecto, asígnele el nombre *Stock.cs*y, a continuación, reemplace el código de plantilla con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-164">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample1.cs)]

    <span data-ttu-id="1aa7f-165">Las dos propiedades que se va a configurar al crear las poblaciones son el símbolo (por ejemplo, MSFT para Microsoft) y el precio.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-165">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="1aa7f-166">Las demás propiedades dependen de cómo y cuándo establecer precios.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-166">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="1aa7f-167">La primera vez que se establece el precio, el valor obtiene propaga a DayOpen.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-167">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="1aa7f-168">Posteriormente, al establecer el cambio de precio y se calculan los valores de propiedad CambioPorcentual según la diferencia entre el precio y DayOpen.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-168">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="1aa7f-169">Cree las clases StockTicker y StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="1aa7f-169">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="1aa7f-170">Usará la API de concentrador SignalR para controlar la interacción con el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-170">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="1aa7f-171">Una clase StockTickerHub que se deriva de la clase de concentrador SignalR controlará recibir conexiones y las llamadas a métodos de los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-171">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="1aa7f-172">También necesita mantener los datos de cotizaciones y ejecutar un objeto de temporizador para desencadenar periódicamente las actualizaciones de precios, independientemente de las conexiones de cliente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-172">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="1aa7f-173">No se puede colocar estas funciones en una clase de Hub, porque las instancias de concentrador son transitorias.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-173">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="1aa7f-174">Se crea una instancia de la clase de concentrador para cada operación en el centro, como las conexiones y las llamadas desde el cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-174">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="1aa7f-175">Por lo que el mecanismo que mantiene los datos de cotizaciones, actualiza los precios y difunde las actualizaciones de precios debe ejecutarse en una clase independiente, que le nombre StockTicker.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-175">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Difusión de StockTicker](tutorial-server-broadcast-with-signalr/_static/image5.png)

<span data-ttu-id="1aa7f-177">Solo quiere una instancia de la clase StockTicker para ejecutarse en el servidor, por lo que necesitará configurar una referencia de cada instancia StockTickerHub a la instancia de singleton StockTicker.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-177">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="1aa7f-178">La clase StockTicker tiene que ser capaz de difusión a los clientes porque tiene los datos de cotizaciones y desencadena las actualizaciones, pero StockTicker no es una clase de concentrador.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-178">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="1aa7f-179">Por lo tanto, la clase StockTicker debe obtener una referencia al objeto de contexto de conexión de concentrador SignalR.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-179">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="1aa7f-180">También puede usar el objeto de contexto de conexión de SignalR para difundir a los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-180">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="1aa7f-181">En **el Explorador de soluciones**, haga clic en el proyecto y haga clic en **Add | Clase de concentrador SignalR (v2)**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-181">In **Solution Explorer**, right-click the project and click **Add | SignalR Hub Class (v2)**.</span></span>
2. <span data-ttu-id="1aa7f-182">Nombre del nuevo centro *StockTickerHub.cs*y, a continuación, haga clic en **agregar**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-182">Name the new hub *StockTickerHub.cs*, and then click **Add**.</span></span> <span data-ttu-id="1aa7f-183">Paquetes de SignalR NuGet se agregará al proyecto.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-183">SignalR NuGet packages will be added to your project.</span></span>
3. <span data-ttu-id="1aa7f-184">Reemplace el código de plantilla con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-184">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample2.cs)]

    <span data-ttu-id="1aa7f-185">El [concentrador](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) clase se utiliza para definir los métodos que se pueden llamar los clientes en el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-185">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="1aa7f-186">Define un método: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-186">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="1aa7f-187">Cuando un cliente se conecta inicialmente con el servidor, llamará a este método para obtener una lista de todas las acciones con el precio actual.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-187">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="1aa7f-188">Puede ejecutar de forma sincrónica y devolver el método `IEnumerable<Stock>` porque devuelve datos de la memoria.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-188">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="1aa7f-189">Si el método tuvo que obtener los datos haciendo algo que implicaría espera, por ejemplo, una búsqueda de la base de datos o una llamada de servicio web, especificaría `Task<IEnumerable<Stock>>` como el valor devuelto para habilitar el procesamiento asincrónico.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-189">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="1aa7f-190">Para obtener más información, consulte [Guía de la API de ASP.NET SignalR Hubs - Server - cuándo se debe ejecutar de forma asincrónica](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-190">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span></span>

    <span data-ttu-id="1aa7f-191">El atributo HubName especifica cómo hacer referencia a la central en el código de JavaScript en el cliente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-191">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="1aa7f-192">El nombre predeterminado en el cliente si no usa este atributo es una versión de mayúsculas y minúsculas camel del nombre de clase, que en este caso sería stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-192">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="1aa7f-193">Como verá más adelante al crear la clase StockTicker, se crea una instancia singleton de esa clase en su propiedad de instancia estática.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-193">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="1aa7f-194">Que la instancia singleton de StockTicker permanece en memoria independientemente de cuántos clientes conexión o desconexión y esa instancia es lo que usa el método GetAllStocks para devolver información bursátil actual.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-194">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
4. <span data-ttu-id="1aa7f-195">Cree un nuevo archivo de clase en la carpeta del proyecto, asígnele el nombre *StockTicker.cs*y, a continuación, reemplace el código de plantilla con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-195">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample3.cs)]

    <span data-ttu-id="1aa7f-196">Puesto que varios subprocesos a ejecutar la misma instancia de código StockTicker, la clase StockTicker debe ser seguro para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-196">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="1aa7f-197">Almacenamiento de la instancia de singleton en un campo estático</span><span class="sxs-lookup"><span data-stu-id="1aa7f-197">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="1aa7f-198">El código inicializa estático \_campo de instancia que respalda la propiedad de instancia con una instancia de la clase y esta es la única instancia de la clase que se puede crear, porque el constructor está marcado como privado.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-198">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="1aa7f-199">[La inicialización diferida](https://msdn.microsoft.com/library/dd997286.aspx) se usa para el \_campo de instancia, no por motivos de rendimiento, pero para asegurarse de que la creación de instancias es seguro para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-199">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample4.cs)]

    <span data-ttu-id="1aa7f-200">Cada vez que un cliente se conecta al servidor, una nueva instancia de la clase StockTickerHub que se ejecuta en un subproceso independiente Obtiene la instancia de singleton StockTicker desde la propiedad estática StockTicker.Instance, como se vio anteriormente en la clase StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-200">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="1aa7f-201">Almacenar datos de acciones en un elemento ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="1aa7f-201">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="1aa7f-202">El constructor inicializa el \_colección de acciones con algunos datos de ejemplo stock y GetAllStocks devuelve las existencias.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-202">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="1aa7f-203">Como vimos anteriormente, esta colección de acciones a su vez devuelve StockTickerHub.GetAllStocks que es un método de servidor en la clase de concentrador que se pueden llamar los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-203">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample5.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample6.cs)]

    <span data-ttu-id="1aa7f-204">La colección de acciones se define como un [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) tipo de seguridad para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-204">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="1aa7f-205">Como alternativa, puede usar un [diccionario](https://msdn.microsoft.com/library/xfhwa508.aspx) de objetos y bloquear explícitamente el diccionario al realizar cambios en ella.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-205">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="1aa7f-206">Para esta aplicación de ejemplo, es correcto para almacenar datos de la aplicación en la memoria y perder los datos cuando se elimina la instancia de StockTicker.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-206">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="1aa7f-207">En una aplicación real podría funcionar con un almacén de datos back-end como una base de datos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-207">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="1aa7f-208">Actualizaciones periódicas de cotizaciones</span><span class="sxs-lookup"><span data-stu-id="1aa7f-208">Periodically updating stock prices</span></span>

    <span data-ttu-id="1aa7f-209">El constructor se inicia un objeto de temporizador que llama periódicamente a los métodos que actualizan los precios de las acciones de forma aleatoria.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-209">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample7.cs)]

    <span data-ttu-id="1aa7f-210">UpdateStockPrices lo llama el temporizador, que se pasa null en el parámetro state.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-210">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="1aa7f-211">Antes de actualizar los precios, se toma un bloqueo en el \_updateStockPricesLock objeto.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-211">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="1aa7f-212">El código comprueba si otro subproceso ya se está actualizando los precios y, a continuación, llama a TryUpdateStockPrice en cada acción en la lista.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-212">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="1aa7f-213">El método TryUpdateStockPrice decide si debe cambiar el precio y cuánto para cambiarlo.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-213">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="1aa7f-214">Si se cambia el precio de las acciones, se llama BroadcastStockPrice para el cambio de precio de las acciones de difusión a todos los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-214">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="1aa7f-215">El \_updatingStockPrices marca está marcado como [volátil](https://msdn.microsoft.com/library/x13ttww7.aspx) para asegurarse de que el acceso a él es seguro para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-215">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample8.cs)]

    <span data-ttu-id="1aa7f-216">En una aplicación real, el método TryUpdateStockPrice llamaría a un servicio web para buscar el precio; en este código utiliza un generador de números aleatorios para realizar cambios de forma aleatoria.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-216">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="1aa7f-217">Obtener el contexto de SignalR para que la clase StockTicker puede difundir a los clientes</span><span class="sxs-lookup"><span data-stu-id="1aa7f-217">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="1aa7f-218">Dado que los cambios de precio aquí se originan en el objeto StockTicker, esto es el objeto que se debe llamar a un método updateStockPrice en todos los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-218">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="1aa7f-219">En una clase de Hub tiene una API para llamar a métodos de cliente, pero StockTicker no se deriva de la clase de concentrador y no tiene una referencia a cualquier objeto de concentrador.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-219">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="1aa7f-220">Por lo tanto, para difundir a los clientes conectados, la clase StockTicker debe obtener la instancia del contexto de SignalR para la clase StockTickerHub y usarlo para llamar a métodos en los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-220">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="1aa7f-221">El código obtiene una referencia al contexto de SignalR cuando crea la instancia de la clase singleton, que hacen referencia a pasadas al constructor, y el constructor lo coloca en la propiedad de los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-221">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="1aa7f-222">Hay dos razones por qué desea obtener el contexto de una sola vez: obtener el contexto es una operación costosa, y garantiza la obtención de una vez que se conserva el orden deseado de los mensajes enviados a los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-222">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample9.cs)]

    <span data-ttu-id="1aa7f-223">Obtener la propiedad de los clientes del contexto y lo coloca en la propiedad StockTickerClient le permite escribir código para llamar a los métodos de cliente que tiene el mismo aspecto y como lo haría en una clase de concentrador.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-223">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="1aa7f-224">Por ejemplo, puede escribir Clients.All.updateStockPrice(stock) para difundir a todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-224">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="1aa7f-225">El método updateStockPrice que está llamando en BroadcastStockPrice que no exista; se agregará más adelante al escribir código que se ejecuta en el cliente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-225">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="1aa7f-226">Puede hacer referencia a updateStockPrice aquí porque Clients.All es dinámico, lo que significa que la expresión se evaluará en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-226">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="1aa7f-227">Cuando se ejecuta esta llamada al método, SignalR enviará el nombre del método y el valor del parámetro al cliente y si el cliente tiene un método denominado updateStockPrice, se llamará a ese método y el valor del parámetro se pasará a él.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-227">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="1aa7f-228">Clients.All significa que enviar a todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-228">Clients.All means send to all clients.</span></span> <span data-ttu-id="1aa7f-229">SignalR ofrece otras opciones para especificar qué clientes o grupos de clientes para enviar a.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-229">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="1aa7f-230">Para obtener más información, consulte [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-230">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="1aa7f-231">Registre la ruta de SignalR</span><span class="sxs-lookup"><span data-stu-id="1aa7f-231">Register the SignalR route</span></span>

<span data-ttu-id="1aa7f-232">El servidor necesita saber qué dirección URL para interceptar y dirigir a SignalR.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-232">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="1aa7f-233">Para ello, agregue una clase de inicio OWIN:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-233">To do that, add an OWIN startup class:</span></span>

1. <span data-ttu-id="1aa7f-234">En **el Explorador de soluciones**, haga clic en el proyecto y, a continuación, haga clic en **Add | Clase de inicio OWIN**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-234">In **Solution Explorer**, right-click the project, and then click **Add | OWIN Startup Class**.</span></span> <span data-ttu-id="1aa7f-235">Nombre de la clase **Startup.cs**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-235">Name the class **Startup.cs**.</span></span>
2. <span data-ttu-id="1aa7f-236">Reemplace el código de **Startup.cs** con lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-236">Replace the code in **Startup.cs** with the following.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample10.cs)]

<span data-ttu-id="1aa7f-237">Ahora ha completado la configuración el código del servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-237">You have now completed setting up the server code.</span></span> <span data-ttu-id="1aa7f-238">En la sección siguiente a configurar el cliente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-238">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="1aa7f-239">Configurar el código de cliente</span><span class="sxs-lookup"><span data-stu-id="1aa7f-239">Set up the client code</span></span>

1. <span data-ttu-id="1aa7f-240">Crear un nuevo archivo HTML en la carpeta del proyecto y asígnele el nombre *StockTicker.html*.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-240">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="1aa7f-241">Reemplace el código de plantilla con el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-241">Replace the template code with the following code.</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample11.html)]

    <span data-ttu-id="1aa7f-242">El código HTML crea una tabla con 5 columnas, una fila de encabezado y una fila de datos con una sola celda que abarca las 5 columnas.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-242">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="1aa7f-243">La fila de datos muestra "Cargando..." y solo se mostrarán momentáneamente cuando se inicia la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-243">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="1aa7f-244">Código de JavaScript quitará esa fila y agregar en su lugar de filas con datos recuperados del servidor de acciones.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-244">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="1aa7f-245">Las etiquetas de script especifican el archivo de script de jQuery, el archivo de script de SignalR core, el archivo de script de proxy de SignalR y un archivo de script StockTicker que creará más adelante.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-245">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="1aa7f-246">El archivo de script de proxy de SignalR, que especifica la dirección URL "/ signalr/hubs", se genera dinámicamente y define los métodos de proxy para los métodos de la clase de Hub, en este caso para StockTickerHub.GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-246">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="1aa7f-247">Si lo prefiere, puede generar manualmente este archivo de JavaScript mediante [SignalR utilidades](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) y deshabilite la creación dinámica de archivos en la llamada al método MapHubs.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-247">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="1aa7f-248">Asegúrese de que el archivo JavaScript hace referencia en *StockTicker.html* son correctos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-248">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="1aa7f-249">Es decir, asegúrese de que la versión de jQuery en la etiqueta de script (1.10.2 en el ejemplo) es la misma que la versión de jQuery en su proyecto *Scripts* carpeta y asegúrese de que la versión de SignalR en la etiqueta de script es el mismo que el objeto de SignalR versión del proyecto *Scripts* carpeta.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-249">That is, make sure that the jQuery version in your script tag (1.10.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="1aa7f-250">Si es necesario, cambie los nombres de archivo en las etiquetas de script.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-250">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="1aa7f-251">En **el Explorador de soluciones**, haga clic en *StockTicker.html*y, a continuación, haga clic en **establecer como página de inicio**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-251">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="1aa7f-252">Cree un nuevo archivo JavaScript en la carpeta del proyecto y denomínelo *StockTicker.js*...</span><span class="sxs-lookup"><span data-stu-id="1aa7f-252">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="1aa7f-253">Reemplace el código de plantilla con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-253">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample12.js)]

    <span data-ttu-id="1aa7f-254">$.connection hace referencia a los servidores proxy de SignalR.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-254">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="1aa7f-255">El código obtiene una referencia al proxy para la clase StockTickerHub y lo coloca en la variable de tableros de cotizaciones.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-255">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="1aa7f-256">El nombre del proxy es el nombre que se ha establecido mediante el atributo [HubName]:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-256">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample13.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample14.cs)]

    <span data-ttu-id="1aa7f-257">Después de que se definen todas las variables y funciones, la última línea de código en el archivo inicializa la conexión de SignalR mediante una llamada a la función de inicio de SignalR.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-257">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="1aa7f-258">La función de inicio se ejecuta de forma asincrónica y devuelve un [jQuery aplazado objeto](http://api.jquery.com/category/deferred-object/), lo que significa que puede llamar a la función done para especificar la función que se va a llamar cuando se complete la operación asincrónica...</span><span class="sxs-lookup"><span data-stu-id="1aa7f-258">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample15.js)]

    <span data-ttu-id="1aa7f-259">La función init llama a la función getAllStocks en el servidor y usa la información que devuelve el servidor para actualizar la tabla stock.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-259">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="1aa7f-260">Tenga en cuenta que de forma predeterminada, tiene que usar la grafía camel en el cliente aunque el nombre del método con grafía pascal en el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-260">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="1aa7f-261">La regla de grafía camel solo se aplica a los métodos, no objetos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-261">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="1aa7f-262">Por ejemplo, consulte existencias. Símbolo de y acciones. Precio, no stock.symbol o stock.price.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-262">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample16.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample17.cs)]

    <span data-ttu-id="1aa7f-263">Si desea utilizar las mayúsculas y minúsculas de pascal en el cliente, o si desea utilizar un nombre de método completamente diferente, podría decorar el método de concentrador con el atributo HubMethodName del mismo modo decorar la clase de Hub con el atributo HubName.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-263">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="1aa7f-264">En el método init, HTML para una fila de tabla se crea para cada objeto de acción recibida desde el servidor formatStock que realiza la llamada a las propiedades de formato del objeto estándar y, a continuación, al llamar a suplantar (que se define en la parte superior de *StockTicker.js*) para reemplazar los marcadores de posición en la variable rowTemplate con los valores de propiedad de objeto estándar.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-264">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="1aa7f-265">El HTML resultante, a continuación, se anexa a la tabla stock.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-265">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="1aa7f-266">Se llama a init pasándolo como una función de devolución de llamada que se ejecuta una vez finalizada la función de inicio asincrónica.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-266">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="1aa7f-267">Si se llama a init como una instrucción de JavaScript independiente después de llamar al inicio, la función produciría un error porque se ejecutaría inmediatamente sin esperar a la función de inicio a fin de establecer la conexión.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-267">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="1aa7f-268">En ese caso, la función init intentaría llamar a la función getAllStocks antes de establece la conexión al servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-268">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="1aa7f-269">Cuando el servidor cambia el precio de una acción, llama a la updateStockPrice en los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-269">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="1aa7f-270">La función se agrega a la propiedad de cliente del proxy stockTicker para ponerlo a disposición de las llamadas desde el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-270">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample18.js)]

    <span data-ttu-id="1aa7f-271">La función updateStockPrice da formato a un objeto estándar recibido del servidor en una fila de tabla de la misma forma que la función init.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-271">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="1aa7f-272">Sin embargo, en lugar de anexar la fila a la tabla, busca la fila actual de la acción en la tabla y reemplaza esa fila por uno nuevo.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-272">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="1aa7f-273">Probar la aplicación</span><span class="sxs-lookup"><span data-stu-id="1aa7f-273">Test the application</span></span>

1. <span data-ttu-id="1aa7f-274">Presione F5 para ejecutar la aplicación en modo de depuración.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-274">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="1aa7f-275">La tabla stock muestra inicialmente la "Cargando..." línea, a continuación, tras una breve demora que se muestran los datos de stock iniciales y, a continuación, los precios de cotización iniciar un cambio.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-275">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Carga](tutorial-server-broadcast-with-signalr/_static/image6.png)

    ![Tabla inicial de stock](tutorial-server-broadcast-with-signalr/_static/image7.png)

    ![Tabla stock recibir los cambios de servidor](tutorial-server-broadcast-with-signalr/_static/image8.png)
2. <span data-ttu-id="1aa7f-279">Copie la dirección URL de la barra de direcciones del explorador y péguela en una o varias ventanas de explorador nueva.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-279">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="1aa7f-280">La visualización del material inicial es el mismo que el primer explorador y los cambios se realizan simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-280">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="1aa7f-281">Cierre todos los exploradores y abra un nuevo explorador, vaya a la misma dirección URL.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-281">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="1aa7f-282">El objeto singleton StockTicker ha continuado ejecutar en el servidor, por lo que la presentación de la tabla stock muestra que siguieron las poblaciones a cambiar.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-282">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="1aa7f-283">(No se ve en la tabla con cero inicial cambiar cifras.)</span><span class="sxs-lookup"><span data-stu-id="1aa7f-283">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="1aa7f-284">Cierre el explorador.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-284">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="1aa7f-285">Habilite el registro</span><span class="sxs-lookup"><span data-stu-id="1aa7f-285">Enable logging</span></span>

<span data-ttu-id="1aa7f-286">SignalR tiene una función de registro integrados que se puede habilitar en el cliente para ayudar a solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-286">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="1aa7f-287">En esta sección Habilitar el registro y vea los ejemplos que muestran cómo los registros de indican qué de los siguientes métodos de transporte usa SignalR:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-287">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="1aa7f-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), admitido por IIS 8 y los exploradores actuales.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="1aa7f-289">[Eventos de servidor envió](http://en.wikipedia.org/wiki/Server-sent_events), admitido por los exploradores distintos de Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-289">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="1aa7f-290">[Marco para siempre](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), admitido por Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="1aa7f-291">[AJAX de sondeo prolongado](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), compatible con todos los exploradores.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-291">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="1aa7f-292">En una conexión determinada, SignalR elige el mejor método de transporte que admiten el servidor y el cliente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-292">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="1aa7f-293">Abra *StockTicker.js* y agregue una línea de código para habilitar el registro inmediatamente antes del código que inicializa la conexión al final del archivo:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-293">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample19.js)]
2. <span data-ttu-id="1aa7f-294">Presione F5 para ejecutar el proyecto.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-294">Press F5 to run the project.</span></span>
3. <span data-ttu-id="1aa7f-295">Abra la ventana de herramientas de desarrollador de su explorador y seleccione la consola para ver los registros.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-295">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="1aa7f-296">Es posible que deba actualizar la página para ver los registros de Signalr negocie el método de transporte para una conexión nueva.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-296">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="1aa7f-297">Si está ejecutando Internet Explorer 10 en Windows 8 (IIS 8), el método de transporte es WebSockets.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-297">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Consola de IE 10 IIS 8](tutorial-server-broadcast-with-signalr/_static/image9.png)

    <span data-ttu-id="1aa7f-299">Si está ejecutando Internet Explorer 10 en Windows 7 (IIS 7.5), el método de transporte es iframe.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-299">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![Consola IE 10, IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image10.png)

    <span data-ttu-id="1aa7f-301">En Firefox, instale el complemento Firebug para obtener una ventana de consola.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-301">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="1aa7f-302">Si está ejecutando el 19 de Firefox en Windows 8 (IIS 8), el método de transporte es WebSockets.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-302">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 Websockets](tutorial-server-broadcast-with-signalr/_static/image11.png)

    <span data-ttu-id="1aa7f-304">Si está ejecutando el 19 de Firefox en Windows 7 (IIS 7.5), el método de transporte es eventos enviados por el servidor.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-304">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Consola de IIS 7.5 Firefox 19](tutorial-server-broadcast-with-signalr/_static/image12.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="1aa7f-306">Instalar y revise el ejemplo StockTicker completo</span><span class="sxs-lookup"><span data-stu-id="1aa7f-306">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="1aa7f-307">La aplicación StockTicker instalado por el [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) paquete NuGet incluye más características que la versión simplificada que acaba de crear desde cero.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-307">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="1aa7f-308">En esta sección del tutorial, instale el paquete NuGet y revise las nuevas características y el código que implementa en ellos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-308">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span> <span data-ttu-id="1aa7f-309">Si instala el paquete sin necesidad de realizar los pasos anteriores de este tutorial, debe agregar una clase de inicio OWIN al proyecto.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-309">If you install the package without performing the earlier steps of this tutorial, you must add an OWIN startup class to your project.</span></span> <span data-ttu-id="1aa7f-310">Este paso se explica en el archivo readme.txt del paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-310">This step is explained in the readme.txt file for the NuGet package.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="1aa7f-311">Instale el paquete SignalR.Sample NuGet</span><span class="sxs-lookup"><span data-stu-id="1aa7f-311">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="1aa7f-312">En **el Explorador de soluciones**, haga clic en el proyecto y haga clic en **administrar paquetes de NuGet**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-312">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="1aa7f-313">En el **administrar paquetes de NuGet** cuadro de diálogo, haga clic en **Online**, escriba *SignalR.Sample* en el **buscar en línea** cuadro y, a continuación, haga clic en  **Instalar** en el **SignalR.Sample** paquete.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-313">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Instalar paquete SignalR.Sample](tutorial-server-broadcast-with-signalr/_static/image13.png)
3. <span data-ttu-id="1aa7f-315">En **el Explorador de soluciones**, expanda el *SignalR.Sample* carpeta que se creó al instalar el paquete SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-315">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
4. <span data-ttu-id="1aa7f-316">En el *SignalR.Sample* carpeta, haga clic en *StockTicker.html*y, a continuación, haga clic en **establecer como página principal**.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-316">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="1aa7f-317">Instalación de SignalR.Sample NuGet el paquete podría cambiar la versión de jQuery que tiene en su *Scripts* carpeta.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-317">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="1aa7f-318">El nuevo *StockTicker.html* archivo que instala el paquete en el *SignalR.Sample* carpeta estará sincronizado con la versión de jQuery que instala el paquete, pero si desea ejecutar el original *StockTicker.html* archivo nuevo, es posible que deba actualizar la referencia de jQuery en la etiqueta de script en primer lugar.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-318">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="1aa7f-319">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="1aa7f-319">Run the application</span></span>

1. <span data-ttu-id="1aa7f-320">Presione F5 para ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-320">Press F5 to run the application.</span></span>

    <span data-ttu-id="1aa7f-321">Además de la cuadrícula que vio anteriormente, la aplicación de tablero de cotizaciones completa muestra una ventana de desplazamiento horizontal que muestra los mismos datos de stock.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-321">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="1aa7f-322">Al ejecutar la aplicación por primera vez, el mercado"" es "closed" y verá una cuadrícula estática y una ventana del indicador que no es el desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-322">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![Inicio de la pantalla de StockTicker](tutorial-server-broadcast-with-signalr/_static/image14.png)

    <span data-ttu-id="1aa7f-324">Al hacer clic en **Open Market**, **Live bolsa** cuadro comienza a desplazarse horizontalmente y se inicia el servidor para difundir periódicamente los cambios de precio de las acciones de forma aleatoria.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-324">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="1aa7f-325">Cada vez que una cotización cambia tanto el **Live tabla Stock** cuadrícula y el **tablero de cotizaciones en directo** cuadro se actualizan.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-325">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="1aa7f-326">Cuando cambie el precio de una acción es positivo, se muestra el paquete de acciones con un fondo verde, y cuando el cambio es negativo, se muestra el paquete de acciones con un fondo rojo.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-326">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Mercado de aplicación StockTicker, abrir](tutorial-server-broadcast-with-signalr/_static/image15.png)

    <span data-ttu-id="1aa7f-328">El **mercado cerrar** botón deja de los cambios y el desplazamiento del tablero y el **restablecer** botón restablece todos los datos de acciones al estado inicial antes de iniciar los cambios de precio.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-328">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="1aa7f-329">Si abre más ventanas del explorador y vaya a la misma dirección URL, verá los mismos datos que se actualiza dinámicamente al mismo tiempo en cada explorador.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-329">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="1aa7f-330">Al hacer clic en uno de los botones, todos los exploradores responden la misma manera a la vez.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-330">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="1aa7f-331">Visualización de tablero de cotizaciones en directo</span><span class="sxs-lookup"><span data-stu-id="1aa7f-331">Live Stock Ticker display</span></span>

<span data-ttu-id="1aa7f-332">El **Live bolsa** presentación es una lista sin ordenar en un elemento div que tiene el formato en una sola línea con los estilos CSS.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-332">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="1aa7f-333">El teletipo se inicializa y se actualiza la misma manera que la tabla: reemplazando los marcadores de posición en una &lt;li&gt; cadena de plantilla y agregar dinámicamente la &lt;li&gt; elementos a la &lt;ul&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-333">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="1aa7f-334">El desplazamiento se realiza mediante la función animar jQuery para variar el margen izquierda de la lista sin ordenar en el elemento div.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-334">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="1aa7f-335">El tablero de cotizaciones HTML:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-335">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample20.html)]

<span data-ttu-id="1aa7f-336">El tablero de cotizaciones CSS:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-336">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample21.html)]

<span data-ttu-id="1aa7f-337">Desplácese por el código jQuery que hace:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-337">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample22.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="1aa7f-338">Métodos adicionales en el servidor que el cliente puede llamar a</span><span class="sxs-lookup"><span data-stu-id="1aa7f-338">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="1aa7f-339">La clase StockTickerHub define cuatro métodos adicionales que puede llamar el cliente:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-339">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample23.cs)]

<span data-ttu-id="1aa7f-340">En respuesta a los botones en la parte superior de la página se denominan OpenMarket, CloseMarket y restablecimiento.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-340">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="1aa7f-341">Muestra el patrón de un cliente desencadenar un cambio de estado que se propaga inmediatamente a todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-341">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="1aa7f-342">Cada uno de estos métodos llama a un método en la clase StockTicker que afecte el estado de mercado cambiar y, a continuación, transmite el estado nueva.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-342">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="1aa7f-343">En la clase StockTicker, se mantiene el estado del mercado por una propiedad MarketState que devuelve un valor de enumeración MarketState:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-343">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample24.cs)]

<span data-ttu-id="1aa7f-344">Cada uno de los métodos que cambian el estado de mercado hacerlo dentro de un bloqueo porque la clase StockTicker debe ser seguro para subprocesos:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-344">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample25.cs)]

<span data-ttu-id="1aa7f-345">Para asegurarse de que este código es seguro para subprocesos, el \_marketState campo que respalda la propiedad MarketState se marca como volátil,</span><span class="sxs-lookup"><span data-stu-id="1aa7f-345">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample26.cs)]

<span data-ttu-id="1aa7f-346">Los métodos BroadcastMarketStateChange y BroadcastMarketReset son similares al método BroadcastStockPrice que ya hemos visto, salvo que llaman a diferentes métodos definidos en el cliente:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-346">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample27.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="1aa7f-347">Funciones adicionales en el cliente que el servidor puede llamar a</span><span class="sxs-lookup"><span data-stu-id="1aa7f-347">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="1aa7f-348">La función updateStockPrice ahora controla la cuadrícula y la presentación de tableros de cotizaciones y usa jQuery.Color parpadea colores verde y rojo.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-348">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="1aa7f-349">Nuevas funciones en *SignalR.StockTicker.js* habilitar y deshabilitar los botones basados en estado de mercado, y detener o iniciar el desplazamiento horizontal de teletipo ventana.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-349">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="1aa7f-350">Puesto que se agregan varias funciones para ticker.client, el [jQuery ampliar la función](http://api.jquery.com/jQuery.extend/) se usa para agregarlos.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-350">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample28.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="1aa7f-351">Programa de instalación de cliente adicionales después de establecer la conexión</span><span class="sxs-lookup"><span data-stu-id="1aa7f-351">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="1aa7f-352">Una vez que el cliente establece la conexión, tiene cierto trabajo adicional para hacer: averiguar si el mercado está abierto o cerrado con el fin de llamar a la función de marketClosed o marketOpened adecuado y asociar las llamadas al método de servidor a los botones.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-352">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample29.js)]

<span data-ttu-id="1aa7f-353">Los métodos de servidor no son conecté los botones hasta que una vez establecida la conexión, para que el código no se puede tratar de llamar a los métodos de servidor para que estén disponibles.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-353">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="1aa7f-354">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="1aa7f-354">Next steps</span></span>

<span data-ttu-id="1aa7f-355">En este tutorial ha aprendido cómo programar una aplicación de SignalR que transmite mensajes desde el servidor a todos los clientes conectados tanto de forma periódica en respuesta a las notificaciones desde cualquier cliente.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-355">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="1aa7f-356">El patrón de uso de una instancia singleton de multiproceso para mantener el estado del servidor también puede usarse también en escenarios de juego en línea multijugador.</span><span class="sxs-lookup"><span data-stu-id="1aa7f-356">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="1aa7f-357">Para obtener un ejemplo, vea [ShootR juego basado en SignalR](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-357">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="1aa7f-358">Para ver tutoriales que muestran escenarios de comunicación punto a punto, consulte [Introducción a SignalR](introduction-to-signalr.md) y [actualizar en tiempo real con SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-358">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](introduction-to-signalr.md) and [Real-Time Updating with SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span></span>

<span data-ttu-id="1aa7f-359">Para obtener información sobre los conceptos más avanzados de desarrollo de SignalR, visite los sitios siguientes para recursos y código fuente de SignalR:</span><span class="sxs-lookup"><span data-stu-id="1aa7f-359">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="1aa7f-360">SignalR de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="1aa7f-360">ASP.NET SignalR</span></span>](../../index.md)
- [<span data-ttu-id="1aa7f-361">Proyecto de SignalR</span><span class="sxs-lookup"><span data-stu-id="1aa7f-361">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="1aa7f-362">SignalR Github y ejemplos</span><span class="sxs-lookup"><span data-stu-id="1aa7f-362">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="1aa7f-363">SignalR Wiki</span><span class="sxs-lookup"><span data-stu-id="1aa7f-363">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)

<span data-ttu-id="1aa7f-364">Para ver un tutorial sobre cómo implementar una aplicación de SignalR en Azure, consulte [usando SignalR con Web Apps en Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-364">For a walkthrough on how to deploy a SignalR application to Azure, see [Using SignalR with Web Apps in Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span></span> <span data-ttu-id="1aa7f-365">Para obtener información detallada sobre cómo implementar un proyecto web de Visual Studio a un sitio Web de Windows Azure, consulte [crear una aplicación web ASP.NET en Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span><span class="sxs-lookup"><span data-stu-id="1aa7f-365">For detailed information about how to deploy a Visual Studio web project to a Windows Azure Web Site, see [Create an ASP.NET web app in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span></span>
