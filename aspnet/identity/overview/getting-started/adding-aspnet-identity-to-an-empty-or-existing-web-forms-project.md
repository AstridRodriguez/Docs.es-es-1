---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: "Agregar la identidad de ASP.NET a un Web existente o vacía Forms proyecto | Documentos de Microsoft"
author: raquelsa
description: "Este tutorial muestra cómo agregar identidades de ASP.NET (el nuevo sistema de pertenencia de ASP.NET) a una aplicación ASP.NET. Cuando se crea un nuevo formularios Web Forms o MVC..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/23/2013
ms.topic: article
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 3ab67b93a32106c0b79f9e8d739d47835391edb5
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/24/2018
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="a6888-104">Proyecto de forma de agregar identidades de ASP.NET a un Web vacío o existente</span><span class="sxs-lookup"><span data-stu-id="a6888-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="a6888-105">por [Raquel Soares Alemania Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="a6888-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="a6888-106">Este tutorial muestra cómo agregar [ASP.NET Identity](introduction-to-aspnet-identity.md) (el nuevo sistema de pertenencia de ASP.NET) a una aplicación ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a6888-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="a6888-107">Cuando crea un nuevo proyecto de formularios Web Forms o MVC en Visual Studio 2013 RTM con cuentas individuales, Visual Studio instalará todos los paquetes necesarios y agregar todas las clases necesarias para usted.</span><span class="sxs-lookup"><span data-stu-id="a6888-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="a6888-108">Este tutorial muestra los pasos para agregar compatibilidad de ASP.NET Identity para el proyecto de formularios Web Forms existente o un nuevo proyecto vacío.</span><span class="sxs-lookup"><span data-stu-id="a6888-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="a6888-109">Se resumirán todos los paquetes de NuGet que se debe instalar y clases que se debe agregar.</span><span class="sxs-lookup"><span data-stu-id="a6888-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="a6888-110">Pasará a través de formularios Web Forms de ejemplo para registrar los nuevos usuarios y el registro mientras resalta todas las API de punto de entrada principal para la autenticación y administración de usuarios.</span><span class="sxs-lookup"><span data-stu-id="a6888-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="a6888-111">Este ejemplo usará la implementación predeterminada de ASP.NET Identity para el almacenamiento de datos SQL que se basa en Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="a6888-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="a6888-112">Este tutorial, usaremos LocalDB para la base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="a6888-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="a6888-113">Este tutorial se escribió Raquel Soares De Almeida y Rick Anderson ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="a6888-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="a6888-114">Introducción a la identidad de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="a6888-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="a6888-115">Empiece por instalar y ejecutar [Visual Studio Express 2013 para Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="a6888-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="a6888-116">Haga clic en **nuevo proyecto** desde el principio página, o puede utilizar el menú y seleccione **archivo**y, a continuación, **nuevo proyecto**.</span><span class="sxs-lookup"><span data-stu-id="a6888-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="a6888-117">Seleccione **Visual C# i** n el panel izquierdo, a continuación, **Web** y, a continuación, seleccione **aplicación Web ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="a6888-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="a6888-118">Denomine el proyecto "WebFormsIdentity" y, a continuación, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="a6888-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="a6888-119">En el **nuevo proyecto ASP.NET** cuadro de diálogo, seleccione la **vacía** plantilla.</span><span class="sxs-lookup"><span data-stu-id="a6888-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
 <span data-ttu-id="a6888-120">Observe el **Cambiar autenticación** botón está deshabilitado y no hay compatibilidad con la autenticación se proporciona en esta plantilla.</span><span class="sxs-lookup"><span data-stu-id="a6888-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="a6888-121">Las plantillas de formularios Web Forms, MVC y API Web le permiten seleccionar el método de autenticación.</span><span class="sxs-lookup"><span data-stu-id="a6888-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="a6888-122">Para obtener más información, consulte [información general de la autenticación](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span><span class="sxs-lookup"><span data-stu-id="a6888-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="a6888-123">Agregar paquetes de identidad a la aplicación</span><span class="sxs-lookup"><span data-stu-id="a6888-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="a6888-124">En el Explorador de soluciones, haga clic en el proyecto y seleccione **administrar paquetes de NuGet**.</span><span class="sxs-lookup"><span data-stu-id="a6888-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="a6888-125">En el cuadro de diálogo de cuadro de texto de búsqueda, escriba "*Identity.E*".</span><span class="sxs-lookup"><span data-stu-id="a6888-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="a6888-126">Haga clic en instalar para este paquete.</span><span class="sxs-lookup"><span data-stu-id="a6888-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="a6888-127">Tenga en cuenta que este paquete instalará los paquetes de dependencia: Entity Framework y Microsoft ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="a6888-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="a6888-128">Adición de formularios Web Forms para registrar los usuarios</span><span class="sxs-lookup"><span data-stu-id="a6888-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="a6888-129">En **el Explorador de soluciones**, haga clic en el proyecto y haga clic en **agregar**y, a continuación, **formulario Web**.</span><span class="sxs-lookup"><span data-stu-id="a6888-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="a6888-130">En el **especificar nombre para el elemento** cuadro de diálogo, el nombre del nuevo formulario web **registrar**y, a continuación, haga clic en **Aceptar**</span><span class="sxs-lookup"><span data-stu-id="a6888-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="a6888-131">Reemplace el marcado en generado *Register.aspx* archivo con el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="a6888-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="a6888-132">Se resaltan los cambios de código.</span><span class="sxs-lookup"><span data-stu-id="a6888-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="a6888-133">Esto es simplemente una versión simplificada de la *Register.aspx* archivo que se crea cuando se crea un nuevo proyecto de formularios Web Forms de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a6888-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="a6888-134">El marcado anterior agrega campos de formulario y un botón para registrar un nuevo usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="a6888-135">Abra la *Register.aspx.cs* archivo y reemplace el contenido del archivo con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="a6888-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="a6888-136">El código anterior es una versión simplificada de la *Register.aspx.cs* archivo que se crea cuando se crea un nuevo proyecto de formularios Web Forms de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a6888-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="a6888-137">El *IdentityUser* clase es la implementación de EntityFramework predeterminada de la *IUser* interfaz.</span><span class="sxs-lookup"><span data-stu-id="a6888-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="a6888-138">*IUser* interfaz es la interfaz básica para un usuario en ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="a6888-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="a6888-139">El *UserStore* clase es la implementación de EntityFramework predeterminada de un almacén de usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="a6888-140">Esta clase implementa interfaces mínimas de ASP.NET Identity Core: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* y *IUserRoleStore* .</span><span class="sxs-lookup"><span data-stu-id="a6888-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="a6888-141">El *UserManager* clase expone usuario relacionados con las API que guardarán automáticamente los cambios realizados en el *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="a6888-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="a6888-142">El *IdentityResult* clase representa el resultado de una operación de identidad.</span><span class="sxs-lookup"><span data-stu-id="a6888-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="a6888-143">En **el Explorador de soluciones**, haga clic en el proyecto y haga clic en **agregar**, **Agregar carpeta ASP.NET** y, a continuación, **aplicación\_datos**.</span><span class="sxs-lookup"><span data-stu-id="a6888-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="a6888-144">Abra la *Web.config* de archivos y agregue una entrada de cadena de conexión para la base de datos que se usará para almacenar información del usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="a6888-145">Se creará la base de datos en tiempo de ejecución por Entity Framework para las entidades de identidad.</span><span class="sxs-lookup"><span data-stu-id="a6888-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="a6888-146">La cadena de conexión es similar a la que se crea automáticamente al crear un nuevo proyecto de formularios Web Forms.</span><span class="sxs-lookup"><span data-stu-id="a6888-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="a6888-147">El código resaltado muestra el marcado que debe agregar:</span><span class="sxs-lookup"><span data-stu-id="a6888-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="a6888-148">Para Visual Studio 2015 o versiones posteriores, reemplace `(localdb)\v11.0` con `(localdb)\MSSQLLocalDB` en la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="a6888-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="a6888-149">Haga clic en el archivo *Register.aspx* en el proyecto y seleccione **establecer como página de inicio**.</span><span class="sxs-lookup"><span data-stu-id="a6888-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="a6888-150">Presione Ctrl + F5 para compilar y ejecutar la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="a6888-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="a6888-151">Escriba un nuevo nombre de usuario y una contraseña y, a continuación, haga clic en **registrar**.</span><span class="sxs-lookup"><span data-stu-id="a6888-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="a6888-152">ASP.NET Identity tiene compatibilidad para la validación y en este ejemplo puede comprobar el comportamiento predeterminado del usuario y contraseña validadores que proceden del paquete principal de identidad.</span><span class="sxs-lookup"><span data-stu-id="a6888-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="a6888-153">El validador de manera predeterminada para el usuario (`UserValidator`) tiene una propiedad `AllowOnlyAlphanumericUserNames` que tiene el valor predeterminado establecido en `true`.</span><span class="sxs-lookup"><span data-stu-id="a6888-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="a6888-154">El validador predeterminado para la contraseña (`MinimumLengthValidator`) garantiza que la contraseña tenga al menos 6 caracteres.</span><span class="sxs-lookup"><span data-stu-id="a6888-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="a6888-155">Validadores de estas propiedades se encuentran en `UserManager` que se puede invalidar si desea tener validación personalizada,</span><span class="sxs-lookup"><span data-stu-id="a6888-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="a6888-156">Comprobar la base de datos de identidad de LocalDb y las tablas generadas por Entity Framework</span><span class="sxs-lookup"><span data-stu-id="a6888-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="a6888-157">En el **vista** menú, haga clic en **Explorador de servidores**.</span><span class="sxs-lookup"><span data-stu-id="a6888-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="a6888-158">Expanda **DefaultConnection (WebFormsIdentity)**, expanda **tablas**, haga clic en **AspNetUsers** y haga clic en **mostrar datos de tabla**.</span><span class="sxs-lookup"><span data-stu-id="a6888-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="a6888-159">Configuración de la aplicación para la autenticación de OWIN</span><span class="sxs-lookup"><span data-stu-id="a6888-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="a6888-160">En este momento sólo hemos agregado compatibilidad para la creación de usuarios.</span><span class="sxs-lookup"><span data-stu-id="a6888-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="a6888-161">Ahora, vamos a mostrar cómo podemos agregar autenticación para iniciar sesión un usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="a6888-162">Identidad de ASP.NET usa middleware de autenticación de Microsoft OWIN para la autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="a6888-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="a6888-163">La autenticación con cookies OWIN es una cookie y reclama el mecanismo de autenticación basada en que se puede usar cualquier marco de trabajo hospedado en [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) o IIS.</span><span class="sxs-lookup"><span data-stu-id="a6888-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="a6888-164">Con este modelo, los mismos paquetes de autenticación pueden utilizarse en varios entornos, incluidos ASP.NET MVC y formularios Web Forms.</span><span class="sxs-lookup"><span data-stu-id="a6888-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="a6888-165">Para obtener más información sobre el proyecto Katana y cómo ejecutar middleware en un host independiente, vea [introducción con el proyecto de Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="a6888-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="a6888-166">Instalación de paquetes de autenticación en la aplicación</span><span class="sxs-lookup"><span data-stu-id="a6888-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="a6888-167">En el Explorador de soluciones, haga clic en el proyecto y seleccione **administrar paquetes de NuGet**.</span><span class="sxs-lookup"><span data-stu-id="a6888-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="a6888-168">En el cuadro de diálogo de cuadro de texto de búsqueda, escriba "*Identity.Owin*".</span><span class="sxs-lookup"><span data-stu-id="a6888-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="a6888-169">Haga clic en instalar para este paquete.</span><span class="sxs-lookup"><span data-stu-id="a6888-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="a6888-170">Busque el paquete ***Microsoft.Owin.Host.SystemWeb*** e instalarlo.</span><span class="sxs-lookup"><span data-stu-id="a6888-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="a6888-171">El **Microsoft.Aspnet.Identity.Owin** paquete contiene un conjunto de clases de extensión OWIN para administrar y configurar el middleware de autenticación OWIN a ser consumidos por los paquetes de ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="a6888-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="a6888-172">El **Microsoft.Owin.Host.SystemWeb** paquete contiene un servidor OWIN que permite que aplicaciones basadas en OWIN para ejecutar en IIS mediante la canalización de solicitudes ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a6888-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="a6888-173">Para obtener más información, consulte [Middleware de OWIN en IIS integrado canalización](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="a6888-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="a6888-174">Agregar clases de configuración de autenticación y de inicio de OWIN</span><span class="sxs-lookup"><span data-stu-id="a6888-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="a6888-175">En **el Explorador de soluciones**, haga clic en el proyecto, haga clic en **agregar**y, a continuación, **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a6888-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="a6888-176">En el cuadro de diálogo de cuadro de texto de búsqueda, escriba "*owin*".</span><span class="sxs-lookup"><span data-stu-id="a6888-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="a6888-177">La clase el nombre "*inicio*" y haga clic en **agregar**.</span><span class="sxs-lookup"><span data-stu-id="a6888-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="a6888-178">En el archivo Startup.cs, agregue el código resaltado que se muestra a continuación para configurar la autenticación de cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="a6888-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="a6888-179">Esta clase contiene la `OwinStartup` atributo para especificar la clase de inicio OWIN.</span><span class="sxs-lookup"><span data-stu-id="a6888-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="a6888-180">Todas las aplicaciones OWIN tiene una clase de inicio donde se especifican los componentes de la canalización de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a6888-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="a6888-181">Vea [detección de clase de inicio de OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) para obtener más información sobre este modelo.</span><span class="sxs-lookup"><span data-stu-id="a6888-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="a6888-182">Adición de formularios Web Forms para registrar e iniciar sesión a los usuarios</span><span class="sxs-lookup"><span data-stu-id="a6888-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="a6888-183">Abra la *Register.cs* de archivos y agregue el código siguiente a la que se registrará en el usuario al registro es satisfactorio.</span><span class="sxs-lookup"><span data-stu-id="a6888-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="a6888-184">A continuación, se resaltan los cambios.</span><span class="sxs-lookup"><span data-stu-id="a6888-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="a6888-185">Puesto que ASP.NET Identity y autenticación con cookies OWIN son sistema basada en notificaciones, el marco de trabajo requiere que el desarrollador de aplicaciones generar un [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) para el usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="a6888-186">Valor de ClaimsIdentity incluye información sobre todas las notificaciones para el usuario, como los Roles que pertenece el usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="a6888-187">También puede agregar más notificaciones para el usuario en esta fase.</span><span class="sxs-lookup"><span data-stu-id="a6888-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="a6888-188">Puede iniciar sesión en el usuario mediante el uso de la clase AuthenticationManager de OWIN y llamar al método `SignIn` y pasar el valor de ClaimsIdentity como se indicó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="a6888-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="a6888-189">Este código se inicie sesión en el usuario y generar también un cookie.</span><span class="sxs-lookup"><span data-stu-id="a6888-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="a6888-190">Esta llamada es análoga a [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilizado por el [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) módulo.</span><span class="sxs-lookup"><span data-stu-id="a6888-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="a6888-191">En **el Explorador de soluciones**, haga clic en el proyecto, haga clic **agregar**y, a continuación, **formulario Web**.</span><span class="sxs-lookup"><span data-stu-id="a6888-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="a6888-192">Un nombre al formulario web **inicio de sesión**.</span><span class="sxs-lookup"><span data-stu-id="a6888-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="a6888-193">Reemplace el contenido de la *Login.aspx* archivo con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="a6888-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="a6888-194">Reemplace el contenido de la *Login.aspx.cs* archivo con lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="a6888-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="a6888-195">El `Page_Load` ahora comprueba el estado de usuario actual y toma medidas en función de su `Context.User.Identity.IsAuthenticated` estado.</span><span class="sxs-lookup"><span data-stu-id="a6888-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="a6888-196">**Mostrar Logged en nombre de usuario** : The Microsoft ASP.NET Identity Framework incorpora métodos de extensión en [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) que le permite obtener la `UserName` y `UserId` para el Usuario ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="a6888-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="a6888-197">Estos métodos de extensión se definen en la `Microsoft.AspNet.Identity.Core` ensamblado.</span><span class="sxs-lookup"><span data-stu-id="a6888-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="a6888-198">Estos métodos de extensión son el sustituto de [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="a6888-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="a6888-199">Método de inicio de sesión:</span><span class="sxs-lookup"><span data-stu-id="a6888-199">SignIn method:</span></span>   
    >     <span data-ttu-id="a6888-200">`This`método reemplaza la anterior `CreateUser_Click` método en este ejemplo y ahora los signos de usuario después de crear correctamente el usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="a6888-201">El marco de trabajo de Microsoft OWIN incorpora métodos de extensión en `System.Web.HttpContext` que le permite obtener una referencia a un `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="a6888-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="a6888-202">Estos métodos de extensión se definen en `Microsoft.Owin.Host.SystemWeb` ensamblado.</span><span class="sxs-lookup"><span data-stu-id="a6888-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="a6888-203">El `OwinContext` clase expone un `IAuthenticationManager` propiedad que representa la funcionalidad de middleware de autenticación disponible en la solicitud actual.</span><span class="sxs-lookup"><span data-stu-id="a6888-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="a6888-204">Puede iniciar sesión en el usuario mediante el uso de la `AuthenticationManager` de OWIN y llamar al método `SignIn` y pasando el `ClaimsIdentity` como se indicó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="a6888-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="a6888-205">Dado que ASP.NET Identity y autenticación con cookies OWIN son sistema basado en notificaciones, el marco de trabajo requiere la aplicación para generar un `ClaimsIdentity` para el usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="a6888-206">El `ClaimsIdentity` tiene información sobre todas las notificaciones para el usuario, como los roles que pertenece el usuario.</span><span class="sxs-lookup"><span data-stu-id="a6888-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="a6888-207">También puede agregar más notificaciones para el usuario en esta fase</span><span class="sxs-lookup"><span data-stu-id="a6888-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="a6888-208">Este código se inicie sesión en el usuario y generar también un cookie.</span><span class="sxs-lookup"><span data-stu-id="a6888-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="a6888-209">Esta llamada es análoga a [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilizado por el [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) módulo.</span><span class="sxs-lookup"><span data-stu-id="a6888-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="a6888-210">`SignOut`método:</span><span class="sxs-lookup"><span data-stu-id="a6888-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="a6888-211">Obtiene una referencia a la `AuthenticationManager` OWIN y llama `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="a6888-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="a6888-212">Esto es análogo a [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) método utilizado por el [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) módulo.</span><span class="sxs-lookup"><span data-stu-id="a6888-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="a6888-213">Presione **Ctrl + F5** para compilar y ejecutar la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="a6888-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="a6888-214">Escriba un nuevo nombre de usuario y una contraseña y, a continuación, haga clic en **registrar**.</span><span class="sxs-lookup"><span data-stu-id="a6888-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
 <span data-ttu-id="a6888-215">Nota: en este momento, el nuevo usuario se crea y registra en.</span><span class="sxs-lookup"><span data-stu-id="a6888-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="a6888-216">Haga clic en **cerrar sesión** botón. Se le redirigirá en el registro en el formulario.</span><span class="sxs-lookup"><span data-stu-id="a6888-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="a6888-217">Escriba un nombre de usuario no válido o su contraseña y haga clic **sesión** botón.</span><span class="sxs-lookup"><span data-stu-id="a6888-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
 <span data-ttu-id="a6888-218">El `UserManager.Find` método devolverá null y el mensaje de error: " *nombre de usuario no válido o la contraseña* " se mostrará.</span><span class="sxs-lookup"><span data-stu-id="a6888-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
