---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrar datos de proveedor Universal para la suscripción y perfiles de usuario para la identidad de ASP.NET (C#) | Documentos de Microsoft
author: rustd
description: Este tutorial describen los pasos necesarios migrar datos de las funciones y del usuario y los datos de perfil de usuario creados con proveedores universales de una aplicación existente...
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/13/2013
ms.topic: article
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: f65f93b20543d06ea70a9009b6921e297477c99e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/06/2018
---
<a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="5b4d1-103">Migrar datos de proveedor Universal para la suscripción y perfiles de usuario para la identidad de ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="5b4d1-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>
====================
<span data-ttu-id="5b4d1-104">por [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="5b4d1-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="5b4d1-105">Este tutorial describen los pasos necesarios migrar datos de las funciones y del usuario y los datos de perfil de usuario creados con proveedores universales de una aplicación existente para el modelo de identidad de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="5b4d1-106">El enfoque mencionados aquí puede usarse migrar datos de perfil de usuario en una aplicación con la suscripción SQL también.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>


<span data-ttu-id="5b4d1-107">Con la versión de Visual Studio 2013, el equipo de ASP.NET introdujo un nuevo sistema de ASP.NET Identity y puede leer más acerca de esa versión [aquí](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="5b4d1-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="5b4d1-108">En el artículo que se va a migrar las aplicaciones web de [pertenencia de SQL en el nuevo sistema de identidad](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), este artículo explica los pasos para migrar aplicaciones existentes que siguen el modelo de proveedores para la administración de usuarios y roles en el nuevo modelo de identidad.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="5b4d1-109">El objetivo de este tutorial será principalmente sobre cómo migrar los datos de perfil de usuario para enlazarlo sin problemas en el nuevo sistema.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="5b4d1-110">Migrar la información de usuario y el rol es similar para la suscripción SQL.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="5b4d1-111">El enfoque de seguir para migrar datos de perfil puede usarse en una aplicación con la suscripción SQL también.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="5b4d1-112">Por ejemplo, empezaremos con una aplicación web creada con Visual Studio 2012 que usa el modelo de proveedores.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="5b4d1-113">Se podrá, a continuación, agregue código para la administración de perfiles, registrar un usuario, agregar datos de perfil para los usuarios, migrar el esquema de base de datos y, a continuación, cambie la aplicación para usar el sistema de identidades de usuario y administración de funciones.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="5b4d1-114">Como una prueba de migración, los usuarios creados mediante proveedores universales deben ser podrán iniciar sesión y deben ser capaz de registrar los nuevos usuarios.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="5b4d1-115">Puede encontrar el ejemplo completo en [ https://github.com/suhasj/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="5b4d1-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>


## <a name="profile-data-migration-summary"></a><span data-ttu-id="5b4d1-116">Resumen de migración de datos de perfil</span><span class="sxs-lookup"><span data-stu-id="5b4d1-116">Profile data migration summary</span></span>

<span data-ttu-id="5b4d1-117">Antes de comenzar con las migraciones, echemos un vistazo a la experiencia de almacenamiento de datos de perfil en el modelo de proveedores.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="5b4d1-118">Datos de perfil de aplicación a los usuarios se pueden almacenar en varias formas, los más comunes entre ellos está utilizando el perfil integrado proveedores enviados junto con los proveedores universales.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="5b4d1-119">Incluyen los pasos</span><span class="sxs-lookup"><span data-stu-id="5b4d1-119">The steps would include</span></span>

1. <span data-ttu-id="5b4d1-120">Agregar una clase que tiene propiedades que se usan para almacenar los datos de perfil.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="5b4d1-121">Agregue una clase que extiende 'ProfileBase' e implementa métodos para obtener los datos de perfil descritos anteriormente para el usuario.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="5b4d1-122">Habilitar el uso de proveedores de perfiles de forma predeterminada en el *web.config* de archivos y definir la clase declarada en el paso 2 de # que se utilizará al obtener acceso a la información de perfil.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="5b4d1-123">La información de perfil se almacena como datos binarios en la tabla 'Perfiles' de la base de datos y xml serializado.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="5b4d1-124">Después de migrar la aplicación para utilizar el nuevo sistema de identidad de ASP.NET, la información de perfil se deserializa y se almacenan como propiedades en la clase de usuario.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="5b4d1-125">Cada propiedad, a continuación, se asignan a columnas de la tabla de usuario.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="5b4d1-126">Aquí la ventaja es que las propiedades pueden trabajar directamente con la clase de usuario además de no tener que serializar o deserializar la información de datos cada vez cuando se obtiene acceso.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="5b4d1-127">Introducción</span><span class="sxs-lookup"><span data-stu-id="5b4d1-127">Getting Started</span></span>

1. <span data-ttu-id="5b4d1-128">Cree una nueva aplicación de formularios Web Forms de ASP.NET 4.5 en Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="5b4d1-129">El ejemplo actual usa la plantilla de formularios Web Forms, pero podría utilizar aplicación MVC también.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="5b4d1-130">Crear una nueva carpeta 'Modelos' para almacenar información de perfil</span><span class="sxs-lookup"><span data-stu-id="5b4d1-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="5b4d1-131">Por ejemplo, almacenar háganoslo la fecha de nacimiento, ciudad, alto y peso del usuario en el perfil.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="5b4d1-132">El alto y el peso se almacenan como una clase personalizada denominada 'PersonalStats'.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="5b4d1-133">Para almacenar y recuperar el perfil, se necesita una clase que extiende 'ProfileBase'.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="5b4d1-134">Vamos a crear una nueva clase 'AppProfile' para obtener y almacenar información de perfil.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="5b4d1-135">Habilitar el perfil en el *web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="5b4d1-136">Escriba el nombre de clase que se utilizará para almacenar o recuperar información de usuario creada en el paso 3 de #.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="5b4d1-137">Agregar una página de formularios web en la carpeta 'Account' para obtener los datos del perfil del usuario y los almacene.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="5b4d1-138">Haga clic con el botón secundario en el proyecto y seleccione 'Agregar nuevo elemento'.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="5b4d1-139">Agregue una nueva página de formularios Web Forms con página maestra 'AddProfileData.aspx'.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="5b4d1-140">Copie lo siguiente en la sección 'MainContent':</span><span class="sxs-lookup"><span data-stu-id="5b4d1-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="5b4d1-141">Agregue el código siguiente en el código subyacente:</span><span class="sxs-lookup"><span data-stu-id="5b4d1-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="5b4d1-142">Agregue el espacio de nombres bajo qué AppProfile se define la clase para quitar los errores de compilación.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="5b4d1-143">Ejecutar la aplicación y crear un nuevo usuario con el nombre de usuario '**olduser'.**</span><span class="sxs-lookup"><span data-stu-id="5b4d1-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="5b4d1-144">Navegue a la página 'AddProfileData' y agregue información de perfil para el usuario.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="5b4d1-145">Puede comprobar que los datos se almacenan como xml serializado en la tabla 'Perfiles' mediante la ventana del explorador de servidores.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="5b4d1-146">En Visual Studio, desde el menú "Ver", elija 'Explorador de servidores'.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="5b4d1-147">Debería haber una conexión de datos para la base de datos definido en el *web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="5b4d1-148">Al hacer clic en la conexión de datos muestra las categorías de sub diferentes.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="5b4d1-149">Expanda 'Tablas' para mostrar las distintas tablas en la base de datos, a continuación, haga clic con el botón secundario en "Perfiles" y elegir "Mostrar datos de tabla' para ver los datos de perfil que se almacenan en la tabla de perfiles.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="5b4d1-150">Migrar el esquema de base de datos</span><span class="sxs-lookup"><span data-stu-id="5b4d1-150">Migrating database schema</span></span>

<span data-ttu-id="5b4d1-151">Para que la base de datos existente que funcione con el sistema de identidad, es necesario actualizar el esquema en la base de datos de identidad para admitir los campos que se agregan a la base de datos original.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="5b4d1-152">Esto puede hacerse mediante secuencias de comandos SQL para crear nuevas tablas y copiar la información existente.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="5b4d1-153">En la ventana 'Explorador de servidores de ', expanda el 'DefaultConnection' para mostrar las tablas.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="5b4d1-154">Haga clic en tablas y seleccione 'Nueva consulta'</span><span class="sxs-lookup"><span data-stu-id="5b4d1-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="5b4d1-155">Pegue el script SQL de [ https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt ](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) y ejecútelo.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="5b4d1-156">Si se actualiza 'DefaultConnection', podemos ver que se agregan las nuevas tablas.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="5b4d1-157">Puede comprobar los datos dentro de las tablas para ver que la información se ha migrado.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="5b4d1-158">Migrar la aplicación para utilizar la identidad de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="5b4d1-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="5b4d1-159">Instalar los paquetes de Nuget necesarios para la identidad de ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="5b4d1-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="5b4d1-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="5b4d1-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="5b4d1-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="5b4d1-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="5b4d1-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="5b4d1-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="5b4d1-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="5b4d1-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="5b4d1-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="5b4d1-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="5b4d1-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="5b4d1-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="5b4d1-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="5b4d1-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="5b4d1-167">Puede encontrar más información acerca de cómo administrar paquetes de Nuget [aquí](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span><span class="sxs-lookup"><span data-stu-id="5b4d1-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="5b4d1-168">Para trabajar con los datos existentes en la tabla, es necesario crear clases de modelo que se asignan a las tablas y enlazar en el sistema de identidades.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="5b4d1-169">Como parte del contrato de identidad, las clases del modelo deben implementar las interfaces definidas en el archivo dll Identity.Core o amplían la implementación existente de estas interfaces disponibles en Microsoft.AspNet.Identity.EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="5b4d1-170">Vamos a usar las clases existentes para el rol, los inicios de sesión de usuario y notificaciones de usuario.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="5b4d1-171">Es necesario utilizar un usuario personalizado para nuestro ejemplo.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="5b4d1-172">Haga clic con el botón secundario en el proyecto y crear nueva carpeta 'IdentityModels'.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="5b4d1-173">Agregue una nueva clase de 'User' tal y como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="5b4d1-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="5b4d1-174">Tenga en cuenta que 'ProfileInfo' ahora es una propiedad en la clase de usuario.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="5b4d1-175">Por lo tanto, podemos usar la clase de usuario para trabajar directamente con datos de perfil.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="5b4d1-176">Copie los archivos en el **IdentityModels** y **IdentityAccount** carpetas desde el origen de la descarga ( [ https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="5b4d1-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="5b4d1-177">Estos tienen las demás clases del modelo y las nuevas páginas necesarias para el usuario y administración de roles mediante las API de identidad de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="5b4d1-178">El enfoque usado es similar a la pertenencia de SQL y se puede encontrar una explicación detallada [aquí](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="5b4d1-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="5b4d1-179">Copiar datos de perfil en las nuevas tablas</span><span class="sxs-lookup"><span data-stu-id="5b4d1-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="5b4d1-180">Como se mencionó anteriormente, es necesario deserializar los datos xml en las tablas de perfiles y los almacene en las columnas de la tabla AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="5b4d1-181">Las nuevas columnas creadas en la tabla de usuarios en el paso anterior, por lo que todo lo que queda es rellenar las columnas con los datos necesarios.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="5b4d1-182">Para ello, usamos una aplicación de consola que se ejecuta una vez para rellenar las columnas recién creadas en la tabla de usuarios.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="5b4d1-183">Cree una nueva aplicación de consola en la solución existente.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="5b4d1-184">Instale la versión más reciente del paquete de Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="5b4d1-185">Agregar la aplicación web creado anteriormente como una referencia a la aplicación de consola.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="5b4d1-186">Para hacer esto derecho haga clic en proyecto, 'Agregar referencias a', a continuación, la solución, a continuación, haga clic en el proyecto y haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="5b4d1-187">Copie el siguiente código en la clase Program.cs.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="5b4d1-188">Esta lógica lee los datos de perfil para cada usuario, lo serializa como objeto 'ProfileInfo' y lo almacena en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="5b4d1-189">Algunos de los modelos usados se definen en la carpeta 'IdentityModels' del proyecto de aplicación web, por lo que debe incluir los espacios de nombres correspondiente.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="5b4d1-190">El código anterior funciona en el archivo de base de datos en la aplicación\_crear carpeta de datos del proyecto de aplicación web en los pasos anteriores.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="5b4d1-191">Para hacer referencia a, actualizar la cadena de conexión en el archivo app.config de la aplicación de consola con la cadena de conexión en el archivo web.config de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="5b4d1-192">También proporcionan la ruta de acceso física completa en la propiedad 'AttachDbFilename'.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="5b4d1-193">Abra un símbolo del sistema y navegue hasta la carpeta bin de la aplicación de consola anterior.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="5b4d1-194">Ejecute el archivo ejecutable y revise los resultados del registro tal como se muestra en la siguiente imagen.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="5b4d1-195">Abra la tabla 'AspNetUsers' en el Explorador de servidores y comprobar los datos en las nuevas columnas que contengan las propiedades.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="5b4d1-196">Se deben actualizar con los valores de propiedad correspondiente.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="5b4d1-197">Comprobar la funcionalidad</span><span class="sxs-lookup"><span data-stu-id="5b4d1-197">Verify functionality</span></span>

<span data-ttu-id="5b4d1-198">Use las páginas de pertenencia recién agregado que se implementan mediante ASP.NET Identity que inicie sesión un usuario de la base de datos anterior.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="5b4d1-199">El usuario debe ser capaz de iniciar sesión con las mismas credenciales.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="5b4d1-200">Pruebe las otras funcionalidades como agregar OAuth, crear un nuevo usuario, cambio de contraseñas, la adición de roles, agregar usuarios a roles, etcetera.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="5b4d1-201">Los datos de perfil para el usuario anterior y los nuevos usuarios se deben recuperar y almacenan en la tabla de usuarios.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="5b4d1-202">Ya no se debe hacer referencia a la tabla anterior.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="5b4d1-203">Conclusión</span><span class="sxs-lookup"><span data-stu-id="5b4d1-203">Conclusion</span></span>

<span data-ttu-id="5b4d1-204">El artículo describe el proceso de migración de aplicaciones web que usan el modelo de proveedor de pertenencia a ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="5b4d1-205">Además, el artículo describe migrar datos de perfil para que los usuarios se puede enlazar en el sistema de identidades.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="5b4d1-206">Por favor, deje sus comentarios a continuación para resolver dudas y problemas que surgen al migrar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5b4d1-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="5b4d1-207">*Gracias a Rick Anderson y Robert McMurray para revisar el artículo.*</span><span class="sxs-lookup"><span data-stu-id="5b4d1-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
